/*! For license information please see bundle.min.js.LICENSE.txt */
!function(){var __webpack_modules__={58:function(module,__unused_webpack_exports,__webpack_require__){"use strict";function _interopDefault(ex){return ex&&"object"==typeof ex&&"default"in ex?ex.default:ex}var util=_interopDefault(__webpack_require__(296)),Heap=_interopDefault(__webpack_require__(485)),get=_interopDefault(__webpack_require__(208)),set=_interopDefault(__webpack_require__(468)),toPath=_interopDefault(__webpack_require__(782));function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var window$1="undefined"==typeof window?null:window,navigator=window$1?window$1.navigator:null,typeofstr=(window$1&&window$1.document,_typeof("")),typeofobj=_typeof({}),typeoffn=_typeof((function(){})),typeofhtmlele="undefined"==typeof HTMLElement?"undefined":_typeof(HTMLElement),instanceStr=function instanceStr(obj){return obj&&obj.instanceString&&fn(obj.instanceString)?obj.instanceString():null},string=function string(obj){return null!=obj&&_typeof(obj)==typeofstr},fn=function fn(obj){return null!=obj&&_typeof(obj)===typeoffn},array=function array(obj){return!elementOrCollection(obj)&&(Array.isArray?Array.isArray(obj):null!=obj&&obj instanceof Array)},plainObject=function plainObject(obj){return null!=obj&&_typeof(obj)===typeofobj&&!array(obj)&&obj.constructor===Object},number=function number(obj){return null!=obj&&_typeof(obj)===_typeof(1)&&!isNaN(obj)},htmlElement=function htmlElement(obj){return"undefined"===typeofhtmlele?void 0:null!=obj&&obj instanceof HTMLElement},elementOrCollection=function elementOrCollection(obj){return element(obj)||collection(obj)},element=function element(obj){return"collection"===instanceStr(obj)&&obj._private.single},collection=function collection(obj){return"collection"===instanceStr(obj)&&!obj._private.single},core=function core(obj){return"core"===instanceStr(obj)},stylesheet=function stylesheet(obj){return"stylesheet"===instanceStr(obj)},emptyString=function emptyString(obj){return null==obj||!(""!==obj&&!obj.match(/^\s+$/))},promise=function promise(obj){return function object(obj){return null!=obj&&_typeof(obj)===typeofobj}(obj)&&fn(obj.then)},memoize=function memoize(fn,keyFn){keyFn||(keyFn=function keyFn(){if(1===arguments.length)return arguments[0];if(0===arguments.length)return"undefined";for(var args=[],i=0;i<arguments.length;i++)args.push(arguments[i]);return args.join("$")});var memoizedFn=function memoizedFn(){var ret,self=this,args=arguments,k=keyFn.apply(self,args),cache=memoizedFn.cache;return(ret=cache[k])||(ret=cache[k]=fn.apply(self,args)),ret};return memoizedFn.cache={},memoizedFn},camel2dash=memoize((function(str){return str.replace(/([A-Z])/g,(function(v){return"-"+v.toLowerCase()}))})),dash2camel=memoize((function(str){return str.replace(/(-\w)/g,(function(v){return v[1].toUpperCase()}))})),prependCamel=memoize((function(prefix,str){return prefix+str[0].toUpperCase()+str.substring(1)}),(function(prefix,str){return prefix+"$"+str})),capitalize=function capitalize(str){return emptyString(str)?str:str.charAt(0).toUpperCase()+str.substring(1)},number$1="(?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))",ascending=function ascending(a,b){return a<b?-1:a>b?1:0},extend=null!=Object.assign?Object.assign.bind(Object):function(tgt){for(var args=arguments,i=1;i<args.length;i++){var obj=args[i];if(null!=obj)for(var keys=Object.keys(obj),j=0;j<keys.length;j++){var k=keys[j];tgt[k]=obj[k]}}return tgt},color2tuple=function color2tuple(color){return(array(color)?color:null)||function colorname2tuple(color){return colors[color.toLowerCase()]}(color)||function hex2tuple(hex){var r,g,b;if((4===hex.length||7===hex.length)&&"#"===hex[0])return 4===hex.length?(r=parseInt(hex[1]+hex[1],16),g=parseInt(hex[2]+hex[2],16),b=parseInt(hex[3]+hex[3],16)):(r=parseInt(hex[1]+hex[2],16),g=parseInt(hex[3]+hex[4],16),b=parseInt(hex[5]+hex[6],16)),[r,g,b]}(color)||function rgb2tuple(rgb){var ret,m=new RegExp("^rgb[a]?\\(((?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))[%]?)\\s*,\\s*((?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))[%]?)\\s*,\\s*((?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))[%]?)(?:\\s*,\\s*((?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))))?\\)$").exec(rgb);if(m){ret=[];for(var isPct=[],i=1;i<=3;i++){var channel=m[i];if("%"===channel[channel.length-1]&&(isPct[i]=!0),channel=parseFloat(channel),isPct[i]&&(channel=channel/100*255),channel<0||channel>255)return;ret.push(Math.floor(channel))}var atLeastOneIsPct=isPct[1]||isPct[2]||isPct[3],allArePct=isPct[1]&&isPct[2]&&isPct[3];if(atLeastOneIsPct&&!allArePct)return;var alpha=m[4];if(void 0!==alpha){if((alpha=parseFloat(alpha))<0||alpha>1)return;ret.push(alpha)}}return ret}(color)||function hsl2tuple(hsl){var ret,h,s,l,a,r,g,b;function hue2rgb(p,q,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?p+6*(q-p)*t:t<.5?q:t<2/3?p+(q-p)*(2/3-t)*6:p}var m=new RegExp("^hsl[a]?\\(((?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?)))\\s*,\\s*((?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))[%])\\s*,\\s*((?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))[%])(?:\\s*,\\s*((?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))))?\\)$").exec(hsl);if(m){if((h=parseInt(m[1]))<0?h=(360- -1*h%360)%360:h>360&&(h%=360),h/=360,(s=parseFloat(m[2]))<0||s>100)return;if(s/=100,(l=parseFloat(m[3]))<0||l>100)return;if(l/=100,void 0!==(a=m[4])&&((a=parseFloat(a))<0||a>1))return;if(0===s)r=g=b=Math.round(255*l);else{var q=l<.5?l*(1+s):l+s-l*s,p=2*l-q;r=Math.round(255*hue2rgb(p,q,h+1/3)),g=Math.round(255*hue2rgb(p,q,h)),b=Math.round(255*hue2rgb(p,q,h-1/3))}ret=[r,g,b,a]}return ret}(color)},colors={transparent:[0,0,0,0],aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],grey:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},setMap=function setMap(options){for(var obj=options.map,keys=options.keys,l=keys.length,i=0;i<l;i++){var key=keys[i];if(plainObject(key))throw Error("Tried to set map with object key");i<keys.length-1?(null==obj[key]&&(obj[key]={}),obj=obj[key]):obj[key]=options.value}},getMap=function getMap(options){for(var obj=options.map,keys=options.keys,l=keys.length,i=0;i<l;i++){var key=keys[i];if(plainObject(key))throw Error("Tried to get map with object key");if(null==(obj=obj[key]))return obj}return obj},performance=window$1?window$1.performance:null,pnow=performance&&performance.now?function(){return performance.now()}:function(){return Date.now()},raf=function(){if(window$1){if(window$1.requestAnimationFrame)return function(fn){window$1.requestAnimationFrame(fn)};if(window$1.mozRequestAnimationFrame)return function(fn){window$1.mozRequestAnimationFrame(fn)};if(window$1.webkitRequestAnimationFrame)return function(fn){window$1.webkitRequestAnimationFrame(fn)};if(window$1.msRequestAnimationFrame)return function(fn){window$1.msRequestAnimationFrame(fn)}}return function(fn){fn&&setTimeout((function(){fn(pnow())}),1e3/60)}}(),requestAnimationFrame=function requestAnimationFrame(fn){return raf(fn)},performanceNow=pnow,K=65599,hashIterableInts=function hashIterableInts(iterator){for(var entry,seed=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9261,hash=seed;!(entry=iterator.next()).done;)hash=hash*K+entry.value|0;return hash},hashInt=function hashInt(num){var seed=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9261;return seed*K+num|0},hashIntAlt=function hashIntAlt(num){var seed=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5381;return(seed<<5)+seed+num|0},combineHashesArray=function combineHashesArray(hashes){return 2097152*hashes[0]+hashes[1]},hashArrays=function hashArrays(hashes1,hashes2){return[hashInt(hashes1[0],hashes2[0]),hashIntAlt(hashes1[1],hashes2[1])]},hashString=function hashString(str,seed){var entry={value:0,done:!1},i=0,length=str.length;return hashIterableInts({next:function next(){return i<length?entry.value=str.charCodeAt(i++):entry.done=!0,entry}},seed)},hashStrings=function hashStrings(){return hashStringsArray(arguments)},hashStringsArray=function hashStringsArray(strs){for(var hash,i=0;i<strs.length;i++){var str=strs[i];hash=0===i?hashString(str):hashString(str,hash)}return hash},warningsEnabled=!0,warnSupported=null!=console.warn,traceSupported=null!=console.trace,MAX_INT=Number.MAX_SAFE_INTEGER||9007199254740991,trueify=function trueify(){return!0},falsify=function falsify(){return!1},zeroify=function zeroify(){return 0},noop=function noop(){},error=function error(msg){throw new Error(msg)},warnings=function warnings(enabled){if(void 0===enabled)return warningsEnabled;warningsEnabled=!!enabled},warn=function warn(msg){warnings()&&(warnSupported?console.warn(msg):(console.log(msg),traceSupported&&console.trace()))},copy=function copy(obj){return null==obj?obj:array(obj)?obj.slice():plainObject(obj)?function clone(obj){return extend({},obj)}(obj):obj},uuid=function uuid(a,b){for(b=a="";a++<36;b+=51*a&52?(15^a?8^Math.random()*(20^a?16:4):4).toString(16):"-");return b},_staticEmptyObject={},staticEmptyObject=function staticEmptyObject(){return _staticEmptyObject},defaults=function defaults(_defaults){var keys=Object.keys(_defaults);return function(opts){for(var filledOpts={},i=0;i<keys.length;i++){var key=keys[i],optVal=null==opts?void 0:opts[key];filledOpts[key]=void 0===optVal?_defaults[key]:optVal}return filledOpts}},removeFromArray=function removeFromArray(arr,ele,oneCopy){for(var i=arr.length-1;i>=0&&(arr[i]!==ele||(arr.splice(i,1),!oneCopy));i--);},clearArray=function clearArray(arr){arr.splice(0,arr.length)},getPrefixedProperty=function getPrefixedProperty(obj,propName,prefix){return prefix&&(propName=prependCamel(prefix,propName)),obj[propName]},setPrefixedProperty=function setPrefixedProperty(obj,propName,prefix,value){prefix&&(propName=prependCamel(prefix,propName)),obj[propName]=value},Map$1="undefined"!=typeof Map?Map:function(){function ObjectMap(){_classCallCheck(this,ObjectMap),this._obj={}}return _createClass(ObjectMap,[{key:"set",value:function set(key,val){return this._obj[key]=val,this}},{key:"delete",value:function _delete(key){return this._obj[key]=void 0,this}},{key:"clear",value:function clear(){this._obj={}}},{key:"has",value:function has(key){return void 0!==this._obj[key]}},{key:"get",value:function get(key){return this._obj[key]}}]),ObjectMap}(),ObjectSet=function(){function ObjectSet(arrayOrObjectSet){if(_classCallCheck(this,ObjectSet),this._obj=Object.create(null),this.size=0,null!=arrayOrObjectSet){var arr;arr=null!=arrayOrObjectSet.instanceString&&arrayOrObjectSet.instanceString()===this.instanceString()?arrayOrObjectSet.toArray():arrayOrObjectSet;for(var i=0;i<arr.length;i++)this.add(arr[i])}}return _createClass(ObjectSet,[{key:"instanceString",value:function instanceString(){return"set"}},{key:"add",value:function add(val){var o=this._obj;1!==o[val]&&(o[val]=1,this.size++)}},{key:"delete",value:function _delete(val){var o=this._obj;1===o[val]&&(o[val]=0,this.size--)}},{key:"clear",value:function clear(){this._obj=Object.create(null)}},{key:"has",value:function has(val){return 1===this._obj[val]}},{key:"toArray",value:function toArray(){var _this=this;return Object.keys(this._obj).filter((function(key){return _this.has(key)}))}},{key:"forEach",value:function forEach(callback,thisArg){return this.toArray().forEach(callback,thisArg)}}]),ObjectSet}(),Set$1="undefined"!==("undefined"==typeof Set?"undefined":_typeof(Set))?Set:ObjectSet,Element=function Element(cy,params){var restore=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(void 0!==cy&&void 0!==params&&core(cy)){var group=params.group;if(null==group&&(group=params.data&&null!=params.data.source&&null!=params.data.target?"edges":"nodes"),"nodes"===group||"edges"===group){this.length=1,this[0]=this;var _p=this._private={cy:cy,single:!0,data:params.data||{},position:params.position||{x:0,y:0},autoWidth:void 0,autoHeight:void 0,autoPadding:void 0,compoundBoundsClean:!1,listeners:[],group:group,style:{},rstyle:{},styleCxts:[],styleKeys:{},removed:!0,selected:!!params.selected,selectable:void 0===params.selectable||!!params.selectable,locked:!!params.locked,grabbed:!1,grabbable:void 0===params.grabbable||!!params.grabbable,pannable:void 0===params.pannable?"edges"===group:!!params.pannable,active:!1,classes:new Set$1,animation:{current:[],queue:[]},rscratch:{},scratch:params.scratch||{},edges:[],children:[],parent:null,traversalCache:{},backgrounding:!1,bbCache:null,bbCacheShift:{x:0,y:0},bodyBounds:null,overlayBounds:null,labelBounds:{all:null,source:null,target:null,main:null},arrowBounds:{source:null,target:null,"mid-source":null,"mid-target":null}};if(null==_p.position.x&&(_p.position.x=0),null==_p.position.y&&(_p.position.y=0),params.renderedPosition){var rpos=params.renderedPosition,pan=cy.pan(),zoom=cy.zoom();_p.position={x:(rpos.x-pan.x)/zoom,y:(rpos.y-pan.y)/zoom}}var classes=[];array(params.classes)?classes=params.classes:string(params.classes)&&(classes=params.classes.split(/\s+/));for(var i=0,l=classes.length;i<l;i++){var cls=classes[i];cls&&""!==cls&&_p.classes.add(cls)}this.createEmitter();var bypass=params.style||params.css;bypass&&(warn("Setting a `style` bypass at element creation should be done only when absolutely necessary.  Try to use the stylesheet instead."),this.style(bypass)),(void 0===restore||restore)&&this.restore()}else error("An element must be of type `nodes` or `edges`; you specified `"+group+"`")}else error("An element must have a core reference and parameters set")},defineSearch=function defineSearch(params){return params={bfs:params.bfs||!params.dfs,dfs:params.dfs||!params.bfs},function searchFn(roots,fn$1,directed){var options;plainObject(roots)&&!elementOrCollection(roots)&&(roots=(options=roots).roots||options.root,fn$1=options.visit,directed=options.directed),directed=2!==arguments.length||fn(fn$1)?directed:fn$1,fn$1=fn(fn$1)?fn$1:function(){};for(var found,cy=this._private.cy,v=roots=string(roots)?this.filter(roots):roots,Q=[],connectedNodes=[],connectedBy={},id2depth={},V={},j=0,_this$byGroup=this.byGroup(),nodes=_this$byGroup.nodes,edges=_this$byGroup.edges,i=0;i<v.length;i++){var vi=v[i],viId=vi.id();vi.isNode()&&(Q.unshift(vi),params.bfs&&(V[viId]=!0,connectedNodes.push(vi)),id2depth[viId]=0)}var _loop2=function _loop2(){var v=params.bfs?Q.shift():Q.pop(),vId=v.id();if(params.dfs){if(V[vId])return"continue";V[vId]=!0,connectedNodes.push(v)}var ret,depth=id2depth[vId],prevEdge=connectedBy[vId],src=null!=prevEdge?prevEdge.source():null,tgt=null!=prevEdge?prevEdge.target():null,prevNode=null==prevEdge?void 0:v.same(src)?tgt[0]:src[0];if(!0===(ret=fn$1(v,prevEdge,prevNode,j++,depth)))return found=v,"break";if(!1===ret)return"break";for(var vwEdges=v.connectedEdges().filter((function(e){return(!directed||e.source().same(v))&&edges.has(e)})),_i2=0;_i2<vwEdges.length;_i2++){var e=vwEdges[_i2],w=e.connectedNodes().filter((function(n){return!n.same(v)&&nodes.has(n)})),wId=w.id();0===w.length||V[wId]||(w=w[0],Q.push(w),params.bfs&&(V[wId]=!0,connectedNodes.push(w)),connectedBy[wId]=e,id2depth[wId]=id2depth[vId]+1)}};_loop:for(;0!==Q.length;){var _ret=_loop2();switch(_ret){case"continue":continue;case"break":break _loop}}for(var connectedEles=cy.collection(),_i=0;_i<connectedNodes.length;_i++){var node=connectedNodes[_i],edge=connectedBy[node.id()];null!=edge&&connectedEles.push(edge),connectedEles.push(node)}return{path:cy.collection(connectedEles),found:cy.collection(found)}}},elesfn={breadthFirstSearch:defineSearch({bfs:!0}),depthFirstSearch:defineSearch({dfs:!0})};elesfn.bfs=elesfn.breadthFirstSearch,elesfn.dfs=elesfn.depthFirstSearch;var dijkstraDefaults=defaults({root:null,weight:function weight(edge){return 1},directed:!1}),elesfn$1={dijkstra:function dijkstra(options){if(!plainObject(options)){var args=arguments;options={root:args[0],weight:args[1],directed:args[2]}}var _dijkstraDefaults=dijkstraDefaults(options),root=_dijkstraDefaults.root,weight=_dijkstraDefaults.weight,directed=_dijkstraDefaults.directed,eles=this,weightFn=weight,source=string(root)?this.filter(root)[0]:root[0],dist={},prev={},knownDist={},_this$byGroup=this.byGroup(),nodes=_this$byGroup.nodes,edges=_this$byGroup.edges;edges.unmergeBy((function(ele){return ele.isLoop()}));for(var getDist=function getDist(node){return dist[node.id()]},setDist=function setDist(node,d){dist[node.id()]=d,Q.updateItem(node)},Q=new Heap((function(a,b){return getDist(a)-getDist(b)})),i=0;i<nodes.length;i++){var node=nodes[i];dist[node.id()]=node.same(source)?0:1/0,Q.push(node)}for(var distBetween=function distBetween(u,v){for(var smallestEdge,uvs=(directed?u.edgesTo(v):u.edgesWith(v)).intersect(edges),smallestDistance=1/0,_i=0;_i<uvs.length;_i++){var edge=uvs[_i],_weight=weightFn(edge);(_weight<smallestDistance||!smallestEdge)&&(smallestDistance=_weight,smallestEdge=edge)}return{edge:smallestEdge,dist:smallestDistance}};Q.size()>0;){var u=Q.pop(),smalletsDist=getDist(u),uid=u.id();if(knownDist[uid]=smalletsDist,smalletsDist!==1/0)for(var neighbors=u.neighborhood().intersect(nodes),_i2=0;_i2<neighbors.length;_i2++){var v=neighbors[_i2],vid=v.id(),vDist=distBetween(u,v),alt=smalletsDist+vDist.dist;alt<getDist(v)&&(setDist(v,alt),prev[vid]={node:u,edge:vDist.edge})}}return{distanceTo:function distanceTo(node){var target=string(node)?nodes.filter(node)[0]:node[0];return knownDist[target.id()]},pathTo:function pathTo(node){var target=string(node)?nodes.filter(node)[0]:node[0],S=[],u=target,uid=u.id();if(target.length>0)for(S.unshift(target);prev[uid];){var p=prev[uid];S.unshift(p.edge),S.unshift(p.node),uid=(u=p.node).id()}return eles.spawn(S)}}}},elesfn$2={kruskal:function kruskal(weightFn){weightFn=weightFn||function(edge){return 1};for(var _this$byGroup=this.byGroup(),nodes=_this$byGroup.nodes,edges=_this$byGroup.edges,numNodes=nodes.length,forest=new Array(numNodes),A=nodes,findSetIndex=function findSetIndex(ele){for(var i=0;i<forest.length;i++){if(forest[i].has(ele))return i}},i=0;i<numNodes;i++)forest[i]=this.spawn(nodes[i]);for(var S=edges.sort((function(a,b){return weightFn(a)-weightFn(b)})),_i=0;_i<S.length;_i++){var edge=S[_i],u=edge.source()[0],v=edge.target()[0],setUIndex=findSetIndex(u),setVIndex=findSetIndex(v),setU=forest[setUIndex],setV=forest[setVIndex];setUIndex!==setVIndex&&(A.merge(edge),setU.merge(setV),forest.splice(setVIndex,1))}return A}},aStarDefaults=defaults({root:null,goal:null,weight:function weight(edge){return 1},heuristic:function heuristic(edge){return 0},directed:!1}),elesfn$3={aStar:function aStar(options){var cy=this.cy(),_aStarDefaults=aStarDefaults(options),root=_aStarDefaults.root,goal=_aStarDefaults.goal,heuristic=_aStarDefaults.heuristic,directed=_aStarDefaults.directed,weight=_aStarDefaults.weight;root=cy.collection(root)[0],goal=cy.collection(goal)[0];var cMin,cMinId,sid=root.id(),tid=goal.id(),gScore={},fScore={},closedSetIds={},openSet=new Heap((function(a,b){return fScore[a.id()]-fScore[b.id()]})),openSetIds=new Set$1,cameFrom={},cameFromEdge={},addToOpenSet=function addToOpenSet(ele,id){openSet.push(ele),openSetIds.add(id)},popFromOpenSet=function popFromOpenSet(){cMin=openSet.pop(),cMinId=cMin.id(),openSetIds.delete(cMinId)},isInOpenSet=function isInOpenSet(id){return openSetIds.has(id)};addToOpenSet(root,sid),gScore[sid]=0,fScore[sid]=heuristic(root);for(var steps=0;openSet.size()>0;){if(popFromOpenSet(),steps++,cMinId===tid){for(var path=[],pathNode=goal,pathNodeId=tid,pathEdge=cameFromEdge[pathNodeId];path.unshift(pathNode),null!=pathEdge&&path.unshift(pathEdge),null!=(pathNode=cameFrom[pathNodeId]);)pathEdge=cameFromEdge[pathNodeId=pathNode.id()];return{found:!0,distance:gScore[cMinId],path:this.spawn(path),steps:steps}}closedSetIds[cMinId]=!0;for(var vwEdges=cMin._private.edges,i=0;i<vwEdges.length;i++){var e=vwEdges[i];if(this.hasElementWithId(e.id())&&(!directed||e.data("source")===cMinId)){var wSrc=e.source(),wTgt=e.target(),w=wSrc.id()!==cMinId?wSrc:wTgt,wid=w.id();if(this.hasElementWithId(wid)&&!closedSetIds[wid]){var tempScore=gScore[cMinId]+weight(e);isInOpenSet(wid)?tempScore<gScore[wid]&&(gScore[wid]=tempScore,fScore[wid]=tempScore+heuristic(w),cameFrom[wid]=cMin,cameFromEdge[wid]=e):(gScore[wid]=tempScore,fScore[wid]=tempScore+heuristic(w),addToOpenSet(w,wid),cameFrom[wid]=cMin,cameFromEdge[wid]=e)}}}}return{found:!1,distance:void 0,path:void 0,steps:steps}}},floydWarshallDefaults=defaults({weight:function weight(edge){return 1},directed:!1}),elesfn$4={floydWarshall:function floydWarshall(options){for(var cy=this.cy(),_floydWarshallDefault=floydWarshallDefaults(options),weight=_floydWarshallDefault.weight,directed=_floydWarshallDefault.directed,weightFn=weight,_this$byGroup=this.byGroup(),nodes=_this$byGroup.nodes,edges=_this$byGroup.edges,N=nodes.length,Nsq=N*N,indexOf=function indexOf(node){return nodes.indexOf(node)},atIndex=function atIndex(i){return nodes[i]},dist=new Array(Nsq),n=0;n<Nsq;n++){var j=n%N,i=(n-j)/N;dist[n]=i===j?0:1/0}for(var next=new Array(Nsq),edgeNext=new Array(Nsq),_i=0;_i<edges.length;_i++){var edge=edges[_i],src=edge.source()[0],tgt=edge.target()[0];if(src!==tgt){var s=indexOf(src),t=indexOf(tgt),st=s*N+t,_weight=weightFn(edge);if(dist[st]>_weight&&(dist[st]=_weight,next[st]=t,edgeNext[st]=edge),!directed){var ts=t*N+s;!directed&&dist[ts]>_weight&&(dist[ts]=_weight,next[ts]=s,edgeNext[ts]=edge)}}}for(var k=0;k<N;k++)for(var _i2=0;_i2<N;_i2++)for(var ik=_i2*N+k,_j=0;_j<N;_j++){var ij=_i2*N+_j,kj=k*N+_j;dist[ik]+dist[kj]<dist[ij]&&(dist[ij]=dist[ik]+dist[kj],next[ij]=next[ik])}var indexOfArgEle=function indexOfArgEle(ele){return indexOf(function getArgEle(ele){return(string(ele)?cy.filter(ele):ele)[0]}(ele))},res={distance:function distance(from,to){var i=indexOfArgEle(from),j=indexOfArgEle(to);return dist[i*N+j]},path:function path(from,to){var i=indexOfArgEle(from),j=indexOfArgEle(to),fromNode=atIndex(i);if(i===j)return fromNode.collection();if(null==next[i*N+j])return cy.collection();var edge,path=cy.collection(),prev=i;for(path.merge(fromNode);i!==j;)prev=i,i=next[i*N+j],edge=edgeNext[prev*N+i],path.merge(edge),path.merge(atIndex(i));return path}};return res}},bellmanFordDefaults=defaults({weight:function weight(edge){return 1},directed:!1,root:null}),elesfn$5={bellmanFord:function bellmanFord(options){var _this=this,_bellmanFordDefaults=bellmanFordDefaults(options),weight=_bellmanFordDefaults.weight,directed=_bellmanFordDefaults.directed,root=_bellmanFordDefaults.root,weightFn=weight,eles=this,cy=this.cy(),_this$byGroup=this.byGroup(),edges=_this$byGroup.edges,nodes=_this$byGroup.nodes,numNodes=nodes.length,infoMap=new Map$1,hasNegativeWeightCycle=!1,negativeWeightCycles=[];root=cy.collection(root)[0],edges.unmergeBy((function(edge){return edge.isLoop()}));for(var numEdges=edges.length,getInfo=function getInfo(node){var obj=infoMap.get(node.id());return obj||(obj={},infoMap.set(node.id(),obj)),obj},getNodeFromTo=function getNodeFromTo(to){return(string(to)?cy.$(to):to)[0]},i=0;i<numNodes;i++){var node=nodes[i],info=getInfo(node);node.same(root)?info.dist=0:info.dist=1/0,info.pred=null,info.edge=null}for(var replacedEdge=!1,checkForEdgeReplacement=function checkForEdgeReplacement(node1,node2,edge,info1,info2,weight){var dist=info1.dist+weight;dist<info2.dist&&!edge.same(info1.edge)&&(info2.dist=dist,info2.pred=node1,info2.edge=edge,replacedEdge=!0)},_i=1;_i<numNodes;_i++){replacedEdge=!1;for(var e=0;e<numEdges;e++){var edge=edges[e],src=edge.source(),tgt=edge.target(),_weight=weightFn(edge),srcInfo=getInfo(src),tgtInfo=getInfo(tgt);checkForEdgeReplacement(src,0,edge,srcInfo,tgtInfo,_weight),directed||checkForEdgeReplacement(tgt,0,edge,tgtInfo,srcInfo,_weight)}if(!replacedEdge)break}if(replacedEdge)for(var negativeWeightCycleIds=[],_e=0;_e<numEdges;_e++){var _edge=edges[_e],_src=_edge.source(),_tgt=_edge.target(),_weight2=weightFn(_edge),srcDist=getInfo(_src).dist,tgtDist=getInfo(_tgt).dist;if(srcDist+_weight2<tgtDist||!directed&&tgtDist+_weight2<srcDist){if(hasNegativeWeightCycle||(warn("Graph contains a negative weight cycle for Bellman-Ford"),hasNegativeWeightCycle=!0),!1===options.findNegativeWeightCycles)break;var negativeNodes=[];srcDist+_weight2<tgtDist&&negativeNodes.push(_src),!directed&&tgtDist+_weight2<srcDist&&negativeNodes.push(_tgt);for(var numNegativeNodes=negativeNodes.length,n=0;n<numNegativeNodes;n++){var start=negativeNodes[n],cycle=[start];cycle.push(getInfo(start).edge);for(var _node=getInfo(start).pred;-1===cycle.indexOf(_node);)cycle.push(_node),cycle.push(getInfo(_node).edge),_node=getInfo(_node).pred;for(var smallestId=(cycle=cycle.slice(cycle.indexOf(_node)))[0].id(),smallestIndex=0,c=2;c<cycle.length;c+=2)cycle[c].id()<smallestId&&(smallestId=cycle[c].id(),smallestIndex=c);(cycle=cycle.slice(smallestIndex).concat(cycle.slice(0,smallestIndex))).push(cycle[0]);var cycleId=cycle.map((function(el){return el.id()})).join(",");-1===negativeWeightCycleIds.indexOf(cycleId)&&(negativeWeightCycles.push(eles.spawn(cycle)),negativeWeightCycleIds.push(cycleId))}}}return{distanceTo:function distanceTo(to){return getInfo(getNodeFromTo(to)).dist},pathTo:function pathTo(to){for(var thisStart=arguments.length>1&&void 0!==arguments[1]?arguments[1]:root,end=getNodeFromTo(to),path=[],node=end;;){if(null==node)return _this.spawn();var _getInfo=getInfo(node),edge=_getInfo.edge,pred=_getInfo.pred;if(path.unshift(node[0]),node.same(thisStart)&&path.length>0)break;null!=edge&&path.unshift(edge),node=pred}return eles.spawn(path)},hasNegativeWeightCycle:hasNegativeWeightCycle,negativeWeightCycles:negativeWeightCycles}}},sqrt2=Math.sqrt(2),collapse=function collapse(edgeIndex,nodeMap,remainingEdges){0===remainingEdges.length&&error("Karger-Stein must be run on a connected (sub)graph");for(var edgeInfo=remainingEdges[edgeIndex],sourceIn=edgeInfo[1],targetIn=edgeInfo[2],partition1=nodeMap[sourceIn],partition2=nodeMap[targetIn],newEdges=remainingEdges,i=newEdges.length-1;i>=0;i--){var edge=newEdges[i],src=edge[1],tgt=edge[2];(nodeMap[src]===partition1&&nodeMap[tgt]===partition2||nodeMap[src]===partition2&&nodeMap[tgt]===partition1)&&newEdges.splice(i,1)}for(var _i=0;_i<newEdges.length;_i++){var _edge=newEdges[_i];_edge[1]===partition2?(newEdges[_i]=_edge.slice(),newEdges[_i][1]=partition1):_edge[2]===partition2&&(newEdges[_i]=_edge.slice(),newEdges[_i][2]=partition1)}for(var _i2=0;_i2<nodeMap.length;_i2++)nodeMap[_i2]===partition2&&(nodeMap[_i2]=partition1);return newEdges},contractUntil=function contractUntil(metaNodeMap,remainingEdges,size,sizeLimit){for(;size>sizeLimit;){var edgeIndex=Math.floor(Math.random()*remainingEdges.length);remainingEdges=collapse(edgeIndex,metaNodeMap,remainingEdges),size--}return remainingEdges},elesfn$6={kargerStein:function kargerStein(){var _this=this,_this$byGroup=this.byGroup(),nodes=_this$byGroup.nodes,edges=_this$byGroup.edges;edges.unmergeBy((function(edge){return edge.isLoop()}));var numNodes=nodes.length,numEdges=edges.length,numIter=Math.ceil(Math.pow(Math.log(numNodes)/Math.LN2,2)),stopSize=Math.floor(numNodes/sqrt2);if(!(numNodes<2)){for(var edgeIndexes=[],i=0;i<numEdges;i++){var e=edges[i];edgeIndexes.push([i,nodes.indexOf(e.source()),nodes.indexOf(e.target())])}for(var minCutSize=1/0,minCutEdgeIndexes=[],minCutNodeMap=new Array(numNodes),metaNodeMap=new Array(numNodes),metaNodeMap2=new Array(numNodes),copyNodesMap=function copyNodesMap(from,to){for(var _i3=0;_i3<numNodes;_i3++)to[_i3]=from[_i3]},iter=0;iter<=numIter;iter++){for(var _i4=0;_i4<numNodes;_i4++)metaNodeMap[_i4]=_i4;var edgesState=contractUntil(metaNodeMap,edgeIndexes.slice(),numNodes,stopSize),edgesState2=edgesState.slice();copyNodesMap(metaNodeMap,metaNodeMap2);var res1=contractUntil(metaNodeMap,edgesState,stopSize,2),res2=contractUntil(metaNodeMap2,edgesState2,stopSize,2);res1.length<=res2.length&&res1.length<minCutSize?(minCutSize=res1.length,minCutEdgeIndexes=res1,copyNodesMap(metaNodeMap,minCutNodeMap)):res2.length<=res1.length&&res2.length<minCutSize&&(minCutSize=res2.length,minCutEdgeIndexes=res2,copyNodesMap(metaNodeMap2,minCutNodeMap))}for(var cut=this.spawn(minCutEdgeIndexes.map((function(e){return edges[e[0]]}))),partition1=this.spawn(),partition2=this.spawn(),witnessNodePartition=minCutNodeMap[0],_i5=0;_i5<minCutNodeMap.length;_i5++){var partitionId=minCutNodeMap[_i5],node=nodes[_i5];partitionId===witnessNodePartition?partition1.merge(node):partition2.merge(node)}var constructComponent=function constructComponent(subset){var component=_this.spawn();return subset.forEach((function(node){component.merge(node),node.connectedEdges().forEach((function(edge){_this.contains(edge)&&!cut.contains(edge)&&component.merge(edge)}))})),component},components=[constructComponent(partition1),constructComponent(partition2)];return{cut:cut,components:components,partition1:partition1,partition2:partition2}}error("At least 2 nodes are required for Karger-Stein algorithm")}},modelToRenderedPosition=function modelToRenderedPosition(p,zoom,pan){return{x:p.x*zoom+pan.x,y:p.y*zoom+pan.y}},renderedToModelPosition=function renderedToModelPosition(p,zoom,pan){return{x:(p.x-pan.x)/zoom,y:(p.y-pan.y)/zoom}},array2point=function array2point(arr){return{x:arr[0],y:arr[1]}},getAngleFromDisp=function getAngleFromDisp(dispX,dispY){return Math.atan2(dispY,dispX)-Math.PI/2},log2=Math.log2||function(n){return Math.log(n)/Math.log(2)},signum=function signum(x){return x>0?1:x<0?-1:0},dist=function dist(p1,p2){return Math.sqrt(sqdist(p1,p2))},sqdist=function sqdist(p1,p2){var dx=p2.x-p1.x,dy=p2.y-p1.y;return dx*dx+dy*dy},inPlaceSumNormalize=function inPlaceSumNormalize(v){for(var length=v.length,total=0,i=0;i<length;i++)total+=v[i];for(var _i=0;_i<length;_i++)v[_i]=v[_i]/total;return v},qbezierAt=function qbezierAt(p0,p1,p2,t){return(1-t)*(1-t)*p0+2*(1-t)*t*p1+t*t*p2},qbezierPtAt=function qbezierPtAt(p0,p1,p2,t){return{x:qbezierAt(p0.x,p1.x,p2.x,t),y:qbezierAt(p0.y,p1.y,p2.y,t)}},bound=function bound(min,val,max){return Math.max(min,Math.min(max,val))},makeBoundingBox=function makeBoundingBox(bb){if(null==bb)return{x1:1/0,y1:1/0,x2:-1/0,y2:-1/0,w:0,h:0};if(null!=bb.x1&&null!=bb.y1){if(null!=bb.x2&&null!=bb.y2&&bb.x2>=bb.x1&&bb.y2>=bb.y1)return{x1:bb.x1,y1:bb.y1,x2:bb.x2,y2:bb.y2,w:bb.x2-bb.x1,h:bb.y2-bb.y1};if(null!=bb.w&&null!=bb.h&&bb.w>=0&&bb.h>=0)return{x1:bb.x1,y1:bb.y1,x2:bb.x1+bb.w,y2:bb.y1+bb.h,w:bb.w,h:bb.h}}},updateBoundingBox=function updateBoundingBox(bb1,bb2){bb1.x1=Math.min(bb1.x1,bb2.x1),bb1.x2=Math.max(bb1.x2,bb2.x2),bb1.w=bb1.x2-bb1.x1,bb1.y1=Math.min(bb1.y1,bb2.y1),bb1.y2=Math.max(bb1.y2,bb2.y2),bb1.h=bb1.y2-bb1.y1},expandBoundingBoxByPoint=function expandBoundingBoxByPoint(bb,x,y){bb.x1=Math.min(bb.x1,x),bb.x2=Math.max(bb.x2,x),bb.w=bb.x2-bb.x1,bb.y1=Math.min(bb.y1,y),bb.y2=Math.max(bb.y2,y),bb.h=bb.y2-bb.y1},expandBoundingBox=function expandBoundingBox(bb){var padding=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return bb.x1-=padding,bb.x2+=padding,bb.y1-=padding,bb.y2+=padding,bb.w=bb.x2-bb.x1,bb.h=bb.y2-bb.y1,bb},expandBoundingBoxSides=function expandBoundingBoxSides(bb){var top,right,bottom,left,padding=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0];if(1===padding.length)top=right=bottom=left=padding[0];else if(2===padding.length)top=bottom=padding[0],left=right=padding[1];else if(4===padding.length){var _padding=_slicedToArray(padding,4);top=_padding[0],right=_padding[1],bottom=_padding[2],left=_padding[3]}return bb.x1-=left,bb.x2+=right,bb.y1-=top,bb.y2+=bottom,bb.w=bb.x2-bb.x1,bb.h=bb.y2-bb.y1,bb},assignBoundingBox=function assignBoundingBox(bb1,bb2){bb1.x1=bb2.x1,bb1.y1=bb2.y1,bb1.x2=bb2.x2,bb1.y2=bb2.y2,bb1.w=bb1.x2-bb1.x1,bb1.h=bb1.y2-bb1.y1},boundingBoxesIntersect=function boundingBoxesIntersect(bb1,bb2){return!(bb1.x1>bb2.x2)&&(!(bb2.x1>bb1.x2)&&(!(bb1.x2<bb2.x1)&&(!(bb2.x2<bb1.x1)&&(!(bb1.y2<bb2.y1)&&(!(bb2.y2<bb1.y1)&&(!(bb1.y1>bb2.y2)&&!(bb2.y1>bb1.y2)))))))},inBoundingBox=function inBoundingBox(bb,x,y){return bb.x1<=x&&x<=bb.x2&&bb.y1<=y&&y<=bb.y2},pointInBoundingBox=function pointInBoundingBox(bb,pt){return inBoundingBox(bb,pt.x,pt.y)},boundingBoxInBoundingBox=function boundingBoxInBoundingBox(bb1,bb2){return inBoundingBox(bb1,bb2.x1,bb2.y1)&&inBoundingBox(bb1,bb2.x2,bb2.y2)},roundRectangleIntersectLine=function roundRectangleIntersectLine(x,y,nodeX,nodeY,width,height,padding){var straightLineIntersections,cornerRadius=getRoundRectangleRadius(width,height),halfWidth=width/2,halfHeight=height/2,topStartY=nodeY-halfHeight-padding;if((straightLineIntersections=finiteLinesIntersect(x,y,nodeX,nodeY,nodeX-halfWidth+cornerRadius-padding,topStartY,nodeX+halfWidth-cornerRadius+padding,topStartY,!1)).length>0)return straightLineIntersections;var rightStartX=nodeX+halfWidth+padding;if((straightLineIntersections=finiteLinesIntersect(x,y,nodeX,nodeY,rightStartX,nodeY-halfHeight+cornerRadius-padding,rightStartX,nodeY+halfHeight-cornerRadius+padding,!1)).length>0)return straightLineIntersections;var bottomStartY=nodeY+halfHeight+padding;if((straightLineIntersections=finiteLinesIntersect(x,y,nodeX,nodeY,nodeX-halfWidth+cornerRadius-padding,bottomStartY,nodeX+halfWidth-cornerRadius+padding,bottomStartY,!1)).length>0)return straightLineIntersections;var arcIntersections,leftStartX=nodeX-halfWidth-padding;if((straightLineIntersections=finiteLinesIntersect(x,y,nodeX,nodeY,leftStartX,nodeY-halfHeight+cornerRadius-padding,leftStartX,nodeY+halfHeight-cornerRadius+padding,!1)).length>0)return straightLineIntersections;var topLeftCenterX=nodeX-halfWidth+cornerRadius,topLeftCenterY=nodeY-halfHeight+cornerRadius;if((arcIntersections=intersectLineCircle(x,y,nodeX,nodeY,topLeftCenterX,topLeftCenterY,cornerRadius+padding)).length>0&&arcIntersections[0]<=topLeftCenterX&&arcIntersections[1]<=topLeftCenterY)return[arcIntersections[0],arcIntersections[1]];var topRightCenterX=nodeX+halfWidth-cornerRadius,topRightCenterY=nodeY-halfHeight+cornerRadius;if((arcIntersections=intersectLineCircle(x,y,nodeX,nodeY,topRightCenterX,topRightCenterY,cornerRadius+padding)).length>0&&arcIntersections[0]>=topRightCenterX&&arcIntersections[1]<=topRightCenterY)return[arcIntersections[0],arcIntersections[1]];var bottomRightCenterX=nodeX+halfWidth-cornerRadius,bottomRightCenterY=nodeY+halfHeight-cornerRadius;if((arcIntersections=intersectLineCircle(x,y,nodeX,nodeY,bottomRightCenterX,bottomRightCenterY,cornerRadius+padding)).length>0&&arcIntersections[0]>=bottomRightCenterX&&arcIntersections[1]>=bottomRightCenterY)return[arcIntersections[0],arcIntersections[1]];var bottomLeftCenterX=nodeX-halfWidth+cornerRadius,bottomLeftCenterY=nodeY+halfHeight-cornerRadius;return(arcIntersections=intersectLineCircle(x,y,nodeX,nodeY,bottomLeftCenterX,bottomLeftCenterY,cornerRadius+padding)).length>0&&arcIntersections[0]<=bottomLeftCenterX&&arcIntersections[1]>=bottomLeftCenterY?[arcIntersections[0],arcIntersections[1]]:[]},inLineVicinity=function inLineVicinity(x,y,lx1,ly1,lx2,ly2,tolerance){var t=tolerance,x1=Math.min(lx1,lx2),x2=Math.max(lx1,lx2),y1=Math.min(ly1,ly2),y2=Math.max(ly1,ly2);return x1-t<=x&&x<=x2+t&&y1-t<=y&&y<=y2+t},inBezierVicinity=function inBezierVicinity(x,y,x1,y1,x2,y2,x3,y3,tolerance){var bb_x1=Math.min(x1,x3,x2)-tolerance,bb_x2=Math.max(x1,x3,x2)+tolerance,bb_y1=Math.min(y1,y3,y2)-tolerance,bb_y2=Math.max(y1,y3,y2)+tolerance;return!(x<bb_x1||x>bb_x2||y<bb_y1||y>bb_y2)},sqdistToQuadraticBezier=function sqdistToQuadraticBezier(x,y,x1,y1,x2,y2,x3,y3){var roots=[];!function solveCubic(a,b,c,d,result){var discriminant,q,r,dum1,s,t,term1,r13;0===a&&(a=1e-5),r=-27*(d/=a)+(b/=a)*(9*(c/=a)-b*b*2),discriminant=(q=(3*c-b*b)/9)*q*q+(r/=54)*r,result[1]=0,term1=b/3,discriminant>0?(s=(s=r+Math.sqrt(discriminant))<0?-Math.pow(-s,1/3):Math.pow(s,1/3),t=(t=r-Math.sqrt(discriminant))<0?-Math.pow(-t,1/3):Math.pow(t,1/3),result[0]=-term1+s+t,term1+=(s+t)/2,result[4]=result[2]=-term1,term1=Math.sqrt(3)*(-t+s)/2,result[3]=term1,result[5]=-term1):(result[5]=result[3]=0,0===discriminant?(r13=r<0?-Math.pow(-r,1/3):Math.pow(r,1/3),result[0]=2*r13-term1,result[4]=result[2]=-(r13+term1)):(dum1=(q=-q)*q*q,dum1=Math.acos(r/Math.sqrt(dum1)),r13=2*Math.sqrt(q),result[0]=-term1+r13*Math.cos(dum1/3),result[2]=-term1+r13*Math.cos((dum1+2*Math.PI)/3),result[4]=-term1+r13*Math.cos((dum1+4*Math.PI)/3)))}(1*x1*x1-4*x1*x2+2*x1*x3+4*x2*x2-4*x2*x3+x3*x3+y1*y1-4*y1*y2+2*y1*y3+4*y2*y2-4*y2*y3+y3*y3,9*x1*x2-3*x1*x1-3*x1*x3-6*x2*x2+3*x2*x3+9*y1*y2-3*y1*y1-3*y1*y3-6*y2*y2+3*y2*y3,3*x1*x1-6*x1*x2+x1*x3-x1*x+2*x2*x2+2*x2*x-x3*x+3*y1*y1-6*y1*y2+y1*y3-y1*y+2*y2*y2+2*y2*y-y3*y,1*x1*x2-x1*x1+x1*x-x2*x+y1*y2-y1*y1+y1*y-y2*y,roots);for(var params=[],index=0;index<6;index+=2)Math.abs(roots[index+1])<1e-7&&roots[index]>=0&&roots[index]<=1&&params.push(roots[index]);params.push(1),params.push(0);for(var curX,curY,distSquared,minDistanceSquared=-1,i=0;i<params.length;i++)curX=Math.pow(1-params[i],2)*x1+2*(1-params[i])*params[i]*x2+params[i]*params[i]*x3,curY=Math.pow(1-params[i],2)*y1+2*(1-params[i])*params[i]*y2+params[i]*params[i]*y3,distSquared=Math.pow(curX-x,2)+Math.pow(curY-y,2),minDistanceSquared>=0?distSquared<minDistanceSquared&&(minDistanceSquared=distSquared):minDistanceSquared=distSquared;return minDistanceSquared},sqdistToFiniteLine=function sqdistToFiniteLine(x,y,x1,y1,x2,y2){var offset=[x-x1,y-y1],line=[x2-x1,y2-y1],lineSq=line[0]*line[0]+line[1]*line[1],hypSq=offset[0]*offset[0]+offset[1]*offset[1],dotProduct=offset[0]*line[0]+offset[1]*line[1],adjSq=dotProduct*dotProduct/lineSq;return dotProduct<0?hypSq:adjSq>lineSq?(x-x2)*(x-x2)+(y-y2)*(y-y2):hypSq-adjSq},pointInsidePolygonPoints=function pointInsidePolygonPoints(x,y,points){for(var x1,y1,x2,y2,up=0,i=0;i<points.length/2;i++)if(x1=points[2*i],y1=points[2*i+1],i+1<points.length/2?(x2=points[2*(i+1)],y2=points[2*(i+1)+1]):(x2=points[2*(i+1-points.length/2)],y2=points[2*(i+1-points.length/2)+1]),x1==x&&x2==x);else{if(!(x1>=x&&x>=x2||x1<=x&&x<=x2))continue;(x-x1)/(x2-x1)*(y2-y1)+y1>y&&up++}return up%2!=0},pointInsidePolygon=function pointInsidePolygon(x,y,basePoints,centerX,centerY,width,height,direction,padding){var angle,transformedPoints=new Array(basePoints.length);null!=direction[0]?(angle=Math.atan(direction[1]/direction[0]),direction[0]<0?angle+=Math.PI/2:angle=-angle-Math.PI/2):angle=direction;for(var points,cos=Math.cos(-angle),sin=Math.sin(-angle),i=0;i<transformedPoints.length/2;i++)transformedPoints[2*i]=width/2*(basePoints[2*i]*cos-basePoints[2*i+1]*sin),transformedPoints[2*i+1]=height/2*(basePoints[2*i+1]*cos+basePoints[2*i]*sin),transformedPoints[2*i]+=centerX,transformedPoints[2*i+1]+=centerY;if(padding>0){var expandedLineSet=expandPolygon(transformedPoints,-padding);points=joinLines(expandedLineSet)}else points=transformedPoints;return pointInsidePolygonPoints(x,y,points)},joinLines=function joinLines(lineSet){for(var currentLineStartX,currentLineStartY,currentLineEndX,currentLineEndY,nextLineStartX,nextLineStartY,nextLineEndX,nextLineEndY,vertices=new Array(lineSet.length/2),i=0;i<lineSet.length/4;i++){currentLineStartX=lineSet[4*i],currentLineStartY=lineSet[4*i+1],currentLineEndX=lineSet[4*i+2],currentLineEndY=lineSet[4*i+3],i<lineSet.length/4-1?(nextLineStartX=lineSet[4*(i+1)],nextLineStartY=lineSet[4*(i+1)+1],nextLineEndX=lineSet[4*(i+1)+2],nextLineEndY=lineSet[4*(i+1)+3]):(nextLineStartX=lineSet[0],nextLineStartY=lineSet[1],nextLineEndX=lineSet[2],nextLineEndY=lineSet[3]);var intersection=finiteLinesIntersect(currentLineStartX,currentLineStartY,currentLineEndX,currentLineEndY,nextLineStartX,nextLineStartY,nextLineEndX,nextLineEndY,!0);vertices[2*i]=intersection[0],vertices[2*i+1]=intersection[1]}return vertices},expandPolygon=function expandPolygon(points,pad){for(var currentPointX,currentPointY,nextPointX,nextPointY,expandedLineSet=new Array(2*points.length),i=0;i<points.length/2;i++){currentPointX=points[2*i],currentPointY=points[2*i+1],i<points.length/2-1?(nextPointX=points[2*(i+1)],nextPointY=points[2*(i+1)+1]):(nextPointX=points[0],nextPointY=points[1]);var offsetX=nextPointY-currentPointY,offsetY=-(nextPointX-currentPointX),offsetLength=Math.sqrt(offsetX*offsetX+offsetY*offsetY),normalizedOffsetX=offsetX/offsetLength,normalizedOffsetY=offsetY/offsetLength;expandedLineSet[4*i]=currentPointX+normalizedOffsetX*pad,expandedLineSet[4*i+1]=currentPointY+normalizedOffsetY*pad,expandedLineSet[4*i+2]=nextPointX+normalizedOffsetX*pad,expandedLineSet[4*i+3]=nextPointY+normalizedOffsetY*pad}return expandedLineSet},checkInEllipse=function checkInEllipse(x,y,width,height,centerX,centerY,padding){return x-=centerX,y-=centerY,(x/=width/2+padding)*x+(y/=height/2+padding)*y<=1},intersectLineCircle=function intersectLineCircle(x1,y1,x2,y2,centerX,centerY,radius){var d=[x2-x1,y2-y1],f=[x1-centerX,y1-centerY],a=d[0]*d[0]+d[1]*d[1],b=2*(f[0]*d[0]+f[1]*d[1]),discriminant=b*b-4*a*(f[0]*f[0]+f[1]*f[1]-radius*radius);if(discriminant<0)return[];var t1=(-b+Math.sqrt(discriminant))/(2*a),t2=(-b-Math.sqrt(discriminant))/(2*a),tMin=Math.min(t1,t2),tMax=Math.max(t1,t2),inRangeParams=[];if(tMin>=0&&tMin<=1&&inRangeParams.push(tMin),tMax>=0&&tMax<=1&&inRangeParams.push(tMax),0===inRangeParams.length)return[];var nearIntersectionX=inRangeParams[0]*d[0]+x1,nearIntersectionY=inRangeParams[0]*d[1]+y1;return inRangeParams.length>1?inRangeParams[0]==inRangeParams[1]?[nearIntersectionX,nearIntersectionY]:[nearIntersectionX,nearIntersectionY,inRangeParams[1]*d[0]+x1,inRangeParams[1]*d[1]+y1]:[nearIntersectionX,nearIntersectionY]},midOfThree=function midOfThree(a,b,c){return b<=a&&a<=c||c<=a&&a<=b?a:a<=b&&b<=c||c<=b&&b<=a?b:c},finiteLinesIntersect=function finiteLinesIntersect(x1,y1,x2,y2,x3,y3,x4,y4,infiniteLines){var dx13=x1-x3,dx21=x2-x1,dx43=x4-x3,dy13=y1-y3,dy21=y2-y1,dy43=y4-y3,ua_t=dx43*dy13-dy43*dx13,ub_t=dx21*dy13-dy21*dx13,u_b=dy43*dx21-dx43*dy21;if(0!==u_b){var ua=ua_t/u_b,ub=ub_t/u_b;return-.001<=ua&&ua<=1.001&&-.001<=ub&&ub<=1.001||infiniteLines?[x1+ua*dx21,y1+ua*dy21]:[]}return 0===ua_t||0===ub_t?midOfThree(x1,x2,x4)===x4?[x4,y4]:midOfThree(x1,x2,x3)===x3?[x3,y3]:midOfThree(x3,x4,x2)===x2?[x2,y2]:[]:[]},polygonIntersectLine=function polygonIntersectLine(x,y,basePoints,centerX,centerY,width,height,padding){var intersection,points,currentX,currentY,nextX,nextY,intersections=[],transformedPoints=new Array(basePoints.length),doTransform=!0;if(null==width&&(doTransform=!1),doTransform){for(var i=0;i<transformedPoints.length/2;i++)transformedPoints[2*i]=basePoints[2*i]*width+centerX,transformedPoints[2*i+1]=basePoints[2*i+1]*height+centerY;if(padding>0){var expandedLineSet=expandPolygon(transformedPoints,-padding);points=joinLines(expandedLineSet)}else points=transformedPoints}else points=basePoints;for(var _i2=0;_i2<points.length/2;_i2++)currentX=points[2*_i2],currentY=points[2*_i2+1],_i2<points.length/2-1?(nextX=points[2*(_i2+1)],nextY=points[2*(_i2+1)+1]):(nextX=points[0],nextY=points[1]),0!==(intersection=finiteLinesIntersect(x,y,centerX,centerY,currentX,currentY,nextX,nextY)).length&&intersections.push(intersection[0],intersection[1]);return intersections},shortenIntersection=function shortenIntersection(intersection,offset,amount){var disp=[intersection[0]-offset[0],intersection[1]-offset[1]],length=Math.sqrt(disp[0]*disp[0]+disp[1]*disp[1]),lenRatio=(length-amount)/length;return lenRatio<0&&(lenRatio=1e-5),[offset[0]+lenRatio*disp[0],offset[1]+lenRatio*disp[1]]},generateUnitNgonPointsFitToSquare=function generateUnitNgonPointsFitToSquare(sides,rotationRadians){var points=generateUnitNgonPoints(sides,rotationRadians);return points=fitPolygonToSquare(points)},fitPolygonToSquare=function fitPolygonToSquare(points){for(var x,y,sides=points.length/2,minX=1/0,minY=1/0,maxX=-1/0,maxY=-1/0,i=0;i<sides;i++)x=points[2*i],y=points[2*i+1],minX=Math.min(minX,x),maxX=Math.max(maxX,x),minY=Math.min(minY,y),maxY=Math.max(maxY,y);for(var sx=2/(maxX-minX),sy=2/(maxY-minY),_i5=0;_i5<sides;_i5++)x=points[2*_i5]=points[2*_i5]*sx,y=points[2*_i5+1]=points[2*_i5+1]*sy,minX=Math.min(minX,x),maxX=Math.max(maxX,x),minY=Math.min(minY,y),maxY=Math.max(maxY,y);if(minY<-1)for(var _i6=0;_i6<sides;_i6++)y=points[2*_i6+1]=points[2*_i6+1]+(-1-minY);return points},generateUnitNgonPoints=function generateUnitNgonPoints(sides,rotationRadians){var increment=1/sides*2*Math.PI,startAngle=sides%2==0?Math.PI/2+increment/2:Math.PI/2;startAngle+=rotationRadians;for(var currentAngle,points=new Array(2*sides),i=0;i<sides;i++)currentAngle=i*increment+startAngle,points[2*i]=Math.cos(currentAngle),points[2*i+1]=Math.sin(-currentAngle);return points},getRoundRectangleRadius=function getRoundRectangleRadius(width,height){return Math.min(width/4,height/4,8)},getRoundPolygonRadius=function getRoundPolygonRadius(width,height){return Math.min(width/10,height/10,8)},getBarrelCurveConstants=function getBarrelCurveConstants(width,height){return{heightOffset:Math.min(15,.05*height),widthOffset:Math.min(100,.25*width),ctrlPtOffsetPct:.05}},pageRankDefaults=defaults({dampingFactor:.8,precision:1e-6,iterations:200,weight:function weight(edge){return 1}}),elesfn$7={pageRank:function pageRank(options){for(var _pageRankDefaults=pageRankDefaults(options),dampingFactor=_pageRankDefaults.dampingFactor,precision=_pageRankDefaults.precision,iterations=_pageRankDefaults.iterations,weight=_pageRankDefaults.weight,cy=this._private.cy,_this$byGroup=this.byGroup(),nodes=_this$byGroup.nodes,edges=_this$byGroup.edges,numNodes=nodes.length,numNodesSqd=numNodes*numNodes,numEdges=edges.length,matrix=new Array(numNodesSqd),columnSum=new Array(numNodes),additionalProb=(1-dampingFactor)/numNodes,i=0;i<numNodes;i++){for(var j=0;j<numNodes;j++){matrix[i*numNodes+j]=0}columnSum[i]=0}for(var _i=0;_i<numEdges;_i++){var edge=edges[_i],srcId=edge.data("source"),tgtId=edge.data("target");if(srcId!==tgtId){var s=nodes.indexOfId(srcId),t=nodes.indexOfId(tgtId),w=weight(edge);matrix[t*numNodes+s]+=w,columnSum[s]+=w}}for(var p=1/numNodes+additionalProb,_j=0;_j<numNodes;_j++)if(0===columnSum[_j])for(var _i2=0;_i2<numNodes;_i2++){matrix[_i2*numNodes+_j]=p}else for(var _i3=0;_i3<numNodes;_i3++){var _n3=_i3*numNodes+_j;matrix[_n3]=matrix[_n3]/columnSum[_j]+additionalProb}for(var previous,eigenvector=new Array(numNodes),temp=new Array(numNodes),_i4=0;_i4<numNodes;_i4++)eigenvector[_i4]=1;for(var iter=0;iter<iterations;iter++){for(var _i5=0;_i5<numNodes;_i5++)temp[_i5]=0;for(var _i6=0;_i6<numNodes;_i6++)for(var _j2=0;_j2<numNodes;_j2++){var _n4=_i6*numNodes+_j2;temp[_i6]+=matrix[_n4]*eigenvector[_j2]}inPlaceSumNormalize(temp),previous=eigenvector,eigenvector=temp,temp=previous;for(var diff=0,_i7=0;_i7<numNodes;_i7++){var delta=previous[_i7]-eigenvector[_i7];diff+=delta*delta}if(diff<precision)break}return{rank:function rank(node){return node=cy.collection(node)[0],eigenvector[nodes.indexOf(node)]}}}},defaults$1=defaults({root:null,weight:function weight(edge){return 1},directed:!1,alpha:0}),elesfn$8={degreeCentralityNormalized:function degreeCentralityNormalized(options){options=defaults$1(options);var cy=this.cy(),nodes=this.nodes(),numNodes=nodes.length;if(options.directed){for(var indegrees={},outdegrees={},maxIndegree=0,maxOutdegree=0,_i=0;_i<numNodes;_i++){var _node=nodes[_i],id=_node.id();options.root=_node;var _currDegree=this.degreeCentrality(options);maxIndegree<_currDegree.indegree&&(maxIndegree=_currDegree.indegree),maxOutdegree<_currDegree.outdegree&&(maxOutdegree=_currDegree.outdegree),indegrees[id]=_currDegree.indegree,outdegrees[id]=_currDegree.outdegree}return{indegree:function indegree(node){return 0==maxIndegree?0:(string(node)&&(node=cy.filter(node)),indegrees[node.id()]/maxIndegree)},outdegree:function outdegree(node){return 0===maxOutdegree?0:(string(node)&&(node=cy.filter(node)),outdegrees[node.id()]/maxOutdegree)}}}for(var degrees={},maxDegree=0,i=0;i<numNodes;i++){var node=nodes[i];options.root=node;var currDegree=this.degreeCentrality(options);maxDegree<currDegree.degree&&(maxDegree=currDegree.degree),degrees[node.id()]=currDegree.degree}return{degree:function degree(node){return 0===maxDegree?0:(string(node)&&(node=cy.filter(node)),degrees[node.id()]/maxDegree)}}},degreeCentrality:function degreeCentrality(options){options=defaults$1(options);var cy=this.cy(),callingEles=this,_options=options,root=_options.root,weight=_options.weight,directed=_options.directed,alpha=_options.alpha;if(root=cy.collection(root)[0],directed){for(var edges=root.connectedEdges(),incoming=edges.filter((function(edge){return edge.target().same(root)&&callingEles.has(edge)})),outgoing=edges.filter((function(edge){return edge.source().same(root)&&callingEles.has(edge)})),k_in=incoming.length,k_out=outgoing.length,s_in=0,s_out=0,_i2=0;_i2<incoming.length;_i2++)s_in+=weight(incoming[_i2]);for(var _i3=0;_i3<outgoing.length;_i3++)s_out+=weight(outgoing[_i3]);return{indegree:Math.pow(k_in,1-alpha)*Math.pow(s_in,alpha),outdegree:Math.pow(k_out,1-alpha)*Math.pow(s_out,alpha)}}for(var connEdges=root.connectedEdges().intersection(callingEles),k=connEdges.length,s=0,i=0;i<connEdges.length;i++)s+=weight(connEdges[i]);return{degree:Math.pow(k,1-alpha)*Math.pow(s,alpha)}}};elesfn$8.dc=elesfn$8.degreeCentrality,elesfn$8.dcn=elesfn$8.degreeCentralityNormalised=elesfn$8.degreeCentralityNormalized;var defaults$2=defaults({harmonic:!0,weight:function weight(){return 1},directed:!1,root:null}),elesfn$9={closenessCentralityNormalized:function closenessCentralityNormalized(options){for(var _defaults=defaults$2(options),harmonic=_defaults.harmonic,weight=_defaults.weight,directed=_defaults.directed,cy=this.cy(),closenesses={},maxCloseness=0,nodes=this.nodes(),fw=this.floydWarshall({weight:weight,directed:directed}),i=0;i<nodes.length;i++){for(var currCloseness=0,node_i=nodes[i],j=0;j<nodes.length;j++)if(i!==j){var d=fw.distance(node_i,nodes[j]);currCloseness+=harmonic?1/d:d}harmonic||(currCloseness=1/currCloseness),maxCloseness<currCloseness&&(maxCloseness=currCloseness),closenesses[node_i.id()]=currCloseness}return{closeness:function closeness(node){return 0==maxCloseness?0:(node=string(node)?cy.filter(node)[0].id():node.id(),closenesses[node]/maxCloseness)}}},closenessCentrality:function closenessCentrality(options){var _defaults2=defaults$2(options),root=_defaults2.root,weight=_defaults2.weight,directed=_defaults2.directed,harmonic=_defaults2.harmonic;root=this.filter(root)[0];for(var dijkstra=this.dijkstra({root:root,weight:weight,directed:directed}),totalDistance=0,nodes=this.nodes(),i=0;i<nodes.length;i++){var n=nodes[i];if(!n.same(root)){var d=dijkstra.distanceTo(n);totalDistance+=harmonic?1/d:d}}return harmonic?totalDistance:1/totalDistance}};elesfn$9.cc=elesfn$9.closenessCentrality,elesfn$9.ccn=elesfn$9.closenessCentralityNormalised=elesfn$9.closenessCentralityNormalized;var defaults$3=defaults({weight:null,directed:!1}),elesfn$a={betweennessCentrality:function betweennessCentrality(options){for(var _defaults=defaults$3(options),directed=_defaults.directed,weight=_defaults.weight,weighted=null!=weight,cy=this.cy(),V=this.nodes(),A={},_C={},max=0,C_set=function set(key,val){_C[key]=val,val>max&&(max=val)},C_get=function get(key){return _C[key]},i=0;i<V.length;i++){var v=V[i],vid=v.id();A[vid]=directed?v.outgoers().nodes():v.openNeighborhood().nodes(),C_set(vid,0)}for(var _loop=function _loop(s){for(var sid=V[s].id(),S=[],P={},g={},d={},Q=new Heap((function(a,b){return d[a]-d[b]})),_i=0;_i<V.length;_i++){var _vid=V[_i].id();P[_vid]=[],g[_vid]=0,d[_vid]=1/0}for(g[sid]=1,d[sid]=0,Q.push(sid);!Q.empty();){var _v=Q.pop();if(S.push(_v),weighted)for(var j=0;j<A[_v].length;j++){var w=A[_v][j],vEle=cy.getElementById(_v),edge=void 0;edge=vEle.edgesTo(w).length>0?vEle.edgesTo(w)[0]:w.edgesTo(vEle)[0];var edgeWeight=weight(edge);w=w.id(),d[w]>d[_v]+edgeWeight&&(d[w]=d[_v]+edgeWeight,Q.nodes.indexOf(w)<0?Q.push(w):Q.updateItem(w),g[w]=0,P[w]=[]),d[w]==d[_v]+edgeWeight&&(g[w]=g[w]+g[_v],P[w].push(_v))}else for(var _j=0;_j<A[_v].length;_j++){var _w=A[_v][_j].id();d[_w]==1/0&&(Q.push(_w),d[_w]=d[_v]+1),d[_w]==d[_v]+1&&(g[_w]=g[_w]+g[_v],P[_w].push(_v))}}for(var e={},_i2=0;_i2<V.length;_i2++)e[V[_i2].id()]=0;for(;S.length>0;){for(var _w2=S.pop(),_j2=0;_j2<P[_w2].length;_j2++){var _v2=P[_w2][_j2];e[_v2]=e[_v2]+g[_v2]/g[_w2]*(1+e[_w2])}_w2!=V[s].id()&&C_set(_w2,C_get(_w2)+e[_w2])}},s=0;s<V.length;s++)_loop(s);var ret={betweenness:function betweenness(node){var id=cy.collection(node).id();return C_get(id)},betweennessNormalized:function betweennessNormalized(node){if(0==max)return 0;var id=cy.collection(node).id();return C_get(id)/max}};return ret.betweennessNormalised=ret.betweennessNormalized,ret}};elesfn$a.bc=elesfn$a.betweennessCentrality;var defaults$4=defaults({expandFactor:2,inflateFactor:2,multFactor:1,maxIterations:20,attributes:[function(edge){return 1}]}),getSimilarity=function getSimilarity(edge,attributes){for(var total=0,i=0;i<attributes.length;i++)total+=attributes[i](edge);return total},normalize=function normalize(M,n){for(var sum,col=0;col<n;col++){sum=0;for(var row=0;row<n;row++)sum+=M[row*n+col];for(var _row=0;_row<n;_row++)M[_row*n+col]=M[_row*n+col]/sum}},mmult=function mmult(A,B,n){for(var C=new Array(n*n),i=0;i<n;i++){for(var j=0;j<n;j++)C[i*n+j]=0;for(var k=0;k<n;k++)for(var _j=0;_j<n;_j++)C[i*n+_j]+=A[i*n+k]*B[k*n+_j]}return C},expand=function expand(M,n,expandFactor){for(var _M=M.slice(0),p=1;p<expandFactor;p++)M=mmult(M,_M,n);return M},inflate=function inflate(M,n,inflateFactor){for(var _M=new Array(n*n),i=0;i<n*n;i++)_M[i]=Math.pow(M[i],inflateFactor);return normalize(_M,n),_M},hasConverged=function hasConverged(M,_M,n2,roundFactor){for(var i=0;i<n2;i++){if(Math.round(M[i]*Math.pow(10,roundFactor))/Math.pow(10,roundFactor)!==Math.round(_M[i]*Math.pow(10,roundFactor))/Math.pow(10,roundFactor))return!1}return!0},isDuplicate=function isDuplicate(c1,c2){for(var i=0;i<c1.length;i++)if(!c2[i]||c1[i].id()!==c2[i].id())return!1;return!0},markovClustering=function markovClustering(options){for(var nodes=this.nodes(),edges=this.edges(),cy=this.cy(),opts=function setOptions(options){return defaults$4(options)}(options),id2position={},i=0;i<nodes.length;i++)id2position[nodes[i].id()]=i;for(var _M,n=nodes.length,n2=n*n,M=new Array(n2),_i=0;_i<n2;_i++)M[_i]=0;for(var e=0;e<edges.length;e++){var edge=edges[e],_i2=id2position[edge.source().id()],j=id2position[edge.target().id()],sim=getSimilarity(edge,opts.attributes);M[_i2*n+j]+=sim,M[j*n+_i2]+=sim}!function addLoops(M,n,val){for(var i=0;i<n;i++)M[i*n+i]=val}(M,n,opts.multFactor),normalize(M,n);for(var isStillMoving=!0,iterations=0;isStillMoving&&iterations<opts.maxIterations;)isStillMoving=!1,_M=expand(M,n,opts.expandFactor),M=inflate(_M,n,opts.inflateFactor),hasConverged(M,_M,n2,4)||(isStillMoving=!0),iterations++;var clusters=function assign(M,n,nodes,cy){for(var clusters=[],i=0;i<n;i++){for(var cluster=[],j=0;j<n;j++)Math.round(1e3*M[i*n+j])/1e3>0&&cluster.push(nodes[j]);0!==cluster.length&&clusters.push(cy.collection(cluster))}return clusters}(M,n,nodes,cy);return clusters=function removeDuplicates(clusters){for(var i=0;i<clusters.length;i++)for(var j=0;j<clusters.length;j++)i!=j&&isDuplicate(clusters[i],clusters[j])&&clusters.splice(j,1);return clusters}(clusters),clusters},markovClustering$1={markovClustering:markovClustering,mcl:markovClustering},identity=function identity(x){return x},absDiff=function absDiff(p,q){return Math.abs(q-p)},addAbsDiff=function addAbsDiff(total,p,q){return total+absDiff(p,q)},addSquaredDiff=function addSquaredDiff(total,p,q){return total+Math.pow(q-p,2)},sqrt=function sqrt(x){return Math.sqrt(x)},maxAbsDiff=function maxAbsDiff(currentMax,p,q){return Math.max(currentMax,absDiff(p,q))},getDistance=function getDistance(length,getP,getQ,init,visit){for(var post=arguments.length>5&&void 0!==arguments[5]?arguments[5]:identity,ret=init,dim=0;dim<length;dim++)ret=visit(ret,getP(dim),getQ(dim));return post(ret)},distances={euclidean:function euclidean(length,getP,getQ){return length>=2?getDistance(length,getP,getQ,0,addSquaredDiff,sqrt):getDistance(length,getP,getQ,0,addAbsDiff)},squaredEuclidean:function squaredEuclidean(length,getP,getQ){return getDistance(length,getP,getQ,0,addSquaredDiff)},manhattan:function manhattan(length,getP,getQ){return getDistance(length,getP,getQ,0,addAbsDiff)},max:function max(length,getP,getQ){return getDistance(length,getP,getQ,-1/0,maxAbsDiff)}};function clusteringDistance(method,length,getP,getQ,nodeP,nodeQ){var impl;return impl=fn(method)?method:distances[method]||distances.euclidean,0===length&&fn(method)?impl(nodeP,nodeQ):impl(length,getP,getQ,nodeP,nodeQ)}distances["squared-euclidean"]=distances.squaredEuclidean,distances.squaredeuclidean=distances.squaredEuclidean;var defaults$5=defaults({k:2,m:2,sensitivityThreshold:1e-4,distance:"euclidean",maxIterations:10,attributes:[],testMode:!1,testCentroids:null}),setOptions$1=function setOptions(options){return defaults$5(options)},getDist=function getDist(type,node,centroid,attributes,mode){var getP="kMedoids"!==mode?function(i){return centroid[i]}:function(i){return attributes[i](centroid)},nodeP=centroid,nodeQ=node;return clusteringDistance(type,attributes.length,getP,(function getQ(i){return attributes[i](node)}),nodeP,nodeQ)},randomCentroids=function randomCentroids(nodes,k,attributes){for(var ndim=attributes.length,min=new Array(ndim),max=new Array(ndim),centroids=new Array(k),centroid=null,i=0;i<ndim;i++)min[i]=nodes.min(attributes[i]).value,max[i]=nodes.max(attributes[i]).value;for(var c=0;c<k;c++){centroid=[];for(var _i=0;_i<ndim;_i++)centroid[_i]=Math.random()*(max[_i]-min[_i])+min[_i];centroids[c]=centroid}return centroids},classify=function classify(node,centroids,distance,attributes,type){for(var min=1/0,index=0,i=0;i<centroids.length;i++){var dist=getDist(distance,node,centroids[i],attributes,type);dist<min&&(min=dist,index=i)}return index},buildCluster=function buildCluster(centroid,nodes,assignment){for(var cluster=[],node=null,n=0;n<nodes.length;n++)assignment[(node=nodes[n]).id()]===centroid&&cluster.push(node);return cluster},haveValuesConverged=function haveValuesConverged(v1,v2,sensitivityThreshold){return Math.abs(v2-v1)<=sensitivityThreshold},haveMatricesConverged=function haveMatricesConverged(v1,v2,sensitivityThreshold){for(var i=0;i<v1.length;i++)for(var j=0;j<v1[i].length;j++){if(Math.abs(v1[i][j]-v2[i][j])>sensitivityThreshold)return!1}return!0},seenBefore=function seenBefore(node,medoids,n){for(var i=0;i<n;i++)if(node===medoids[i])return!0;return!1},randomMedoids=function randomMedoids(nodes,k){var medoids=new Array(k);if(nodes.length<50)for(var i=0;i<k;i++){for(var node=nodes[Math.floor(Math.random()*nodes.length)];seenBefore(node,medoids,i);)node=nodes[Math.floor(Math.random()*nodes.length)];medoids[i]=node}else for(var _i2=0;_i2<k;_i2++)medoids[_i2]=nodes[Math.floor(Math.random()*nodes.length)];return medoids},findCost=function findCost(potentialNewMedoid,cluster,attributes){for(var cost=0,n=0;n<cluster.length;n++)cost+=getDist("manhattan",cluster[n],potentialNewMedoid,attributes,"kMedoids");return cost},updateCentroids=function updateCentroids(centroids,nodes,U,weight,opts){for(var numerator,denominator,n=0;n<nodes.length;n++)for(var c=0;c<centroids.length;c++)weight[n][c]=Math.pow(U[n][c],opts.m);for(var _c=0;_c<centroids.length;_c++)for(var dim=0;dim<opts.attributes.length;dim++){numerator=0,denominator=0;for(var _n2=0;_n2<nodes.length;_n2++)numerator+=weight[_n2][_c]*opts.attributes[dim](nodes[_n2]),denominator+=weight[_n2][_c];centroids[_c][dim]=numerator/denominator}},updateMembership=function updateMembership(U,_U,centroids,nodes,opts){for(var i=0;i<U.length;i++)_U[i]=U[i].slice();for(var sum,numerator,denominator,pow=2/(opts.m-1),c=0;c<centroids.length;c++)for(var n=0;n<nodes.length;n++){sum=0;for(var k=0;k<centroids.length;k++)numerator=getDist(opts.distance,nodes[n],centroids[c],opts.attributes,"cmeans"),denominator=getDist(opts.distance,nodes[n],centroids[k],opts.attributes,"cmeans"),sum+=Math.pow(numerator/denominator,pow);U[n][c]=1/sum}},fuzzyCMeans=function fuzzyCMeans(options){var clusters,centroids,U,_U,weight,cy=this.cy(),nodes=this.nodes(),opts=setOptions$1(options);_U=new Array(nodes.length);for(var i=0;i<nodes.length;i++)_U[i]=new Array(opts.k);U=new Array(nodes.length);for(var _i3=0;_i3<nodes.length;_i3++)U[_i3]=new Array(opts.k);for(var _i4=0;_i4<nodes.length;_i4++){for(var total=0,j=0;j<opts.k;j++)U[_i4][j]=Math.random(),total+=U[_i4][j];for(var _j=0;_j<opts.k;_j++)U[_i4][_j]=U[_i4][_j]/total}centroids=new Array(opts.k);for(var _i5=0;_i5<opts.k;_i5++)centroids[_i5]=new Array(opts.attributes.length);weight=new Array(nodes.length);for(var _i6=0;_i6<nodes.length;_i6++)weight[_i6]=new Array(opts.k);for(var isStillMoving=!0,iterations=0;isStillMoving&&iterations<opts.maxIterations;)isStillMoving=!1,updateCentroids(centroids,nodes,U,weight,opts),updateMembership(U,_U,centroids,nodes,opts),haveMatricesConverged(U,_U,opts.sensitivityThreshold)||(isStillMoving=!0),iterations++;return clusters=function assign(nodes,U,opts,cy){for(var max,index,clusters=new Array(opts.k),c=0;c<clusters.length;c++)clusters[c]=[];for(var n=0;n<U.length;n++){max=-1/0,index=-1;for(var _c2=0;_c2<U[0].length;_c2++)U[n][_c2]>max&&(max=U[n][_c2],index=_c2);clusters[index].push(nodes[n])}for(var _c3=0;_c3<clusters.length;_c3++)clusters[_c3]=cy.collection(clusters[_c3]);return clusters}(nodes,U,opts,cy),{clusters:clusters,degreeOfMembership:U}},kClustering={kMeans:function kMeans(options){var centroids,cy=this.cy(),nodes=this.nodes(),node=null,opts=setOptions$1(options),clusters=new Array(opts.k),assignment={};centroids=opts.testMode?"number"==typeof opts.testCentroids?randomCentroids(nodes,opts.k,opts.attributes):"object"===_typeof(opts.testCentroids)?opts.testCentroids:randomCentroids(nodes,opts.k,opts.attributes):randomCentroids(nodes,opts.k,opts.attributes);for(var isStillMoving=!0,iterations=0;isStillMoving&&iterations<opts.maxIterations;){for(var n=0;n<nodes.length;n++)assignment[(node=nodes[n]).id()]=classify(node,centroids,opts.distance,opts.attributes,"kMeans");isStillMoving=!1;for(var c=0;c<opts.k;c++){var cluster=buildCluster(c,nodes,assignment);if(0!==cluster.length){for(var ndim=opts.attributes.length,centroid=centroids[c],newCentroid=new Array(ndim),sum=new Array(ndim),d=0;d<ndim;d++){sum[d]=0;for(var i=0;i<cluster.length;i++)node=cluster[i],sum[d]+=opts.attributes[d](node);newCentroid[d]=sum[d]/cluster.length,haveValuesConverged(newCentroid[d],centroid[d],opts.sensitivityThreshold)||(isStillMoving=!0)}centroids[c]=newCentroid,clusters[c]=cy.collection(cluster)}}iterations++}return clusters},kMedoids:function kMedoids(options){var medoids,curCost,cy=this.cy(),nodes=this.nodes(),node=null,opts=setOptions$1(options),clusters=new Array(opts.k),assignment={},minCosts=new Array(opts.k);opts.testMode?"number"==typeof opts.testCentroids||(medoids="object"===_typeof(opts.testCentroids)?opts.testCentroids:randomMedoids(nodes,opts.k)):medoids=randomMedoids(nodes,opts.k);for(var isStillMoving=!0,iterations=0;isStillMoving&&iterations<opts.maxIterations;){for(var n=0;n<nodes.length;n++)assignment[(node=nodes[n]).id()]=classify(node,medoids,opts.distance,opts.attributes,"kMedoids");isStillMoving=!1;for(var m=0;m<medoids.length;m++){var cluster=buildCluster(m,nodes,assignment);if(0!==cluster.length){minCosts[m]=findCost(medoids[m],cluster,opts.attributes);for(var _n=0;_n<cluster.length;_n++)(curCost=findCost(cluster[_n],cluster,opts.attributes))<minCosts[m]&&(minCosts[m]=curCost,medoids[m]=cluster[_n],isStillMoving=!0);clusters[m]=cy.collection(cluster)}}iterations++}return clusters},fuzzyCMeans:fuzzyCMeans,fcm:fuzzyCMeans},defaults$6=defaults({distance:"euclidean",linkage:"min",mode:"threshold",threshold:1/0,addDendrogram:!1,dendrogramDepth:0,attributes:[]}),linkageAliases={single:"min",complete:"max"},mergeClosest=function mergeClosest(clusters,index,dists,mins,opts){for(var dist,minKey=0,min=1/0,attrs=opts.attributes,getDist=function getDist(n1,n2){return clusteringDistance(opts.distance,attrs.length,(function(i){return attrs[i](n1)}),(function(i){return attrs[i](n2)}),n1,n2)},i=0;i<clusters.length;i++){var key=clusters[i].key,_dist=dists[key][mins[key]];_dist<min&&(minKey=key,min=_dist)}if("threshold"===opts.mode&&min>=opts.threshold||"dendrogram"===opts.mode&&1===clusters.length)return!1;var merged,c1=index[minKey],c2=index[mins[minKey]];merged="dendrogram"===opts.mode?{left:c1,right:c2,key:c1.key}:{value:c1.value.concat(c2.value),key:c1.key},clusters[c1.index]=merged,clusters.splice(c2.index,1),index[c1.key]=merged;for(var _i=0;_i<clusters.length;_i++){var cur=clusters[_i];c1.key===cur.key?dist=1/0:"min"===opts.linkage?(dist=dists[c1.key][cur.key],dists[c1.key][cur.key]>dists[c2.key][cur.key]&&(dist=dists[c2.key][cur.key])):"max"===opts.linkage?(dist=dists[c1.key][cur.key],dists[c1.key][cur.key]<dists[c2.key][cur.key]&&(dist=dists[c2.key][cur.key])):dist="mean"===opts.linkage?(dists[c1.key][cur.key]*c1.size+dists[c2.key][cur.key]*c2.size)/(c1.size+c2.size):"dendrogram"===opts.mode?getDist(cur.value,c1.value):getDist(cur.value[0],c1.value[0]),dists[c1.key][cur.key]=dists[cur.key][c1.key]=dist}for(var _i2=0;_i2<clusters.length;_i2++){var key1=clusters[_i2].key;if(mins[key1]===c1.key||mins[key1]===c2.key){for(var _min=key1,j=0;j<clusters.length;j++){var key2=clusters[j].key;dists[key1][key2]<dists[key1][_min]&&(_min=key2)}mins[key1]=_min}clusters[_i2].index=_i2}return c1.key=c2.key=c1.index=c2.index=null,!0},getAllChildren=function getAllChildren(root,arr,cy){root&&(root.value?arr.push(root.value):(root.left&&getAllChildren(root.left,arr),root.right&&getAllChildren(root.right,arr)))},buildDendrogram=function buildDendrogram(root,cy){if(!root)return"";if(root.left&&root.right){var leftStr=buildDendrogram(root.left,cy),rightStr=buildDendrogram(root.right,cy),node=cy.add({group:"nodes",data:{id:leftStr+","+rightStr}});return cy.add({group:"edges",data:{source:leftStr,target:node.id()}}),cy.add({group:"edges",data:{source:rightStr,target:node.id()}}),node.id()}return root.value?root.value.id():void 0},buildClustersFromTree=function buildClustersFromTree(root,k,cy){if(!root)return[];var left=[],right=[],leaves=[];return 0===k?(root.left&&getAllChildren(root.left,left),root.right&&getAllChildren(root.right,right),leaves=left.concat(right),[cy.collection(leaves)]):1===k?root.value?[cy.collection(root.value)]:(root.left&&getAllChildren(root.left,left),root.right&&getAllChildren(root.right,right),[cy.collection(left),cy.collection(right)]):root.value?[cy.collection(root.value)]:(root.left&&(left=buildClustersFromTree(root.left,k-1,cy)),root.right&&(right=buildClustersFromTree(root.right,k-1,cy)),left.concat(right))},hierarchicalClustering=function hierarchicalClustering(options){for(var cy=this.cy(),nodes=this.nodes(),opts=function setOptions(options){var opts=defaults$6(options),preferredAlias=linkageAliases[opts.linkage];return null!=preferredAlias&&(opts.linkage=preferredAlias),opts}(options),attrs=opts.attributes,getDist=function getDist(n1,n2){return clusteringDistance(opts.distance,attrs.length,(function(i){return attrs[i](n1)}),(function(i){return attrs[i](n2)}),n1,n2)},clusters=[],dists=[],mins=[],index=[],n=0;n<nodes.length;n++){var cluster={value:"dendrogram"===opts.mode?nodes[n]:[nodes[n]],key:n,index:n};clusters[n]=cluster,index[n]=cluster,dists[n]=[],mins[n]=0}for(var i=0;i<clusters.length;i++)for(var j=0;j<=i;j++){var dist=void 0;dist="dendrogram"===opts.mode?i===j?1/0:getDist(clusters[i].value,clusters[j].value):i===j?1/0:getDist(clusters[i].value[0],clusters[j].value[0]),dists[i][j]=dist,dists[j][i]=dist,dist<dists[i][mins[i]]&&(mins[i]=j)}for(var retClusters,merged=mergeClosest(clusters,index,dists,mins,opts);merged;)merged=mergeClosest(clusters,index,dists,mins,opts);return"dendrogram"===opts.mode?(retClusters=buildClustersFromTree(clusters[0],opts.dendrogramDepth,cy),opts.addDendrogram&&buildDendrogram(clusters[0],cy)):(retClusters=new Array(clusters.length),clusters.forEach((function(cluster,i){cluster.key=cluster.index=null,retClusters[i]=cy.collection(cluster.value)}))),retClusters},hierarchicalClustering$1={hierarchicalClustering:hierarchicalClustering,hca:hierarchicalClustering},defaults$7=defaults({distance:"euclidean",preference:"median",damping:.8,maxIterations:1e3,minIterations:100,attributes:[]}),getSimilarity$1=function getSimilarity(type,n1,n2,attributes){var attr=function attr(n,i){return attributes[i](n)};return-clusteringDistance(type,attributes.length,(function(i){return attr(n1,i)}),(function(i){return attr(n2,i)}),n1,n2)},getPreference=function getPreference(S,preference){var p=null;return p="median"===preference?function median(arr){var begin=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,end=arguments.length>2&&void 0!==arguments[2]?arguments[2]:arr.length,sort=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],includeHoles=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];arguments.length>3&&void 0!==arguments[3]&&!arguments[3]?(end<arr.length&&arr.splice(end,arr.length-end),begin>0&&arr.splice(0,begin)):arr=arr.slice(begin,end);for(var off=0,i=arr.length-1;i>=0;i--){var v=arr[i];includeHoles?isFinite(v)||(arr[i]=-1/0,off++):arr.splice(i,1)}sort&&arr.sort((function(a,b){return a-b}));var len=arr.length,mid=Math.floor(len/2);return len%2!=0?arr[mid+1+off]:(arr[mid-1+off]+arr[mid+off])/2}(S):"mean"===preference?function mean(arr){for(var begin=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,end=arguments.length>2&&void 0!==arguments[2]?arguments[2]:arr.length,total=0,n=0,i=begin;i<end;i++){var val=arr[i];isFinite(val)&&(total+=val,n++)}return total/n}(S):"min"===preference?function min(arr){for(var begin=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,end=arguments.length>2&&void 0!==arguments[2]?arguments[2]:arr.length,min=1/0,i=begin;i<end;i++){var val=arr[i];isFinite(val)&&(min=Math.min(val,min))}return min}(S):"max"===preference?function max(arr){for(var begin=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,end=arguments.length>2&&void 0!==arguments[2]?arguments[2]:arr.length,max=-1/0,i=begin;i<end;i++){var val=arr[i];isFinite(val)&&(max=Math.max(val,max))}return max}(S):preference,p},assignClusters=function assignClusters(n,S,exemplars){for(var clusters=[],i=0;i<n;i++){for(var index=-1,max=-1/0,ei=0;ei<exemplars.length;ei++){var e=exemplars[ei];S[i*n+e]>max&&(index=e,max=S[i*n+e])}index>0&&clusters.push(index)}for(var _ei=0;_ei<exemplars.length;_ei++)clusters[exemplars[_ei]]=exemplars[_ei];return clusters},affinityPropagation=function affinityPropagation(options){for(var n,n2,S,p,R,A,cy=this.cy(),nodes=this.nodes(),opts=function setOptions(options){var dmp=options.damping,pref=options.preference;.5<=dmp&&dmp<1||error("Damping must range on [0.5, 1).  Got: ".concat(dmp));var validPrefs=["median","mean","min","max"];return validPrefs.some((function(v){return v===pref}))||number(pref)||error("Preference must be one of [".concat(validPrefs.map((function(p){return"'".concat(p,"'")})).join(", "),"] or a number.  Got: ").concat(pref)),defaults$7(options)}(options),id2position={},i=0;i<nodes.length;i++)id2position[nodes[i].id()]=i;n2=(n=nodes.length)*n,S=new Array(n2);for(var _i=0;_i<n2;_i++)S[_i]=-1/0;for(var _i2=0;_i2<n;_i2++)for(var j=0;j<n;j++)_i2!==j&&(S[_i2*n+j]=getSimilarity$1(opts.distance,nodes[_i2],nodes[j],opts.attributes));p=getPreference(S,opts.preference);for(var _i3=0;_i3<n;_i3++)S[_i3*n+_i3]=p;R=new Array(n2);for(var _i4=0;_i4<n2;_i4++)R[_i4]=0;A=new Array(n2);for(var _i5=0;_i5<n2;_i5++)A[_i5]=0;for(var old=new Array(n),Rp=new Array(n),se=new Array(n),_i6=0;_i6<n;_i6++)old[_i6]=0,Rp[_i6]=0,se[_i6]=0;for(var iter,e=new Array(n*opts.minIterations),_i7=0;_i7<e.length;_i7++)e[_i7]=0;for(iter=0;iter<opts.maxIterations;iter++){for(var _i8=0;_i8<n;_i8++){for(var max=-1/0,max2=-1/0,maxI=-1,AS=0,_j=0;_j<n;_j++)old[_j]=R[_i8*n+_j],(AS=A[_i8*n+_j]+S[_i8*n+_j])>=max?(max2=max,max=AS,maxI=_j):AS>max2&&(max2=AS);for(var _j2=0;_j2<n;_j2++)R[_i8*n+_j2]=(1-opts.damping)*(S[_i8*n+_j2]-max)+opts.damping*old[_j2];R[_i8*n+maxI]=(1-opts.damping)*(S[_i8*n+maxI]-max2)+opts.damping*old[maxI]}for(var _i9=0;_i9<n;_i9++){for(var sum=0,_j3=0;_j3<n;_j3++)old[_j3]=A[_j3*n+_i9],Rp[_j3]=Math.max(0,R[_j3*n+_i9]),sum+=Rp[_j3];sum-=Rp[_i9],Rp[_i9]=R[_i9*n+_i9],sum+=Rp[_i9];for(var _j4=0;_j4<n;_j4++)A[_j4*n+_i9]=(1-opts.damping)*Math.min(0,sum-Rp[_j4])+opts.damping*old[_j4];A[_i9*n+_i9]=(1-opts.damping)*(sum-Rp[_i9])+opts.damping*old[_i9]}for(var K=0,_i10=0;_i10<n;_i10++){var E=A[_i10*n+_i10]+R[_i10*n+_i10]>0?1:0;e[iter%opts.minIterations*n+_i10]=E,K+=E}if(K>0&&(iter>=opts.minIterations-1||iter==opts.maxIterations-1)){for(var _sum=0,_i11=0;_i11<n;_i11++){se[_i11]=0;for(var _j5=0;_j5<opts.minIterations;_j5++)se[_i11]+=e[_j5*n+_i11];0!==se[_i11]&&se[_i11]!==opts.minIterations||_sum++}if(_sum===n)break}}for(var exemplarsIndices=function findExemplars(n,R,A){for(var indices=[],i=0;i<n;i++)R[i*n+i]+A[i*n+i]>0&&indices.push(i);return indices}(n,R,A),clusterIndices=function assign(n,S,exemplars){for(var clusters=assignClusters(n,S,exemplars),ei=0;ei<exemplars.length;ei++){for(var ii=[],c=0;c<clusters.length;c++)clusters[c]===exemplars[ei]&&ii.push(c);for(var maxI=-1,maxSum=-1/0,i=0;i<ii.length;i++){for(var sum=0,j=0;j<ii.length;j++)sum+=S[ii[j]*n+ii[i]];sum>maxSum&&(maxI=i,maxSum=sum)}exemplars[ei]=ii[maxI]}return assignClusters(n,S,exemplars)}(n,S,exemplarsIndices),clusters={},c=0;c<exemplarsIndices.length;c++)clusters[exemplarsIndices[c]]=[];for(var _i12=0;_i12<nodes.length;_i12++){var clusterIndex=clusterIndices[id2position[nodes[_i12].id()]];null!=clusterIndex&&clusters[clusterIndex].push(nodes[_i12])}for(var retClusters=new Array(exemplarsIndices.length),_c=0;_c<exemplarsIndices.length;_c++)retClusters[_c]=cy.collection(clusters[exemplarsIndices[_c]]);return retClusters},affinityPropagation$1={affinityPropagation:affinityPropagation,ap:affinityPropagation},hierholzerDefaults=defaults({root:void 0,directed:!1}),elesfn$b={hierholzer:function hierholzer(options){if(!plainObject(options)){var args=arguments;options={root:args[0],directed:args[1]}}var oddIn,oddOut,startVertex,_hierholzerDefaults=hierholzerDefaults(options),root=_hierholzerDefaults.root,directed=_hierholzerDefaults.directed,eles=this,dflag=!1;root&&(startVertex=string(root)?this.filter(root)[0].id():root[0].id());var nodes={},edges={};directed?eles.forEach((function(ele){var id=ele.id();if(ele.isNode()){var ind=ele.indegree(!0),outd=ele.outdegree(!0),d1=ind-outd,d2=outd-ind;1==d1?oddIn?dflag=!0:oddIn=id:1==d2?oddOut?dflag=!0:oddOut=id:(d2>1||d1>1)&&(dflag=!0),nodes[id]=[],ele.outgoers().forEach((function(e){e.isEdge()&&nodes[id].push(e.id())}))}else edges[id]=[void 0,ele.target().id()]})):eles.forEach((function(ele){var id=ele.id();ele.isNode()?(ele.degree(!0)%2&&(oddIn?oddOut?dflag=!0:oddOut=id:oddIn=id),nodes[id]=[],ele.connectedEdges().forEach((function(e){return nodes[id].push(e.id())}))):edges[id]=[ele.source().id(),ele.target().id()]}));var result={found:!1,trail:void 0};if(dflag)return result;if(oddOut&&oddIn)if(directed){if(startVertex&&oddOut!=startVertex)return result;startVertex=oddOut}else{if(startVertex&&oddOut!=startVertex&&oddIn!=startVertex)return result;startVertex||(startVertex=oddOut)}else startVertex||(startVertex=eles[0].id());var walk=function walk(v){for(var adj,adjTail,adjHead,currentNode=v,subtour=[v];nodes[currentNode].length;)adj=nodes[currentNode].shift(),adjTail=edges[adj][0],currentNode!=(adjHead=edges[adj][1])?(nodes[adjHead]=nodes[adjHead].filter((function(e){return e!=adj})),currentNode=adjHead):directed||currentNode==adjTail||(nodes[adjTail]=nodes[adjTail].filter((function(e){return e!=adj})),currentNode=adjTail),subtour.unshift(adj),subtour.unshift(currentNode);return subtour},trail=[],subtour=[];for(subtour=walk(startVertex);1!=subtour.length;)0==nodes[subtour[0]].length?(trail.unshift(eles.getElementById(subtour.shift())),trail.unshift(eles.getElementById(subtour.shift()))):subtour=walk(subtour.shift()).concat(subtour);for(var d in trail.unshift(eles.getElementById(subtour.shift())),nodes)if(nodes[d].length)return result;return result.found=!0,result.trail=this.spawn(trail,!0),result}},hopcroftTarjanBiconnected=function hopcroftTarjanBiconnected(){var eles=this,nodes={},id=0,edgeCount=0,components=[],stack=[],visitedEdges={},biconnectedSearch=function biconnectedSearch(root,currentNode,parent){root===parent&&(edgeCount+=1),nodes[currentNode]={id:id,low:id++,cutVertex:!1};var sourceId,targetId,otherNodeId,edgeId,edges=eles.getElementById(currentNode).connectedEdges().intersection(eles);0===edges.size()?components.push(eles.spawn(eles.getElementById(currentNode))):edges.forEach((function(edge){sourceId=edge.source().id(),targetId=edge.target().id(),(otherNodeId=sourceId===currentNode?targetId:sourceId)!==parent&&(edgeId=edge.id(),visitedEdges[edgeId]||(visitedEdges[edgeId]=!0,stack.push({x:currentNode,y:otherNodeId,edge:edge})),otherNodeId in nodes?nodes[currentNode].low=Math.min(nodes[currentNode].low,nodes[otherNodeId].id):(biconnectedSearch(root,otherNodeId,currentNode),nodes[currentNode].low=Math.min(nodes[currentNode].low,nodes[otherNodeId].low),nodes[currentNode].id<=nodes[otherNodeId].low&&(nodes[currentNode].cutVertex=!0,function buildComponent(x,y){for(var i=stack.length-1,cutset=[],component=eles.spawn();stack[i].x!=x||stack[i].y!=y;)cutset.push(stack.pop().edge),i--;cutset.push(stack.pop().edge),cutset.forEach((function(edge){var connectedNodes=edge.connectedNodes().intersection(eles);component.merge(edge),connectedNodes.forEach((function(node){var nodeId=node.id(),connectedEdges=node.connectedEdges().intersection(eles);component.merge(node),nodes[nodeId].cutVertex?component.merge(connectedEdges.filter((function(edge){return edge.isLoop()}))):component.merge(connectedEdges)}))})),components.push(component)}(currentNode,otherNodeId))))}))};eles.forEach((function(ele){if(ele.isNode()){var nodeId=ele.id();nodeId in nodes||(edgeCount=0,biconnectedSearch(nodeId,nodeId),nodes[nodeId].cutVertex=edgeCount>1)}}));var cutVertices=Object.keys(nodes).filter((function(id){return nodes[id].cutVertex})).map((function(id){return eles.getElementById(id)}));return{cut:eles.spawn(cutVertices),components:components}},tarjanStronglyConnected=function tarjanStronglyConnected(){var eles=this,nodes={},index=0,components=[],stack=[],cut=eles.spawn(eles),stronglyConnectedSearch=function stronglyConnectedSearch(sourceNodeId){if(stack.push(sourceNodeId),nodes[sourceNodeId]={index:index,low:index++,explored:!1},eles.getElementById(sourceNodeId).connectedEdges().intersection(eles).forEach((function(edge){var targetNodeId=edge.target().id();targetNodeId!==sourceNodeId&&(targetNodeId in nodes||stronglyConnectedSearch(targetNodeId),nodes[targetNodeId].explored||(nodes[sourceNodeId].low=Math.min(nodes[sourceNodeId].low,nodes[targetNodeId].low)))})),nodes[sourceNodeId].index===nodes[sourceNodeId].low){for(var componentNodes=eles.spawn();;){var nodeId=stack.pop();if(componentNodes.merge(eles.getElementById(nodeId)),nodes[nodeId].low=nodes[sourceNodeId].index,nodes[nodeId].explored=!0,nodeId===sourceNodeId)break}var componentEdges=componentNodes.edgesWith(componentNodes),component=componentNodes.merge(componentEdges);components.push(component),cut=cut.difference(component)}};return eles.forEach((function(ele){if(ele.isNode()){var nodeId=ele.id();nodeId in nodes||stronglyConnectedSearch(nodeId)}})),{cut:cut,components:components}},elesfn$c={};[elesfn,elesfn$1,elesfn$2,elesfn$3,elesfn$4,elesfn$5,elesfn$6,elesfn$7,elesfn$8,elesfn$9,elesfn$a,markovClustering$1,kClustering,hierarchicalClustering$1,affinityPropagation$1,elesfn$b,{hopcroftTarjanBiconnected:hopcroftTarjanBiconnected,htbc:hopcroftTarjanBiconnected,htb:hopcroftTarjanBiconnected,hopcroftTarjanBiconnectedComponents:hopcroftTarjanBiconnected},{tarjanStronglyConnected:tarjanStronglyConnected,tsc:tarjanStronglyConnected,tscc:tarjanStronglyConnected,tarjanStronglyConnectedComponents:tarjanStronglyConnected}].forEach((function(props){extend(elesfn$c,props)}));var api=function api(executor){if(!(this instanceof api))return new api(executor);this.id="Thenable/1.0.7",this.state=0,this.fulfillValue=void 0,this.rejectReason=void 0,this.onFulfilled=[],this.onRejected=[],this.proxy={then:this.then.bind(this)},"function"==typeof executor&&executor.call(this,this.fulfill.bind(this),this.reject.bind(this))};api.prototype={fulfill:function fulfill(value){return deliver(this,1,"fulfillValue",value)},reject:function reject(value){return deliver(this,2,"rejectReason",value)},then:function then(onFulfilled,onRejected){var next=new api;return this.onFulfilled.push(resolver(onFulfilled,next,"fulfill")),this.onRejected.push(resolver(onRejected,next,"reject")),execute(this),next.proxy}};var deliver=function deliver(curr,state,name,value){return 0===curr.state&&(curr.state=state,curr[name]=value,execute(curr)),curr},execute=function execute(curr){1===curr.state?execute_handlers(curr,"onFulfilled",curr.fulfillValue):2===curr.state&&execute_handlers(curr,"onRejected",curr.rejectReason)},execute_handlers=function execute_handlers(curr,name,value){if(0!==curr[name].length){var handlers=curr[name];curr[name]=[];var func=function func(){for(var i=0;i<handlers.length;i++)handlers[i](value)};"function"==typeof setImmediate?setImmediate(func):setTimeout(func,0)}},resolver=function resolver(cb,next,method){return function(value){if("function"!=typeof cb)next[method].call(next,value);else{var result;try{result=cb(value)}catch(e){return void next.reject(e)}resolve(next,result)}}},resolve=function resolve(promise,x){if(promise!==x&&promise.proxy!==x){var then;if("object"===_typeof(x)&&null!==x||"function"==typeof x)try{then=x.then}catch(e){return void promise.reject(e)}if("function"!=typeof then)promise.fulfill(x);else{var resolved=!1;try{then.call(x,(function(y){resolved||(resolved=!0,y===x?promise.reject(new TypeError("circular thenable chain")):resolve(promise,y))}),(function(r){resolved||(resolved=!0,promise.reject(r))}))}catch(e){resolved||promise.reject(e)}}}else promise.reject(new TypeError("cannot resolve promise with itself"))};api.all=function(ps){return new api((function(resolveAll,rejectAll){for(var vals=new Array(ps.length),doneCount=0,fulfill=function fulfill(i,val){vals[i]=val,++doneCount===ps.length&&resolveAll(vals)},i=0;i<ps.length;i++)!function(i){var p=ps[i];null!=p&&null!=p.then?p.then((function(val){fulfill(i,val)}),(function(err){rejectAll(err)})):fulfill(i,p)}(i)}))},api.resolve=function(val){return new api((function(resolve,reject){resolve(val)}))},api.reject=function(val){return new api((function(resolve,reject){reject(val)}))};var Promise$1="undefined"!=typeof Promise?Promise:api,Animation=function Animation(target,opts,opts2){var isCore=core(target),isEle=!isCore,_p=this._private=extend({duration:1e3},opts,opts2);if(_p.target=target,_p.style=_p.style||_p.css,_p.started=!1,_p.playing=!1,_p.hooked=!1,_p.applying=!1,_p.progress=0,_p.completes=[],_p.frames=[],_p.complete&&fn(_p.complete)&&_p.completes.push(_p.complete),isEle){var pos=target.position();_p.startPosition=_p.startPosition||{x:pos.x,y:pos.y},_p.startStyle=_p.startStyle||target.cy().style().getAnimationStartStyle(target,_p.style)}if(isCore){var pan=target.pan();_p.startPan={x:pan.x,y:pan.y},_p.startZoom=target.zoom()}this.length=1,this[0]=this},anifn=Animation.prototype;extend(anifn,{instanceString:function instanceString(){return"animation"},hook:function hook(){var _p=this._private;if(!_p.hooked){var tAni=_p.target._private.animation;(_p.queue?tAni.queue:tAni.current).push(this),elementOrCollection(_p.target)&&_p.target.cy().addToAnimationPool(_p.target),_p.hooked=!0}return this},play:function play(){var _p=this._private;return 1===_p.progress&&(_p.progress=0),_p.playing=!0,_p.started=!1,_p.stopped=!1,this.hook(),this},playing:function playing(){return this._private.playing},apply:function apply(){var _p=this._private;return _p.applying=!0,_p.started=!1,_p.stopped=!1,this.hook(),this},applying:function applying(){return this._private.applying},pause:function pause(){var _p=this._private;return _p.playing=!1,_p.started=!1,this},stop:function stop(){var _p=this._private;return _p.playing=!1,_p.started=!1,_p.stopped=!0,this},rewind:function rewind(){return this.progress(0)},fastforward:function fastforward(){return this.progress(1)},time:function time(t){var _p=this._private;return void 0===t?_p.progress*_p.duration:this.progress(t/_p.duration)},progress:function progress(p){var _p=this._private,wasPlaying=_p.playing;return void 0===p?_p.progress:(wasPlaying&&this.pause(),_p.progress=p,_p.started=!1,wasPlaying&&this.play(),this)},completed:function completed(){return 1===this._private.progress},reverse:function reverse(){var _p=this._private,wasPlaying=_p.playing;wasPlaying&&this.pause(),_p.progress=1-_p.progress,_p.started=!1;var swap=function swap(a,b){var _pa=_p[a];null!=_pa&&(_p[a]=_p[b],_p[b]=_pa)};if(swap("zoom","startZoom"),swap("pan","startPan"),swap("position","startPosition"),_p.style)for(var i=0;i<_p.style.length;i++){var prop=_p.style[i],name=prop.name,startStyleProp=_p.startStyle[name];_p.startStyle[name]=prop,_p.style[i]=startStyleProp}return wasPlaying&&this.play(),this},promise:function promise(type){var arr,_p=this._private;if("frame"===type)arr=_p.frames;else arr=_p.completes;return new Promise$1((function(resolve,reject){arr.push((function(){resolve()}))}))}}),anifn.complete=anifn.completed,anifn.run=anifn.play,anifn.running=anifn.playing;var define={animated:function animated(){return function animatedImpl(){var all=void 0!==this.length?this:[this];if(!(this._private.cy||this).styleEnabled())return!1;var ele=all[0];return ele?ele._private.animation.current.length>0:void 0}},clearQueue:function clearQueue(){return function clearQueueImpl(){var all=void 0!==this.length?this:[this];if(!(this._private.cy||this).styleEnabled())return this;for(var i=0;i<all.length;i++){all[i]._private.animation.queue=[]}return this}},delay:function delay(){return function delayImpl(time,complete){return(this._private.cy||this).styleEnabled()?this.animate({delay:time,duration:time,complete:complete}):this}},delayAnimation:function delayAnimation(){return function delayAnimationImpl(time,complete){return(this._private.cy||this).styleEnabled()?this.animation({delay:time,duration:time,complete:complete}):this}},animation:function animation(){return function animationImpl(properties,params){var selfIsArrayLike=void 0!==this.length,all=selfIsArrayLike?this:[this],cy=this._private.cy||this,isCore=!selfIsArrayLike,isEles=!isCore;if(!cy.styleEnabled())return this;var style=cy.style();if(properties=extend({},properties,params),0===Object.keys(properties).length)return new Animation(all[0],properties);switch(void 0===properties.duration&&(properties.duration=400),properties.duration){case"slow":properties.duration=600;break;case"fast":properties.duration=200}if(isEles&&(properties.style=style.getPropsList(properties.style||properties.css),properties.css=void 0),isEles&&null!=properties.renderedPosition){var rpos=properties.renderedPosition,pan=cy.pan(),zoom=cy.zoom();properties.position=renderedToModelPosition(rpos,zoom,pan)}if(isCore&&null!=properties.panBy){var panBy=properties.panBy,cyPan=cy.pan();properties.pan={x:cyPan.x+panBy.x,y:cyPan.y+panBy.y}}var center=properties.center||properties.centre;if(isCore&&null!=center){var centerPan=cy.getCenterPan(center.eles,properties.zoom);null!=centerPan&&(properties.pan=centerPan)}if(isCore&&null!=properties.fit){var fit=properties.fit,fitVp=cy.getFitViewport(fit.eles||fit.boundingBox,fit.padding);null!=fitVp&&(properties.pan=fitVp.pan,properties.zoom=fitVp.zoom)}if(isCore&&plainObject(properties.zoom)){var vp=cy.getZoomedViewport(properties.zoom);null!=vp?(vp.zoomed&&(properties.zoom=vp.zoom),vp.panned&&(properties.pan=vp.pan)):properties.zoom=null}return new Animation(all[0],properties)}},animate:function animate(){return function animateImpl(properties,params){var all=void 0!==this.length?this:[this];if(!(this._private.cy||this).styleEnabled())return this;params&&(properties=extend({},properties,params));for(var i=0;i<all.length;i++){var ele=all[i],queue=ele.animated()&&(void 0===properties.queue||properties.queue);ele.animation(properties,queue?{queue:!0}:void 0).play()}return this}},stop:function stop(){return function stopImpl(clearQueue,jumpToEnd){var all=void 0!==this.length?this:[this],cy=this._private.cy||this;if(!cy.styleEnabled())return this;for(var i=0;i<all.length;i++){for(var _p=all[i]._private,anis=_p.animation.current,j=0;j<anis.length;j++){var ani_p=anis[j]._private;jumpToEnd&&(ani_p.duration=0)}clearQueue&&(_p.animation.queue=[]),jumpToEnd||(_p.animation.current=[])}return cy.notify("draw"),this}}},define$1={data:function data(params){return params=extend({},{field:"data",bindingEvent:"data",allowBinding:!1,allowSetting:!1,allowGetting:!1,settingEvent:"data",settingTriggersEvent:!1,triggerFnName:"trigger",immutableKeys:{},updateStyle:!1,beforeGet:function beforeGet(self){},beforeSet:function beforeSet(self,obj){},onSet:function onSet(self){},canSet:function canSet(self){return!0}},params),function dataImpl(name,value){var p=params,selfIsArrayLike=void 0!==this.length,all=selfIsArrayLike?this:[this],single=selfIsArrayLike?this[0]:this;if(string(name)){var ret,path=-1!==name.indexOf(".")&&toPath(name);if(p.allowGetting&&void 0===value)return single&&(p.beforeGet(single),ret=path&&void 0===single._private[p.field][name]?get(single._private[p.field],path):single._private[p.field][name]),ret;if(p.allowSetting&&void 0!==value&&!p.immutableKeys[name]){var change=_defineProperty({},name,value);p.beforeSet(this,change);for(var i=0,l=all.length;i<l;i++){var ele=all[i];p.canSet(ele)&&(path&&void 0===single._private[p.field][name]?set(ele._private[p.field],path,value):ele._private[p.field][name]=value)}p.updateStyle&&this.updateStyle(),p.onSet(this),p.settingTriggersEvent&&this[p.triggerFnName](p.settingEvent)}}else if(p.allowSetting&&plainObject(name)){var k,v,obj=name,keys=Object.keys(obj);p.beforeSet(this,obj);for(var _i=0;_i<keys.length;_i++){if(v=obj[k=keys[_i]],!p.immutableKeys[k])for(var j=0;j<all.length;j++){var _ele=all[j];p.canSet(_ele)&&(_ele._private[p.field][k]=v)}}p.updateStyle&&this.updateStyle(),p.onSet(this),p.settingTriggersEvent&&this[p.triggerFnName](p.settingEvent)}else if(p.allowBinding&&fn(name)){var fn$1=name;this.on(p.bindingEvent,fn$1)}else if(p.allowGetting&&void 0===name){var _ret;return single&&(p.beforeGet(single),_ret=single._private[p.field]),_ret}return this}},removeData:function removeData(params){return params=extend({},{field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!1,immutableKeys:{}},params),function removeDataImpl(names){var p=params,all=void 0!==this.length?this:[this];if(string(names)){for(var keys=names.split(/\s+/),l=keys.length,i=0;i<l;i++){var key=keys[i];if(!emptyString(key))if(!p.immutableKeys[key])for(var i_a=0,l_a=all.length;i_a<l_a;i_a++)all[i_a]._private[p.field][key]=void 0}p.triggerEvent&&this[p.triggerFnName](p.event)}else if(void 0===names){for(var _i_a=0,_l_a=all.length;_i_a<_l_a;_i_a++)for(var _privateFields=all[_i_a]._private[p.field],_keys=Object.keys(_privateFields),_i2=0;_i2<_keys.length;_i2++){var _key=_keys[_i2];!p.immutableKeys[_key]&&(_privateFields[_key]=void 0)}p.triggerEvent&&this[p.triggerFnName](p.event)}return this}}},define$2={eventAliasesOn:function eventAliasesOn(proto){var p=proto;p.addListener=p.listen=p.bind=p.on,p.unlisten=p.unbind=p.off=p.removeListener,p.trigger=p.emit,p.pon=p.promiseOn=function(events,selector){var self=this,args=Array.prototype.slice.call(arguments,0);return new Promise$1((function(resolve,reject){var onArgs=args.concat([function callback(e){self.off.apply(self,offArgs),resolve(e)}]),offArgs=onArgs.concat([]);self.on.apply(self,onArgs)}))}}},define$3={};[define,define$1,define$2].forEach((function(m){extend(define$3,m)}));var elesfn$d={animate:define$3.animate(),animation:define$3.animation(),animated:define$3.animated(),clearQueue:define$3.clearQueue(),delay:define$3.delay(),delayAnimation:define$3.delayAnimation(),stop:define$3.stop()},elesfn$e={classes:function classes(_classes){if(void 0===_classes){var ret=[];return this[0]._private.classes.forEach((function(cls){return ret.push(cls)})),ret}array(_classes)||(_classes=(_classes||"").match(/\S+/g)||[]);for(var changed=[],classesSet=new Set$1(_classes),j=0;j<this.length;j++){for(var ele=this[j],_p=ele._private,eleClasses=_p.classes,changedEle=!1,i=0;i<_classes.length;i++){var cls=_classes[i];if(!eleClasses.has(cls)){changedEle=!0;break}}changedEle||(changedEle=eleClasses.size!==_classes.length),changedEle&&(_p.classes=classesSet,changed.push(ele))}return changed.length>0&&this.spawn(changed).updateStyle().emit("class"),this},addClass:function addClass(classes){return this.toggleClass(classes,!0)},hasClass:function hasClass(className){var ele=this[0];return null!=ele&&ele._private.classes.has(className)},toggleClass:function toggleClass(classes,toggle){array(classes)||(classes=classes.match(/\S+/g)||[]);for(var toggleUndefd=void 0===toggle,changed=[],i=0,il=this.length;i<il;i++)for(var ele=this[i],eleClasses=ele._private.classes,changedEle=!1,j=0;j<classes.length;j++){var cls=classes[j],hasClass=eleClasses.has(cls),changedNow=!1;toggle||toggleUndefd&&!hasClass?(eleClasses.add(cls),changedNow=!0):(!toggle||toggleUndefd&&hasClass)&&(eleClasses.delete(cls),changedNow=!0),!changedEle&&changedNow&&(changed.push(ele),changedEle=!0)}return changed.length>0&&this.spawn(changed).updateStyle().emit("class"),this},removeClass:function removeClass(classes){return this.toggleClass(classes,!1)},flashClass:function flashClass(classes,duration){var self=this;if(null==duration)duration=250;else if(0===duration)return self;return self.addClass(classes),setTimeout((function(){self.removeClass(classes)}),duration),self}};elesfn$e.className=elesfn$e.classNames=elesfn$e.classes;var tokens={metaChar:"[\\!\\\"\\#\\$\\%\\&\\'\\(\\)\\*\\+\\,\\.\\/\\:\\;\\<\\=\\>\\?\\@\\[\\]\\^\\`\\{\\|\\}\\~]",comparatorOp:"=|\\!=|>|>=|<|<=|\\$=|\\^=|\\*=",boolOp:"\\?|\\!|\\^",string:"\"(?:\\\\\"|[^\"])*\"|'(?:\\\\'|[^'])*'",number:number$1,meta:"degree|indegree|outdegree",separator:"\\s*,\\s*",descendant:"\\s+",child:"\\s+>\\s+",subject:"\\$",group:"node|edge|\\*",directedEdge:"\\s+->\\s+",undirectedEdge:"\\s+<->\\s+"};tokens.variable="(?:[\\w-.]|(?:\\\\"+tokens.metaChar+"))+",tokens.className="(?:[\\w-]|(?:\\\\"+tokens.metaChar+"))+",tokens.value=tokens.string+"|"+tokens.number,tokens.id=tokens.variable,function(){var ops,op,i;for(ops=tokens.comparatorOp.split("|"),i=0;i<ops.length;i++)op=ops[i],tokens.comparatorOp+="|@"+op;for(ops=tokens.comparatorOp.split("|"),i=0;i<ops.length;i++)(op=ops[i]).indexOf("!")>=0||"="!==op&&(tokens.comparatorOp+="|\\!"+op)}();var Type_GROUP=0,Type_COLLECTION=1,Type_FILTER=2,Type_DATA_COMPARE=3,Type_DATA_EXIST=4,Type_DATA_BOOL=5,Type_META_COMPARE=6,Type_STATE=7,Type_ID=8,Type_CLASS=9,Type_UNDIRECTED_EDGE=10,Type_DIRECTED_EDGE=11,Type_NODE_SOURCE=12,Type_NODE_TARGET=13,Type_NODE_NEIGHBOR=14,Type_CHILD=15,Type_DESCENDANT=16,Type_PARENT=17,Type_ANCESTOR=18,Type_COMPOUND_SPLIT=19,Type_TRUE=20,stateSelectors=[{selector:":selected",matches:function matches(ele){return ele.selected()}},{selector:":unselected",matches:function matches(ele){return!ele.selected()}},{selector:":selectable",matches:function matches(ele){return ele.selectable()}},{selector:":unselectable",matches:function matches(ele){return!ele.selectable()}},{selector:":locked",matches:function matches(ele){return ele.locked()}},{selector:":unlocked",matches:function matches(ele){return!ele.locked()}},{selector:":visible",matches:function matches(ele){return ele.visible()}},{selector:":hidden",matches:function matches(ele){return!ele.visible()}},{selector:":transparent",matches:function matches(ele){return ele.transparent()}},{selector:":grabbed",matches:function matches(ele){return ele.grabbed()}},{selector:":free",matches:function matches(ele){return!ele.grabbed()}},{selector:":removed",matches:function matches(ele){return ele.removed()}},{selector:":inside",matches:function matches(ele){return!ele.removed()}},{selector:":grabbable",matches:function matches(ele){return ele.grabbable()}},{selector:":ungrabbable",matches:function matches(ele){return!ele.grabbable()}},{selector:":animated",matches:function matches(ele){return ele.animated()}},{selector:":unanimated",matches:function matches(ele){return!ele.animated()}},{selector:":parent",matches:function matches(ele){return ele.isParent()}},{selector:":childless",matches:function matches(ele){return ele.isChildless()}},{selector:":child",matches:function matches(ele){return ele.isChild()}},{selector:":orphan",matches:function matches(ele){return ele.isOrphan()}},{selector:":nonorphan",matches:function matches(ele){return ele.isChild()}},{selector:":compound",matches:function matches(ele){return ele.isNode()?ele.isParent():ele.source().isParent()||ele.target().isParent()}},{selector:":loop",matches:function matches(ele){return ele.isLoop()}},{selector:":simple",matches:function matches(ele){return ele.isSimple()}},{selector:":active",matches:function matches(ele){return ele.active()}},{selector:":inactive",matches:function matches(ele){return!ele.active()}},{selector:":backgrounding",matches:function matches(ele){return ele.backgrounding()}},{selector:":nonbackgrounding",matches:function matches(ele){return!ele.backgrounding()}}].sort((function(a,b){return function descending(a,b){return-1*ascending(a,b)}(a.selector,b.selector)})),lookup=function(){for(var s,selToFn={},i=0;i<stateSelectors.length;i++)selToFn[(s=stateSelectors[i]).selector]=s.matches;return selToFn}(),stateSelectorRegex="("+stateSelectors.map((function(s){return s.selector})).join("|")+")",cleanMetaChars=function cleanMetaChars(str){return str.replace(new RegExp("\\\\("+tokens.metaChar+")","g"),(function(match,$1){return $1}))},replaceLastQuery=function replaceLastQuery(selector,examiningQuery,replacementQuery){selector[selector.length-1]=replacementQuery},exprs=[{name:"group",query:!0,regex:"("+tokens.group+")",populate:function populate(selector,query,_ref){var group=_slicedToArray(_ref,1)[0];query.checks.push({type:Type_GROUP,value:"*"===group?group:group+"s"})}},{name:"state",query:!0,regex:stateSelectorRegex,populate:function populate(selector,query,_ref3){var state=_slicedToArray(_ref3,1)[0];query.checks.push({type:Type_STATE,value:state})}},{name:"id",query:!0,regex:"\\#("+tokens.id+")",populate:function populate(selector,query,_ref5){var id=_slicedToArray(_ref5,1)[0];query.checks.push({type:Type_ID,value:cleanMetaChars(id)})}},{name:"className",query:!0,regex:"\\.("+tokens.className+")",populate:function populate(selector,query,_ref7){var className=_slicedToArray(_ref7,1)[0];query.checks.push({type:Type_CLASS,value:cleanMetaChars(className)})}},{name:"dataExists",query:!0,regex:"\\[\\s*("+tokens.variable+")\\s*\\]",populate:function populate(selector,query,_ref9){var variable=_slicedToArray(_ref9,1)[0];query.checks.push({type:Type_DATA_EXIST,field:cleanMetaChars(variable)})}},{name:"dataCompare",query:!0,regex:"\\[\\s*("+tokens.variable+")\\s*("+tokens.comparatorOp+")\\s*("+tokens.value+")\\s*\\]",populate:function populate(selector,query,_ref11){var _ref12=_slicedToArray(_ref11,3),variable=_ref12[0],comparatorOp=_ref12[1],value=_ref12[2];value=null!=new RegExp("^"+tokens.string+"$").exec(value)?value.substring(1,value.length-1):parseFloat(value),query.checks.push({type:Type_DATA_COMPARE,field:cleanMetaChars(variable),operator:comparatorOp,value:value})}},{name:"dataBool",query:!0,regex:"\\[\\s*("+tokens.boolOp+")\\s*("+tokens.variable+")\\s*\\]",populate:function populate(selector,query,_ref13){var _ref14=_slicedToArray(_ref13,2),boolOp=_ref14[0],variable=_ref14[1];query.checks.push({type:Type_DATA_BOOL,field:cleanMetaChars(variable),operator:boolOp})}},{name:"metaCompare",query:!0,regex:"\\[\\[\\s*("+tokens.meta+")\\s*("+tokens.comparatorOp+")\\s*("+tokens.number+")\\s*\\]\\]",populate:function populate(selector,query,_ref15){var _ref16=_slicedToArray(_ref15,3),meta=_ref16[0],comparatorOp=_ref16[1],number=_ref16[2];query.checks.push({type:Type_META_COMPARE,field:cleanMetaChars(meta),operator:comparatorOp,value:parseFloat(number)})}},{name:"nextQuery",separator:!0,regex:tokens.separator,populate:function populate(selector,query){var currentSubject=selector.currentSubject,edgeCount=selector.edgeCount,compoundCount=selector.compoundCount,lastQ=selector[selector.length-1];return null!=currentSubject&&(lastQ.subject=currentSubject,selector.currentSubject=null),lastQ.edgeCount=edgeCount,lastQ.compoundCount=compoundCount,selector.edgeCount=0,selector.compoundCount=0,selector[selector.length++]={checks:[]}}},{name:"directedEdge",separator:!0,regex:tokens.directedEdge,populate:function populate(selector,query){if(null==selector.currentSubject){var edgeQuery={checks:[]},source=query,target={checks:[]};return edgeQuery.checks.push({type:Type_DIRECTED_EDGE,source:source,target:target}),replaceLastQuery(selector,0,edgeQuery),selector.edgeCount++,target}var srcTgtQ={checks:[]},_source=query,_target={checks:[]};return srcTgtQ.checks.push({type:Type_NODE_SOURCE,source:_source,target:_target}),replaceLastQuery(selector,0,srcTgtQ),selector.edgeCount++,_target}},{name:"undirectedEdge",separator:!0,regex:tokens.undirectedEdge,populate:function populate(selector,query){if(null==selector.currentSubject){var edgeQuery={checks:[]},source=query,target={checks:[]};return edgeQuery.checks.push({type:Type_UNDIRECTED_EDGE,nodes:[source,target]}),replaceLastQuery(selector,0,edgeQuery),selector.edgeCount++,target}var nhoodQ={checks:[]},node=query,neighbor={checks:[]};return nhoodQ.checks.push({type:Type_NODE_NEIGHBOR,node:node,neighbor:neighbor}),replaceLastQuery(selector,0,nhoodQ),neighbor}},{name:"child",separator:!0,regex:tokens.child,populate:function populate(selector,query){if(null==selector.currentSubject){var parentChildQuery={checks:[]},child={checks:[]},parent=selector[selector.length-1];return parentChildQuery.checks.push({type:Type_CHILD,parent:parent,child:child}),replaceLastQuery(selector,0,parentChildQuery),selector.compoundCount++,child}if(selector.currentSubject===query){var compound={checks:[]},left=selector[selector.length-1],right={checks:[]},subject={checks:[]},_child={checks:[]},_parent={checks:[]};return compound.checks.push({type:Type_COMPOUND_SPLIT,left:left,right:right,subject:subject}),subject.checks=query.checks,query.checks=[{type:Type_TRUE}],_parent.checks.push({type:Type_TRUE}),right.checks.push({type:Type_PARENT,parent:_parent,child:_child}),replaceLastQuery(selector,0,compound),selector.currentSubject=subject,selector.compoundCount++,_child}var _parent2={checks:[]},_child2={checks:[]},pcQChecks=[{type:Type_PARENT,parent:_parent2,child:_child2}];return _parent2.checks=query.checks,query.checks=pcQChecks,selector.compoundCount++,_child2}},{name:"descendant",separator:!0,regex:tokens.descendant,populate:function populate(selector,query){if(null==selector.currentSubject){var ancChQuery={checks:[]},descendant={checks:[]},ancestor=selector[selector.length-1];return ancChQuery.checks.push({type:Type_DESCENDANT,ancestor:ancestor,descendant:descendant}),replaceLastQuery(selector,0,ancChQuery),selector.compoundCount++,descendant}if(selector.currentSubject===query){var compound={checks:[]},left=selector[selector.length-1],right={checks:[]},subject={checks:[]},_descendant={checks:[]},_ancestor={checks:[]};return compound.checks.push({type:Type_COMPOUND_SPLIT,left:left,right:right,subject:subject}),subject.checks=query.checks,query.checks=[{type:Type_TRUE}],_ancestor.checks.push({type:Type_TRUE}),right.checks.push({type:Type_ANCESTOR,ancestor:_ancestor,descendant:_descendant}),replaceLastQuery(selector,0,compound),selector.currentSubject=subject,selector.compoundCount++,_descendant}var _ancestor2={checks:[]},_descendant2={checks:[]},adQChecks=[{type:Type_ANCESTOR,ancestor:_ancestor2,descendant:_descendant2}];return _ancestor2.checks=query.checks,query.checks=adQChecks,selector.compoundCount++,_descendant2}},{name:"subject",modifier:!0,regex:tokens.subject,populate:function populate(selector,query){if(null!=selector.currentSubject&&selector.currentSubject!==query)return warn("Redefinition of subject in selector `"+selector.toString()+"`"),!1;selector.currentSubject=query;var topChk=selector[selector.length-1].checks[0],topType=null==topChk?null:topChk.type;topType===Type_DIRECTED_EDGE?topChk.type=Type_NODE_TARGET:topType===Type_UNDIRECTED_EDGE&&(topChk.type=Type_NODE_NEIGHBOR,topChk.node=topChk.nodes[1],topChk.neighbor=topChk.nodes[0],topChk.nodes=null)}}];exprs.forEach((function(e){return e.regexObj=new RegExp("^"+e.regex)}));var consumeExpr=function consumeExpr(remaining){for(var expr,match,name,j=0;j<exprs.length;j++){var e=exprs[j],n=e.name,m=remaining.match(e.regexObj);if(null!=m){match=m,expr=e,name=n;var consumed=m[0];remaining=remaining.substring(consumed.length);break}}return{expr:expr,match:match,name:name,remaining:remaining}},parse$1={parse:function parse(selector){var remaining=this.inputText=selector,currentQuery=this[0]={checks:[]};for(this.length=1,remaining=function consumeWhitespace(remaining){var match=remaining.match(/^\s+/);if(match){var consumed=match[0];remaining=remaining.substring(consumed.length)}return remaining}(remaining);;){var exprInfo=consumeExpr(remaining);if(null==exprInfo.expr)return warn("The selector `"+selector+"`is invalid"),!1;var args=exprInfo.match.slice(1),ret=exprInfo.expr.populate(this,currentQuery,args);if(!1===ret)return!1;if(null!=ret&&(currentQuery=ret),(remaining=exprInfo.remaining).match(/^\s*$/))break}var lastQ=this[this.length-1];null!=this.currentSubject&&(lastQ.subject=this.currentSubject),lastQ.edgeCount=this.edgeCount,lastQ.compoundCount=this.compoundCount;for(var i=0;i<this.length;i++){var q=this[i];if(q.compoundCount>0&&q.edgeCount>0)return warn("The selector `"+selector+"` is invalid because it uses both a compound selector and an edge selector"),!1;if(q.edgeCount>1)return warn("The selector `"+selector+"` is invalid because it uses multiple edge selectors"),!1;1===q.edgeCount&&warn("The selector `"+selector+"` is deprecated.  Edge selectors do not take effect on changes to source and target nodes after an edge is added, for performance reasons.  Use a class or data selector on edges instead, updating the class or data of an edge when your app detects a change in source or target nodes.")}return!0},toString:function toString(){if(null!=this.toStringCache)return this.toStringCache;for(var clean=function clean(obj){return null==obj?"":obj},cleanVal=function cleanVal(val){return string(val)?'"'+val+'"':clean(val)},space=function space(val){return" "+val+" "},checkToString=function checkToString(check,subject){var type=check.type,value=check.value;switch(type){case Type_GROUP:var group=clean(value);return group.substring(0,group.length-1);case Type_DATA_COMPARE:var field=check.field,operator=check.operator;return"["+field+space(clean(operator))+cleanVal(value)+"]";case Type_DATA_BOOL:var _operator=check.operator,_field=check.field;return"["+clean(_operator)+_field+"]";case Type_DATA_EXIST:return"["+check.field+"]";case Type_META_COMPARE:var _operator2=check.operator;return"[["+check.field+space(clean(_operator2))+cleanVal(value)+"]]";case Type_STATE:return value;case Type_ID:return"#"+value;case Type_CLASS:return"."+value;case Type_PARENT:case Type_CHILD:return queryToString(check.parent,subject)+space(">")+queryToString(check.child,subject);case Type_ANCESTOR:case Type_DESCENDANT:return queryToString(check.ancestor,subject)+" "+queryToString(check.descendant,subject);case Type_COMPOUND_SPLIT:var lhs=queryToString(check.left,subject),sub=queryToString(check.subject,subject),rhs=queryToString(check.right,subject);return lhs+(lhs.length>0?" ":"")+sub+rhs;case Type_TRUE:return""}},queryToString=function queryToString(query,subject){return query.checks.reduce((function(str,chk,i){return str+(subject===query&&0===i?"$":"")+checkToString(chk,subject)}),"")},str="",i=0;i<this.length;i++){var query=this[i];str+=queryToString(query,query.subject),this.length>1&&i<this.length-1&&(str+=", ")}return this.toStringCache=str,str}},valCmp=function valCmp(fieldVal,operator,value){var matches,fieldStr,valStr,isFieldStr=string(fieldVal),isFieldNum=number(fieldVal),isValStr=string(value),caseInsensitive=!1,notExpr=!1,isIneqCmp=!1;switch(operator.indexOf("!")>=0&&(operator=operator.replace("!",""),notExpr=!0),operator.indexOf("@")>=0&&(operator=operator.replace("@",""),caseInsensitive=!0),(isFieldStr||isValStr||caseInsensitive)&&(fieldStr=isFieldStr||isFieldNum?""+fieldVal:"",valStr=""+value),caseInsensitive&&(fieldVal=fieldStr=fieldStr.toLowerCase(),value=valStr=valStr.toLowerCase()),operator){case"*=":matches=fieldStr.indexOf(valStr)>=0;break;case"$=":matches=fieldStr.indexOf(valStr,fieldStr.length-valStr.length)>=0;break;case"^=":matches=0===fieldStr.indexOf(valStr);break;case"=":matches=fieldVal===value;break;case">":isIneqCmp=!0,matches=fieldVal>value;break;case">=":isIneqCmp=!0,matches=fieldVal>=value;break;case"<":isIneqCmp=!0,matches=fieldVal<value;break;case"<=":isIneqCmp=!0,matches=fieldVal<=value;break;default:matches=!1}return!notExpr||null==fieldVal&&isIneqCmp||(matches=!matches),matches},data=function data(ele,field){return ele.data(field)},match=[],matches=function matches(query,ele){return query.checks.every((function(chk){return match[chk.type](chk,ele)}))};match[Type_GROUP]=function(check,ele){var group=check.value;return"*"===group||group===ele.group()},match[Type_STATE]=function(check,ele){return function stateSelectorMatches(sel,ele){return lookup[sel](ele)}(check.value,ele)},match[Type_ID]=function(check,ele){var id=check.value;return ele.id()===id},match[Type_CLASS]=function(check,ele){var cls=check.value;return ele.hasClass(cls)},match[Type_META_COMPARE]=function(check,ele){var field=check.field,operator=check.operator,value=check.value;return valCmp(function meta(ele,field){return ele[field]()}(ele,field),operator,value)},match[Type_DATA_COMPARE]=function(check,ele){var field=check.field,operator=check.operator,value=check.value;return valCmp(data(ele,field),operator,value)},match[Type_DATA_BOOL]=function(check,ele){var field=check.field,operator=check.operator;return function boolCmp(fieldVal,operator){switch(operator){case"?":return!!fieldVal;case"!":return!fieldVal;case"^":return void 0===fieldVal}}(data(ele,field),operator)},match[Type_DATA_EXIST]=function(check,ele){var field=check.field;check.operator;return function existCmp(fieldVal){return void 0!==fieldVal}(data(ele,field))},match[Type_UNDIRECTED_EDGE]=function(check,ele){var qA=check.nodes[0],qB=check.nodes[1],src=ele.source(),tgt=ele.target();return matches(qA,src)&&matches(qB,tgt)||matches(qB,src)&&matches(qA,tgt)},match[Type_NODE_NEIGHBOR]=function(check,ele){return matches(check.node,ele)&&ele.neighborhood().some((function(n){return n.isNode()&&matches(check.neighbor,n)}))},match[Type_DIRECTED_EDGE]=function(check,ele){return matches(check.source,ele.source())&&matches(check.target,ele.target())},match[Type_NODE_SOURCE]=function(check,ele){return matches(check.source,ele)&&ele.outgoers().some((function(n){return n.isNode()&&matches(check.target,n)}))},match[Type_NODE_TARGET]=function(check,ele){return matches(check.target,ele)&&ele.incomers().some((function(n){return n.isNode()&&matches(check.source,n)}))},match[Type_CHILD]=function(check,ele){return matches(check.child,ele)&&matches(check.parent,ele.parent())},match[Type_PARENT]=function(check,ele){return matches(check.parent,ele)&&ele.children().some((function(c){return matches(check.child,c)}))},match[Type_DESCENDANT]=function(check,ele){return matches(check.descendant,ele)&&ele.ancestors().some((function(a){return matches(check.ancestor,a)}))},match[Type_ANCESTOR]=function(check,ele){return matches(check.ancestor,ele)&&ele.descendants().some((function(d){return matches(check.descendant,d)}))},match[Type_COMPOUND_SPLIT]=function(check,ele){return matches(check.subject,ele)&&matches(check.left,ele)&&matches(check.right,ele)},match[Type_TRUE]=function(){return!0},match[Type_COLLECTION]=function(check,ele){return check.value.has(ele)},match[Type_FILTER]=function(check,ele){return(0,check.value)(ele)};var matching={matches:function matches$1(ele){for(var j=0;j<this.length;j++){var query=this[j];if(matches(query,ele))return!0}return!1},filter:function filter(collection){var self=this;if(1===self.length&&1===self[0].checks.length&&self[0].checks[0].type===Type_ID)return collection.getElementById(self[0].checks[0].value).collection();var selectorFunction=function selectorFunction(element){for(var j=0;j<self.length;j++){var query=self[j];if(matches(query,element))return!0}return!1};return null==self.text()&&(selectorFunction=function selectorFunction(){return!0}),collection.filter(selectorFunction)}},Selector=function Selector(selector){this.inputText=selector,this.currentSubject=null,this.compoundCount=0,this.edgeCount=0,this.length=0,null==selector||string(selector)&&selector.match(/^\s*$/)||(elementOrCollection(selector)?this.addQuery({checks:[{type:Type_COLLECTION,value:selector.collection()}]}):fn(selector)?this.addQuery({checks:[{type:Type_FILTER,value:selector}]}):string(selector)?this.parse(selector)||(this.invalid=!0):error("A selector must be created from a string; found "))},selfn=Selector.prototype;[parse$1,matching].forEach((function(p){return extend(selfn,p)})),selfn.text=function(){return this.inputText},selfn.size=function(){return this.length},selfn.eq=function(i){return this[i]},selfn.sameText=function(otherSel){return!this.invalid&&!otherSel.invalid&&this.text()===otherSel.text()},selfn.addQuery=function(q){this[this.length++]=q},selfn.selector=selfn.toString;var elesfn$f={allAre:function allAre(selector){var selObj=new Selector(selector);return this.every((function(ele){return selObj.matches(ele)}))},is:function is(selector){var selObj=new Selector(selector);return this.some((function(ele){return selObj.matches(ele)}))},some:function some(fn,thisArg){for(var i=0;i<this.length;i++){if(thisArg?fn.apply(thisArg,[this[i],i,this]):fn(this[i],i,this))return!0}return!1},every:function every(fn,thisArg){for(var i=0;i<this.length;i++){if(!(thisArg?fn.apply(thisArg,[this[i],i,this]):fn(this[i],i,this)))return!1}return!0},same:function same(collection){if(this===collection)return!0;collection=this.cy().collection(collection);var thisLength=this.length;return thisLength===collection.length&&(1===thisLength?this[0]===collection[0]:this.every((function(ele){return collection.hasElementWithId(ele.id())})))},anySame:function anySame(collection){return collection=this.cy().collection(collection),this.some((function(ele){return collection.hasElementWithId(ele.id())}))},allAreNeighbors:function allAreNeighbors(collection){collection=this.cy().collection(collection);var nhood=this.neighborhood();return collection.every((function(ele){return nhood.hasElementWithId(ele.id())}))},contains:function contains(collection){collection=this.cy().collection(collection);var self=this;return collection.every((function(ele){return self.hasElementWithId(ele.id())}))}};elesfn$f.allAreNeighbours=elesfn$f.allAreNeighbors,elesfn$f.has=elesfn$f.contains,elesfn$f.equal=elesfn$f.equals=elesfn$f.same;var fn$1,elesfn$h,cache=function cache(fn,name){return function traversalCache(arg1,arg2,arg3,arg4){var key,selectorOrEles=arg1;if(null==selectorOrEles?key="":elementOrCollection(selectorOrEles)&&1===selectorOrEles.length&&(key=selectorOrEles.id()),1===this.length&&key){var _p=this[0]._private,tch=_p.traversalCache=_p.traversalCache||{},ch=tch[name]=tch[name]||[],hash=hashString(key),cacheHit=ch[hash];return cacheHit||(ch[hash]=fn.call(this,arg1,arg2,arg3,arg4))}return fn.call(this,arg1,arg2,arg3,arg4)}},elesfn$g={parent:function parent(selector){var parents=[];if(1===this.length){var parent=this[0]._private.parent;if(parent)return parent}for(var i=0;i<this.length;i++){var _parent=this[i]._private.parent;_parent&&parents.push(_parent)}return this.spawn(parents,!0).filter(selector)},parents:function parents(selector){for(var parents=[],eles=this.parent();eles.nonempty();){for(var i=0;i<eles.length;i++){var ele=eles[i];parents.push(ele)}eles=eles.parent()}return this.spawn(parents,!0).filter(selector)},commonAncestors:function commonAncestors(selector){for(var ancestors,i=0;i<this.length;i++){var parents=this[i].parents();ancestors=(ancestors=ancestors||parents).intersect(parents)}return ancestors.filter(selector)},orphans:function orphans(selector){return this.stdFilter((function(ele){return ele.isOrphan()})).filter(selector)},nonorphans:function nonorphans(selector){return this.stdFilter((function(ele){return ele.isChild()})).filter(selector)},children:cache((function(selector){for(var children=[],i=0;i<this.length;i++)for(var eleChildren=this[i]._private.children,j=0;j<eleChildren.length;j++)children.push(eleChildren[j]);return this.spawn(children,!0).filter(selector)}),"children"),siblings:function siblings(selector){return this.parent().children().not(this).filter(selector)},isParent:function isParent(){var ele=this[0];if(ele)return ele.isNode()&&0!==ele._private.children.length},isChildless:function isChildless(){var ele=this[0];if(ele)return ele.isNode()&&0===ele._private.children.length},isChild:function isChild(){var ele=this[0];if(ele)return ele.isNode()&&null!=ele._private.parent},isOrphan:function isOrphan(){var ele=this[0];if(ele)return ele.isNode()&&null==ele._private.parent},descendants:function descendants(selector){var elements=[];return function add(eles){for(var i=0;i<eles.length;i++){var ele=eles[i];elements.push(ele),ele.children().nonempty()&&add(ele.children())}}(this.children()),this.spawn(elements,!0).filter(selector)}};function forEachCompound(eles,fn,includeSelf,recursiveStep){for(var q=[],did=new Set$1,hasCompounds=eles.cy().hasCompoundNodes(),i=0;i<eles.length;i++){var ele=eles[i];includeSelf?q.push(ele):hasCompounds&&recursiveStep(q,did,ele)}for(;q.length>0;){var _ele=q.shift();fn(_ele),did.add(_ele.id()),hasCompounds&&recursiveStep(q,did,_ele)}return eles}function addChildren(q,did,ele){if(ele.isParent())for(var children=ele._private.children,i=0;i<children.length;i++){var child=children[i];did.has(child.id())||q.push(child)}}function addParent(q,did,ele){if(ele.isChild()){var parent=ele._private.parent;did.has(parent.id())||q.push(parent)}}function addParentAndChildren(q,did,ele){addParent(q,did,ele),addChildren(q,did,ele)}elesfn$g.forEachDown=function(fn){var includeSelf=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return forEachCompound(this,fn,includeSelf,addChildren)},elesfn$g.forEachUp=function(fn){var includeSelf=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return forEachCompound(this,fn,includeSelf,addParent)},elesfn$g.forEachUpAndDown=function(fn){var includeSelf=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return forEachCompound(this,fn,includeSelf,addParentAndChildren)},elesfn$g.ancestors=elesfn$g.parents,(fn$1=elesfn$h={data:define$3.data({field:"data",bindingEvent:"data",allowBinding:!0,allowSetting:!0,settingEvent:"data",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,immutableKeys:{id:!0,source:!0,target:!0,parent:!0},updateStyle:!0}),removeData:define$3.removeData({field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!0,immutableKeys:{id:!0,source:!0,target:!0,parent:!0},updateStyle:!0}),scratch:define$3.data({field:"scratch",bindingEvent:"scratch",allowBinding:!0,allowSetting:!0,settingEvent:"scratch",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeScratch:define$3.removeData({field:"scratch",event:"scratch",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0}),rscratch:define$3.data({field:"rscratch",allowBinding:!1,allowSetting:!0,settingTriggersEvent:!1,allowGetting:!0}),removeRscratch:define$3.removeData({field:"rscratch",triggerEvent:!1}),id:function id(){var ele=this[0];if(ele)return ele._private.data.id}}).attr=fn$1.data,fn$1.removeAttr=fn$1.removeData;var fn$2,elesfn$j,data$1=elesfn$h,elesfn$i={};function defineDegreeFunction(callback){return function(includeLoops){if(void 0===includeLoops&&(includeLoops=!0),0!==this.length&&this.isNode()&&!this.removed()){for(var degree=0,node=this[0],connectedEdges=node._private.edges,i=0;i<connectedEdges.length;i++){var edge=connectedEdges[i];!includeLoops&&edge.isLoop()||(degree+=callback(node,edge))}return degree}}}function defineDegreeBoundsFunction(degreeFn,callback){return function(includeLoops){for(var ret,nodes=this.nodes(),i=0;i<nodes.length;i++){var degree=nodes[i][degreeFn](includeLoops);void 0===degree||void 0!==ret&&!callback(degree,ret)||(ret=degree)}return ret}}extend(elesfn$i,{degree:defineDegreeFunction((function(node,edge){return edge.source().same(edge.target())?2:1})),indegree:defineDegreeFunction((function(node,edge){return edge.target().same(node)?1:0})),outdegree:defineDegreeFunction((function(node,edge){return edge.source().same(node)?1:0}))}),extend(elesfn$i,{minDegree:defineDegreeBoundsFunction("degree",(function(degree,min){return degree<min})),maxDegree:defineDegreeBoundsFunction("degree",(function(degree,max){return degree>max})),minIndegree:defineDegreeBoundsFunction("indegree",(function(degree,min){return degree<min})),maxIndegree:defineDegreeBoundsFunction("indegree",(function(degree,max){return degree>max})),minOutdegree:defineDegreeBoundsFunction("outdegree",(function(degree,min){return degree<min})),maxOutdegree:defineDegreeBoundsFunction("outdegree",(function(degree,max){return degree>max}))}),extend(elesfn$i,{totalDegree:function totalDegree(includeLoops){for(var total=0,nodes=this.nodes(),i=0;i<nodes.length;i++)total+=nodes[i].degree(includeLoops);return total}});var beforePositionSet=function beforePositionSet(eles,newPos,silent){for(var i=0;i<eles.length;i++){var ele=eles[i];if(!ele.locked()){var oldPos=ele._private.position,delta={x:null!=newPos.x?newPos.x-oldPos.x:0,y:null!=newPos.y?newPos.y-oldPos.y:0};!ele.isParent()||0===delta.x&&0===delta.y||ele.children().shift(delta,silent),ele.dirtyBoundingBoxCache()}}},positionDef={field:"position",bindingEvent:"position",allowBinding:!0,allowSetting:!0,settingEvent:"position",settingTriggersEvent:!0,triggerFnName:"emitAndNotify",allowGetting:!0,validKeys:["x","y"],beforeGet:function beforeGet(ele){ele.updateCompoundBounds()},beforeSet:function beforeSet(eles,newPos){beforePositionSet(eles,newPos,!1)},onSet:function onSet(eles){eles.dirtyCompoundBoundsCache()},canSet:function canSet(ele){return!ele.locked()}};fn$2=elesfn$j={position:define$3.data(positionDef),silentPosition:define$3.data(extend({},positionDef,{allowBinding:!1,allowSetting:!0,settingTriggersEvent:!1,allowGetting:!1,beforeSet:function beforeSet(eles,newPos){beforePositionSet(eles,newPos,!0)},onSet:function onSet(eles){eles.dirtyCompoundBoundsCache()}})),positions:function positions(pos,silent){if(plainObject(pos))silent?this.silentPosition(pos):this.position(pos);else if(fn(pos)){var _fn=pos,cy=this.cy();cy.startBatch();for(var i=0;i<this.length;i++){var _pos,ele=this[i];(_pos=_fn(ele,i))&&(silent?ele.silentPosition(_pos):ele.position(_pos))}cy.endBatch()}return this},silentPositions:function silentPositions(pos){return this.positions(pos,!0)},shift:function shift(dim,val,silent){var delta;if(plainObject(dim)?(delta={x:number(dim.x)?dim.x:0,y:number(dim.y)?dim.y:0},silent=val):string(dim)&&number(val)&&((delta={x:0,y:0})[dim]=val),null!=delta){var cy=this.cy();cy.startBatch();for(var i=0;i<this.length;i++){var ele=this[i];if(!(cy.hasCompoundNodes()&&ele.isChild()&&ele.ancestors().anySame(this))){var pos=ele.position(),newPos={x:pos.x+delta.x,y:pos.y+delta.y};silent?ele.silentPosition(newPos):ele.position(newPos)}}cy.endBatch()}return this},silentShift:function silentShift(dim,val){return plainObject(dim)?this.shift(dim,!0):string(dim)&&number(val)&&this.shift(dim,val,!0),this},renderedPosition:function renderedPosition(dim,val){var ele=this[0],cy=this.cy(),zoom=cy.zoom(),pan=cy.pan(),rpos=plainObject(dim)?dim:void 0,setting=void 0!==rpos||void 0!==val&&string(dim);if(ele&&ele.isNode()){if(!setting){var pos=ele.position();return rpos=modelToRenderedPosition(pos,zoom,pan),void 0===dim?rpos:rpos[dim]}for(var i=0;i<this.length;i++){var _ele=this[i];void 0!==val?_ele.position(dim,(val-pan[dim])/zoom):void 0!==rpos&&_ele.position(renderedToModelPosition(rpos,zoom,pan))}}else if(!setting)return;return this},relativePosition:function relativePosition(dim,val){var ele=this[0],cy=this.cy(),ppos=plainObject(dim)?dim:void 0,setting=void 0!==ppos||void 0!==val&&string(dim),hasCompoundNodes=cy.hasCompoundNodes();if(ele&&ele.isNode()){if(!setting){var pos=ele.position(),_parent=hasCompoundNodes?ele.parent():null,_hasParent=_parent&&_parent.length>0,_relativeToParent=_hasParent;_hasParent&&(_parent=_parent[0]);var _origin=_relativeToParent?_parent.position():{x:0,y:0};return ppos={x:pos.x-_origin.x,y:pos.y-_origin.y},void 0===dim?ppos:ppos[dim]}for(var i=0;i<this.length;i++){var _ele2=this[i],parent=hasCompoundNodes?_ele2.parent():null,hasParent=parent&&parent.length>0,relativeToParent=hasParent;hasParent&&(parent=parent[0]);var origin=relativeToParent?parent.position():{x:0,y:0};void 0!==val?_ele2.position(dim,val+origin[dim]):void 0!==ppos&&_ele2.position({x:ppos.x+origin.x,y:ppos.y+origin.y})}}else if(!setting)return;return this}},fn$2.modelPosition=fn$2.point=fn$2.position,fn$2.modelPositions=fn$2.points=fn$2.positions,fn$2.renderedPoint=fn$2.renderedPosition,fn$2.relativePoint=fn$2.relativePosition;var fn$3,elesfn$k,position=elesfn$j;fn$3=elesfn$k={},elesfn$k.renderedBoundingBox=function(options){var bb=this.boundingBox(options),cy=this.cy(),zoom=cy.zoom(),pan=cy.pan(),x1=bb.x1*zoom+pan.x,x2=bb.x2*zoom+pan.x,y1=bb.y1*zoom+pan.y,y2=bb.y2*zoom+pan.y;return{x1:x1,x2:x2,y1:y1,y2:y2,w:x2-x1,h:y2-y1}},elesfn$k.dirtyCompoundBoundsCache=function(){var silent=arguments.length>0&&void 0!==arguments[0]&&arguments[0],cy=this.cy();return cy.styleEnabled()&&cy.hasCompoundNodes()?(this.forEachUp((function(ele){if(ele.isParent()){var _p=ele._private;_p.compoundBoundsClean=!1,_p.bbCache=null,silent||ele.emitAndNotify("bounds")}})),this):this},elesfn$k.updateCompoundBounds=function(){var force=arguments.length>0&&void 0!==arguments[0]&&arguments[0],cy=this.cy();if(!cy.styleEnabled()||!cy.hasCompoundNodes())return this;if(!force&&cy.batching())return this;function update(parent){if(parent.isParent()){var _p=parent._private,children=parent.children(),includeLabels="include"===parent.pstyle("compound-sizing-wrt-labels").value,min={width:{val:parent.pstyle("min-width").pfValue,left:parent.pstyle("min-width-bias-left"),right:parent.pstyle("min-width-bias-right")},height:{val:parent.pstyle("min-height").pfValue,top:parent.pstyle("min-height-bias-top"),bottom:parent.pstyle("min-height-bias-bottom")}},bb=children.boundingBox({includeLabels:includeLabels,includeOverlays:!1,useCache:!1}),pos=_p.position;0!==bb.w&&0!==bb.h||((bb={w:parent.pstyle("width").pfValue,h:parent.pstyle("height").pfValue}).x1=pos.x-bb.w/2,bb.x2=pos.x+bb.w/2,bb.y1=pos.y-bb.h/2,bb.y2=pos.y+bb.h/2);var leftVal=min.width.left.value;"px"===min.width.left.units&&min.width.val>0&&(leftVal=100*leftVal/min.width.val);var rightVal=min.width.right.value;"px"===min.width.right.units&&min.width.val>0&&(rightVal=100*rightVal/min.width.val);var topVal=min.height.top.value;"px"===min.height.top.units&&min.height.val>0&&(topVal=100*topVal/min.height.val);var bottomVal=min.height.bottom.value;"px"===min.height.bottom.units&&min.height.val>0&&(bottomVal=100*bottomVal/min.height.val);var widthBiasDiffs=computeBiasValues(min.width.val-bb.w,leftVal,rightVal),diffLeft=widthBiasDiffs.biasDiff,diffRight=widthBiasDiffs.biasComplementDiff,heightBiasDiffs=computeBiasValues(min.height.val-bb.h,topVal,bottomVal),diffTop=heightBiasDiffs.biasDiff,diffBottom=heightBiasDiffs.biasComplementDiff;_p.autoPadding=function computePaddingValues(width,height,paddingObject,relativeTo){if("%"!==paddingObject.units)return"px"===paddingObject.units?paddingObject.pfValue:0;switch(relativeTo){case"width":return width>0?paddingObject.pfValue*width:0;case"height":return height>0?paddingObject.pfValue*height:0;case"average":return width>0&&height>0?paddingObject.pfValue*(width+height)/2:0;case"min":return width>0&&height>0?width>height?paddingObject.pfValue*height:paddingObject.pfValue*width:0;case"max":return width>0&&height>0?width>height?paddingObject.pfValue*width:paddingObject.pfValue*height:0;default:return 0}}(bb.w,bb.h,parent.pstyle("padding"),parent.pstyle("padding-relative-to").value),_p.autoWidth=Math.max(bb.w,min.width.val),pos.x=(-diffLeft+bb.x1+bb.x2+diffRight)/2,_p.autoHeight=Math.max(bb.h,min.height.val),pos.y=(-diffTop+bb.y1+bb.y2+diffBottom)/2}function computeBiasValues(propDiff,propBias,propBiasComplement){var biasDiff=0,biasComplementDiff=0,biasTotal=propBias+propBiasComplement;return propDiff>0&&biasTotal>0&&(biasDiff=propBias/biasTotal*propDiff,biasComplementDiff=propBiasComplement/biasTotal*propDiff),{biasDiff:biasDiff,biasComplementDiff:biasComplementDiff}}}for(var i=0;i<this.length;i++){var ele=this[i],_p=ele._private;_p.compoundBoundsClean&&!force||(update(ele),cy.batching()||(_p.compoundBoundsClean=!0))}return this};var noninf=function noninf(x){return x===1/0||x===-1/0?0:x},updateBounds=function updateBounds(b,x1,y1,x2,y2){x2-x1!=0&&y2-y1!=0&&null!=x1&&null!=y1&&null!=x2&&null!=y2&&(b.x1=x1<b.x1?x1:b.x1,b.x2=x2>b.x2?x2:b.x2,b.y1=y1<b.y1?y1:b.y1,b.y2=y2>b.y2?y2:b.y2,b.w=b.x2-b.x1,b.h=b.y2-b.y1)},updateBoundsFromBox=function updateBoundsFromBox(b,b2){return null==b2?b:updateBounds(b,b2.x1,b2.y1,b2.x2,b2.y2)},prefixedProperty=function prefixedProperty(obj,field,prefix){return getPrefixedProperty(obj,field,prefix)},updateBoundsFromArrow=function updateBoundsFromArrow(bounds,ele,prefix){if(!ele.cy().headless()){var x,y,_p=ele._private,rstyle=_p.rstyle,halfArW=rstyle.arrowWidth/2;if("none"!==ele.pstyle(prefix+"-arrow-shape").value){"source"===prefix?(x=rstyle.srcX,y=rstyle.srcY):"target"===prefix?(x=rstyle.tgtX,y=rstyle.tgtY):(x=rstyle.midX,y=rstyle.midY);var bbs=_p.arrowBounds=_p.arrowBounds||{},bb=bbs[prefix]=bbs[prefix]||{};bb.x1=x-halfArW,bb.y1=y-halfArW,bb.x2=x+halfArW,bb.y2=y+halfArW,bb.w=bb.x2-bb.x1,bb.h=bb.y2-bb.y1,expandBoundingBox(bb,1),updateBounds(bounds,bb.x1,bb.y1,bb.x2,bb.y2)}}},updateBoundsFromLabel=function updateBoundsFromLabel(bounds,ele,prefix){if(!ele.cy().headless()){var prefixDash;prefixDash=prefix?prefix+"-":"";var _p=ele._private,rstyle=_p.rstyle;if(ele.pstyle(prefixDash+"label").strValue){var lx1,lx2,ly1,ly2,halign=ele.pstyle("text-halign"),valign=ele.pstyle("text-valign"),labelWidth=prefixedProperty(rstyle,"labelWidth",prefix),labelHeight=prefixedProperty(rstyle,"labelHeight",prefix),labelX=prefixedProperty(rstyle,"labelX",prefix),labelY=prefixedProperty(rstyle,"labelY",prefix),marginX=ele.pstyle(prefixDash+"text-margin-x").pfValue,marginY=ele.pstyle(prefixDash+"text-margin-y").pfValue,isEdge=ele.isEdge(),rotation=ele.pstyle(prefixDash+"text-rotation"),outlineWidth=ele.pstyle("text-outline-width").pfValue,halfBorderWidth=ele.pstyle("text-border-width").pfValue/2,padding=ele.pstyle("text-background-padding").pfValue,lh=labelHeight,lw=labelWidth,lw_2=lw/2,lh_2=lh/2;if(isEdge)lx1=labelX-lw_2,lx2=labelX+lw_2,ly1=labelY-lh_2,ly2=labelY+lh_2;else{switch(halign.value){case"left":lx1=labelX-lw,lx2=labelX;break;case"center":lx1=labelX-lw_2,lx2=labelX+lw_2;break;case"right":lx1=labelX,lx2=labelX+lw}switch(valign.value){case"top":ly1=labelY-lh,ly2=labelY;break;case"center":ly1=labelY-lh_2,ly2=labelY+lh_2;break;case"bottom":ly1=labelY,ly2=labelY+lh}}lx1+=marginX-Math.max(outlineWidth,halfBorderWidth)-padding-2,lx2+=marginX+Math.max(outlineWidth,halfBorderWidth)+padding+2,ly1+=marginY-Math.max(outlineWidth,halfBorderWidth)-padding-2,ly2+=marginY+Math.max(outlineWidth,halfBorderWidth)+padding+2;var bbPrefix=prefix||"main",bbs=_p.labelBounds,bb=bbs[bbPrefix]=bbs[bbPrefix]||{};bb.x1=lx1,bb.y1=ly1,bb.x2=lx2,bb.y2=ly2,bb.w=lx2-lx1,bb.h=ly2-ly1;var isAutorotate=isEdge&&"autorotate"===rotation.strValue,isPfValue=null!=rotation.pfValue&&0!==rotation.pfValue;if(isAutorotate||isPfValue){var theta=isAutorotate?prefixedProperty(_p.rstyle,"labelAngle",prefix):rotation.pfValue,cos=Math.cos(theta),sin=Math.sin(theta),xo=(lx1+lx2)/2,yo=(ly1+ly2)/2;if(!isEdge){switch(halign.value){case"left":xo=lx2;break;case"right":xo=lx1}switch(valign.value){case"top":yo=ly2;break;case"bottom":yo=ly1}}var rotate=function rotate(x,y){return{x:(x-=xo)*cos-(y-=yo)*sin+xo,y:x*sin+y*cos+yo}},px1y1=rotate(lx1,ly1),px1y2=rotate(lx1,ly2),px2y1=rotate(lx2,ly1),px2y2=rotate(lx2,ly2);lx1=Math.min(px1y1.x,px1y2.x,px2y1.x,px2y2.x),lx2=Math.max(px1y1.x,px1y2.x,px2y1.x,px2y2.x),ly1=Math.min(px1y1.y,px1y2.y,px2y1.y,px2y2.y),ly2=Math.max(px1y1.y,px1y2.y,px2y1.y,px2y2.y)}var bbPrefixRot=bbPrefix+"Rot",bbRot=bbs[bbPrefixRot]=bbs[bbPrefixRot]||{};bbRot.x1=lx1,bbRot.y1=ly1,bbRot.x2=lx2,bbRot.y2=ly2,bbRot.w=lx2-lx1,bbRot.h=ly2-ly1,updateBounds(bounds,lx1,ly1,lx2,ly2),updateBounds(_p.labelBounds.all,lx1,ly1,lx2,ly2)}return bounds}},getKey=function getKey(opts){var i=0,tf=function tf(val){return(val?1:0)<<i++},key=0;return key+=tf(opts.incudeNodes),key+=tf(opts.includeEdges),key+=tf(opts.includeLabels),key+=tf(opts.includeMainLabels),key+=tf(opts.includeSourceLabels),key+=tf(opts.includeTargetLabels),key+=tf(opts.includeOverlays)},getBoundingBoxPosKey=function getBoundingBoxPosKey(ele){if(ele.isEdge()){var p1=ele.source().position(),p2=ele.target().position(),r=function r(x){return Math.round(x)};return function hashIntsArray(ints,seed){var entry={value:0,done:!1},i=0,length=ints.length;return hashIterableInts({next:function next(){return i<length?entry.value=ints[i++]:entry.done=!0,entry}},seed)}([r(p1.x),r(p1.y),r(p2.x),r(p2.y)])}return 0},cachedBoundingBoxImpl=function cachedBoundingBoxImpl(ele,opts){var bb,_p=ele._private,isEdge=ele.isEdge(),usingDefOpts=(null==opts?defBbOptsKey:getKey(opts))===defBbOptsKey,currPosKey=getBoundingBoxPosKey(ele),isPosKeySame=_p.bbCachePosKey===currPosKey,useCache=opts.useCache&&isPosKeySame,isDirty=function isDirty(ele){return null==ele._private.bbCache||ele._private.styleDirty};if(!useCache||isDirty(ele)||isEdge&&isDirty(ele.source())||isDirty(ele.target())?(isPosKeySame||ele.recalculateRenderedStyle(useCache),bb=function boundingBoxImpl(ele,options){var ex1,ex2,ey1,ey2,x,y,cy=ele._private.cy,styleEnabled=cy.styleEnabled(),headless=cy.headless(),bounds=makeBoundingBox(),_p=ele._private,isNode=ele.isNode(),isEdge=ele.isEdge(),rstyle=_p.rstyle,manualExpansion=isNode&&styleEnabled?ele.pstyle("bounds-expansion").pfValue:[0],isDisplayed=function isDisplayed(ele){return"none"!==ele.pstyle("display").value},displayed=!styleEnabled||isDisplayed(ele)&&(!isEdge||isDisplayed(ele.source())&&isDisplayed(ele.target()));if(displayed){var overlayPadding=0;styleEnabled&&options.includeOverlays&&0!==ele.pstyle("overlay-opacity").value&&(overlayPadding=ele.pstyle("overlay-padding").value);var underlayPadding=0;styleEnabled&&options.includeUnderlays&&0!==ele.pstyle("underlay-opacity").value&&(underlayPadding=ele.pstyle("underlay-padding").value);var padding=Math.max(overlayPadding,underlayPadding),wHalf=0;if(styleEnabled&&(wHalf=ele.pstyle("width").pfValue/2),isNode&&options.includeNodes){var pos=ele.position();x=pos.x,y=pos.y;var halfW=ele.outerWidth()/2,halfH=ele.outerHeight()/2;updateBounds(bounds,ex1=x-halfW,ey1=y-halfH,ex2=x+halfW,ey2=y+halfH)}else if(isEdge&&options.includeEdges)if(styleEnabled&&!headless){var curveStyle=ele.pstyle("curve-style").strValue;if(ex1=Math.min(rstyle.srcX,rstyle.midX,rstyle.tgtX),ex2=Math.max(rstyle.srcX,rstyle.midX,rstyle.tgtX),ey1=Math.min(rstyle.srcY,rstyle.midY,rstyle.tgtY),ey2=Math.max(rstyle.srcY,rstyle.midY,rstyle.tgtY),updateBounds(bounds,ex1-=wHalf,ey1-=wHalf,ex2+=wHalf,ey2+=wHalf),"haystack"===curveStyle){var hpts=rstyle.haystackPts;if(hpts&&2===hpts.length){if(ex1=hpts[0].x,ey1=hpts[0].y,ex1>(ex2=hpts[1].x)){var temp=ex1;ex1=ex2,ex2=temp}if(ey1>(ey2=hpts[1].y)){var _temp=ey1;ey1=ey2,ey2=_temp}updateBounds(bounds,ex1-wHalf,ey1-wHalf,ex2+wHalf,ey2+wHalf)}}else if("bezier"===curveStyle||"unbundled-bezier"===curveStyle||"segments"===curveStyle||"taxi"===curveStyle){var pts;switch(curveStyle){case"bezier":case"unbundled-bezier":pts=rstyle.bezierPts;break;case"segments":case"taxi":pts=rstyle.linePts}if(null!=pts)for(var j=0;j<pts.length;j++){var pt=pts[j];ex1=pt.x-wHalf,ex2=pt.x+wHalf,ey1=pt.y-wHalf,ey2=pt.y+wHalf,updateBounds(bounds,ex1,ey1,ex2,ey2)}}}else{var n1pos=ele.source().position(),n2pos=ele.target().position();if((ex1=n1pos.x)>(ex2=n2pos.x)){var _temp2=ex1;ex1=ex2,ex2=_temp2}if((ey1=n1pos.y)>(ey2=n2pos.y)){var _temp3=ey1;ey1=ey2,ey2=_temp3}updateBounds(bounds,ex1-=wHalf,ey1-=wHalf,ex2+=wHalf,ey2+=wHalf)}if(styleEnabled&&options.includeEdges&&isEdge&&(updateBoundsFromArrow(bounds,ele,"mid-source"),updateBoundsFromArrow(bounds,ele,"mid-target"),updateBoundsFromArrow(bounds,ele,"source"),updateBoundsFromArrow(bounds,ele,"target")),styleEnabled&&"yes"===ele.pstyle("ghost").value){var gx=ele.pstyle("ghost-offset-x").pfValue,gy=ele.pstyle("ghost-offset-y").pfValue;updateBounds(bounds,bounds.x1+gx,bounds.y1+gy,bounds.x2+gx,bounds.y2+gy)}var bbBody=_p.bodyBounds=_p.bodyBounds||{};assignBoundingBox(bbBody,bounds),expandBoundingBoxSides(bbBody,manualExpansion),expandBoundingBox(bbBody,1),styleEnabled&&(ex1=bounds.x1,ex2=bounds.x2,ey1=bounds.y1,ey2=bounds.y2,updateBounds(bounds,ex1-padding,ey1-padding,ex2+padding,ey2+padding));var bbOverlay=_p.overlayBounds=_p.overlayBounds||{};assignBoundingBox(bbOverlay,bounds),expandBoundingBoxSides(bbOverlay,manualExpansion),expandBoundingBox(bbOverlay,1);var bbLabels=_p.labelBounds=_p.labelBounds||{};null!=bbLabels.all?function clearBoundingBox(bb){bb.x1=1/0,bb.y1=1/0,bb.x2=-1/0,bb.y2=-1/0,bb.w=0,bb.h=0}(bbLabels.all):bbLabels.all=makeBoundingBox(),styleEnabled&&options.includeLabels&&(options.includeMainLabels&&updateBoundsFromLabel(bounds,ele,null),isEdge&&(options.includeSourceLabels&&updateBoundsFromLabel(bounds,ele,"source"),options.includeTargetLabels&&updateBoundsFromLabel(bounds,ele,"target")))}return bounds.x1=noninf(bounds.x1),bounds.y1=noninf(bounds.y1),bounds.x2=noninf(bounds.x2),bounds.y2=noninf(bounds.y2),bounds.w=noninf(bounds.x2-bounds.x1),bounds.h=noninf(bounds.y2-bounds.y1),bounds.w>0&&bounds.h>0&&displayed&&(expandBoundingBoxSides(bounds,manualExpansion),expandBoundingBox(bounds,1)),bounds}(ele,defBbOpts),_p.bbCache=bb,_p.bbCachePosKey=currPosKey):bb=_p.bbCache,!usingDefOpts){var isNode=ele.isNode();bb=makeBoundingBox(),(opts.includeNodes&&isNode||opts.includeEdges&&!isNode)&&(opts.includeOverlays?updateBoundsFromBox(bb,_p.overlayBounds):updateBoundsFromBox(bb,_p.bodyBounds)),opts.includeLabels&&(opts.includeMainLabels&&(!isEdge||opts.includeSourceLabels&&opts.includeTargetLabels)?updateBoundsFromBox(bb,_p.labelBounds.all):(opts.includeMainLabels&&updateBoundsFromBox(bb,_p.labelBounds.mainRot),opts.includeSourceLabels&&updateBoundsFromBox(bb,_p.labelBounds.sourceRot),opts.includeTargetLabels&&updateBoundsFromBox(bb,_p.labelBounds.targetRot))),bb.w=bb.x2-bb.x1,bb.h=bb.y2-bb.y1}return bb},defBbOpts={includeNodes:!0,includeEdges:!0,includeLabels:!0,includeMainLabels:!0,includeSourceLabels:!0,includeTargetLabels:!0,includeOverlays:!0,includeUnderlays:!0,useCache:!0},defBbOptsKey=getKey(defBbOpts),filledBbOpts=defaults(defBbOpts);elesfn$k.boundingBox=function(options){var bounds;if(1!==this.length||null==this[0]._private.bbCache||this[0]._private.styleDirty||void 0!==options&&void 0!==options.useCache&&!0!==options.useCache){bounds=makeBoundingBox();var opts=filledBbOpts(options=options||defBbOpts);if(this.cy().styleEnabled())for(var i=0;i<this.length;i++){var ele=this[i],_p=ele._private,currPosKey=getBoundingBoxPosKey(ele),isPosKeySame=_p.bbCachePosKey===currPosKey,useCache=opts.useCache&&isPosKeySame&&!_p.styleDirty;ele.recalculateRenderedStyle(useCache)}this.updateCompoundBounds(!options.useCache);for(var _i=0;_i<this.length;_i++){var _ele=this[_i];updateBoundsFromBox(bounds,cachedBoundingBoxImpl(_ele,opts))}}else options=void 0===options?defBbOpts:filledBbOpts(options),bounds=cachedBoundingBoxImpl(this[0],options);return bounds.x1=noninf(bounds.x1),bounds.y1=noninf(bounds.y1),bounds.x2=noninf(bounds.x2),bounds.y2=noninf(bounds.y2),bounds.w=noninf(bounds.x2-bounds.x1),bounds.h=noninf(bounds.y2-bounds.y1),bounds},elesfn$k.dirtyBoundingBoxCache=function(){for(var i=0;i<this.length;i++){var _p=this[i]._private;_p.bbCache=null,_p.bbCachePosKey=null,_p.bodyBounds=null,_p.overlayBounds=null,_p.labelBounds.all=null,_p.labelBounds.source=null,_p.labelBounds.target=null,_p.labelBounds.main=null,_p.labelBounds.sourceRot=null,_p.labelBounds.targetRot=null,_p.labelBounds.mainRot=null,_p.arrowBounds.source=null,_p.arrowBounds.target=null,_p.arrowBounds["mid-source"]=null,_p.arrowBounds["mid-target"]=null}return this.emitAndNotify("bounds"),this},elesfn$k.boundingBoxAt=function(fn){var nodes=this.nodes(),cy=this.cy(),hasCompoundNodes=cy.hasCompoundNodes(),parents=cy.collection();if(hasCompoundNodes&&(parents=nodes.filter((function(node){return node.isParent()})),nodes=nodes.not(parents)),plainObject(fn)){var obj=fn;fn=function fn(){return obj}}cy.startBatch(),nodes.forEach((function storeOldPos(node,i){return node._private.bbAtOldPos=fn(node,i)})).silentPositions(fn),hasCompoundNodes&&(parents.dirtyCompoundBoundsCache(),parents.dirtyBoundingBoxCache(),parents.updateCompoundBounds(!0));var bb=function copyBoundingBox(bb){return{x1:bb.x1,x2:bb.x2,w:bb.w,y1:bb.y1,y2:bb.y2,h:bb.h}}(this.boundingBox({useCache:!1}));return nodes.silentPositions((function getOldPos(node){return node._private.bbAtOldPos})),hasCompoundNodes&&(parents.dirtyCompoundBoundsCache(),parents.dirtyBoundingBoxCache(),parents.updateCompoundBounds(!0)),cy.endBatch(),bb},fn$3.boundingbox=fn$3.bb=fn$3.boundingBox,fn$3.renderedBoundingbox=fn$3.renderedBoundingBox;var fn$4,elesfn$l,bounds=elesfn$k;fn$4=elesfn$l={};var defineDimFns=function defineDimFns(opts){opts.uppercaseName=capitalize(opts.name),opts.autoName="auto"+opts.uppercaseName,opts.labelName="label"+opts.uppercaseName,opts.outerName="outer"+opts.uppercaseName,opts.uppercaseOuterName=capitalize(opts.outerName),fn$4[opts.name]=function dimImpl(){var ele=this[0],_p=ele._private,styleEnabled=_p.cy._private.styleEnabled;if(ele){if(styleEnabled){if(ele.isParent())return ele.updateCompoundBounds(),_p[opts.autoName]||0;var d=ele.pstyle(opts.name);return"label"===d.strValue?(ele.recalculateRenderedStyle(),_p.rstyle[opts.labelName]||0):d.pfValue}return 1}},fn$4["outer"+opts.uppercaseName]=function outerDimImpl(){var ele=this[0],styleEnabled=ele._private.cy._private.styleEnabled;if(ele)return styleEnabled?ele[opts.name]()+ele.pstyle("border-width").pfValue+2*ele.padding():1},fn$4["rendered"+opts.uppercaseName]=function renderedDimImpl(){var ele=this[0];if(ele)return ele[opts.name]()*this.cy().zoom()},fn$4["rendered"+opts.uppercaseOuterName]=function renderedOuterDimImpl(){var ele=this[0];if(ele)return ele[opts.outerName]()*this.cy().zoom()}};defineDimFns({name:"width"}),defineDimFns({name:"height"}),elesfn$l.padding=function(){var ele=this[0],_p=ele._private;return ele.isParent()?(ele.updateCompoundBounds(),void 0!==_p.autoPadding?_p.autoPadding:ele.pstyle("padding").pfValue):ele.pstyle("padding").pfValue},elesfn$l.paddedHeight=function(){var ele=this[0];return ele.height()+2*ele.padding()},elesfn$l.paddedWidth=function(){var ele=this[0];return ele.width()+2*ele.padding()};var widthHeight=elesfn$l,pts={controlPoints:{get:function controlPoints(ele){return ele.renderer().getControlPoints(ele)},mult:!0},segmentPoints:{get:function segmentPoints(ele){return ele.renderer().getSegmentPoints(ele)},mult:!0},sourceEndpoint:{get:function sourceEndpoint(ele){return ele.renderer().getSourceEndpoint(ele)}},targetEndpoint:{get:function targetEndpoint(ele){return ele.renderer().getTargetEndpoint(ele)}},midpoint:{get:function midpoint(ele){return ele.renderer().getEdgeMidpoint(ele)}}},edgePoints=Object.keys(pts).reduce((function(obj,name){var spec=pts[name],rName=function renderedName(name){return"rendered"+name[0].toUpperCase()+name.substr(1)}(name);return obj[name]=function(){return function ifEdge(ele,getValue){if(ele.isEdge())return getValue(ele)}(this,spec.get)},spec.mult?obj[rName]=function(){return function ifEdgeRenderedPositions(ele,getPoints){if(ele.isEdge()){var cy=ele.cy(),pan=cy.pan(),zoom=cy.zoom();return getPoints(ele).map((function(p){return modelToRenderedPosition(p,zoom,pan)}))}}(this,spec.get)}:obj[rName]=function(){return function ifEdgeRenderedPosition(ele,getPoint){if(ele.isEdge()){var cy=ele.cy();return modelToRenderedPosition(getPoint(ele),cy.zoom(),cy.pan())}}(this,spec.get)},obj}),{}),dimensions=extend({},position,bounds,widthHeight,edgePoints),Event=function Event(src,props){this.recycle(src,props)};function returnFalse(){return!1}function returnTrue(){return!0}Event.prototype={instanceString:function instanceString(){return"event"},recycle:function recycle(src,props){if(this.isImmediatePropagationStopped=this.isPropagationStopped=this.isDefaultPrevented=returnFalse,null!=src&&src.preventDefault?(this.type=src.type,this.isDefaultPrevented=src.defaultPrevented?returnTrue:returnFalse):null!=src&&src.type?props=src:this.type=src,null!=props&&(this.originalEvent=props.originalEvent,this.type=null!=props.type?props.type:this.type,this.cy=props.cy,this.target=props.target,this.position=props.position,this.renderedPosition=props.renderedPosition,this.namespace=props.namespace,this.layout=props.layout),null!=this.cy&&null!=this.position&&null==this.renderedPosition){var pos=this.position,zoom=this.cy.zoom(),pan=this.cy.pan();this.renderedPosition={x:pos.x*zoom+pan.x,y:pos.y*zoom+pan.y}}this.timeStamp=src&&src.timeStamp||Date.now()},preventDefault:function preventDefault(){this.isDefaultPrevented=returnTrue;var e=this.originalEvent;e&&e.preventDefault&&e.preventDefault()},stopPropagation:function stopPropagation(){this.isPropagationStopped=returnTrue;var e=this.originalEvent;e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function stopImmediatePropagation(){this.isImmediatePropagationStopped=returnTrue,this.stopPropagation()},isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse};var eventRegex=/^([^.]+)(\.(?:[^.]+))?$/,defaults$8={qualifierCompare:function qualifierCompare(q1,q2){return q1===q2},eventMatches:function eventMatches(){return!0},addEventFields:function addEventFields(){},callbackContext:function callbackContext(context){return context},beforeEmit:function beforeEmit(){},afterEmit:function afterEmit(){},bubble:function bubble(){return!1},parent:function parent(){return null},context:null},defaultsKeys=Object.keys(defaults$8),emptyOpts={};function Emitter(){for(var opts=arguments.length>0&&void 0!==arguments[0]?arguments[0]:emptyOpts,context=arguments.length>1?arguments[1]:void 0,i=0;i<defaultsKeys.length;i++){var key=defaultsKeys[i];this[key]=opts[key]||defaults$8[key]}this.context=context||this.context,this.listeners=[],this.emitting=0}var p=Emitter.prototype,forEachEvent=function forEachEvent(self,handler,events,qualifier,callback,conf,confOverrides){fn(qualifier)&&(callback=qualifier,qualifier=null),confOverrides&&(conf=null==conf?confOverrides:extend({},conf,confOverrides));for(var eventList=array(events)?events:events.split(/\s+/),i=0;i<eventList.length;i++){var evt=eventList[i];if(!emptyString(evt)){var match=evt.match(eventRegex);if(match)if(!1===handler(self,evt,match[1],match[2]?match[2]:null,qualifier,callback,conf))break}}},makeEventObj=function makeEventObj(self,obj){return self.addEventFields(self.context,obj),new Event(obj.type,obj)},forEachEventObj=function forEachEventObj(self,handler,events){if(function event(obj){return"event"===instanceStr(obj)}(events))handler(self,events);else if(plainObject(events))handler(self,makeEventObj(self,events));else for(var eventList=array(events)?events:events.split(/\s+/),i=0;i<eventList.length;i++){var evt=eventList[i];if(!emptyString(evt)){var match=evt.match(eventRegex);if(match){var type=match[1],namespace=match[2]?match[2]:null;handler(self,makeEventObj(self,{type:type,namespace:namespace,target:self.context}))}}}};p.on=p.addListener=function(events,qualifier,callback,conf,confOverrides){return forEachEvent(this,(function(self,event,type,namespace,qualifier,callback,conf){fn(callback)&&self.listeners.push({event:event,callback:callback,type:type,namespace:namespace,qualifier:qualifier,conf:conf})}),events,qualifier,callback,conf,confOverrides),this},p.one=function(events,qualifier,callback,conf){return this.on(events,qualifier,callback,conf,{one:!0})},p.removeListener=p.off=function(events,qualifier,callback,conf){var _this=this;0!==this.emitting&&(this.listeners=function copyArray(arr){return arr.slice()}(this.listeners));for(var listeners=this.listeners,_loop=function _loop(i){var listener=listeners[i];forEachEvent(_this,(function(self,event,type,namespace,qualifier,callback){if((listener.type===type||"*"===events)&&(!namespace&&".*"!==listener.namespace||listener.namespace===namespace)&&(!qualifier||self.qualifierCompare(listener.qualifier,qualifier))&&(!callback||listener.callback===callback))return listeners.splice(i,1),!1}),events,qualifier,callback,conf)},i=listeners.length-1;i>=0;i--)_loop(i);return this},p.removeAllListeners=function(){return this.removeListener("*")},p.emit=p.trigger=function(events,extraParams,manualCallback){var listeners=this.listeners,numListenersBeforeEmit=listeners.length;return this.emitting++,array(extraParams)||(extraParams=[extraParams]),forEachEventObj(this,(function(self,eventObj){null!=manualCallback&&(listeners=[{event:eventObj.event,type:eventObj.type,namespace:eventObj.namespace,callback:manualCallback}],numListenersBeforeEmit=listeners.length);for(var _loop2=function _loop2(i){var listener=listeners[i];if(listener.type===eventObj.type&&(!listener.namespace||listener.namespace===eventObj.namespace||".*"===listener.namespace)&&self.eventMatches(self.context,listener,eventObj)){var args=[eventObj];null!=extraParams&&function push(arr,otherArr){for(var i=0;i<otherArr.length;i++){var el=otherArr[i];arr.push(el)}}(args,extraParams),self.beforeEmit(self.context,listener,eventObj),listener.conf&&listener.conf.one&&(self.listeners=self.listeners.filter((function(l){return l!==listener})));var context=self.callbackContext(self.context,listener,eventObj),ret=listener.callback.apply(context,args);self.afterEmit(self.context,listener,eventObj),!1===ret&&(eventObj.stopPropagation(),eventObj.preventDefault())}},i=0;i<numListenersBeforeEmit;i++)_loop2(i);self.bubble(self.context)&&!eventObj.isPropagationStopped()&&self.parent(self.context).emit(eventObj,extraParams)}),events),this.emitting--,this};var emitterOptions={qualifierCompare:function qualifierCompare(selector1,selector2){return null==selector1||null==selector2?null==selector1&&null==selector2:selector1.sameText(selector2)},eventMatches:function eventMatches(ele,listener,eventObj){var selector=listener.qualifier;return null==selector||ele!==eventObj.target&&element(eventObj.target)&&selector.matches(eventObj.target)},addEventFields:function addEventFields(ele,evt){evt.cy=ele.cy(),evt.target=ele},callbackContext:function callbackContext(ele,listener,eventObj){return null!=listener.qualifier?eventObj.target:ele},beforeEmit:function beforeEmit(context,listener){listener.conf&&listener.conf.once&&listener.conf.onceCollection.removeListener(listener.event,listener.qualifier,listener.callback)},bubble:function bubble(){return!0},parent:function parent(ele){return ele.isChild()?ele.parent():ele.cy()}},argSelector=function argSelector(arg){return string(arg)?new Selector(arg):arg},elesfn$m={createEmitter:function createEmitter(){for(var i=0;i<this.length;i++){var ele=this[i],_p=ele._private;_p.emitter||(_p.emitter=new Emitter(emitterOptions,ele))}return this},emitter:function emitter(){return this._private.emitter},on:function on(events,selector,callback){for(var argSel=argSelector(selector),i=0;i<this.length;i++){this[i].emitter().on(events,argSel,callback)}return this},removeListener:function removeListener(events,selector,callback){for(var argSel=argSelector(selector),i=0;i<this.length;i++){this[i].emitter().removeListener(events,argSel,callback)}return this},removeAllListeners:function removeAllListeners(){for(var i=0;i<this.length;i++){this[i].emitter().removeAllListeners()}return this},one:function one(events,selector,callback){for(var argSel=argSelector(selector),i=0;i<this.length;i++){this[i].emitter().one(events,argSel,callback)}return this},once:function once(events,selector,callback){for(var argSel=argSelector(selector),i=0;i<this.length;i++){this[i].emitter().on(events,argSel,callback,{once:!0,onceCollection:this})}},emit:function emit(events,extraParams){for(var i=0;i<this.length;i++){this[i].emitter().emit(events,extraParams)}return this},emitAndNotify:function emitAndNotify(event,extraParams){if(0!==this.length)return this.cy().notify(event,this),this.emit(event,extraParams),this}};define$3.eventAliasesOn(elesfn$m);var elesfn$n={nodes:function nodes(selector){return this.filter((function(ele){return ele.isNode()})).filter(selector)},edges:function edges(selector){return this.filter((function(ele){return ele.isEdge()})).filter(selector)},byGroup:function byGroup(){for(var nodes=this.spawn(),edges=this.spawn(),i=0;i<this.length;i++){var ele=this[i];ele.isNode()?nodes.push(ele):edges.push(ele)}return{nodes:nodes,edges:edges}},filter:function filter(_filter,thisArg){if(void 0===_filter)return this;if(string(_filter)||elementOrCollection(_filter))return new Selector(_filter).filter(this);if(fn(_filter)){for(var filterEles=this.spawn(),i=0;i<this.length;i++){var ele=this[i];(thisArg?_filter.apply(thisArg,[ele,i,this]):_filter(ele,i,this))&&filterEles.push(ele)}return filterEles}return this.spawn()},not:function not(toRemove){if(toRemove){string(toRemove)&&(toRemove=this.filter(toRemove));for(var elements=this.spawn(),i=0;i<this.length;i++){var element=this[i];toRemove.has(element)||elements.push(element)}return elements}return this},absoluteComplement:function absoluteComplement(){return this.cy().mutableElements().not(this)},intersect:function intersect(other){if(string(other)){var selector=other;return this.filter(selector)}for(var elements=this.spawn(),col2=other,col1Smaller=this.length<other.length,colS=col1Smaller?this:col2,colL=col1Smaller?col2:this,i=0;i<colS.length;i++){var ele=colS[i];colL.has(ele)&&elements.push(ele)}return elements},xor:function xor(other){var cy=this._private.cy;string(other)&&(other=cy.$(other));var elements=this.spawn(),col2=other,add=function add(col,other){for(var i=0;i<col.length;i++){var ele=col[i],id=ele._private.data.id;other.hasElementWithId(id)||elements.push(ele)}};return add(this,col2),add(col2,this),elements},diff:function diff(other){var cy=this._private.cy;string(other)&&(other=cy.$(other));var left=this.spawn(),right=this.spawn(),both=this.spawn(),col2=other,add=function add(col,other,retEles){for(var i=0;i<col.length;i++){var ele=col[i],id=ele._private.data.id;other.hasElementWithId(id)?both.merge(ele):retEles.push(ele)}};return add(this,col2,left),add(col2,this,right),{left:left,right:right,both:both}},add:function add(toAdd){var cy=this._private.cy;if(!toAdd)return this;if(string(toAdd)){var selector=toAdd;toAdd=cy.mutableElements().filter(selector)}for(var elements=this.spawnSelf(),i=0;i<toAdd.length;i++){var ele=toAdd[i],add=!this.has(ele);add&&elements.push(ele)}return elements},merge:function merge(toAdd){var _p=this._private,cy=_p.cy;if(!toAdd)return this;if(toAdd&&string(toAdd)){var selector=toAdd;toAdd=cy.mutableElements().filter(selector)}for(var map=_p.map,i=0;i<toAdd.length;i++){var toAddEle=toAdd[i],id=toAddEle._private.data.id;if(!map.has(id)){var index=this.length++;this[index]=toAddEle,map.set(id,{ele:toAddEle,index:index})}}return this},unmergeAt:function unmergeAt(i){var id=this[i].id(),map=this._private.map;this[i]=void 0,map.delete(id);var unmergedLastEle=i===this.length-1;if(this.length>1&&!unmergedLastEle){var lastEleI=this.length-1,lastEle=this[lastEleI],lastEleId=lastEle._private.data.id;this[lastEleI]=void 0,this[i]=lastEle,map.set(lastEleId,{ele:lastEle,index:i})}return this.length--,this},unmergeOne:function unmergeOne(ele){ele=ele[0];var _p=this._private,id=ele._private.data.id,entry=_p.map.get(id);if(!entry)return this;var i=entry.index;return this.unmergeAt(i),this},unmerge:function unmerge(toRemove){var cy=this._private.cy;if(!toRemove)return this;if(toRemove&&string(toRemove)){var selector=toRemove;toRemove=cy.mutableElements().filter(selector)}for(var i=0;i<toRemove.length;i++)this.unmergeOne(toRemove[i]);return this},unmergeBy:function unmergeBy(toRmFn){for(var i=this.length-1;i>=0;i--){toRmFn(this[i])&&this.unmergeAt(i)}return this},map:function map(mapFn,thisArg){for(var arr=[],i=0;i<this.length;i++){var ele=this[i],ret=thisArg?mapFn.apply(thisArg,[ele,i,this]):mapFn(ele,i,this);arr.push(ret)}return arr},reduce:function reduce(fn,initialValue){for(var val=initialValue,i=0;i<this.length;i++)val=fn(val,this[i],i,this);return val},max:function max(valFn,thisArg){for(var maxEle,max=-1/0,i=0;i<this.length;i++){var ele=this[i],val=thisArg?valFn.apply(thisArg,[ele,i,this]):valFn(ele,i,this);val>max&&(max=val,maxEle=ele)}return{value:max,ele:maxEle}},min:function min(valFn,thisArg){for(var minEle,min=1/0,i=0;i<this.length;i++){var ele=this[i],val=thisArg?valFn.apply(thisArg,[ele,i,this]):valFn(ele,i,this);val<min&&(min=val,minEle=ele)}return{value:min,ele:minEle}}},fn$5=elesfn$n;fn$5.u=fn$5["|"]=fn$5["+"]=fn$5.union=fn$5.or=fn$5.add,fn$5["\\"]=fn$5["!"]=fn$5["-"]=fn$5.difference=fn$5.relativeComplement=fn$5.subtract=fn$5.not,fn$5.n=fn$5["&"]=fn$5["."]=fn$5.and=fn$5.intersection=fn$5.intersect,fn$5["^"]=fn$5["(+)"]=fn$5["(-)"]=fn$5.symmetricDifference=fn$5.symdiff=fn$5.xor,fn$5.fnFilter=fn$5.filterFn=fn$5.stdFilter=fn$5.filter,fn$5.complement=fn$5.abscomp=fn$5.absoluteComplement;var zIndexSort=function zIndexSort(a,b){var hasCompoundNodes=a.cy().hasCompoundNodes();function getDepth(ele){var style=ele.pstyle("z-compound-depth");return"auto"===style.value?hasCompoundNodes?ele.zDepth():0:"bottom"===style.value?-1:"top"===style.value?MAX_INT:0}var depthDiff=getDepth(a)-getDepth(b);if(0!==depthDiff)return depthDiff;function getEleDepth(ele){return"auto"===ele.pstyle("z-index-compare").value&&ele.isNode()?1:0}var eleDiff=getEleDepth(a)-getEleDepth(b);if(0!==eleDiff)return eleDiff;var zDiff=a.pstyle("z-index").value-b.pstyle("z-index").value;return 0!==zDiff?zDiff:a.poolIndex()-b.poolIndex()},elesfn$p={forEach:function forEach(fn$1,thisArg){if(fn(fn$1))for(var N=this.length,i=0;i<N;i++){var ele=this[i];if(!1===(thisArg?fn$1.apply(thisArg,[ele,i,this]):fn$1(ele,i,this)))break}return this},toArray:function toArray(){for(var array=[],i=0;i<this.length;i++)array.push(this[i]);return array},slice:function slice(start,end){var array=[],thisSize=this.length;null==end&&(end=thisSize),null==start&&(start=0),start<0&&(start=thisSize+start),end<0&&(end=thisSize+end);for(var i=start;i>=0&&i<end&&i<thisSize;i++)array.push(this[i]);return this.spawn(array)},size:function size(){return this.length},eq:function eq(i){return this[i]||this.spawn()},first:function first(){return this[0]||this.spawn()},last:function last(){return this[this.length-1]||this.spawn()},empty:function empty(){return 0===this.length},nonempty:function nonempty(){return!this.empty()},sort:function sort(sortFn){if(!fn(sortFn))return this;var sorted=this.toArray().sort(sortFn);return this.spawn(sorted)},sortByZIndex:function sortByZIndex(){return this.sort(zIndexSort)},zDepth:function zDepth(){var ele=this[0];if(ele){var _p=ele._private;if("nodes"===_p.group){var depth=_p.data.parent?ele.parents().size():0;return ele.isParent()?depth:MAX_INT-1}var src=_p.source,tgt=_p.target,srcDepth=src.zDepth(),tgtDepth=tgt.zDepth();return Math.max(srcDepth,tgtDepth,0)}}};elesfn$p.each=elesfn$p.forEach;!function defineSymbolIterator(){"undefined"!=("undefined"==typeof Symbol?"undefined":_typeof(Symbol))&&"undefined"!=_typeof(Symbol.iterator)&&(elesfn$p[Symbol.iterator]=function(){var _this=this,entry={value:void 0,done:!1},i=0,length=this.length;return _defineProperty({next:function next(){return i<length?entry.value=_this[i++]:(entry.value=void 0,entry.done=!0),entry}},Symbol.iterator,(function(){return this}))})}();var getLayoutDimensionOptions=defaults({nodeDimensionsIncludeLabels:!1}),elesfn$q={layoutDimensions:function layoutDimensions(options){var dims;if(options=getLayoutDimensionOptions(options),this.takesUpSpace())if(options.nodeDimensionsIncludeLabels){var bbDim=this.boundingBox();dims={w:bbDim.w,h:bbDim.h}}else dims={w:this.outerWidth(),h:this.outerHeight()};else dims={w:0,h:0};return 0!==dims.w&&0!==dims.h||(dims.w=dims.h=1),dims},layoutPositions:function layoutPositions(layout,options,fn){var nodes=this.nodes().filter((function(n){return!n.isParent()})),cy=this.cy(),layoutEles=options.eles,getMemoizeKey=function getMemoizeKey(node){return node.id()},fnMem=memoize(fn,getMemoizeKey);layout.emit({type:"layoutstart",layout:layout}),layout.animations=[];var useSpacingFactor=options.spacingFactor&&1!==options.spacingFactor,bb=function spacingBb(){if(!useSpacingFactor)return null;for(var bb=makeBoundingBox(),i=0;i<nodes.length;i++){var node=nodes[i],pos=fnMem(node,i);expandBoundingBoxByPoint(bb,pos.x,pos.y)}return bb}(),getFinalPos=memoize((function(node,i){var newPos=fnMem(node,i);useSpacingFactor&&(newPos=function calculateSpacing(spacing,nodesBb,pos){var center_x=nodesBb.x1+nodesBb.w/2,center_y=nodesBb.y1+nodesBb.h/2;return{x:center_x+(pos.x-center_x)*spacing,y:center_y+(pos.y-center_y)*spacing}}(Math.abs(options.spacingFactor),bb,newPos));return null!=options.transform&&(newPos=options.transform(node,newPos)),newPos}),getMemoizeKey);if(options.animate){for(var i=0;i<nodes.length;i++){var node=nodes[i],newPos=getFinalPos(node,i);if(null==options.animateFilter||options.animateFilter(node,i)){var ani=node.animation({position:newPos,duration:options.animationDuration,easing:options.animationEasing});layout.animations.push(ani)}else node.position(newPos)}if(options.fit){var fitAni=cy.animation({fit:{boundingBox:layoutEles.boundingBoxAt(getFinalPos),padding:options.padding},duration:options.animationDuration,easing:options.animationEasing});layout.animations.push(fitAni)}else if(void 0!==options.zoom&&void 0!==options.pan){var zoomPanAni=cy.animation({zoom:options.zoom,pan:options.pan,duration:options.animationDuration,easing:options.animationEasing});layout.animations.push(zoomPanAni)}layout.animations.forEach((function(ani){return ani.play()})),layout.one("layoutready",options.ready),layout.emit({type:"layoutready",layout:layout}),Promise$1.all(layout.animations.map((function(ani){return ani.promise()}))).then((function(){layout.one("layoutstop",options.stop),layout.emit({type:"layoutstop",layout:layout})}))}else nodes.positions(getFinalPos),options.fit&&cy.fit(options.eles,options.padding),null!=options.zoom&&cy.zoom(options.zoom),options.pan&&cy.pan(options.pan),layout.one("layoutready",options.ready),layout.emit({type:"layoutready",layout:layout}),layout.one("layoutstop",options.stop),layout.emit({type:"layoutstop",layout:layout});return this},layout:function layout(options){return this.cy().makeLayout(extend({},options,{eles:this}))}};function styleCache(key,fn,ele){var val,_p=ele._private,cache=_p.styleCache=_p.styleCache||[];return null!=(val=cache[key])?val:val=cache[key]=fn(ele)}function cacheStyleFunction(key,fn){return key=hashString(key),function cachedStyleFunction(ele){return styleCache(key,fn,ele)}}function cachePrototypeStyleFunction(key,fn){key=hashString(key);var selfFn=function selfFn(ele){return fn.call(ele)};return function cachedPrototypeStyleFunction(){var ele=this[0];if(ele)return styleCache(key,selfFn,ele)}}elesfn$q.createLayout=elesfn$q.makeLayout=elesfn$q.layout;var elesfn$r={recalculateRenderedStyle:function recalculateRenderedStyle(useCache){var cy=this.cy(),renderer=cy.renderer(),styleEnabled=cy.styleEnabled();return renderer&&styleEnabled&&renderer.recalculateRenderedStyle(this,useCache),this},dirtyStyleCache:function dirtyStyleCache(){var eles,cy=this.cy(),dirty=function dirty(ele){return ele._private.styleCache=null};cy.hasCompoundNodes()?((eles=this.spawnSelf().merge(this.descendants()).merge(this.parents())).merge(eles.connectedEdges()),eles.forEach(dirty)):this.forEach((function(ele){dirty(ele),ele.connectedEdges().forEach(dirty)}));return this},updateStyle:function updateStyle(notifyRenderer){var cy=this._private.cy;if(!cy.styleEnabled())return this;if(cy.batching())return cy._private.batchStyleEles.merge(this),this;var updatedEles=this;notifyRenderer=!(!notifyRenderer&&void 0!==notifyRenderer),cy.hasCompoundNodes()&&(updatedEles=this.spawnSelf().merge(this.descendants()).merge(this.parents()));var changedEles=updatedEles;return notifyRenderer?changedEles.emitAndNotify("style"):changedEles.emit("style"),updatedEles.forEach((function(ele){return ele._private.styleDirty=!0})),this},cleanStyle:function cleanStyle(){var cy=this.cy();if(cy.styleEnabled())for(var i=0;i<this.length;i++){var ele=this[i];ele._private.styleDirty&&(ele._private.styleDirty=!1,cy.style().apply(ele))}},parsedStyle:function parsedStyle(property){var includeNonDefault=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],ele=this[0],cy=ele.cy();if(cy.styleEnabled()&&ele){this.cleanStyle();var overriddenStyle=ele._private.style[property];return null!=overriddenStyle?overriddenStyle:includeNonDefault?cy.style().getDefaultProperty(property):null}},numericStyle:function numericStyle(property){var ele=this[0];if(ele.cy().styleEnabled()&&ele){var pstyle=ele.pstyle(property);return void 0!==pstyle.pfValue?pstyle.pfValue:pstyle.value}},numericStyleUnits:function numericStyleUnits(property){var ele=this[0];if(ele.cy().styleEnabled())return ele?ele.pstyle(property).units:void 0},renderedStyle:function renderedStyle(property){var cy=this.cy();if(!cy.styleEnabled())return this;var ele=this[0];return ele?cy.style().getRenderedStyle(ele,property):void 0},style:function style(name,value){var cy=this.cy();if(!cy.styleEnabled())return this;var style=cy.style();if(plainObject(name)){var props=name;style.applyBypass(this,props,false),this.emitAndNotify("style")}else if(string(name)){if(void 0===value){var ele=this[0];return ele?style.getStylePropertyValue(ele,name):void 0}style.applyBypass(this,name,value,false),this.emitAndNotify("style")}else if(void 0===name){var _ele=this[0];return _ele?style.getRawStyle(_ele):void 0}return this},removeStyle:function removeStyle(names){var cy=this.cy();if(!cy.styleEnabled())return this;var style=cy.style();if(void 0===names)for(var i=0;i<this.length;i++){var ele=this[i];style.removeAllBypasses(ele,false)}else{names=names.split(/\s+/);for(var _i=0;_i<this.length;_i++){var _ele2=this[_i];style.removeBypasses(_ele2,names,false)}}return this.emitAndNotify("style"),this},show:function show(){return this.css("display","element"),this},hide:function hide(){return this.css("display","none"),this},effectiveOpacity:function effectiveOpacity(){var cy=this.cy();if(!cy.styleEnabled())return 1;var hasCompoundNodes=cy.hasCompoundNodes(),ele=this[0];if(ele){var _p=ele._private,parentOpacity=ele.pstyle("opacity").value;if(!hasCompoundNodes)return parentOpacity;var parents=_p.data.parent?ele.parents():null;if(parents)for(var i=0;i<parents.length;i++){parentOpacity*=parents[i].pstyle("opacity").value}return parentOpacity}},transparent:function transparent(){if(!this.cy().styleEnabled())return!1;var ele=this[0],hasCompoundNodes=ele.cy().hasCompoundNodes();return ele?hasCompoundNodes?0===ele.effectiveOpacity():0===ele.pstyle("opacity").value:void 0},backgrounding:function backgrounding(){return!!this.cy().styleEnabled()&&!!this[0]._private.backgrounding}};function checkCompound(ele,parentOk){var parents=ele._private.data.parent?ele.parents():null;if(parents)for(var i=0;i<parents.length;i++){if(!parentOk(parents[i]))return!1}return!0}function defineDerivedStateFunction(specs){var ok=specs.ok,edgeOkViaNode=specs.edgeOkViaNode||specs.ok,parentOk=specs.parentOk||specs.ok;return function(){var cy=this.cy();if(!cy.styleEnabled())return!0;var ele=this[0],hasCompoundNodes=cy.hasCompoundNodes();if(ele){var _p=ele._private;if(!ok(ele))return!1;if(ele.isNode())return!hasCompoundNodes||checkCompound(ele,parentOk);var src=_p.source,tgt=_p.target;return edgeOkViaNode(src)&&(!hasCompoundNodes||checkCompound(src,edgeOkViaNode))&&(src===tgt||edgeOkViaNode(tgt)&&(!hasCompoundNodes||checkCompound(tgt,edgeOkViaNode)))}}}var eleTakesUpSpace=cacheStyleFunction("eleTakesUpSpace",(function(ele){return"element"===ele.pstyle("display").value&&0!==ele.width()&&(!ele.isNode()||0!==ele.height())}));elesfn$r.takesUpSpace=cachePrototypeStyleFunction("takesUpSpace",defineDerivedStateFunction({ok:eleTakesUpSpace}));var eleInteractive=cacheStyleFunction("eleInteractive",(function(ele){return"yes"===ele.pstyle("events").value&&"visible"===ele.pstyle("visibility").value&&eleTakesUpSpace(ele)})),parentInteractive=cacheStyleFunction("parentInteractive",(function(parent){return"visible"===parent.pstyle("visibility").value&&eleTakesUpSpace(parent)}));elesfn$r.interactive=cachePrototypeStyleFunction("interactive",defineDerivedStateFunction({ok:eleInteractive,parentOk:parentInteractive,edgeOkViaNode:eleTakesUpSpace})),elesfn$r.noninteractive=function(){var ele=this[0];if(ele)return!ele.interactive()};var eleVisible=cacheStyleFunction("eleVisible",(function(ele){return"visible"===ele.pstyle("visibility").value&&0!==ele.pstyle("opacity").pfValue&&eleTakesUpSpace(ele)})),edgeVisibleViaNode=eleTakesUpSpace;elesfn$r.visible=cachePrototypeStyleFunction("visible",defineDerivedStateFunction({ok:eleVisible,edgeOkViaNode:edgeVisibleViaNode})),elesfn$r.hidden=function(){var ele=this[0];if(ele)return!ele.visible()},elesfn$r.isBundledBezier=cachePrototypeStyleFunction("isBundledBezier",(function(){return!!this.cy().styleEnabled()&&(!this.removed()&&"bezier"===this.pstyle("curve-style").value&&this.takesUpSpace())})),elesfn$r.bypass=elesfn$r.css=elesfn$r.style,elesfn$r.renderedCss=elesfn$r.renderedStyle,elesfn$r.removeBypass=elesfn$r.removeCss=elesfn$r.removeStyle,elesfn$r.pstyle=elesfn$r.parsedStyle;var elesfn$s={};function defineSwitchFunction(params){return function(){var args=arguments,changedEles=[];if(2===args.length){var data=args[0],handler=args[1];this.on(params.event,data,handler)}else if(1===args.length&&fn(args[0])){var _handler=args[0];this.on(params.event,_handler)}else if(0===args.length||1===args.length&&array(args[0])){for(var addlEvents=1===args.length?args[0]:null,i=0;i<this.length;i++){var ele=this[i],able=!params.ableField||ele._private[params.ableField],changed=ele._private[params.field]!=params.value;if(params.overrideAble){var overrideAble=params.overrideAble(ele);if(void 0!==overrideAble&&(able=overrideAble,!overrideAble))return this}able&&(ele._private[params.field]=params.value,changed&&changedEles.push(ele))}var changedColl=this.spawn(changedEles);changedColl.updateStyle(),changedColl.emit(params.event),addlEvents&&changedColl.emit(addlEvents)}return this}}function defineSwitchSet(params){elesfn$s[params.field]=function(){var ele=this[0];if(ele){if(params.overrideField){var val=params.overrideField(ele);if(void 0!==val)return val}return ele._private[params.field]}},elesfn$s[params.on]=defineSwitchFunction({event:params.on,field:params.field,ableField:params.ableField,overrideAble:params.overrideAble,value:!0}),elesfn$s[params.off]=defineSwitchFunction({event:params.off,field:params.field,ableField:params.ableField,overrideAble:params.overrideAble,value:!1})}defineSwitchSet({field:"locked",overrideField:function overrideField(ele){return!!ele.cy().autolock()||void 0},on:"lock",off:"unlock"}),defineSwitchSet({field:"grabbable",overrideField:function overrideField(ele){return!ele.cy().autoungrabify()&&!ele.pannable()&&void 0},on:"grabify",off:"ungrabify"}),defineSwitchSet({field:"selected",ableField:"selectable",overrideAble:function overrideAble(ele){return!ele.cy().autounselectify()&&void 0},on:"select",off:"unselect"}),defineSwitchSet({field:"selectable",overrideField:function overrideField(ele){return!ele.cy().autounselectify()&&void 0},on:"selectify",off:"unselectify"}),elesfn$s.deselect=elesfn$s.unselect,elesfn$s.grabbed=function(){var ele=this[0];if(ele)return ele._private.grabbed},defineSwitchSet({field:"active",on:"activate",off:"unactivate"}),defineSwitchSet({field:"pannable",on:"panify",off:"unpanify"}),elesfn$s.inactive=function(){var ele=this[0];if(ele)return!ele._private.active};var elesfn$t={},defineDagExtremity=function defineDagExtremity(params){return function dagExtremityImpl(selector){for(var ret=[],i=0;i<this.length;i++){var ele=this[i];if(ele.isNode()){for(var disqualified=!1,edges=ele.connectedEdges(),j=0;j<edges.length;j++){var edge=edges[j],src=edge.source(),tgt=edge.target();if(params.noIncomingEdges&&tgt===ele&&src!==ele||params.noOutgoingEdges&&src===ele&&tgt!==ele){disqualified=!0;break}}disqualified||ret.push(ele)}}return this.spawn(ret,!0).filter(selector)}},defineDagOneHop=function defineDagOneHop(params){return function(selector){for(var oEles=[],i=0;i<this.length;i++){var ele=this[i];if(ele.isNode())for(var edges=ele.connectedEdges(),j=0;j<edges.length;j++){var edge=edges[j],src=edge.source(),tgt=edge.target();params.outgoing&&src===ele?(oEles.push(edge),oEles.push(tgt)):params.incoming&&tgt===ele&&(oEles.push(edge),oEles.push(src))}}return this.spawn(oEles,!0).filter(selector)}},defineDagAllHops=function defineDagAllHops(params){return function(selector){for(var eles=this,sEles=[],sElesIds={};;){var next=params.outgoing?eles.outgoers():eles.incomers();if(0===next.length)break;for(var newNext=!1,i=0;i<next.length;i++){var n=next[i],nid=n.id();sElesIds[nid]||(sElesIds[nid]=!0,sEles.push(n),newNext=!0)}if(!newNext)break;eles=next}return this.spawn(sEles,!0).filter(selector)}};function defineSourceFunction(params){return function sourceImpl(selector){for(var sources=[],i=0;i<this.length;i++){var src=this[i]._private[params.attr];src&&sources.push(src)}return this.spawn(sources,!0).filter(selector)}}function defineEdgesWithFunction(params){return function edgesWithImpl(otherNodes){var elements=[],cy=this._private.cy,p=params||{};string(otherNodes)&&(otherNodes=cy.$(otherNodes));for(var h=0;h<otherNodes.length;h++)for(var edges=otherNodes[h]._private.edges,i=0;i<edges.length;i++){var edge=edges[i],edgeData=edge._private.data,thisToOther=this.hasElementWithId(edgeData.source)&&otherNodes.hasElementWithId(edgeData.target),otherToThis=otherNodes.hasElementWithId(edgeData.source)&&this.hasElementWithId(edgeData.target);if(thisToOther||otherToThis){if(p.thisIsSrc||p.thisIsTgt){if(p.thisIsSrc&&!thisToOther)continue;if(p.thisIsTgt&&!otherToThis)continue}elements.push(edge)}}return this.spawn(elements,!0)}}function defineParallelEdgesFunction(params){return params=extend({},{codirected:!1},params),function parallelEdgesImpl(selector){for(var elements=[],edges=this.edges(),p=params,i=0;i<edges.length;i++)for(var edge1_p=edges[i]._private,src1=edge1_p.source,srcid1=src1._private.data.id,tgtid1=edge1_p.data.target,srcEdges1=src1._private.edges,j=0;j<srcEdges1.length;j++){var edge2=srcEdges1[j],edge2data=edge2._private.data,tgtid2=edge2data.target,srcid2=edge2data.source,codirected=tgtid2===tgtid1&&srcid2===srcid1,oppdirected=srcid1===tgtid2&&tgtid1===srcid2;(p.codirected&&codirected||!p.codirected&&(codirected||oppdirected))&&elements.push(edge2)}return this.spawn(elements,!0).filter(selector)}}elesfn$t.clearTraversalCache=function(){for(var i=0;i<this.length;i++)this[i]._private.traversalCache=null},extend(elesfn$t,{roots:defineDagExtremity({noIncomingEdges:!0}),leaves:defineDagExtremity({noOutgoingEdges:!0}),outgoers:cache(defineDagOneHop({outgoing:!0}),"outgoers"),successors:defineDagAllHops({outgoing:!0}),incomers:cache(defineDagOneHop({incoming:!0}),"incomers"),predecessors:defineDagAllHops({incoming:!0})}),extend(elesfn$t,{neighborhood:cache((function(selector){for(var elements=[],nodes=this.nodes(),i=0;i<nodes.length;i++)for(var node=nodes[i],connectedEdges=node.connectedEdges(),j=0;j<connectedEdges.length;j++){var edge=connectedEdges[j],src=edge.source(),tgt=edge.target(),otherNode=node===src?tgt:src;otherNode.length>0&&elements.push(otherNode[0]),elements.push(edge[0])}return this.spawn(elements,!0).filter(selector)}),"neighborhood"),closedNeighborhood:function closedNeighborhood(selector){return this.neighborhood().add(this).filter(selector)},openNeighborhood:function openNeighborhood(selector){return this.neighborhood(selector)}}),elesfn$t.neighbourhood=elesfn$t.neighborhood,elesfn$t.closedNeighbourhood=elesfn$t.closedNeighborhood,elesfn$t.openNeighbourhood=elesfn$t.openNeighborhood,extend(elesfn$t,{source:cache((function sourceImpl(selector){var src,ele=this[0];return ele&&(src=ele._private.source||ele.cy().collection()),src&&selector?src.filter(selector):src}),"source"),target:cache((function targetImpl(selector){var tgt,ele=this[0];return ele&&(tgt=ele._private.target||ele.cy().collection()),tgt&&selector?tgt.filter(selector):tgt}),"target"),sources:defineSourceFunction({attr:"source"}),targets:defineSourceFunction({attr:"target"})}),extend(elesfn$t,{edgesWith:cache(defineEdgesWithFunction(),"edgesWith"),edgesTo:cache(defineEdgesWithFunction({thisIsSrc:!0}),"edgesTo")}),extend(elesfn$t,{connectedEdges:cache((function(selector){for(var retEles=[],i=0;i<this.length;i++){var node=this[i];if(node.isNode())for(var edges=node._private.edges,j=0;j<edges.length;j++){var edge=edges[j];retEles.push(edge)}}return this.spawn(retEles,!0).filter(selector)}),"connectedEdges"),connectedNodes:cache((function(selector){for(var retEles=[],i=0;i<this.length;i++){var edge=this[i];edge.isEdge()&&(retEles.push(edge.source()[0]),retEles.push(edge.target()[0]))}return this.spawn(retEles,!0).filter(selector)}),"connectedNodes"),parallelEdges:cache(defineParallelEdgesFunction(),"parallelEdges"),codirectedEdges:cache(defineParallelEdgesFunction({codirected:!0}),"codirectedEdges")}),extend(elesfn$t,{components:function components(root){var self=this,cy=self.cy(),visited=cy.collection(),unvisited=null==root?self.nodes():root.nodes(),components=[];null!=root&&unvisited.empty()&&(unvisited=root.sources());var visitInComponent=function visitInComponent(node,component){visited.merge(node),unvisited.unmerge(node),component.merge(node)};if(unvisited.empty())return self.spawn();var _loop=function _loop(){var cmpt=cy.collection();components.push(cmpt);var root=unvisited[0];visitInComponent(root,cmpt),self.bfs({directed:!1,roots:root,visit:function visit(v){return visitInComponent(v,cmpt)}}),cmpt.forEach((function(node){node.connectedEdges().forEach((function(e){self.has(e)&&cmpt.has(e.source())&&cmpt.has(e.target())&&cmpt.merge(e)}))}))};do{_loop()}while(unvisited.length>0);return components},component:function component(){var ele=this[0];return ele.cy().mutableElements().components(ele)[0]}}),elesfn$t.componentsOf=elesfn$t.components;var Collection=function Collection(cy,elements){var unique=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(void 0!==cy){var map=new Map$1,createdElements=!1;if(elements){if(elements.length>0&&plainObject(elements[0])&&!element(elements[0])){createdElements=!0;for(var eles=[],elesIds=new Set$1,i=0,l=elements.length;i<l;i++){var json=elements[i];null==json.data&&(json.data={});var _data=json.data;if(null==_data.id)_data.id=uuid();else if(cy.hasElementWithId(_data.id)||elesIds.has(_data.id))continue;var ele=new Element(cy,json,!1);eles.push(ele),elesIds.add(_data.id)}elements=eles}}else elements=[];this.length=0;for(var _i=0,_l=elements.length;_i<_l;_i++){var element$1=elements[_i][0];if(null!=element$1){var id=element$1._private.data.id;unique&&map.has(id)||(unique&&map.set(id,{index:this.length,ele:element$1}),this[this.length]=element$1,this.length++)}}this._private={eles:this,cy:cy,get map(){return null==this.lazyMap&&this.rebuildMap(),this.lazyMap},set map(m){this.lazyMap=m},rebuildMap:function rebuildMap(){for(var m=this.lazyMap=new Map$1,eles=this.eles,_i2=0;_i2<eles.length;_i2++){var _ele=eles[_i2];m.set(_ele.id(),{index:_i2,ele:_ele})}}},unique&&(this._private.map=map),createdElements&&this.restore()}else error("A collection must have a reference to the core")},elesfn$u=Element.prototype=Collection.prototype=Object.create(Array.prototype);elesfn$u.instanceString=function(){return"collection"},elesfn$u.spawn=function(eles,unique){return new Collection(this.cy(),eles,unique)},elesfn$u.spawnSelf=function(){return this.spawn(this)},elesfn$u.cy=function(){return this._private.cy},elesfn$u.renderer=function(){return this._private.cy.renderer()},elesfn$u.element=function(){return this[0]},elesfn$u.collection=function(){return collection(this)?this:new Collection(this._private.cy,[this])},elesfn$u.unique=function(){return new Collection(this._private.cy,this,!0)},elesfn$u.hasElementWithId=function(id){return id=""+id,this._private.map.has(id)},elesfn$u.getElementById=function(id){id=""+id;var cy=this._private.cy,entry=this._private.map.get(id);return entry?entry.ele:new Collection(cy)},elesfn$u.$id=elesfn$u.getElementById,elesfn$u.poolIndex=function(){var eles=this._private.cy._private.elements,id=this[0]._private.data.id;return eles._private.map.get(id).index},elesfn$u.indexOf=function(ele){var id=ele[0]._private.data.id;return this._private.map.get(id).index},elesfn$u.indexOfId=function(id){return id=""+id,this._private.map.get(id).index},elesfn$u.json=function(obj){var ele=this.element(),cy=this.cy();if(null==ele&&obj)return this;if(null!=ele){var p=ele._private;if(plainObject(obj)){if(cy.startBatch(),obj.data){ele.data(obj.data);var _data2=p.data;if(ele.isEdge()){var move=!1,spec={},src=obj.data.source,tgt=obj.data.target;null!=src&&src!=_data2.source&&(spec.source=""+src,move=!0),null!=tgt&&tgt!=_data2.target&&(spec.target=""+tgt,move=!0),move&&(ele=ele.move(spec))}else{var newParentValSpecd="parent"in obj.data,parent=obj.data.parent;!newParentValSpecd||null==parent&&null==_data2.parent||parent==_data2.parent||(void 0===parent&&(parent=null),null!=parent&&(parent=""+parent),ele=ele.move({parent:parent}))}}obj.position&&ele.position(obj.position);var checkSwitch=function checkSwitch(k,trueFnName,falseFnName){var obj_k=obj[k];null!=obj_k&&obj_k!==p[k]&&(obj_k?ele[trueFnName]():ele[falseFnName]())};return checkSwitch("removed","remove","restore"),checkSwitch("selected","select","unselect"),checkSwitch("selectable","selectify","unselectify"),checkSwitch("locked","lock","unlock"),checkSwitch("grabbable","grabify","ungrabify"),checkSwitch("pannable","panify","unpanify"),null!=obj.classes&&ele.classes(obj.classes),cy.endBatch(),this}if(void 0===obj){var json={data:copy(p.data),position:copy(p.position),group:p.group,removed:p.removed,selected:p.selected,selectable:p.selectable,locked:p.locked,grabbable:p.grabbable,pannable:p.pannable,classes:null};json.classes="";var i=0;return p.classes.forEach((function(cls){return json.classes+=0==i++?cls:" "+cls})),json}}},elesfn$u.jsons=function(){for(var jsons=[],i=0;i<this.length;i++){var json=this[i].json();jsons.push(json)}return jsons},elesfn$u.clone=function(){for(var cy=this.cy(),elesArr=[],i=0;i<this.length;i++){var json=this[i].json(),clone=new Element(cy,json,!1);elesArr.push(clone)}return new Collection(cy,elesArr)},elesfn$u.copy=elesfn$u.clone,elesfn$u.restore=function(){for(var elements,i,notifyRenderer=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],addToPool=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],self=this,cy=self.cy(),cy_p=cy._private,nodes=[],edges=[],_i3=0,l=self.length;_i3<l;_i3++){var ele=self[_i3];addToPool&&!ele.removed()||(ele.isNode()?nodes.push(ele):edges.push(ele))}elements=nodes.concat(edges);var removeFromElements=function removeFromElements(){elements.splice(i,1),i--};for(i=0;i<elements.length;i++){var _ele2=elements[i],_private=_ele2._private,_data3=_private.data;if(_ele2.clearTraversalCache(),addToPool||_private.removed)if(void 0===_data3.id)_data3.id=uuid();else if(number(_data3.id))_data3.id=""+_data3.id;else{if(emptyString(_data3.id)||!string(_data3.id)){error("Can not create element with invalid string ID `"+_data3.id+"`"),removeFromElements();continue}if(cy.hasElementWithId(_data3.id)){error("Can not create second element with ID `"+_data3.id+"`"),removeFromElements();continue}}else;var id=_data3.id;if(_ele2.isNode()){var pos=_private.position;null==pos.x&&(pos.x=0),null==pos.y&&(pos.y=0)}if(_ele2.isEdge()){for(var edge=_ele2,fields=["source","target"],fieldsLength=fields.length,badSourceOrTarget=!1,j=0;j<fieldsLength;j++){var field=fields[j],val=_data3[field];number(val)&&(val=_data3[field]=""+_data3[field]),null==val||""===val?(error("Can not create edge `"+id+"` with unspecified "+field),badSourceOrTarget=!0):cy.hasElementWithId(val)||(error("Can not create edge `"+id+"` with nonexistant "+field+" `"+val+"`"),badSourceOrTarget=!0)}if(badSourceOrTarget){removeFromElements();continue}var src=cy.getElementById(_data3.source),tgt=cy.getElementById(_data3.target);src.same(tgt)?src._private.edges.push(edge):(src._private.edges.push(edge),tgt._private.edges.push(edge)),edge._private.source=src,edge._private.target=tgt}_private.map=new Map$1,_private.map.set(id,{ele:_ele2,index:0}),_private.removed=!1,addToPool&&cy.addToPool(_ele2)}for(var _i4=0;_i4<nodes.length;_i4++){var node=nodes[_i4],_data4=node._private.data;number(_data4.parent)&&(_data4.parent=""+_data4.parent);var parentId=_data4.parent,specifiedParent=null!=parentId;if(specifiedParent){var parent=cy.getElementById(parentId);if(parent.empty())_data4.parent=void 0;else{for(var selfAsParent=!1,ancestor=parent;!ancestor.empty();){if(node.same(ancestor)){selfAsParent=!0,_data4.parent=void 0;break}ancestor=ancestor.parent()}selfAsParent||(parent[0]._private.children.push(node),node._private.parent=parent[0],cy_p.hasCompoundNodes=!0)}}}if(elements.length>0){for(var restored=elements.length===self.length?self:new Collection(cy,elements),_i5=0;_i5<restored.length;_i5++){var _ele3=restored[_i5];_ele3.isNode()||(_ele3.parallelEdges().clearTraversalCache(),_ele3.source().clearTraversalCache(),_ele3.target().clearTraversalCache())}(cy_p.hasCompoundNodes?cy.collection().merge(restored).merge(restored.connectedNodes()).merge(restored.parent()):restored).dirtyCompoundBoundsCache().dirtyBoundingBoxCache().updateStyle(notifyRenderer),notifyRenderer?restored.emitAndNotify("add"):addToPool&&restored.emit("add")}return self},elesfn$u.removed=function(){var ele=this[0];return ele&&ele._private.removed},elesfn$u.inside=function(){var ele=this[0];return ele&&!ele._private.removed},elesfn$u.remove=function(){var notifyRenderer=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],removeFromPool=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],self=this,elesToRemove=[],elesToRemoveIds={},cy=self._private.cy;function addConnectedEdges(node){for(var edges=node._private.edges,i=0;i<edges.length;i++)add(edges[i])}function addChildren(node){for(var children=node._private.children,i=0;i<children.length;i++)add(children[i])}function add(ele){var alreadyAdded=elesToRemoveIds[ele.id()];removeFromPool&&ele.removed()||alreadyAdded||(elesToRemoveIds[ele.id()]=!0,ele.isNode()?(elesToRemove.push(ele),addConnectedEdges(ele),addChildren(ele)):elesToRemove.unshift(ele))}for(var i=0,l=self.length;i<l;i++){var ele=self[i];add(ele)}function removeEdgeRef(node,edge){var connectedEdges=node._private.edges;removeFromArray(connectedEdges,edge),node.clearTraversalCache()}function removeParallelRef(pllEdge){pllEdge.clearTraversalCache()}var alteredParents=[];function removeChildRef(parent,ele){ele=ele[0];var children=(parent=parent[0])._private.children,pid=parent.id();removeFromArray(children,ele),ele._private.parent=null,alteredParents.ids[pid]||(alteredParents.ids[pid]=!0,alteredParents.push(parent))}alteredParents.ids={},self.dirtyCompoundBoundsCache(),removeFromPool&&cy.removeFromPool(elesToRemove);for(var _i6=0;_i6<elesToRemove.length;_i6++){var _ele4=elesToRemove[_i6];if(_ele4.isEdge()){var src=_ele4.source()[0],tgt=_ele4.target()[0];removeEdgeRef(src,_ele4),removeEdgeRef(tgt,_ele4);for(var pllEdges=_ele4.parallelEdges(),j=0;j<pllEdges.length;j++){var pllEdge=pllEdges[j];removeParallelRef(pllEdge),pllEdge.isBundledBezier()&&pllEdge.dirtyBoundingBoxCache()}}else{var parent=_ele4.parent();0!==parent.length&&removeChildRef(parent,_ele4)}removeFromPool&&(_ele4._private.removed=!0)}var elesStillInside=cy._private.elements;cy._private.hasCompoundNodes=!1;for(var _i7=0;_i7<elesStillInside.length;_i7++){var _ele5=elesStillInside[_i7];if(_ele5.isParent()){cy._private.hasCompoundNodes=!0;break}}var removedElements=new Collection(this.cy(),elesToRemove);removedElements.size()>0&&(notifyRenderer?removedElements.emitAndNotify("remove"):removeFromPool&&removedElements.emit("remove"));for(var _i8=0;_i8<alteredParents.length;_i8++){var _ele6=alteredParents[_i8];removeFromPool&&_ele6.removed()||_ele6.updateStyle()}return removedElements},elesfn$u.move=function(struct){var cy=this._private.cy,eles=this,toString=function toString(id){return null==id?id:""+id};if(void 0!==struct.source||void 0!==struct.target){var srcId=toString(struct.source),tgtId=toString(struct.target),srcExists=null!=srcId&&cy.hasElementWithId(srcId),tgtExists=null!=tgtId&&cy.hasElementWithId(tgtId);(srcExists||tgtExists)&&(cy.batch((function(){eles.remove(false,false),eles.emitAndNotify("moveout");for(var i=0;i<eles.length;i++){var ele=eles[i],_data5=ele._private.data;ele.isEdge()&&(srcExists&&(_data5.source=srcId),tgtExists&&(_data5.target=tgtId))}eles.restore(false,false)})),eles.emitAndNotify("move"))}else if(void 0!==struct.parent){var parentId=toString(struct.parent);if(null===parentId||cy.hasElementWithId(parentId)){var pidToAssign=null===parentId?void 0:parentId;cy.batch((function(){var updated=eles.remove(false,false);updated.emitAndNotify("moveout");for(var i=0;i<eles.length;i++){var ele=eles[i],_data6=ele._private.data;ele.isNode()&&(_data6.parent=pidToAssign)}updated.restore(false,false)})),eles.emitAndNotify("move")}}return this},[elesfn$c,elesfn$d,elesfn$e,elesfn$f,elesfn$g,data$1,elesfn$i,dimensions,elesfn$m,elesfn$n,{isNode:function isNode(){return"nodes"===this.group()},isEdge:function isEdge(){return"edges"===this.group()},isLoop:function isLoop(){return this.isEdge()&&this.source()[0]===this.target()[0]},isSimple:function isSimple(){return this.isEdge()&&this.source()[0]!==this.target()[0]},group:function group(){var ele=this[0];if(ele)return ele._private.group}},elesfn$p,elesfn$q,elesfn$r,elesfn$s,elesfn$t].forEach((function(props){extend(elesfn$u,props)}));var corefn={add:function add(opts){var elements,cy=this;if(elementOrCollection(opts)){var eles=opts;if(eles._private.cy===cy)elements=eles.restore();else{for(var jsons=[],i=0;i<eles.length;i++){var ele=eles[i];jsons.push(ele.json())}elements=new Collection(cy,jsons)}}else if(array(opts)){elements=new Collection(cy,opts)}else if(plainObject(opts)&&(array(opts.nodes)||array(opts.edges))){for(var elesByGroup=opts,_jsons2=[],grs=["nodes","edges"],_i=0,il=grs.length;_i<il;_i++){var group=grs[_i],elesArray=elesByGroup[group];if(array(elesArray))for(var j=0,jl=elesArray.length;j<jl;j++){var json=extend({group:group},elesArray[j]);_jsons2.push(json)}}elements=new Collection(cy,_jsons2)}else{elements=new Element(cy,opts).collection()}return elements},remove:function remove(collection){if(elementOrCollection(collection));else if(string(collection)){var selector=collection;collection=this.$(selector)}return collection.remove()}};var generateSpringRK4=function(){function springAccelerationForState(state){return-state.tension*state.x-state.friction*state.v}function springEvaluateStateWithDerivative(initialState,dt,derivative){var state={x:initialState.x+derivative.dx*dt,v:initialState.v+derivative.dv*dt,tension:initialState.tension,friction:initialState.friction};return{dx:state.v,dv:springAccelerationForState(state)}}function springIntegrateState(state,dt){var a={dx:state.v,dv:springAccelerationForState(state)},b=springEvaluateStateWithDerivative(state,.5*dt,a),c=springEvaluateStateWithDerivative(state,.5*dt,b),d=springEvaluateStateWithDerivative(state,dt,c),dxdt=1/6*(a.dx+2*(b.dx+c.dx)+d.dx),dvdt=1/6*(a.dv+2*(b.dv+c.dv)+d.dv);return state.x=state.x+dxdt*dt,state.v=state.v+dvdt*dt,state}return function springRK4Factory(tension,friction,duration){var have_duration,dt,last_state,initState={x:-1,v:0,tension:null,friction:null},path=[0],time_lapsed=0;for(tension=parseFloat(tension)||500,friction=parseFloat(friction)||20,duration=duration||null,initState.tension=tension,initState.friction=friction,dt=(have_duration=null!==duration)?(time_lapsed=springRK4Factory(tension,friction))/duration*.016:.016;last_state=springIntegrateState(last_state||initState,dt),path.push(1+last_state.x),time_lapsed+=16,Math.abs(last_state.x)>1e-4&&Math.abs(last_state.v)>1e-4;);return have_duration?function(percentComplete){return path[percentComplete*(path.length-1)|0]}:time_lapsed}}(),cubicBezier=function cubicBezier(t1,p1,t2,p2){var bezier=function generateCubicBezier(mX1,mY1,mX2,mY2){var NEWTON_ITERATIONS=4,NEWTON_MIN_SLOPE=.001,SUBDIVISION_PRECISION=1e-7,SUBDIVISION_MAX_ITERATIONS=10,kSplineTableSize=11,kSampleStepSize=1/(kSplineTableSize-1),float32ArraySupported="undefined"!=typeof Float32Array;if(4!==arguments.length)return!1;for(var i=0;i<4;++i)if("number"!=typeof arguments[i]||isNaN(arguments[i])||!isFinite(arguments[i]))return!1;mX1=Math.min(mX1,1),mX2=Math.min(mX2,1),mX1=Math.max(mX1,0),mX2=Math.max(mX2,0);var mSampleValues=float32ArraySupported?new Float32Array(kSplineTableSize):new Array(kSplineTableSize);function A(aA1,aA2){return 1-3*aA2+3*aA1}function B(aA1,aA2){return 3*aA2-6*aA1}function C(aA1){return 3*aA1}function calcBezier(aT,aA1,aA2){return((A(aA1,aA2)*aT+B(aA1,aA2))*aT+C(aA1))*aT}function getSlope(aT,aA1,aA2){return 3*A(aA1,aA2)*aT*aT+2*B(aA1,aA2)*aT+C(aA1)}function newtonRaphsonIterate(aX,aGuessT){for(var _i=0;_i<NEWTON_ITERATIONS;++_i){var currentSlope=getSlope(aGuessT,mX1,mX2);if(0===currentSlope)return aGuessT;aGuessT-=(calcBezier(aGuessT,mX1,mX2)-aX)/currentSlope}return aGuessT}function calcSampleValues(){for(var _i2=0;_i2<kSplineTableSize;++_i2)mSampleValues[_i2]=calcBezier(_i2*kSampleStepSize,mX1,mX2)}function binarySubdivide(aX,aA,aB){var currentX,currentT,i=0;do{(currentX=calcBezier(currentT=aA+(aB-aA)/2,mX1,mX2)-aX)>0?aB=currentT:aA=currentT}while(Math.abs(currentX)>SUBDIVISION_PRECISION&&++i<SUBDIVISION_MAX_ITERATIONS);return currentT}function getTForX(aX){for(var intervalStart=0,currentSample=1,lastSample=kSplineTableSize-1;currentSample!==lastSample&&mSampleValues[currentSample]<=aX;++currentSample)intervalStart+=kSampleStepSize;--currentSample;var guessForT=intervalStart+(aX-mSampleValues[currentSample])/(mSampleValues[currentSample+1]-mSampleValues[currentSample])*kSampleStepSize,initialSlope=getSlope(guessForT,mX1,mX2);return initialSlope>=NEWTON_MIN_SLOPE?newtonRaphsonIterate(aX,guessForT):0===initialSlope?guessForT:binarySubdivide(aX,intervalStart,intervalStart+kSampleStepSize)}var _precomputed=!1;function precompute(){_precomputed=!0,mX1===mY1&&mX2===mY2||calcSampleValues()}var f=function f(aX){return _precomputed||precompute(),mX1===mY1&&mX2===mY2?aX:0===aX?0:1===aX?1:calcBezier(getTForX(aX),mY1,mY2)};f.getControlPoints=function(){return[{x:mX1,y:mY1},{x:mX2,y:mY2}]};var str="generateBezier("+[mX1,mY1,mX2,mY2]+")";return f.toString=function(){return str},f}(t1,p1,t2,p2);return function(start,end,percent){return start+(end-start)*bezier(percent)}},easings={linear:function linear(start,end,percent){return start+(end-start)*percent},ease:cubicBezier(.25,.1,.25,1),"ease-in":cubicBezier(.42,0,1,1),"ease-out":cubicBezier(0,0,.58,1),"ease-in-out":cubicBezier(.42,0,.58,1),"ease-in-sine":cubicBezier(.47,0,.745,.715),"ease-out-sine":cubicBezier(.39,.575,.565,1),"ease-in-out-sine":cubicBezier(.445,.05,.55,.95),"ease-in-quad":cubicBezier(.55,.085,.68,.53),"ease-out-quad":cubicBezier(.25,.46,.45,.94),"ease-in-out-quad":cubicBezier(.455,.03,.515,.955),"ease-in-cubic":cubicBezier(.55,.055,.675,.19),"ease-out-cubic":cubicBezier(.215,.61,.355,1),"ease-in-out-cubic":cubicBezier(.645,.045,.355,1),"ease-in-quart":cubicBezier(.895,.03,.685,.22),"ease-out-quart":cubicBezier(.165,.84,.44,1),"ease-in-out-quart":cubicBezier(.77,0,.175,1),"ease-in-quint":cubicBezier(.755,.05,.855,.06),"ease-out-quint":cubicBezier(.23,1,.32,1),"ease-in-out-quint":cubicBezier(.86,0,.07,1),"ease-in-expo":cubicBezier(.95,.05,.795,.035),"ease-out-expo":cubicBezier(.19,1,.22,1),"ease-in-out-expo":cubicBezier(1,0,0,1),"ease-in-circ":cubicBezier(.6,.04,.98,.335),"ease-out-circ":cubicBezier(.075,.82,.165,1),"ease-in-out-circ":cubicBezier(.785,.135,.15,.86),spring:function spring(tension,friction,duration){if(0===duration)return easings.linear;var spring=generateSpringRK4(tension,friction,duration);return function(start,end,percent){return start+(end-start)*spring(percent)}},"cubic-bezier":cubicBezier};function getEasedValue(type,start,end,percent,easingFn){if(1===percent)return end;if(start===end)return end;var val=easingFn(start,end,percent);return null==type||((type.roundValue||type.color)&&(val=Math.round(val)),void 0!==type.min&&(val=Math.max(val,type.min)),void 0!==type.max&&(val=Math.min(val,type.max))),val}function getValue(prop,spec){return null!=prop.pfValue||null!=prop.value?null==prop.pfValue||null!=spec&&"%"===spec.type.units?prop.value:prop.pfValue:prop}function ease(startProp,endProp,percent,easingFn,propSpec){var type=null!=propSpec?propSpec.type:null;percent<0?percent=0:percent>1&&(percent=1);var start=getValue(startProp,propSpec),end=getValue(endProp,propSpec);if(number(start)&&number(end))return getEasedValue(type,start,end,percent,easingFn);if(array(start)&&array(end)){for(var easedArr=[],i=0;i<end.length;i++){var si=start[i],ei=end[i];if(null!=si&&null!=ei){var val=getEasedValue(type,si,ei,percent,easingFn);easedArr.push(val)}else easedArr.push(ei)}return easedArr}}function step(self,ani,now,isCore){var isEles=!isCore,_p=self._private,ani_p=ani._private,pEasing=ani_p.easing,startTime=ani_p.startTime,style=(isCore?self:self.cy()).style();if(!ani_p.easingImpl)if(null==pEasing)ani_p.easingImpl=easings.linear;else{var easingVals,name,args;if(string(pEasing))easingVals=style.parse("transition-timing-function",pEasing).value;else easingVals=pEasing;string(easingVals)?(name=easingVals,args=[]):(name=easingVals[1],args=easingVals.slice(2).map((function(n){return+n}))),args.length>0?("spring"===name&&args.push(ani_p.duration),ani_p.easingImpl=easings[name].apply(null,args)):ani_p.easingImpl=easings[name]}var percent,easing=ani_p.easingImpl;if(percent=0===ani_p.duration?1:(now-startTime)/ani_p.duration,ani_p.applying&&(percent=ani_p.progress),percent<0?percent=0:percent>1&&(percent=1),null==ani_p.delay){var startPos=ani_p.startPosition,endPos=ani_p.position;if(endPos&&isEles&&!self.locked()){var newPos={};valid(startPos.x,endPos.x)&&(newPos.x=ease(startPos.x,endPos.x,percent,easing)),valid(startPos.y,endPos.y)&&(newPos.y=ease(startPos.y,endPos.y,percent,easing)),self.position(newPos)}var startPan=ani_p.startPan,endPan=ani_p.pan,pan=_p.pan,animatingPan=null!=endPan&&isCore;animatingPan&&(valid(startPan.x,endPan.x)&&(pan.x=ease(startPan.x,endPan.x,percent,easing)),valid(startPan.y,endPan.y)&&(pan.y=ease(startPan.y,endPan.y,percent,easing)),self.emit("pan"));var startZoom=ani_p.startZoom,endZoom=ani_p.zoom,animatingZoom=null!=endZoom&&isCore;animatingZoom&&(valid(startZoom,endZoom)&&(_p.zoom=bound(_p.minZoom,ease(startZoom,endZoom,percent,easing),_p.maxZoom)),self.emit("zoom")),(animatingPan||animatingZoom)&&self.emit("viewport");var props=ani_p.style;if(props&&props.length>0&&isEles){for(var i=0;i<props.length;i++){var prop=props[i],_name=prop.name,end=prop,start=ani_p.startStyle[_name],easedVal=ease(start,end,percent,easing,style.properties[start.name]);style.overrideBypass(self,_name,easedVal)}self.emit("style")}}return ani_p.progress=percent,percent}function valid(start,end){return null!=start&&null!=end&&(!(!number(start)||!number(end))||!(!start||!end))}function startAnimation(self,ani,now,isCore){var ani_p=ani._private;ani_p.started=!0,ani_p.startTime=now-ani_p.progress*ani_p.duration}function stepAll(now,cy){var eles=cy._private.aniEles,doneEles=[];function stepOne(ele,isCore){var _p=ele._private,current=_p.animation.current,queue=_p.animation.queue,ranAnis=!1;if(0===current.length){var next=queue.shift();next&&current.push(next)}for(var callbacks=function callbacks(_callbacks){for(var j=_callbacks.length-1;j>=0;j--){(0,_callbacks[j])()}_callbacks.splice(0,_callbacks.length)},i=current.length-1;i>=0;i--){var ani=current[i],ani_p=ani._private;ani_p.stopped?(current.splice(i,1),ani_p.hooked=!1,ani_p.playing=!1,ani_p.started=!1,callbacks(ani_p.frames)):(ani_p.playing||ani_p.applying)&&(ani_p.playing&&ani_p.applying&&(ani_p.applying=!1),ani_p.started||startAnimation(0,ani,now),step(ele,ani,now,isCore),ani_p.applying&&(ani_p.applying=!1),callbacks(ani_p.frames),null!=ani_p.step&&ani_p.step(now),ani.completed()&&(current.splice(i,1),ani_p.hooked=!1,ani_p.playing=!1,ani_p.started=!1,callbacks(ani_p.completes)),ranAnis=!0)}return isCore||0!==current.length||0!==queue.length||doneEles.push(ele),ranAnis}for(var ranEleAni=!1,e=0;e<eles.length;e++){var handledThisEle=stepOne(eles[e]);ranEleAni=ranEleAni||handledThisEle}var ranCoreAni=stepOne(cy,!0);(ranEleAni||ranCoreAni)&&(eles.length>0?cy.notify("draw",eles):cy.notify("draw")),eles.unmerge(doneEles),cy.emit("step")}var corefn$1={animate:define$3.animate(),animation:define$3.animation(),animated:define$3.animated(),clearQueue:define$3.clearQueue(),delay:define$3.delay(),delayAnimation:define$3.delayAnimation(),stop:define$3.stop(),addToAnimationPool:function addToAnimationPool(eles){this.styleEnabled()&&this._private.aniEles.merge(eles)},stopAnimationLoop:function stopAnimationLoop(){this._private.animationsRunning=!1},startAnimationLoop:function startAnimationLoop(){var cy=this;if(cy._private.animationsRunning=!0,cy.styleEnabled()){var renderer=cy.renderer();renderer&&renderer.beforeRender?renderer.beforeRender((function rendererAnimationStep(willDraw,now){stepAll(now,cy)}),renderer.beforeRenderPriorities.animations):function headlessStep(){cy._private.animationsRunning&&requestAnimationFrame((function animationStep(now){stepAll(now,cy),headlessStep()}))}()}}},emitterOptions$1={qualifierCompare:function qualifierCompare(selector1,selector2){return null==selector1||null==selector2?null==selector1&&null==selector2:selector1.sameText(selector2)},eventMatches:function eventMatches(cy,listener,eventObj){var selector=listener.qualifier;return null==selector||cy!==eventObj.target&&element(eventObj.target)&&selector.matches(eventObj.target)},addEventFields:function addEventFields(cy,evt){evt.cy=cy,evt.target=cy},callbackContext:function callbackContext(cy,listener,eventObj){return null!=listener.qualifier?eventObj.target:cy}},argSelector$1=function argSelector(arg){return string(arg)?new Selector(arg):arg},elesfn$v={createEmitter:function createEmitter(){var _p=this._private;return _p.emitter||(_p.emitter=new Emitter(emitterOptions$1,this)),this},emitter:function emitter(){return this._private.emitter},on:function on(events,selector,callback){return this.emitter().on(events,argSelector$1(selector),callback),this},removeListener:function removeListener(events,selector,callback){return this.emitter().removeListener(events,argSelector$1(selector),callback),this},removeAllListeners:function removeAllListeners(){return this.emitter().removeAllListeners(),this},one:function one(events,selector,callback){return this.emitter().one(events,argSelector$1(selector),callback),this},once:function once(events,selector,callback){return this.emitter().one(events,argSelector$1(selector),callback),this},emit:function emit(events,extraParams){return this.emitter().emit(events,extraParams),this},emitAndNotify:function emitAndNotify(event,eles){return this.emit(event),this.notify(event,eles),this}};define$3.eventAliasesOn(elesfn$v);var corefn$2={png:function png(options){return options=options||{},this._private.renderer.png(options)},jpg:function jpg(options){var renderer=this._private.renderer;return(options=options||{}).bg=options.bg||"#fff",renderer.jpg(options)}};corefn$2.jpeg=corefn$2.jpg;var corefn$3={layout:function layout(options){if(null!=options)if(null!=options.name){var name=options.name,Layout=this.extension("layout",name);if(null!=Layout){var eles;eles=string(options.eles)?this.$(options.eles):null!=options.eles?options.eles:this.$();var layout=new Layout(extend({},options,{cy:this,eles:eles}));return layout}error("No such layout `"+name+"` found.  Did you forget to import it and `cytoscape.use()` it?")}else error("A `name` must be specified to make a layout");else error("Layout options must be specified to make a layout")}};corefn$3.createLayout=corefn$3.makeLayout=corefn$3.layout;var corefn$4={notify:function notify(eventName,eventEles){var _p=this._private;if(this.batching()){_p.batchNotifications=_p.batchNotifications||{};var eles=_p.batchNotifications[eventName]=_p.batchNotifications[eventName]||this.collection();null!=eventEles&&eles.merge(eventEles)}else if(_p.notificationsEnabled){var renderer=this.renderer();!this.destroyed()&&renderer&&renderer.notify(eventName,eventEles)}},notifications:function notifications(bool){var p=this._private;return void 0===bool?p.notificationsEnabled:(p.notificationsEnabled=!!bool,this)},noNotifications:function noNotifications(callback){this.notifications(!1),callback(),this.notifications(!0)},batching:function batching(){return this._private.batchCount>0},startBatch:function startBatch(){var _p=this._private;return null==_p.batchCount&&(_p.batchCount=0),0===_p.batchCount&&(_p.batchStyleEles=this.collection(),_p.batchNotifications={}),_p.batchCount++,this},endBatch:function endBatch(){var _p=this._private;if(0===_p.batchCount)return this;if(_p.batchCount--,0===_p.batchCount){_p.batchStyleEles.updateStyle();var renderer=this.renderer();Object.keys(_p.batchNotifications).forEach((function(eventName){var eles=_p.batchNotifications[eventName];eles.empty()?renderer.notify(eventName):renderer.notify(eventName,eles)}))}return this},batch:function batch(callback){return this.startBatch(),callback(),this.endBatch(),this},batchData:function batchData(map){var cy=this;return this.batch((function(){for(var ids=Object.keys(map),i=0;i<ids.length;i++){var id=ids[i],data=map[id];cy.getElementById(id).data(data)}}))}},rendererDefaults=defaults({hideEdgesOnViewport:!1,textureOnViewport:!1,motionBlur:!1,motionBlurOpacity:.05,pixelRatio:void 0,desktopTapThreshold:4,touchTapThreshold:8,wheelSensitivity:1,debug:!1,showFps:!1}),corefn$5={renderTo:function renderTo(context,zoom,pan,pxRatio){return this._private.renderer.renderTo(context,zoom,pan,pxRatio),this},renderer:function renderer(){return this._private.renderer},forceRender:function forceRender(){return this.notify("draw"),this},resize:function resize(){return this.invalidateSize(),this.emitAndNotify("resize"),this},initRenderer:function initRenderer(options){var RendererProto=this.extension("renderer",options.name);if(null!=RendererProto){void 0!==options.wheelSensitivity&&warn("You have set a custom wheel sensitivity.  This will make your app zoom unnaturally when using mainstream mice.  You should change this value from the default only if you can guarantee that all your users will use the same hardware and OS configuration as your current machine.");var rOpts=rendererDefaults(options);rOpts.cy=this,this._private.renderer=new RendererProto(rOpts),this.notify("init")}else error("Can not initialise: No such renderer `".concat(options.name,"` found. Did you forget to import it and `cytoscape.use()` it?"))},destroyRenderer:function destroyRenderer(){this.notify("destroy");var domEle=this.container();if(domEle)for(domEle._cyreg=null;domEle.childNodes.length>0;)domEle.removeChild(domEle.childNodes[0]);this._private.renderer=null,this.mutableElements().forEach((function(ele){var _p=ele._private;_p.rscratch={},_p.rstyle={},_p.animation.current=[],_p.animation.queue=[]}))},onRender:function onRender(fn){return this.on("render",fn)},offRender:function offRender(fn){return this.off("render",fn)}};corefn$5.invalidateDimensions=corefn$5.resize;var corefn$6={collection:function collection(eles,opts){return string(eles)?this.$(eles):elementOrCollection(eles)?eles.collection():array(eles)?new Collection(this,eles,opts):new Collection(this)},nodes:function nodes(selector){var nodes=this.$((function(ele){return ele.isNode()}));return selector?nodes.filter(selector):nodes},edges:function edges(selector){var edges=this.$((function(ele){return ele.isEdge()}));return selector?edges.filter(selector):edges},$:function $(selector){var eles=this._private.elements;return selector?eles.filter(selector):eles.spawnSelf()},mutableElements:function mutableElements(){return this._private.elements}};corefn$6.elements=corefn$6.filter=corefn$6.$;var styfn={};styfn.apply=function(eles){for(var updatedEles=this._private.cy.collection(),ie=0;ie<eles.length;ie++){var ele=eles[ie],cxtMeta=this.getContextMeta(ele);if(!cxtMeta.empty){var cxtStyle=this.getContextStyle(cxtMeta),app=this.applyContextStyle(cxtMeta,cxtStyle,ele);ele._private.appliedInitStyle?this.updateTransitions(ele,app.diffProps):ele._private.appliedInitStyle=!0,this.updateStyleHints(ele)&&updatedEles.push(ele)}}return updatedEles},styfn.getPropertiesDiff=function(oldCxtKey,newCxtKey){var cache=this._private.propDiffs=this._private.propDiffs||{},dualCxtKey=oldCxtKey+"-"+newCxtKey,cachedVal=cache[dualCxtKey];if(cachedVal)return cachedVal;for(var diffProps=[],addedProp={},i=0;i<this.length;i++){var cxt=this[i],oldHasCxt="t"===oldCxtKey[i],newHasCxt="t"===newCxtKey[i],cxtHasDiffed=oldHasCxt!==newHasCxt,cxtHasMappedProps=cxt.mappedProperties.length>0;if(cxtHasDiffed||newHasCxt&&cxtHasMappedProps){var props=void 0;cxtHasDiffed&&cxtHasMappedProps||cxtHasDiffed?props=cxt.properties:cxtHasMappedProps&&(props=cxt.mappedProperties);for(var j=0;j<props.length;j++){for(var prop=props[j],name=prop.name,laterCxtOverrides=!1,k=i+1;k<this.length;k++){var laterCxt=this[k];if("t"===newCxtKey[k]&&(laterCxtOverrides=null!=laterCxt.properties[prop.name]))break}addedProp[name]||laterCxtOverrides||(addedProp[name]=!0,diffProps.push(name))}}}return cache[dualCxtKey]=diffProps,diffProps},styfn.getContextMeta=function(ele){for(var diffProps,cxtKey="",prevKey=ele._private.styleCxtKey||"",i=0;i<this.length;i++){var context=this[i];cxtKey+=context.selector&&context.selector.matches(ele)?"t":"f"}return diffProps=this.getPropertiesDiff(prevKey,cxtKey),ele._private.styleCxtKey=cxtKey,{key:cxtKey,diffPropNames:diffProps,empty:0===diffProps.length}},styfn.getContextStyle=function(cxtMeta){var cxtKey=cxtMeta.key,cxtStyles=this._private.contextStyles=this._private.contextStyles||{};if(cxtStyles[cxtKey])return cxtStyles[cxtKey];for(var style={_private:{key:cxtKey}},i=0;i<this.length;i++){var cxt=this[i];if("t"===cxtKey[i])for(var j=0;j<cxt.properties.length;j++){var prop=cxt.properties[j];style[prop.name]=prop}}return cxtStyles[cxtKey]=style,style},styfn.applyContextStyle=function(cxtMeta,cxtStyle,ele){for(var diffProps=cxtMeta.diffPropNames,retDiffProps={},types=this.types,i=0;i<diffProps.length;i++){var diffPropName=diffProps[i],cxtProp=cxtStyle[diffPropName],eleProp=ele.pstyle(diffPropName);if(!cxtProp){if(!eleProp)continue;cxtProp=eleProp.bypass?{name:diffPropName,deleteBypassed:!0}:{name:diffPropName,delete:!0}}if(eleProp!==cxtProp){if(cxtProp.mapped===types.fn&&null!=eleProp&&null!=eleProp.mapping&&eleProp.mapping.value===cxtProp.value){var mapping=eleProp.mapping;if((mapping.fnValue=cxtProp.value(ele))===mapping.prevFnValue)continue}var retDiffProp=retDiffProps[diffPropName]={prev:eleProp};this.applyParsedProperty(ele,cxtProp),retDiffProp.next=ele.pstyle(diffPropName),retDiffProp.next&&retDiffProp.next.bypass&&(retDiffProp.next=retDiffProp.next.bypassed)}}return{diffProps:retDiffProps}},styfn.updateStyleHints=function(ele){var _p=ele._private,self=this,propNames=self.propertyGroupNames,propGrKeys=self.propertyGroupKeys,propHash=function propHash(ele,propNames,seedKey){return self.getPropertiesHash(ele,propNames,seedKey)},oldStyleKey=_p.styleKey;if(ele.removed())return!1;var isNode="nodes"===_p.group,overriddenStyles=ele._private.style;propNames=Object.keys(overriddenStyles);for(var i=0;i<propGrKeys.length;i++){var grKey=propGrKeys[i];_p.styleKeys[grKey]=[9261,5381]}for(var updateGrKey1=function updateGrKey1(val,grKey){return _p.styleKeys[grKey][0]=hashInt(val,_p.styleKeys[grKey][0])},updateGrKey2=function updateGrKey2(val,grKey){return _p.styleKeys[grKey][1]=hashIntAlt(val,_p.styleKeys[grKey][1])},updateGrKey=function updateGrKey(val,grKey){updateGrKey1(val,grKey),updateGrKey2(val,grKey)},updateGrKeyWStr=function updateGrKeyWStr(strVal,grKey){for(var j=0;j<strVal.length;j++){var ch=strVal.charCodeAt(j);updateGrKey1(ch,grKey),updateGrKey2(ch,grKey)}},cleanNum=function cleanNum(val){return-128<val&&val<128&&Math.floor(val)!==val?2e9-(1024*val|0):val},_i=0;_i<propNames.length;_i++){var name=propNames[_i],parsedProp=overriddenStyles[name];if(null!=parsedProp){var propInfo=this.properties[name],type=propInfo.type,_grKey=propInfo.groupKey,normalizedNumberVal=void 0;null!=propInfo.hashOverride?normalizedNumberVal=propInfo.hashOverride(ele,parsedProp):null!=parsedProp.pfValue&&(normalizedNumberVal=parsedProp.pfValue);var numberVal=null==propInfo.enums?parsedProp.value:null,haveNormNum=null!=normalizedNumberVal,haveNum=haveNormNum||null!=numberVal,units=parsedProp.units;if(type.number&&haveNum&&!type.multiple)updateGrKey(cleanNum(haveNormNum?normalizedNumberVal:numberVal),_grKey),haveNormNum||null==units||updateGrKeyWStr(units,_grKey);else updateGrKeyWStr(parsedProp.strValue,_grKey)}}for(var hash=[9261,5381],_i2=0;_i2<propGrKeys.length;_i2++){var _grKey2=propGrKeys[_i2],grHash=_p.styleKeys[_grKey2];hash[0]=hashInt(grHash[0],hash[0]),hash[1]=hashIntAlt(grHash[1],hash[1])}_p.styleKey=function combineHashes(hash1,hash2){return 2097152*hash1+hash2}(hash[0],hash[1]);var sk=_p.styleKeys;_p.labelDimsKey=combineHashesArray(sk.labelDimensions);var labelKeys=propHash(ele,["label"],sk.labelDimensions);if(_p.labelKey=combineHashesArray(labelKeys),_p.labelStyleKey=combineHashesArray(hashArrays(sk.commonLabel,labelKeys)),!isNode){var sourceLabelKeys=propHash(ele,["source-label"],sk.labelDimensions);_p.sourceLabelKey=combineHashesArray(sourceLabelKeys),_p.sourceLabelStyleKey=combineHashesArray(hashArrays(sk.commonLabel,sourceLabelKeys));var targetLabelKeys=propHash(ele,["target-label"],sk.labelDimensions);_p.targetLabelKey=combineHashesArray(targetLabelKeys),_p.targetLabelStyleKey=combineHashesArray(hashArrays(sk.commonLabel,targetLabelKeys))}if(isNode){var _p$styleKeys=_p.styleKeys,nodeBody=_p$styleKeys.nodeBody,nodeBorder=_p$styleKeys.nodeBorder,backgroundImage=_p$styleKeys.backgroundImage,compound=_p$styleKeys.compound,pie=_p$styleKeys.pie,nodeKeys=[nodeBody,nodeBorder,backgroundImage,compound,pie].filter((function(k){return null!=k})).reduce(hashArrays,[9261,5381]);_p.nodeKey=combineHashesArray(nodeKeys),_p.hasPie=null!=pie&&9261!==pie[0]&&5381!==pie[1]}return oldStyleKey!==_p.styleKey},styfn.clearStyleHints=function(ele){var _p=ele._private;_p.styleCxtKey="",_p.styleKeys={},_p.styleKey=null,_p.labelKey=null,_p.labelStyleKey=null,_p.sourceLabelKey=null,_p.sourceLabelStyleKey=null,_p.targetLabelKey=null,_p.targetLabelStyleKey=null,_p.nodeKey=null,_p.hasPie=null},styfn.applyParsedProperty=function(ele,parsedProp){var flatProp,self=this,prop=parsedProp,style=ele._private.style,types=self.types,type=self.properties[prop.name].type,propIsBypass=prop.bypass,origProp=style[prop.name],origPropIsBypass=origProp&&origProp.bypass,_p=ele._private,getVal=function getVal(p){return null==p?null:null!=p.pfValue?p.pfValue:p.value},checkTriggers=function checkTriggers(){var fromVal=getVal(origProp),toVal=getVal(prop);self.checkTriggers(ele,prop.name,fromVal,toVal)};if(prop&&"pie"===prop.name.substr(0,3)&&warn("The pie style properties are deprecated.  Create charts using background images instead."),"curve-style"===parsedProp.name&&ele.isEdge()&&("bezier"!==parsedProp.value&&ele.isLoop()||"haystack"===parsedProp.value&&(ele.source().isParent()||ele.target().isParent()))&&(prop=parsedProp=this.parse(parsedProp.name,"bezier",propIsBypass)),prop.delete)return style[prop.name]=void 0,checkTriggers(),!0;if(prop.deleteBypassed)return origProp?!!origProp.bypass&&(origProp.bypassed=void 0,checkTriggers(),!0):(checkTriggers(),!0);if(prop.deleteBypass)return origProp?!!origProp.bypass&&(style[prop.name]=origProp.bypassed,checkTriggers(),!0):(checkTriggers(),!0);var printMappingErr=function printMappingErr(){warn("Do not assign mappings to elements without corresponding data (i.e. ele `"+ele.id()+"` has no mapping for property `"+prop.name+"` with data field `"+prop.field+"`); try a `["+prop.field+"]` selector to limit scope to elements with `"+prop.field+"` defined")};switch(prop.mapped){case types.mapData:for(var percent,fields=prop.field.split("."),fieldVal=_p.data,i=0;i<fields.length&&fieldVal;i++){fieldVal=fieldVal[fields[i]]}if(null==fieldVal)return printMappingErr(),!1;if(!number(fieldVal))return warn("Do not use continuous mappers without specifying numeric data (i.e. `"+prop.field+": "+fieldVal+"` for `"+ele.id()+"` is non-numeric)"),!1;var fieldWidth=prop.fieldMax-prop.fieldMin;if((percent=0===fieldWidth?0:(fieldVal-prop.fieldMin)/fieldWidth)<0?percent=0:percent>1&&(percent=1),type.color){var r1=prop.valueMin[0],r2=prop.valueMax[0],g1=prop.valueMin[1],g2=prop.valueMax[1],b1=prop.valueMin[2],b2=prop.valueMax[2],a1=null==prop.valueMin[3]?1:prop.valueMin[3],a2=null==prop.valueMax[3]?1:prop.valueMax[3],clr=[Math.round(r1+(r2-r1)*percent),Math.round(g1+(g2-g1)*percent),Math.round(b1+(b2-b1)*percent),Math.round(a1+(a2-a1)*percent)];flatProp={bypass:prop.bypass,name:prop.name,value:clr,strValue:"rgb("+clr[0]+", "+clr[1]+", "+clr[2]+")"}}else{if(!type.number)return!1;var calcValue=prop.valueMin+(prop.valueMax-prop.valueMin)*percent;flatProp=this.parse(prop.name,calcValue,prop.bypass,"mapping")}if(!flatProp)return printMappingErr(),!1;flatProp.mapping=prop,prop=flatProp;break;case types.data:for(var _fields=prop.field.split("."),_fieldVal=_p.data,_i3=0;_i3<_fields.length&&_fieldVal;_i3++){_fieldVal=_fieldVal[_fields[_i3]]}if(null!=_fieldVal&&(flatProp=this.parse(prop.name,_fieldVal,prop.bypass,"mapping")),!flatProp)return printMappingErr(),!1;flatProp.mapping=prop,prop=flatProp;break;case types.fn:var fn=prop.value,fnRetVal=null!=prop.fnValue?prop.fnValue:fn(ele);if(prop.prevFnValue=fnRetVal,null==fnRetVal)return warn("Custom function mappers may not return null (i.e. `"+prop.name+"` for ele `"+ele.id()+"` is null)"),!1;if(!(flatProp=this.parse(prop.name,fnRetVal,prop.bypass,"mapping")))return warn("Custom function mappers may not return invalid values for the property type (i.e. `"+prop.name+"` for ele `"+ele.id()+"` is invalid)"),!1;flatProp.mapping=copy(prop),prop=flatProp;break;case void 0:break;default:return!1}return propIsBypass?(prop.bypassed=origPropIsBypass?origProp.bypassed:origProp,style[prop.name]=prop):origPropIsBypass?origProp.bypassed=prop:style[prop.name]=prop,checkTriggers(),!0},styfn.cleanElements=function(eles,keepBypasses){for(var i=0;i<eles.length;i++){var ele=eles[i];if(this.clearStyleHints(ele),ele.dirtyCompoundBoundsCache(),ele.dirtyBoundingBoxCache(),keepBypasses)for(var style=ele._private.style,propNames=Object.keys(style),j=0;j<propNames.length;j++){var propName=propNames[j],eleProp=style[propName];null!=eleProp&&(eleProp.bypass?eleProp.bypassed=null:style[propName]=null)}else ele._private.style={}}},styfn.update=function(){this._private.cy.mutableElements().updateStyle()},styfn.updateTransitions=function(ele,diffProps){var self=this,_p=ele._private,props=ele.pstyle("transition-property").value,duration=ele.pstyle("transition-duration").pfValue,delay=ele.pstyle("transition-delay").pfValue;if(props.length>0&&duration>0){for(var style={},anyPrev=!1,i=0;i<props.length;i++){var prop=props[i],styProp=ele.pstyle(prop),diffProp=diffProps[prop];if(diffProp){var fromProp=diffProp.prev,toProp=null!=diffProp.next?diffProp.next:styProp,diff=!1,initVal=void 0;fromProp&&(number(fromProp.pfValue)&&number(toProp.pfValue)?(diff=toProp.pfValue-fromProp.pfValue,initVal=fromProp.pfValue+1e-6*diff):number(fromProp.value)&&number(toProp.value)?(diff=toProp.value-fromProp.value,initVal=fromProp.value+1e-6*diff):array(fromProp.value)&&array(toProp.value)&&(diff=fromProp.value[0]!==toProp.value[0]||fromProp.value[1]!==toProp.value[1]||fromProp.value[2]!==toProp.value[2],initVal=fromProp.strValue),diff&&(style[prop]=toProp.strValue,this.applyBypass(ele,prop,initVal),anyPrev=!0))}}if(!anyPrev)return;_p.transitioning=!0,new Promise$1((function(resolve){delay>0?ele.delayAnimation(delay).play().promise().then(resolve):resolve()})).then((function(){return ele.animation({style:style,duration:duration,easing:ele.pstyle("transition-timing-function").value,queue:!1}).play().promise()})).then((function(){self.removeBypasses(ele,props),ele.emitAndNotify("style"),_p.transitioning=!1}))}else _p.transitioning&&(this.removeBypasses(ele,props),ele.emitAndNotify("style"),_p.transitioning=!1)},styfn.checkTrigger=function(ele,name,fromValue,toValue,getTrigger,onTrigger){var prop=this.properties[name],triggerCheck=getTrigger(prop);null!=triggerCheck&&triggerCheck(fromValue,toValue)&&onTrigger(prop)},styfn.checkZOrderTrigger=function(ele,name,fromValue,toValue){var _this=this;this.checkTrigger(ele,name,fromValue,toValue,(function(prop){return prop.triggersZOrder}),(function(){_this._private.cy.notify("zorder",ele)}))},styfn.checkBoundsTrigger=function(ele,name,fromValue,toValue){this.checkTrigger(ele,name,fromValue,toValue,(function(prop){return prop.triggersBounds}),(function(prop){ele.dirtyCompoundBoundsCache(),ele.dirtyBoundingBoxCache(),"curve-style"!==name||"bezier"!==fromValue&&"bezier"!==toValue||!prop.triggersBoundsOfParallelBeziers||ele.parallelEdges().forEach((function(pllEdge){pllEdge.isBundledBezier()&&pllEdge.dirtyBoundingBoxCache()}))}))},styfn.checkTriggers=function(ele,name,fromValue,toValue){ele.dirtyStyleCache(),this.checkZOrderTrigger(ele,name,fromValue,toValue),this.checkBoundsTrigger(ele,name,fromValue,toValue)};var styfn$1={applyBypass:function(eles,name,value,updateTransitions){var props=[];if("*"===name||"**"===name){if(void 0!==value)for(var i=0;i<this.properties.length;i++){var _name=this.properties[i].name,parsedProp=this.parse(_name,value,!0);parsedProp&&props.push(parsedProp)}}else if(string(name)){var _parsedProp=this.parse(name,value,!0);_parsedProp&&props.push(_parsedProp)}else{if(!plainObject(name))return!1;var specifiedProps=name;updateTransitions=value;for(var names=Object.keys(specifiedProps),_i=0;_i<names.length;_i++){var _name2=names[_i],_value=specifiedProps[_name2];if(void 0===_value&&(_value=specifiedProps[dash2camel(_name2)]),void 0!==_value){var _parsedProp2=this.parse(_name2,_value,!0);_parsedProp2&&props.push(_parsedProp2)}}}if(0===props.length)return!1;for(var ret=!1,_i2=0;_i2<eles.length;_i2++){for(var ele=eles[_i2],diffProps={},diffProp=void 0,j=0;j<props.length;j++){var _prop=props[j];if(updateTransitions){var prevProp=ele.pstyle(_prop.name);diffProp=diffProps[_prop.name]={prev:prevProp}}ret=this.applyParsedProperty(ele,copy(_prop))||ret,updateTransitions&&(diffProp.next=ele.pstyle(_prop.name))}ret&&this.updateStyleHints(ele),updateTransitions&&this.updateTransitions(ele,diffProps,true)}return ret},overrideBypass:function(eles,name,value){name=camel2dash(name);for(var i=0;i<eles.length;i++){var ele=eles[i],prop=ele._private.style[name],type=this.properties[name].type,isColor=type.color,isMulti=type.mutiple,oldValue=prop?null!=prop.pfValue?prop.pfValue:prop.value:null;prop&&prop.bypass?(prop.value=value,null!=prop.pfValue&&(prop.pfValue=value),prop.strValue=isColor?"rgb("+value.join(",")+")":isMulti?value.join(" "):""+value,this.updateStyleHints(ele)):this.applyBypass(ele,name,value),this.checkTriggers(ele,name,oldValue,value)}},removeAllBypasses:function(eles,updateTransitions){return this.removeBypasses(eles,this.propertyNames,updateTransitions)},removeBypasses:function(eles,props,updateTransitions){for(var j=0;j<eles.length;j++){for(var ele=eles[j],diffProps={},i=0;i<props.length;i++){var name=props[i],prop=this.properties[name],prevProp=ele.pstyle(prop.name);if(prevProp&&prevProp.bypass){var parsedProp=this.parse(name,"",!0),diffProp=diffProps[prop.name]={prev:prevProp};this.applyParsedProperty(ele,parsedProp),diffProp.next=ele.pstyle(prop.name)}}this.updateStyleHints(ele),updateTransitions&&this.updateTransitions(ele,diffProps,true)}}},styfn$2={getEmSizeInPixels:function(){var px=this.containerCss("font-size");return null!=px?parseFloat(px):1},containerCss:function(propName){var domElement=this._private.cy.container();if(window$1&&domElement&&window$1.getComputedStyle)return window$1.getComputedStyle(domElement).getPropertyValue(propName)}},styfn$3={getRenderedStyle:function(ele,prop){return prop?this.getStylePropertyValue(ele,prop,!0):this.getRawStyle(ele,!0)},getRawStyle:function(ele,isRenderedVal){if(ele=ele[0]){for(var rstyle={},i=0;i<this.properties.length;i++){var prop=this.properties[i],val=this.getStylePropertyValue(ele,prop.name,isRenderedVal);null!=val&&(rstyle[prop.name]=val,rstyle[dash2camel(prop.name)]=val)}return rstyle}},getIndexedStyle:function(ele,property,subproperty,index){var pstyle=ele.pstyle(property)[subproperty][index];return null!=pstyle?pstyle:ele.cy().style().getDefaultProperty(property)[subproperty][0]},getStylePropertyValue:function(ele,propName,isRenderedVal){if(ele=ele[0]){var prop=this.properties[propName];prop.alias&&(prop=prop.pointsTo);var type=prop.type,styleProp=ele.pstyle(prop.name);if(styleProp){var value=styleProp.value,units=styleProp.units,strValue=styleProp.strValue;if(isRenderedVal&&type.number&&null!=value&&number(value)){var zoom=ele.cy().zoom(),getRenderedValue=function getRenderedValue(val){return val*zoom},getValueStringWithUnits=function getValueStringWithUnits(val,units){return getRenderedValue(val)+units},isArrayValue=array(value);return(isArrayValue?units.every((function(u){return null!=u})):null!=units)?isArrayValue?value.map((function(v,i){return getValueStringWithUnits(v,units[i])})).join(" "):getValueStringWithUnits(value,units):isArrayValue?value.map((function(v){return string(v)?v:""+getRenderedValue(v)})).join(" "):""+getRenderedValue(value)}if(null!=strValue)return strValue}return null}},getAnimationStartStyle:function(ele,aniProps){for(var rstyle={},i=0;i<aniProps.length;i++){var name=aniProps[i].name,styleProp=ele.pstyle(name);void 0!==styleProp&&(styleProp=plainObject(styleProp)?this.parse(name,styleProp.strValue):this.parse(name,styleProp)),styleProp&&(rstyle[name]=styleProp)}return rstyle},getPropsList:function(propsObj){var rstyle=[],style=propsObj,props=this.properties;if(style)for(var names=Object.keys(style),i=0;i<names.length;i++){var name=names[i],val=style[name],prop=props[name]||props[camel2dash(name)],styleProp=this.parse(prop.name,val);styleProp&&rstyle.push(styleProp)}return rstyle},getNonDefaultPropertiesHash:function(ele,propNames,seed){var name,val,strVal,chVal,i,j,hash=seed.slice();for(i=0;i<propNames.length;i++)if(name=propNames[i],null!=(val=ele.pstyle(name,!1)))if(null!=val.pfValue)hash[0]=hashInt(chVal,hash[0]),hash[1]=hashIntAlt(chVal,hash[1]);else for(strVal=val.strValue,j=0;j<strVal.length;j++)chVal=strVal.charCodeAt(j),hash[0]=hashInt(chVal,hash[0]),hash[1]=hashIntAlt(chVal,hash[1]);return hash}};styfn$3.getPropertiesHash=styfn$3.getNonDefaultPropertiesHash;var styfn$4={appendFromJson:function(json){for(var i=0;i<json.length;i++){var context=json[i],selector=context.selector,props=context.style||context.css,names=Object.keys(props);this.selector(selector);for(var j=0;j<names.length;j++){var name=names[j],value=props[name];this.css(name,value)}}return this},fromJson:function(json){return this.resetToDefault(),this.appendFromJson(json),this},json:function(){for(var json=[],i=this.defaultLength;i<this.length;i++){for(var cxt=this[i],selector=cxt.selector,props=cxt.properties,css={},j=0;j<props.length;j++){var prop=props[j];css[prop.name]=prop.strValue}json.push({selector:selector?selector.toString():"core",style:css})}return json}},styfn$5={appendFromString:function(string){var selAndBlockStr,blockRem,propAndValStr,remaining=""+string;function removeSelAndBlockFromRemaining(){remaining=remaining.length>selAndBlockStr.length?remaining.substr(selAndBlockStr.length):""}function removePropAndValFromRem(){blockRem=blockRem.length>propAndValStr.length?blockRem.substr(propAndValStr.length):""}for(remaining=remaining.replace(/[/][*](\s|.)+?[*][/]/g,"");;){if(remaining.match(/^\s*$/))break;var selAndBlock=remaining.match(/^\s*((?:.|\s)+?)\s*\{((?:.|\s)+?)\}/);if(!selAndBlock){warn("Halting stylesheet parsing: String stylesheet contains more to parse but no selector and block found in: "+remaining);break}selAndBlockStr=selAndBlock[0];var selectorStr=selAndBlock[1];if("core"!==selectorStr)if(new Selector(selectorStr).invalid){warn("Skipping parsing of block: Invalid selector found in string stylesheet: "+selectorStr),removeSelAndBlockFromRemaining();continue}var blockStr=selAndBlock[2],invalidBlock=!1;blockRem=blockStr;for(var props=[];;){if(blockRem.match(/^\s*$/))break;var propAndVal=blockRem.match(/^\s*(.+?)\s*:\s*(.+?)\s*;/);if(!propAndVal){warn("Skipping parsing of block: Invalid formatting of style property and value definitions found in:"+blockStr),invalidBlock=!0;break}propAndValStr=propAndVal[0];var propStr=propAndVal[1],valStr=propAndVal[2];if(this.properties[propStr])this.parse(propStr,valStr)?(props.push({name:propStr,val:valStr}),removePropAndValFromRem()):(warn("Skipping property: Invalid property definition in: "+propAndValStr),removePropAndValFromRem());else warn("Skipping property: Invalid property name in: "+propAndValStr),removePropAndValFromRem()}if(invalidBlock){removeSelAndBlockFromRemaining();break}this.selector(selectorStr);for(var i=0;i<props.length;i++){var _prop=props[i];this.css(_prop.name,_prop.val)}removeSelAndBlockFromRemaining()}return this},fromString:function(string){return this.resetToDefault(),this.appendFromString(string),this}},styfn$6={};!function(){var number=number$1,data=function data(prefix){return"^"+prefix+"\\s*\\(\\s*([\\w\\.]+)\\s*\\)$"},mapData=function mapData(prefix){var mapArg=number+"|\\w+|rgb[a]?\\((?:(?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))[%]?)\\s*,\\s*(?:(?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))[%]?)\\s*,\\s*(?:(?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))[%]?)(?:\\s*,\\s*(?:(?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))))?\\)|hsl[a]?\\((?:(?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?)))\\s*,\\s*(?:(?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))[%])\\s*,\\s*(?:(?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))[%])(?:\\s*,\\s*(?:(?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))))?\\)|\\#[0-9a-fA-F]{3}|\\#[0-9a-fA-F]{6}";return"^"+prefix+"\\s*\\(([\\w\\.]+)\\s*\\,\\s*("+number+")\\s*\\,\\s*("+number+")\\s*,\\s*("+mapArg+")\\s*\\,\\s*("+mapArg+")\\)$"},urlRegexes=["^url\\s*\\(\\s*['\"]?(.+?)['\"]?\\s*\\)$","^(none)$","^(.+)$"];styfn$6.types={time:{number:!0,min:0,units:"s|ms",implicitUnits:"ms"},percent:{number:!0,min:0,max:100,units:"%",implicitUnits:"%"},percentages:{number:!0,min:0,max:100,units:"%",implicitUnits:"%",multiple:!0},zeroOneNumber:{number:!0,min:0,max:1,unitless:!0},zeroOneNumbers:{number:!0,min:0,max:1,unitless:!0,multiple:!0},nOneOneNumber:{number:!0,min:-1,max:1,unitless:!0},nonNegativeInt:{number:!0,min:0,integer:!0,unitless:!0},position:{enums:["parent","origin"]},nodeSize:{number:!0,min:0,enums:["label"]},number:{number:!0,unitless:!0},numbers:{number:!0,unitless:!0,multiple:!0},positiveNumber:{number:!0,unitless:!0,min:0,strictMin:!0},size:{number:!0,min:0},bidirectionalSize:{number:!0},bidirectionalSizeMaybePercent:{number:!0,allowPercent:!0},bidirectionalSizes:{number:!0,multiple:!0},sizeMaybePercent:{number:!0,min:0,allowPercent:!0},axisDirection:{enums:["horizontal","leftward","rightward","vertical","upward","downward","auto"]},paddingRelativeTo:{enums:["width","height","average","min","max"]},bgWH:{number:!0,min:0,allowPercent:!0,enums:["auto"],multiple:!0},bgPos:{number:!0,allowPercent:!0,multiple:!0},bgRelativeTo:{enums:["inner","include-padding"],multiple:!0},bgRepeat:{enums:["repeat","repeat-x","repeat-y","no-repeat"],multiple:!0},bgFit:{enums:["none","contain","cover"],multiple:!0},bgCrossOrigin:{enums:["anonymous","use-credentials"],multiple:!0},bgClip:{enums:["none","node"],multiple:!0},bgContainment:{enums:["inside","over"],multiple:!0},color:{color:!0},colors:{color:!0,multiple:!0},fill:{enums:["solid","linear-gradient","radial-gradient"]},bool:{enums:["yes","no"]},bools:{enums:["yes","no"],multiple:!0},lineStyle:{enums:["solid","dotted","dashed"]},lineCap:{enums:["butt","round","square"]},borderStyle:{enums:["solid","dotted","dashed","double"]},curveStyle:{enums:["bezier","unbundled-bezier","haystack","segments","straight","straight-triangle","taxi"]},fontFamily:{regex:'^([\\w- \\"]+(?:\\s*,\\s*[\\w- \\"]+)*)$'},fontStyle:{enums:["italic","normal","oblique"]},fontWeight:{enums:["normal","bold","bolder","lighter","100","200","300","400","500","600","800","900",100,200,300,400,500,600,700,800,900]},textDecoration:{enums:["none","underline","overline","line-through"]},textTransform:{enums:["none","uppercase","lowercase"]},textWrap:{enums:["none","wrap","ellipsis"]},textOverflowWrap:{enums:["whitespace","anywhere"]},textBackgroundShape:{enums:["rectangle","roundrectangle","round-rectangle"]},nodeShape:{enums:["rectangle","roundrectangle","round-rectangle","cutrectangle","cut-rectangle","bottomroundrectangle","bottom-round-rectangle","barrel","ellipse","triangle","round-triangle","square","pentagon","round-pentagon","hexagon","round-hexagon","concavehexagon","concave-hexagon","heptagon","round-heptagon","octagon","round-octagon","tag","round-tag","star","diamond","round-diamond","vee","rhomboid","polygon"]},overlayShape:{enums:["roundrectangle","round-rectangle","ellipse"]},compoundIncludeLabels:{enums:["include","exclude"]},arrowShape:{enums:["tee","triangle","triangle-tee","circle-triangle","triangle-cross","triangle-backcurve","vee","square","circle","diamond","chevron","none"]},arrowFill:{enums:["filled","hollow"]},display:{enums:["element","none"]},visibility:{enums:["hidden","visible"]},zCompoundDepth:{enums:["bottom","orphan","auto","top"]},zIndexCompare:{enums:["auto","manual"]},valign:{enums:["top","center","bottom"]},halign:{enums:["left","center","right"]},justification:{enums:["left","center","right","auto"]},text:{string:!0},data:{mapping:!0,regex:data("data")},layoutData:{mapping:!0,regex:data("layoutData")},scratch:{mapping:!0,regex:data("scratch")},mapData:{mapping:!0,regex:mapData("mapData")},mapLayoutData:{mapping:!0,regex:mapData("mapLayoutData")},mapScratch:{mapping:!0,regex:mapData("mapScratch")},fn:{mapping:!0,fn:!0},url:{regexes:urlRegexes,singleRegexMatchValue:!0},urls:{regexes:urlRegexes,singleRegexMatchValue:!0,multiple:!0},propList:{propList:!0},angle:{number:!0,units:"deg|rad",implicitUnits:"rad"},textRotation:{number:!0,units:"deg|rad",implicitUnits:"rad",enums:["none","autorotate"]},polygonPointList:{number:!0,multiple:!0,evenMultiple:!0,min:-1,max:1,unitless:!0},edgeDistances:{enums:["intersection","node-position"]},edgeEndpoint:{number:!0,multiple:!0,units:"%|px|em|deg|rad",implicitUnits:"px",enums:["inside-to-node","outside-to-node","outside-to-node-or-label","outside-to-line","outside-to-line-or-label"],singleEnum:!0,validate:function validate(valArr,unitsArr){switch(valArr.length){case 2:return"deg"!==unitsArr[0]&&"rad"!==unitsArr[0]&&"deg"!==unitsArr[1]&&"rad"!==unitsArr[1];case 1:return string(valArr[0])||"deg"===unitsArr[0]||"rad"===unitsArr[0];default:return!1}}},easing:{regexes:["^(spring)\\s*\\(\\s*("+number+")\\s*,\\s*("+number+")\\s*\\)$","^(cubic-bezier)\\s*\\(\\s*("+number+")\\s*,\\s*("+number+")\\s*,\\s*("+number+")\\s*,\\s*("+number+")\\s*\\)$"],enums:["linear","ease","ease-in","ease-out","ease-in-out","ease-in-sine","ease-out-sine","ease-in-out-sine","ease-in-quad","ease-out-quad","ease-in-out-quad","ease-in-cubic","ease-out-cubic","ease-in-out-cubic","ease-in-quart","ease-out-quart","ease-in-out-quart","ease-in-quint","ease-out-quint","ease-in-out-quint","ease-in-expo","ease-out-expo","ease-in-out-expo","ease-in-circ","ease-out-circ","ease-in-out-circ"]},gradientDirection:{enums:["to-bottom","to-top","to-left","to-right","to-bottom-right","to-bottom-left","to-top-right","to-top-left","to-right-bottom","to-left-bottom","to-right-top","to-left-top"]},boundsExpansion:{number:!0,multiple:!0,min:0,validate:function validate(valArr){var length=valArr.length;return 1===length||2===length||4===length}}};var diff={zeroNonZero:function zeroNonZero(val1,val2){return(null==val1||null==val2)&&val1!==val2||(0==val1&&0!=val2||0!=val1&&0==val2)},any:function any(val1,val2){return val1!=val2},emptyNonEmpty:function emptyNonEmpty(str1,str2){var empty1=emptyString(str1),empty2=emptyString(str2);return empty1&&!empty2||!empty1&&empty2}},t=styfn$6.types,mainLabel=[{name:"label",type:t.text,triggersBounds:diff.any,triggersZOrder:diff.emptyNonEmpty},{name:"text-rotation",type:t.textRotation,triggersBounds:diff.any},{name:"text-margin-x",type:t.bidirectionalSize,triggersBounds:diff.any},{name:"text-margin-y",type:t.bidirectionalSize,triggersBounds:diff.any}],sourceLabel=[{name:"source-label",type:t.text,triggersBounds:diff.any},{name:"source-text-rotation",type:t.textRotation,triggersBounds:diff.any},{name:"source-text-margin-x",type:t.bidirectionalSize,triggersBounds:diff.any},{name:"source-text-margin-y",type:t.bidirectionalSize,triggersBounds:diff.any},{name:"source-text-offset",type:t.size,triggersBounds:diff.any}],targetLabel=[{name:"target-label",type:t.text,triggersBounds:diff.any},{name:"target-text-rotation",type:t.textRotation,triggersBounds:diff.any},{name:"target-text-margin-x",type:t.bidirectionalSize,triggersBounds:diff.any},{name:"target-text-margin-y",type:t.bidirectionalSize,triggersBounds:diff.any},{name:"target-text-offset",type:t.size,triggersBounds:diff.any}],labelDimensions=[{name:"font-family",type:t.fontFamily,triggersBounds:diff.any},{name:"font-style",type:t.fontStyle,triggersBounds:diff.any},{name:"font-weight",type:t.fontWeight,triggersBounds:diff.any},{name:"font-size",type:t.size,triggersBounds:diff.any},{name:"text-transform",type:t.textTransform,triggersBounds:diff.any},{name:"text-wrap",type:t.textWrap,triggersBounds:diff.any},{name:"text-overflow-wrap",type:t.textOverflowWrap,triggersBounds:diff.any},{name:"text-max-width",type:t.size,triggersBounds:diff.any},{name:"text-outline-width",type:t.size,triggersBounds:diff.any},{name:"line-height",type:t.positiveNumber,triggersBounds:diff.any}],commonLabel=[{name:"text-valign",type:t.valign,triggersBounds:diff.any},{name:"text-halign",type:t.halign,triggersBounds:diff.any},{name:"color",type:t.color},{name:"text-outline-color",type:t.color},{name:"text-outline-opacity",type:t.zeroOneNumber},{name:"text-background-color",type:t.color},{name:"text-background-opacity",type:t.zeroOneNumber},{name:"text-background-padding",type:t.size,triggersBounds:diff.any},{name:"text-border-opacity",type:t.zeroOneNumber},{name:"text-border-color",type:t.color},{name:"text-border-width",type:t.size,triggersBounds:diff.any},{name:"text-border-style",type:t.borderStyle,triggersBounds:diff.any},{name:"text-background-shape",type:t.textBackgroundShape,triggersBounds:diff.any},{name:"text-justification",type:t.justification}],behavior=[{name:"events",type:t.bool},{name:"text-events",type:t.bool}],visibility=[{name:"display",type:t.display,triggersZOrder:diff.any,triggersBounds:diff.any,triggersBoundsOfParallelBeziers:!0},{name:"visibility",type:t.visibility,triggersZOrder:diff.any},{name:"opacity",type:t.zeroOneNumber,triggersZOrder:diff.zeroNonZero},{name:"text-opacity",type:t.zeroOneNumber},{name:"min-zoomed-font-size",type:t.size},{name:"z-compound-depth",type:t.zCompoundDepth,triggersZOrder:diff.any},{name:"z-index-compare",type:t.zIndexCompare,triggersZOrder:diff.any},{name:"z-index",type:t.nonNegativeInt,triggersZOrder:diff.any}],overlay=[{name:"overlay-padding",type:t.size,triggersBounds:diff.any},{name:"overlay-color",type:t.color},{name:"overlay-opacity",type:t.zeroOneNumber,triggersBounds:diff.zeroNonZero},{name:"overlay-shape",type:t.overlayShape,triggersBounds:diff.any}],underlay=[{name:"underlay-padding",type:t.size,triggersBounds:diff.any},{name:"underlay-color",type:t.color},{name:"underlay-opacity",type:t.zeroOneNumber,triggersBounds:diff.zeroNonZero},{name:"underlay-shape",type:t.overlayShape,triggersBounds:diff.any}],transition=[{name:"transition-property",type:t.propList},{name:"transition-duration",type:t.time},{name:"transition-delay",type:t.time},{name:"transition-timing-function",type:t.easing}],nodeSizeHashOverride=function nodeSizeHashOverride(ele,parsedProp){return"label"===parsedProp.value?-ele.poolIndex():parsedProp.pfValue},nodeBody=[{name:"height",type:t.nodeSize,triggersBounds:diff.any,hashOverride:nodeSizeHashOverride},{name:"width",type:t.nodeSize,triggersBounds:diff.any,hashOverride:nodeSizeHashOverride},{name:"shape",type:t.nodeShape,triggersBounds:diff.any},{name:"shape-polygon-points",type:t.polygonPointList,triggersBounds:diff.any},{name:"background-color",type:t.color},{name:"background-fill",type:t.fill},{name:"background-opacity",type:t.zeroOneNumber},{name:"background-blacken",type:t.nOneOneNumber},{name:"background-gradient-stop-colors",type:t.colors},{name:"background-gradient-stop-positions",type:t.percentages},{name:"background-gradient-direction",type:t.gradientDirection},{name:"padding",type:t.sizeMaybePercent,triggersBounds:diff.any},{name:"padding-relative-to",type:t.paddingRelativeTo,triggersBounds:diff.any},{name:"bounds-expansion",type:t.boundsExpansion,triggersBounds:diff.any}],nodeBorder=[{name:"border-color",type:t.color},{name:"border-opacity",type:t.zeroOneNumber},{name:"border-width",type:t.size,triggersBounds:diff.any},{name:"border-style",type:t.borderStyle}],backgroundImage=[{name:"background-image",type:t.urls},{name:"background-image-crossorigin",type:t.bgCrossOrigin},{name:"background-image-opacity",type:t.zeroOneNumbers},{name:"background-image-containment",type:t.bgContainment},{name:"background-image-smoothing",type:t.bools},{name:"background-position-x",type:t.bgPos},{name:"background-position-y",type:t.bgPos},{name:"background-width-relative-to",type:t.bgRelativeTo},{name:"background-height-relative-to",type:t.bgRelativeTo},{name:"background-repeat",type:t.bgRepeat},{name:"background-fit",type:t.bgFit},{name:"background-clip",type:t.bgClip},{name:"background-width",type:t.bgWH},{name:"background-height",type:t.bgWH},{name:"background-offset-x",type:t.bgPos},{name:"background-offset-y",type:t.bgPos}],compound=[{name:"position",type:t.position,triggersBounds:diff.any},{name:"compound-sizing-wrt-labels",type:t.compoundIncludeLabels,triggersBounds:diff.any},{name:"min-width",type:t.size,triggersBounds:diff.any},{name:"min-width-bias-left",type:t.sizeMaybePercent,triggersBounds:diff.any},{name:"min-width-bias-right",type:t.sizeMaybePercent,triggersBounds:diff.any},{name:"min-height",type:t.size,triggersBounds:diff.any},{name:"min-height-bias-top",type:t.sizeMaybePercent,triggersBounds:diff.any},{name:"min-height-bias-bottom",type:t.sizeMaybePercent,triggersBounds:diff.any}],edgeLine=[{name:"line-style",type:t.lineStyle},{name:"line-color",type:t.color},{name:"line-fill",type:t.fill},{name:"line-cap",type:t.lineCap},{name:"line-opacity",type:t.zeroOneNumber},{name:"line-dash-pattern",type:t.numbers},{name:"line-dash-offset",type:t.number},{name:"line-gradient-stop-colors",type:t.colors},{name:"line-gradient-stop-positions",type:t.percentages},{name:"curve-style",type:t.curveStyle,triggersBounds:diff.any,triggersBoundsOfParallelBeziers:!0},{name:"haystack-radius",type:t.zeroOneNumber,triggersBounds:diff.any},{name:"source-endpoint",type:t.edgeEndpoint,triggersBounds:diff.any},{name:"target-endpoint",type:t.edgeEndpoint,triggersBounds:diff.any},{name:"control-point-step-size",type:t.size,triggersBounds:diff.any},{name:"control-point-distances",type:t.bidirectionalSizes,triggersBounds:diff.any},{name:"control-point-weights",type:t.numbers,triggersBounds:diff.any},{name:"segment-distances",type:t.bidirectionalSizes,triggersBounds:diff.any},{name:"segment-weights",type:t.numbers,triggersBounds:diff.any},{name:"taxi-turn",type:t.bidirectionalSizeMaybePercent,triggersBounds:diff.any},{name:"taxi-turn-min-distance",type:t.size,triggersBounds:diff.any},{name:"taxi-direction",type:t.axisDirection,triggersBounds:diff.any},{name:"edge-distances",type:t.edgeDistances,triggersBounds:diff.any},{name:"arrow-scale",type:t.positiveNumber,triggersBounds:diff.any},{name:"loop-direction",type:t.angle,triggersBounds:diff.any},{name:"loop-sweep",type:t.angle,triggersBounds:diff.any},{name:"source-distance-from-node",type:t.size,triggersBounds:diff.any},{name:"target-distance-from-node",type:t.size,triggersBounds:diff.any}],ghost=[{name:"ghost",type:t.bool,triggersBounds:diff.any},{name:"ghost-offset-x",type:t.bidirectionalSize,triggersBounds:diff.any},{name:"ghost-offset-y",type:t.bidirectionalSize,triggersBounds:diff.any},{name:"ghost-opacity",type:t.zeroOneNumber}],core=[{name:"selection-box-color",type:t.color},{name:"selection-box-opacity",type:t.zeroOneNumber},{name:"selection-box-border-color",type:t.color},{name:"selection-box-border-width",type:t.size},{name:"active-bg-color",type:t.color},{name:"active-bg-opacity",type:t.zeroOneNumber},{name:"active-bg-size",type:t.size},{name:"outside-texture-bg-color",type:t.color},{name:"outside-texture-bg-opacity",type:t.zeroOneNumber}],pie=[];styfn$6.pieBackgroundN=16,pie.push({name:"pie-size",type:t.sizeMaybePercent});for(var i=1;i<=styfn$6.pieBackgroundN;i++)pie.push({name:"pie-"+i+"-background-color",type:t.color}),pie.push({name:"pie-"+i+"-background-size",type:t.percent}),pie.push({name:"pie-"+i+"-background-opacity",type:t.zeroOneNumber});var edgeArrow=[],arrowPrefixes=styfn$6.arrowPrefixes=["source","mid-source","target","mid-target"];[{name:"arrow-shape",type:t.arrowShape,triggersBounds:diff.any},{name:"arrow-color",type:t.color},{name:"arrow-fill",type:t.arrowFill}].forEach((function(prop){arrowPrefixes.forEach((function(prefix){var name=prefix+"-"+prop.name,type=prop.type,triggersBounds=prop.triggersBounds;edgeArrow.push({name:name,type:type,triggersBounds:triggersBounds})}))}),{});var props=styfn$6.properties=[].concat(behavior,transition,visibility,overlay,underlay,ghost,commonLabel,labelDimensions,mainLabel,sourceLabel,targetLabel,nodeBody,nodeBorder,backgroundImage,pie,compound,edgeLine,edgeArrow,core),propGroups=styfn$6.propertyGroups={behavior:behavior,transition:transition,visibility:visibility,overlay:overlay,underlay:underlay,ghost:ghost,commonLabel:commonLabel,labelDimensions:labelDimensions,mainLabel:mainLabel,sourceLabel:sourceLabel,targetLabel:targetLabel,nodeBody:nodeBody,nodeBorder:nodeBorder,backgroundImage:backgroundImage,pie:pie,compound:compound,edgeLine:edgeLine,edgeArrow:edgeArrow,core:core},propGroupNames=styfn$6.propertyGroupNames={};(styfn$6.propertyGroupKeys=Object.keys(propGroups)).forEach((function(key){propGroupNames[key]=propGroups[key].map((function(prop){return prop.name})),propGroups[key].forEach((function(prop){return prop.groupKey=key}))}));var aliases=styfn$6.aliases=[{name:"content",pointsTo:"label"},{name:"control-point-distance",pointsTo:"control-point-distances"},{name:"control-point-weight",pointsTo:"control-point-weights"},{name:"edge-text-rotation",pointsTo:"text-rotation"},{name:"padding-left",pointsTo:"padding"},{name:"padding-right",pointsTo:"padding"},{name:"padding-top",pointsTo:"padding"},{name:"padding-bottom",pointsTo:"padding"}];styfn$6.propertyNames=props.map((function(p){return p.name}));for(var _i=0;_i<props.length;_i++){var prop=props[_i];props[prop.name]=prop}for(var _i2=0;_i2<aliases.length;_i2++){var alias=aliases[_i2],pointsToProp=props[alias.pointsTo],aliasProp={name:alias.name,alias:!0,pointsTo:pointsToProp};props.push(aliasProp),props[alias.name]=aliasProp}}(),styfn$6.getDefaultProperty=function(name){return this.getDefaultProperties()[name]},styfn$6.getDefaultProperties=function(){var _p=this._private;if(null!=_p.defaultProperties)return _p.defaultProperties;for(var rawProps=extend({"selection-box-color":"#ddd","selection-box-opacity":.65,"selection-box-border-color":"#aaa","selection-box-border-width":1,"active-bg-color":"black","active-bg-opacity":.15,"active-bg-size":30,"outside-texture-bg-color":"#000","outside-texture-bg-opacity":.125,events:"yes","text-events":"no","text-valign":"top","text-halign":"center","text-justification":"auto","line-height":1,color:"#000","text-outline-color":"#000","text-outline-width":0,"text-outline-opacity":1,"text-opacity":1,"text-decoration":"none","text-transform":"none","text-wrap":"none","text-overflow-wrap":"whitespace","text-max-width":9999,"text-background-color":"#000","text-background-opacity":0,"text-background-shape":"rectangle","text-background-padding":0,"text-border-opacity":0,"text-border-width":0,"text-border-style":"solid","text-border-color":"#000","font-family":"Helvetica Neue, Helvetica, sans-serif","font-style":"normal","font-weight":"normal","font-size":16,"min-zoomed-font-size":0,"text-rotation":"none","source-text-rotation":"none","target-text-rotation":"none",visibility:"visible",display:"element",opacity:1,"z-compound-depth":"auto","z-index-compare":"auto","z-index":0,label:"","text-margin-x":0,"text-margin-y":0,"source-label":"","source-text-offset":0,"source-text-margin-x":0,"source-text-margin-y":0,"target-label":"","target-text-offset":0,"target-text-margin-x":0,"target-text-margin-y":0,"overlay-opacity":0,"overlay-color":"#000","overlay-padding":10,"overlay-shape":"round-rectangle","underlay-opacity":0,"underlay-color":"#000","underlay-padding":10,"underlay-shape":"round-rectangle","transition-property":"none","transition-duration":0,"transition-delay":0,"transition-timing-function":"linear","background-blacken":0,"background-color":"#999","background-fill":"solid","background-opacity":1,"background-image":"none","background-image-crossorigin":"anonymous","background-image-opacity":1,"background-image-containment":"inside","background-image-smoothing":"yes","background-position-x":"50%","background-position-y":"50%","background-offset-x":0,"background-offset-y":0,"background-width-relative-to":"include-padding","background-height-relative-to":"include-padding","background-repeat":"no-repeat","background-fit":"none","background-clip":"node","background-width":"auto","background-height":"auto","border-color":"#000","border-opacity":1,"border-width":0,"border-style":"solid",height:30,width:30,shape:"ellipse","shape-polygon-points":"-1, -1,   1, -1,   1, 1,   -1, 1","bounds-expansion":0,"background-gradient-direction":"to-bottom","background-gradient-stop-colors":"#999","background-gradient-stop-positions":"0%",ghost:"no","ghost-offset-y":0,"ghost-offset-x":0,"ghost-opacity":0,padding:0,"padding-relative-to":"width",position:"origin","compound-sizing-wrt-labels":"include","min-width":0,"min-width-bias-left":0,"min-width-bias-right":0,"min-height":0,"min-height-bias-top":0,"min-height-bias-bottom":0},{"pie-size":"100%"},[{name:"pie-{{i}}-background-color",value:"black"},{name:"pie-{{i}}-background-size",value:"0%"},{name:"pie-{{i}}-background-opacity",value:1}].reduce((function(css,prop){for(var i=1;i<=styfn$6.pieBackgroundN;i++){var name=prop.name.replace("{{i}}",i),val=prop.value;css[name]=val}return css}),{}),{"line-style":"solid","line-color":"#999","line-fill":"solid","line-cap":"butt","line-opacity":1,"line-gradient-stop-colors":"#999","line-gradient-stop-positions":"0%","control-point-step-size":40,"control-point-weights":.5,"segment-weights":.5,"segment-distances":20,"taxi-turn":"50%","taxi-turn-min-distance":10,"taxi-direction":"auto","edge-distances":"intersection","curve-style":"haystack","haystack-radius":0,"arrow-scale":1,"loop-direction":"-45deg","loop-sweep":"-90deg","source-distance-from-node":0,"target-distance-from-node":0,"source-endpoint":"outside-to-node","target-endpoint":"outside-to-node","line-dash-pattern":[6,3],"line-dash-offset":0},[{name:"arrow-shape",value:"none"},{name:"arrow-color",value:"#999"},{name:"arrow-fill",value:"filled"}].reduce((function(css,prop){return styfn$6.arrowPrefixes.forEach((function(prefix){var name=prefix+"-"+prop.name,val=prop.value;css[name]=val})),css}),{})),parsedProps={},i=0;i<this.properties.length;i++){var prop=this.properties[i];if(!prop.pointsTo){var name=prop.name,val=rawProps[name],parsedProp=this.parse(name,val);parsedProps[name]=parsedProp}}return _p.defaultProperties=parsedProps,_p.defaultProperties},styfn$6.addDefaultStylesheet=function(){this.selector(":parent").css({shape:"rectangle",padding:10,"background-color":"#eee","border-color":"#ccc","border-width":1}).selector("edge").css({width:3}).selector(":loop").css({"curve-style":"bezier"}).selector("edge:compound").css({"curve-style":"bezier","source-endpoint":"outside-to-line","target-endpoint":"outside-to-line"}).selector(":selected").css({"background-color":"#0169D9","line-color":"#0169D9","source-arrow-color":"#0169D9","target-arrow-color":"#0169D9","mid-source-arrow-color":"#0169D9","mid-target-arrow-color":"#0169D9"}).selector(":parent:selected").css({"background-color":"#CCE1F9","border-color":"#aec8e5"}).selector(":active").css({"overlay-color":"black","overlay-padding":10,"overlay-opacity":.25}),this.defaultLength=this.length};var styfn$7={parse:function(name,value,propIsBypass,propIsFlat){if(fn(value))return this.parseImplWarn(name,value,propIsBypass,propIsFlat);var ret,argHash=hashStrings(name,""+value,propIsBypass?"t":"f","mapping"===propIsFlat||!0===propIsFlat||!1===propIsFlat||null==propIsFlat?"dontcare":propIsFlat),propCache=this.propCache=this.propCache||[];return(ret=propCache[argHash])||(ret=propCache[argHash]=this.parseImplWarn(name,value,propIsBypass,propIsFlat)),(propIsBypass||"mapping"===propIsFlat)&&(ret=copy(ret))&&(ret.value=copy(ret.value)),ret},parseImplWarn:function(name,value,propIsBypass,propIsFlat){var prop=this.parseImpl(name,value,propIsBypass,propIsFlat);return prop||null==value||warn("The style property `".concat(name,": ").concat(value,"` is invalid")),!prop||"width"!==prop.name&&"height"!==prop.name||"label"!==value||warn("The style value of `label` is deprecated for `"+prop.name+"`"),prop}};styfn$7.parseImpl=function(name,value,propIsBypass,propIsFlat){name=camel2dash(name);var property=this.properties[name],passedValue=value,types=this.types;if(!property)return null;if(void 0===value)return null;property.alias&&(property=property.pointsTo,name=property.name);var valueIsString=string(value);valueIsString&&(value=value.trim());var data,mapData,type=property.type;if(!type)return null;if(propIsBypass&&(""===value||null===value))return{name:name,value:value,bypass:!0,deleteBypass:!0};if(fn(value))return{name:name,value:value,strValue:"fn",mapped:types.fn,bypass:propIsBypass};if(!valueIsString||propIsFlat||value.length<7||"a"!==value[1]);else{if(value.length>=7&&"d"===value[0]&&(data=new RegExp(types.data.regex).exec(value))){if(propIsBypass)return!1;var mapped=types.data;return{name:name,value:data,strValue:""+value,mapped:mapped,field:data[1],bypass:propIsBypass}}if(value.length>=10&&"m"===value[0]&&(mapData=new RegExp(types.mapData.regex).exec(value))){if(propIsBypass)return!1;if(type.multiple)return!1;var _mapped=types.mapData;if(!type.color&&!type.number)return!1;var valueMin=this.parse(name,mapData[4]);if(!valueMin||valueMin.mapped)return!1;var valueMax=this.parse(name,mapData[5]);if(!valueMax||valueMax.mapped)return!1;if(valueMin.pfValue===valueMax.pfValue||valueMin.strValue===valueMax.strValue)return warn("`"+name+": "+value+"` is not a valid mapper because the output range is zero; converting to `"+name+": "+valueMin.strValue+"`"),this.parse(name,valueMin.strValue);if(type.color){var c1=valueMin.value,c2=valueMax.value;if(!(c1[0]!==c2[0]||c1[1]!==c2[1]||c1[2]!==c2[2]||c1[3]!==c2[3]&&(null!=c1[3]&&1!==c1[3]||null!=c2[3]&&1!==c2[3])))return!1}return{name:name,value:mapData,strValue:""+value,mapped:_mapped,field:mapData[1],fieldMin:parseFloat(mapData[2]),fieldMax:parseFloat(mapData[3]),valueMin:valueMin.value,valueMax:valueMax.value,bypass:propIsBypass}}}if(type.multiple&&"multiple"!==propIsFlat){var vals;if(vals=valueIsString?value.split(/\s+/):array(value)?value:[value],type.evenMultiple&&vals.length%2!=0)return null;for(var valArr=[],unitsArr=[],pfValArr=[],strVal="",hasEnum=!1,i=0;i<vals.length;i++){var p=this.parse(name,vals[i],propIsBypass,"multiple");hasEnum=hasEnum||string(p.value),valArr.push(p.value),pfValArr.push(null!=p.pfValue?p.pfValue:p.value),unitsArr.push(p.units),strVal+=(i>0?" ":"")+p.strValue}return type.validate&&!type.validate(valArr,unitsArr)?null:type.singleEnum&&hasEnum?1===valArr.length&&string(valArr[0])?{name:name,value:valArr[0],strValue:valArr[0],bypass:propIsBypass}:null:{name:name,value:valArr,pfValue:pfValArr,strValue:strVal,bypass:propIsBypass,units:unitsArr}}var checkEnums=function checkEnums(){for(var _i=0;_i<type.enums.length;_i++){if(type.enums[_i]===value)return{name:name,value:value,strValue:""+value,bypass:propIsBypass}}return null};if(type.number){var units,implicitUnits="px";if(type.units&&(units=type.units),type.implicitUnits&&(implicitUnits=type.implicitUnits),!type.unitless)if(valueIsString){var unitsRegex="px|em"+(type.allowPercent?"|\\%":"");units&&(unitsRegex=units);var match=value.match("^("+number$1+")("+unitsRegex+")?$");match&&(value=match[1],units=match[2]||implicitUnits)}else units&&!type.implicitUnits||(units=implicitUnits);if(value=parseFloat(value),isNaN(value)&&void 0===type.enums)return null;if(isNaN(value)&&void 0!==type.enums)return value=passedValue,checkEnums();if(type.integer&&!function integer(obj){return number(obj)&&Math.floor(obj)===obj}(value))return null;if(void 0!==type.min&&(value<type.min||type.strictMin&&value===type.min)||void 0!==type.max&&(value>type.max||type.strictMax&&value===type.max))return null;var ret={name:name,value:value,strValue:""+value+(units||""),units:units,bypass:propIsBypass};return type.unitless||"px"!==units&&"em"!==units?ret.pfValue=value:ret.pfValue="px"!==units&&units?this.getEmSizeInPixels()*value:value,"ms"!==units&&"s"!==units||(ret.pfValue="ms"===units?value:1e3*value),"deg"!==units&&"rad"!==units||(ret.pfValue="rad"===units?value:function deg2rad(deg){return Math.PI*deg/180}(value)),"%"===units&&(ret.pfValue=value/100),ret}if(type.propList){var props=[],propsStr=""+value;if("none"===propsStr);else{for(var propsSplit=propsStr.split(/\s*,\s*|\s+/),_i2=0;_i2<propsSplit.length;_i2++){var propName=propsSplit[_i2].trim();this.properties[propName]?props.push(propName):warn("`"+propName+"` is not a valid property name")}if(0===props.length)return null}return{name:name,value:props,strValue:0===props.length?"none":props.join(" "),bypass:propIsBypass}}if(type.color){var tuple=color2tuple(value);return tuple?{name:name,value:tuple,pfValue:tuple,strValue:"rgb("+tuple[0]+","+tuple[1]+","+tuple[2]+")",bypass:propIsBypass}:null}if(type.regex||type.regexes){if(type.enums){var enumProp=checkEnums();if(enumProp)return enumProp}for(var regexes=type.regexes?type.regexes:[type.regex],_i3=0;_i3<regexes.length;_i3++){var m=new RegExp(regexes[_i3]).exec(value);if(m)return{name:name,value:type.singleRegexMatchValue?m[1]:m,strValue:""+value,bypass:propIsBypass}}return null}return type.string?{name:name,value:""+value,strValue:""+value,bypass:propIsBypass}:type.enums?checkEnums():null};var Style=function Style(cy){if(!(this instanceof Style))return new Style(cy);core(cy)?(this._private={cy:cy,coreStyle:{}},this.length=0,this.resetToDefault()):error("A style must have a core reference")},styfn$8=Style.prototype;styfn$8.instanceString=function(){return"style"},styfn$8.clear=function(){for(var _p=this._private,eles=_p.cy.elements(),i=0;i<this.length;i++)this[i]=void 0;return this.length=0,_p.contextStyles={},_p.propDiffs={},this.cleanElements(eles,!0),eles.forEach((function(ele){var ele_p=ele[0]._private;ele_p.styleDirty=!0,ele_p.appliedInitStyle=!1})),this},styfn$8.resetToDefault=function(){return this.clear(),this.addDefaultStylesheet(),this},styfn$8.core=function(propName){return this._private.coreStyle[propName]||this.getDefaultProperty(propName)},styfn$8.selector=function(selectorStr){var selector="core"===selectorStr?null:new Selector(selectorStr),i=this.length++;return this[i]={selector:selector,properties:[],mappedProperties:[],index:i},this},styfn$8.css=function(){var self=this,args=arguments;if(1===args.length)for(var map=args[0],i=0;i<self.properties.length;i++){var prop=self.properties[i],mapVal=map[prop.name];void 0===mapVal&&(mapVal=map[dash2camel(prop.name)]),void 0!==mapVal&&this.cssRule(prop.name,mapVal)}else 2===args.length&&this.cssRule(args[0],args[1]);return this},styfn$8.style=styfn$8.css,styfn$8.cssRule=function(name,value){var property=this.parse(name,value);if(property){var i=this.length-1;this[i].properties.push(property),this[i].properties[property.name]=property,property.name.match(/pie-(\d+)-background-size/)&&property.value&&(this._private.hasPie=!0),property.mapped&&this[i].mappedProperties.push(property),!this[i].selector&&(this._private.coreStyle[property.name]=property)}return this},styfn$8.append=function(style){return stylesheet(style)?style.appendToStyle(this):array(style)?this.appendFromJson(style):string(style)&&this.appendFromString(style),this},Style.fromJson=function(cy,json){var style=new Style(cy);return style.fromJson(json),style},Style.fromString=function(cy,string){return new Style(cy).fromString(string)},[styfn,styfn$1,styfn$2,styfn$3,styfn$4,styfn$5,styfn$6,styfn$7].forEach((function(props){extend(styfn$8,props)})),Style.types=styfn$8.types,Style.properties=styfn$8.properties,Style.propertyGroups=styfn$8.propertyGroups,Style.propertyGroupNames=styfn$8.propertyGroupNames,Style.propertyGroupKeys=styfn$8.propertyGroupKeys;var corefn$7={style:function style(newStyle){newStyle&&this.setStyle(newStyle).update();return this._private.style},setStyle:function setStyle(style){var _p=this._private;return stylesheet(style)?_p.style=style.generateStyle(this):array(style)?_p.style=Style.fromJson(this,style):string(style)?_p.style=Style.fromString(this,style):_p.style=Style(this),_p.style},updateStyle:function updateStyle(){this.mutableElements().updateStyle()}},corefn$8={autolock:function autolock(bool){return void 0===bool?this._private.autolock:(this._private.autolock=!!bool,this)},autoungrabify:function autoungrabify(bool){return void 0===bool?this._private.autoungrabify:(this._private.autoungrabify=!!bool,this)},autounselectify:function autounselectify(bool){return void 0===bool?this._private.autounselectify:(this._private.autounselectify=!!bool,this)},selectionType:function selectionType(selType){var _p=this._private;return null==_p.selectionType&&(_p.selectionType="single"),void 0===selType?_p.selectionType:("additive"!==selType&&"single"!==selType||(_p.selectionType=selType),this)},panningEnabled:function panningEnabled(bool){return void 0===bool?this._private.panningEnabled:(this._private.panningEnabled=!!bool,this)},userPanningEnabled:function userPanningEnabled(bool){return void 0===bool?this._private.userPanningEnabled:(this._private.userPanningEnabled=!!bool,this)},zoomingEnabled:function zoomingEnabled(bool){return void 0===bool?this._private.zoomingEnabled:(this._private.zoomingEnabled=!!bool,this)},userZoomingEnabled:function userZoomingEnabled(bool){return void 0===bool?this._private.userZoomingEnabled:(this._private.userZoomingEnabled=!!bool,this)},boxSelectionEnabled:function boxSelectionEnabled(bool){return void 0===bool?this._private.boxSelectionEnabled:(this._private.boxSelectionEnabled=!!bool,this)},pan:function pan(){var dim,val,dims,x,y,args=arguments,pan=this._private.pan;switch(args.length){case 0:return pan;case 1:if(string(args[0]))return pan[dim=args[0]];if(plainObject(args[0])){if(!this._private.panningEnabled)return this;x=(dims=args[0]).x,y=dims.y,number(x)&&(pan.x=x),number(y)&&(pan.y=y),this.emit("pan viewport")}break;case 2:if(!this._private.panningEnabled)return this;dim=args[0],val=args[1],"x"!==dim&&"y"!==dim||!number(val)||(pan[dim]=val),this.emit("pan viewport")}return this.notify("viewport"),this},panBy:function panBy(arg0,arg1){var dim,val,dims,x,y,args=arguments,pan=this._private.pan;if(!this._private.panningEnabled)return this;switch(args.length){case 1:plainObject(arg0)&&(x=(dims=args[0]).x,y=dims.y,number(x)&&(pan.x+=x),number(y)&&(pan.y+=y),this.emit("pan viewport"));break;case 2:val=arg1,"x"!==(dim=arg0)&&"y"!==dim||!number(val)||(pan[dim]+=val),this.emit("pan viewport")}return this.notify("viewport"),this},fit:function fit(elements,padding){var viewportState=this.getFitViewport(elements,padding);if(viewportState){var _p=this._private;_p.zoom=viewportState.zoom,_p.pan=viewportState.pan,this.emit("pan zoom viewport"),this.notify("viewport")}return this},getFitViewport:function getFitViewport(elements,padding){if(number(elements)&&void 0===padding&&(padding=elements,elements=void 0),this._private.panningEnabled&&this._private.zoomingEnabled){var bb;if(string(elements)){var sel=elements;elements=this.$(sel)}else if(function boundingBox(obj){return plainObject(obj)&&number(obj.x1)&&number(obj.x2)&&number(obj.y1)&&number(obj.y2)}(elements)){var bbe=elements;(bb={x1:bbe.x1,y1:bbe.y1,x2:bbe.x2,y2:bbe.y2}).w=bb.x2-bb.x1,bb.h=bb.y2-bb.y1}else elementOrCollection(elements)||(elements=this.mutableElements());if(!elementOrCollection(elements)||!elements.empty()){bb=bb||elements.boundingBox();var zoom,w=this.width(),h=this.height();if(padding=number(padding)?padding:0,!isNaN(w)&&!isNaN(h)&&w>0&&h>0&&!isNaN(bb.w)&&!isNaN(bb.h)&&bb.w>0&&bb.h>0)return{zoom:zoom=(zoom=(zoom=Math.min((w-2*padding)/bb.w,(h-2*padding)/bb.h))>this._private.maxZoom?this._private.maxZoom:zoom)<this._private.minZoom?this._private.minZoom:zoom,pan:{x:(w-zoom*(bb.x1+bb.x2))/2,y:(h-zoom*(bb.y1+bb.y2))/2}}}}},zoomRange:function zoomRange(min,max){var _p=this._private;if(null==max){var opts=min;min=opts.min,max=opts.max}return number(min)&&number(max)&&min<=max?(_p.minZoom=min,_p.maxZoom=max):number(min)&&void 0===max&&min<=_p.maxZoom?_p.minZoom=min:number(max)&&void 0===min&&max>=_p.minZoom&&(_p.maxZoom=max),this},minZoom:function minZoom(zoom){return void 0===zoom?this._private.minZoom:this.zoomRange({min:zoom})},maxZoom:function maxZoom(zoom){return void 0===zoom?this._private.maxZoom:this.zoomRange({max:zoom})},getZoomedViewport:function getZoomedViewport(params){var pos,zoom,_p=this._private,currentPan=_p.pan,currentZoom=_p.zoom,bail=!1;if(_p.zoomingEnabled||(bail=!0),number(params)?zoom=params:plainObject(params)&&(zoom=params.level,null!=params.position?pos=modelToRenderedPosition(params.position,currentZoom,currentPan):null!=params.renderedPosition&&(pos=params.renderedPosition),null==pos||_p.panningEnabled||(bail=!0)),zoom=(zoom=zoom>_p.maxZoom?_p.maxZoom:zoom)<_p.minZoom?_p.minZoom:zoom,bail||!number(zoom)||zoom===currentZoom||null!=pos&&(!number(pos.x)||!number(pos.y)))return null;if(null!=pos){var pan1=currentPan,zoom1=currentZoom,zoom2=zoom;return{zoomed:!0,panned:!0,zoom:zoom2,pan:{x:-zoom2/zoom1*(pos.x-pan1.x)+pos.x,y:-zoom2/zoom1*(pos.y-pan1.y)+pos.y}}}return{zoomed:!0,panned:!1,zoom:zoom,pan:currentPan}},zoom:function zoom(params){if(void 0===params)return this._private.zoom;var vp=this.getZoomedViewport(params),_p=this._private;return null!=vp&&vp.zoomed?(_p.zoom=vp.zoom,vp.panned&&(_p.pan.x=vp.pan.x,_p.pan.y=vp.pan.y),this.emit("zoom"+(vp.panned?" pan":"")+" viewport"),this.notify("viewport"),this):this},viewport:function viewport(opts){var _p=this._private,zoomDefd=!0,panDefd=!0,events=[],zoomFailed=!1,panFailed=!1;if(!opts)return this;if(number(opts.zoom)||(zoomDefd=!1),plainObject(opts.pan)||(panDefd=!1),!zoomDefd&&!panDefd)return this;if(zoomDefd){var z=opts.zoom;z<_p.minZoom||z>_p.maxZoom||!_p.zoomingEnabled?zoomFailed=!0:(_p.zoom=z,events.push("zoom"))}if(panDefd&&(!zoomFailed||!opts.cancelOnFailedZoom)&&_p.panningEnabled){var p=opts.pan;number(p.x)&&(_p.pan.x=p.x,panFailed=!1),number(p.y)&&(_p.pan.y=p.y,panFailed=!1),panFailed||events.push("pan")}return events.length>0&&(events.push("viewport"),this.emit(events.join(" ")),this.notify("viewport")),this},center:function center(elements){var pan=this.getCenterPan(elements);return pan&&(this._private.pan=pan,this.emit("pan viewport"),this.notify("viewport")),this},getCenterPan:function getCenterPan(elements,zoom){if(this._private.panningEnabled){if(string(elements)){var selector=elements;elements=this.mutableElements().filter(selector)}else elementOrCollection(elements)||(elements=this.mutableElements());if(0!==elements.length){var bb=elements.boundingBox(),w=this.width(),h=this.height();return{x:(w-(zoom=void 0===zoom?this._private.zoom:zoom)*(bb.x1+bb.x2))/2,y:(h-zoom*(bb.y1+bb.y2))/2}}}},reset:function reset(){return this._private.panningEnabled&&this._private.zoomingEnabled?(this.viewport({pan:{x:0,y:0},zoom:1}),this):this},invalidateSize:function invalidateSize(){this._private.sizeCache=null},size:function size(){var style,val,_p=this._private,container=_p.container;return _p.sizeCache=_p.sizeCache||(container?(style=window$1.getComputedStyle(container),val=function val(name){return parseFloat(style.getPropertyValue(name))},{width:container.clientWidth-val("padding-left")-val("padding-right"),height:container.clientHeight-val("padding-top")-val("padding-bottom")}):{width:1,height:1})},width:function width(){return this.size().width},height:function height(){return this.size().height},extent:function extent(){var pan=this._private.pan,zoom=this._private.zoom,rb=this.renderedExtent(),b={x1:(rb.x1-pan.x)/zoom,x2:(rb.x2-pan.x)/zoom,y1:(rb.y1-pan.y)/zoom,y2:(rb.y2-pan.y)/zoom};return b.w=b.x2-b.x1,b.h=b.y2-b.y1,b},renderedExtent:function renderedExtent(){var width=this.width(),height=this.height();return{x1:0,y1:0,x2:width,y2:height,w:width,h:height}},multiClickDebounceTime:function multiClickDebounceTime(_int){return _int?(this._private.multiClickDebounceTime=_int,this):this._private.multiClickDebounceTime}};corefn$8.centre=corefn$8.center,corefn$8.autolockNodes=corefn$8.autolock,corefn$8.autoungrabifyNodes=corefn$8.autoungrabify;var fn$6={data:define$3.data({field:"data",bindingEvent:"data",allowBinding:!0,allowSetting:!0,settingEvent:"data",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeData:define$3.removeData({field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0}),scratch:define$3.data({field:"scratch",bindingEvent:"scratch",allowBinding:!0,allowSetting:!0,settingEvent:"scratch",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeScratch:define$3.removeData({field:"scratch",event:"scratch",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0})};fn$6.attr=fn$6.data,fn$6.removeAttr=fn$6.removeData;var Core=function Core(opts){var cy=this,container=(opts=extend({},opts)).container;container&&!htmlElement(container)&&htmlElement(container[0])&&(container=container[0]);var reg=container?container._cyreg:null;(reg=reg||{})&&reg.cy&&(reg.cy.destroy(),reg={});var readies=reg.readies=reg.readies||[];container&&(container._cyreg=reg),reg.cy=cy;var head=void 0!==window$1&&void 0!==container&&!opts.headless,options=opts;options.layout=extend({name:head?"grid":"null"},options.layout),options.renderer=extend({name:head?"canvas":"null"},options.renderer);var defVal=function defVal(def,val,altVal){return void 0!==val?val:void 0!==altVal?altVal:def},_p=this._private={container:container,ready:!1,options:options,elements:new Collection(this),listeners:[],aniEles:new Collection(this),data:options.data||{},scratch:{},layout:null,renderer:null,destroyed:!1,notificationsEnabled:!0,minZoom:1e-50,maxZoom:1e50,zoomingEnabled:defVal(!0,options.zoomingEnabled),userZoomingEnabled:defVal(!0,options.userZoomingEnabled),panningEnabled:defVal(!0,options.panningEnabled),userPanningEnabled:defVal(!0,options.userPanningEnabled),boxSelectionEnabled:defVal(!0,options.boxSelectionEnabled),autolock:defVal(!1,options.autolock,options.autolockNodes),autoungrabify:defVal(!1,options.autoungrabify,options.autoungrabifyNodes),autounselectify:defVal(!1,options.autounselectify),styleEnabled:void 0===options.styleEnabled?head:options.styleEnabled,zoom:number(options.zoom)?options.zoom:1,pan:{x:plainObject(options.pan)&&number(options.pan.x)?options.pan.x:0,y:plainObject(options.pan)&&number(options.pan.y)?options.pan.y:0},animation:{current:[],queue:[]},hasCompoundNodes:!1,multiClickDebounceTime:defVal(250,options.multiClickDebounceTime)};this.createEmitter(),this.selectionType(options.selectionType),this.zoomRange({min:options.minZoom,max:options.maxZoom});_p.styleEnabled&&cy.setStyle([]);var rendererOptions=extend({},options,options.renderer);cy.initRenderer(rendererOptions);!function loadExtData(extData,next){if(extData.some(promise))return Promise$1.all(extData).then(next);next(extData)}([options.style,options.elements],(function(thens){var initStyle=thens[0],initEles=thens[1];_p.styleEnabled&&cy.style().append(initStyle),function setElesAndLayout(elements,onload,ondone){cy.notifications(!1);var oldEles=cy.mutableElements();oldEles.length>0&&oldEles.remove(),null!=elements&&(plainObject(elements)||array(elements))&&cy.add(elements),cy.one("layoutready",(function(e){cy.notifications(!0),cy.emit(e),cy.one("load",onload),cy.emitAndNotify("load")})).one("layoutstop",(function(){cy.one("done",ondone),cy.emit("done")}));var layoutOpts=extend({},cy._private.options.layout);layoutOpts.eles=cy.elements(),cy.layout(layoutOpts).run()}(initEles,(function(){cy.startAnimationLoop(),_p.ready=!0,fn(options.ready)&&cy.on("ready",options.ready);for(var i=0;i<readies.length;i++){var fn$1=readies[i];cy.on("ready",fn$1)}reg&&(reg.readies=[]),cy.emit("ready")}),options.done)}))},corefn$9=Core.prototype;extend(corefn$9,{instanceString:function instanceString(){return"core"},isReady:function isReady(){return this._private.ready},destroyed:function destroyed(){return this._private.destroyed},ready:function ready(fn){return this.isReady()?this.emitter().emit("ready",[],fn):this.on("ready",fn),this},destroy:function destroy(){var cy=this;if(!cy.destroyed())return cy.stopAnimationLoop(),cy.destroyRenderer(),this.emit("destroy"),cy._private.destroyed=!0,cy},hasElementWithId:function hasElementWithId(id){return this._private.elements.hasElementWithId(id)},getElementById:function getElementById(id){return this._private.elements.getElementById(id)},hasCompoundNodes:function hasCompoundNodes(){return this._private.hasCompoundNodes},headless:function headless(){return this._private.renderer.isHeadless()},styleEnabled:function styleEnabled(){return this._private.styleEnabled},addToPool:function addToPool(eles){return this._private.elements.merge(eles),this},removeFromPool:function removeFromPool(eles){return this._private.elements.unmerge(eles),this},container:function container(){return this._private.container||null},mount:function mount(container){if(null!=container){var cy=this,_p=cy._private,options=_p.options;return!htmlElement(container)&&htmlElement(container[0])&&(container=container[0]),cy.stopAnimationLoop(),cy.destroyRenderer(),_p.container=container,_p.styleEnabled=!0,cy.invalidateSize(),cy.initRenderer(extend({},options,options.renderer,{name:"null"===options.renderer.name?"canvas":options.renderer.name})),cy.startAnimationLoop(),cy.style(options.style),cy.emit("mount"),cy}},unmount:function unmount(){var cy=this;return cy.stopAnimationLoop(),cy.destroyRenderer(),cy.initRenderer({name:"null"}),cy.emit("unmount"),cy},options:function options(){return copy(this._private.options)},json:function json(obj){var cy=this,_p=cy._private,eles=cy.mutableElements();if(plainObject(obj)){if(cy.startBatch(),obj.elements){var idInJson={},updateEles=function updateEles(jsons,gr){for(var toAdd=[],toMod=[],i=0;i<jsons.length;i++){var json=jsons[i];if(json.data.id){var id=""+json.data.id,ele=cy.getElementById(id);idInJson[id]=!0,0!==ele.length?toMod.push({ele:ele,json:json}):gr?(json.group=gr,toAdd.push(json)):toAdd.push(json)}else warn("cy.json() cannot handle elements without an ID attribute")}cy.add(toAdd);for(var _i=0;_i<toMod.length;_i++){var _toMod$_i=toMod[_i],_ele=_toMod$_i.ele,_json=_toMod$_i.json;_ele.json(_json)}};if(array(obj.elements))updateEles(obj.elements);else for(var grs=["nodes","edges"],i=0;i<grs.length;i++){var gr=grs[i],elements=obj.elements[gr];array(elements)&&updateEles(elements,gr)}var parentsToRemove=cy.collection();eles.filter((function(ele){return!idInJson[ele.id()]})).forEach((function(ele){ele.isParent()?parentsToRemove.merge(ele):ele.remove()})),parentsToRemove.forEach((function(ele){return ele.children().move({parent:null})})),parentsToRemove.forEach((function(ele){return function getFreshRef(ele){return cy.getElementById(ele.id())}(ele).remove()}))}obj.style&&cy.style(obj.style),null!=obj.zoom&&obj.zoom!==_p.zoom&&cy.zoom(obj.zoom),obj.pan&&(obj.pan.x===_p.pan.x&&obj.pan.y===_p.pan.y||cy.pan(obj.pan)),obj.data&&cy.data(obj.data);for(var fields=["minZoom","maxZoom","zoomingEnabled","userZoomingEnabled","panningEnabled","userPanningEnabled","boxSelectionEnabled","autolock","autoungrabify","autounselectify","multiClickDebounceTime"],_i2=0;_i2<fields.length;_i2++){var f=fields[_i2];null!=obj[f]&&cy[f](obj[f])}return cy.endBatch(),this}var json={};!!obj?json.elements=this.elements().map((function(ele){return ele.json()})):(json.elements={},eles.forEach((function(ele){var group=ele.group();json.elements[group]||(json.elements[group]=[]),json.elements[group].push(ele.json())}))),this._private.styleEnabled&&(json.style=cy.style().json()),json.data=copy(cy.data());var options=_p.options;return json.zoomingEnabled=_p.zoomingEnabled,json.userZoomingEnabled=_p.userZoomingEnabled,json.zoom=_p.zoom,json.minZoom=_p.minZoom,json.maxZoom=_p.maxZoom,json.panningEnabled=_p.panningEnabled,json.userPanningEnabled=_p.userPanningEnabled,json.pan=copy(_p.pan),json.boxSelectionEnabled=_p.boxSelectionEnabled,json.renderer=copy(options.renderer),json.hideEdgesOnViewport=options.hideEdgesOnViewport,json.textureOnViewport=options.textureOnViewport,json.wheelSensitivity=options.wheelSensitivity,json.motionBlur=options.motionBlur,json.multiClickDebounceTime=options.multiClickDebounceTime,json}}),corefn$9.$id=corefn$9.getElementById,[corefn,corefn$1,elesfn$v,corefn$2,corefn$3,corefn$4,corefn$5,corefn$6,corefn$7,corefn$8,fn$6].forEach((function(props){extend(corefn$9,props)}));var defaults$9={fit:!0,directed:!1,padding:30,circle:!1,grid:!1,spacingFactor:1.75,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,roots:void 0,maximal:!1,depthSort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function animateFilter(node,i){return!0},ready:void 0,stop:void 0,transform:function transform(node,position){return position}},getInfo=function getInfo(ele){return ele.scratch("breadthfirst")},setInfo=function setInfo(ele,obj){return ele.scratch("breadthfirst",obj)};function BreadthFirstLayout(options){this.options=extend({},defaults$9,options)}BreadthFirstLayout.prototype.run=function(){var roots,params=this.options,options=params,cy=params.cy,eles=options.eles,nodes=eles.nodes().filter((function(n){return!n.isParent()})),graph=eles,directed=options.directed,maximal=options.maximal||options.maximalAdjustments>0,bb=makeBoundingBox(options.boundingBox?options.boundingBox:{x1:0,y1:0,w:cy.width(),h:cy.height()});if(elementOrCollection(options.roots))roots=options.roots;else if(array(options.roots)){for(var rootsArray=[],i=0;i<options.roots.length;i++){var id=options.roots[i],ele=cy.getElementById(id);rootsArray.push(ele)}roots=cy.collection(rootsArray)}else if(string(options.roots))roots=cy.$(options.roots);else if(directed)roots=nodes.roots();else{var components=eles.components();roots=cy.collection();for(var _loop=function _loop(_i){var comp=components[_i],maxDegree=comp.maxDegree(!1),compRoots=comp.filter((function(ele){return ele.degree(!1)===maxDegree}));roots=roots.add(compRoots)},_i=0;_i<components.length;_i++)_loop(_i)}var depths=[],foundByBfs={},addToDepth=function addToDepth(ele,d){null==depths[d]&&(depths[d]=[]);var i=depths[d].length;depths[d].push(ele),setInfo(ele,{index:i,depth:d})};graph.bfs({roots:roots,directed:options.directed,visit:function visit(node,edge,pNode,i,depth){var ele=node[0],id=ele.id();addToDepth(ele,depth),foundByBfs[id]=!0}});for(var orphanNodes=[],_i2=0;_i2<nodes.length;_i2++){var _ele=nodes[_i2];foundByBfs[_ele.id()]||orphanNodes.push(_ele)}var assignDepthsAt=function assignDepthsAt(i){for(var eles=depths[i],j=0;j<eles.length;j++){var _ele2=eles[j];null!=_ele2?setInfo(_ele2,{depth:i,index:j}):(eles.splice(j,1),j--)}},assignDepths=function assignDepths(){for(var _i3=0;_i3<depths.length;_i3++)assignDepthsAt(_i3)},adjustMaximally=function adjustMaximally(ele,shifted){for(var eInfo=getInfo(ele),incomers=ele.incomers().filter((function(el){return el.isNode()&&eles.has(el)})),maxDepth=-1,id=ele.id(),k=0;k<incomers.length;k++){var incmr=incomers[k],iInfo=getInfo(incmr);maxDepth=Math.max(maxDepth,iInfo.depth)}return eInfo.depth<=maxDepth&&(shifted[id]?null:(function changeDepth(ele,newDepth){var _getInfo=getInfo(ele),depth=_getInfo.depth,index=_getInfo.index;depths[depth][index]=null,addToDepth(ele,newDepth)}(ele,maxDepth+1),shifted[id]=!0,!0))};if(directed&&maximal){var Q=[],shifted={},enqueue=function enqueue(n){return Q.push(n)},dequeue=function dequeue(){return Q.shift()};for(nodes.forEach((function(n){return Q.push(n)}));Q.length>0;){var _ele3=dequeue(),didShift=adjustMaximally(_ele3,shifted);if(didShift)_ele3.outgoers().filter((function(el){return el.isNode()&&eles.has(el)})).forEach(enqueue);else if(null===didShift){warn("Detected double maximal shift for node `"+_ele3.id()+"`.  Bailing maximal adjustment due to cycle.  Use `options.maximal: true` only on DAGs.");break}}}assignDepths();var minDistance=0;if(options.avoidOverlap)for(var _i4=0;_i4<nodes.length;_i4++){var nbb=nodes[_i4].layoutDimensions(options),w=nbb.w,h=nbb.h;minDistance=Math.max(minDistance,w,h)}var cachedWeightedPercent={},getWeightedPercent=function getWeightedPercent(ele){if(cachedWeightedPercent[ele.id()])return cachedWeightedPercent[ele.id()];for(var eleDepth=getInfo(ele).depth,neighbors=ele.neighborhood(),percent=0,samples=0,_i5=0;_i5<neighbors.length;_i5++){var neighbor=neighbors[_i5];if(!neighbor.isEdge()&&!neighbor.isParent()&&nodes.has(neighbor)){var bf=getInfo(neighbor);if(null!=bf){var index=bf.index,depth=bf.depth;if(null!=index&&null!=depth){var nDepth=depths[depth].length;depth<eleDepth&&(percent+=index/nDepth,samples++)}}}}return percent/=samples=Math.max(1,samples),0===samples&&(percent=0),cachedWeightedPercent[ele.id()]=percent,percent},sortFn=function sortFn(a,b){var diff=getWeightedPercent(a)-getWeightedPercent(b);return 0===diff?ascending(a.id(),b.id()):diff};void 0!==options.depthSort&&(sortFn=options.depthSort);for(var _i6=0;_i6<depths.length;_i6++)depths[_i6].sort(sortFn),assignDepthsAt(_i6);for(var orphanDepth=[],_i7=0;_i7<orphanNodes.length;_i7++)orphanDepth.push(orphanNodes[_i7]);depths.unshift(orphanDepth),assignDepths();for(var biggestDepthSize=0,_i8=0;_i8<depths.length;_i8++)biggestDepthSize=Math.max(depths[_i8].length,biggestDepthSize);var center_x=bb.x1+bb.w/2,center_y=bb.x1+bb.h/2,maxDepthSize=depths.reduce((function(max,eles){return Math.max(max,eles.length)}),0);return eles.nodes().layoutPositions(this,options,(function getPosition(ele){var _getInfo2=getInfo(ele),depth=_getInfo2.depth,index=_getInfo2.index,depthSize=depths[depth].length,distanceX=Math.max(bb.w/((options.grid?maxDepthSize:depthSize)+1),minDistance),distanceY=Math.max(bb.h/(depths.length+1),minDistance),radiusStepSize=Math.min(bb.w/2/depths.length,bb.h/2/depths.length);if(radiusStepSize=Math.max(radiusStepSize,minDistance),options.circle){var radius=radiusStepSize*depth+radiusStepSize-(depths.length>0&&depths[0].length<=3?radiusStepSize/2:0),theta=2*Math.PI/depths[depth].length*index;return 0===depth&&1===depths[0].length&&(radius=1),{x:center_x+radius*Math.cos(theta),y:center_y+radius*Math.sin(theta)}}return{x:center_x+(index+1-(depthSize+1)/2)*distanceX,y:(depth+1)*distanceY}})),this};var defaults$a={fit:!0,padding:30,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,spacingFactor:void 0,radius:void 0,startAngle:1.5*Math.PI,sweep:void 0,clockwise:!0,sort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function animateFilter(node,i){return!0},ready:void 0,stop:void 0,transform:function transform(node,position){return position}};function CircleLayout(options){this.options=extend({},defaults$a,options)}CircleLayout.prototype.run=function(){var params=this.options,options=params,cy=params.cy,eles=options.eles,clockwise=void 0!==options.counterclockwise?!options.counterclockwise:options.clockwise,nodes=eles.nodes().not(":parent");options.sort&&(nodes=nodes.sort(options.sort));for(var r,bb=makeBoundingBox(options.boundingBox?options.boundingBox:{x1:0,y1:0,w:cy.width(),h:cy.height()}),center_x=bb.x1+bb.w/2,center_y=bb.y1+bb.h/2,dTheta=(void 0===options.sweep?2*Math.PI-2*Math.PI/nodes.length:options.sweep)/Math.max(1,nodes.length-1),minDistance=0,i=0;i<nodes.length;i++){var nbb=nodes[i].layoutDimensions(options),w=nbb.w,h=nbb.h;minDistance=Math.max(minDistance,w,h)}if(r=number(options.radius)?options.radius:nodes.length<=1?0:Math.min(bb.h,bb.w)/2-minDistance,nodes.length>1&&options.avoidOverlap){minDistance*=1.75;var dcos=Math.cos(dTheta)-Math.cos(0),dsin=Math.sin(dTheta)-Math.sin(0),rMin=Math.sqrt(minDistance*minDistance/(dcos*dcos+dsin*dsin));r=Math.max(rMin,r)}return eles.nodes().layoutPositions(this,options,(function getPos(ele,i){var theta=options.startAngle+i*dTheta*(clockwise?1:-1),rx=r*Math.cos(theta),ry=r*Math.sin(theta);return{x:center_x+rx,y:center_y+ry}})),this};var DEBUG,defaults$b={fit:!0,padding:30,startAngle:1.5*Math.PI,sweep:void 0,clockwise:!0,equidistant:!1,minNodeSpacing:10,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,height:void 0,width:void 0,spacingFactor:void 0,concentric:function concentric(node){return node.degree()},levelWidth:function levelWidth(nodes){return nodes.maxDegree()/4},animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function animateFilter(node,i){return!0},ready:void 0,stop:void 0,transform:function transform(node,position){return position}};function ConcentricLayout(options){this.options=extend({},defaults$b,options)}ConcentricLayout.prototype.run=function(){for(var params=this.options,options=params,clockwise=void 0!==options.counterclockwise?!options.counterclockwise:options.clockwise,cy=params.cy,eles=options.eles,nodes=eles.nodes().not(":parent"),bb=makeBoundingBox(options.boundingBox?options.boundingBox:{x1:0,y1:0,w:cy.width(),h:cy.height()}),center_x=bb.x1+bb.w/2,center_y=bb.y1+bb.h/2,nodeValues=[],maxNodeSize=0,i=0;i<nodes.length;i++){var value,node=nodes[i];value=options.concentric(node),nodeValues.push({value:value,node:node}),node._private.scratch.concentric=value}nodes.updateStyle();for(var _i=0;_i<nodes.length;_i++){var nbb=nodes[_i].layoutDimensions(options);maxNodeSize=Math.max(maxNodeSize,nbb.w,nbb.h)}nodeValues.sort((function(a,b){return b.value-a.value}));for(var levelWidth=options.levelWidth(nodes),levels=[[]],currentLevel=levels[0],_i2=0;_i2<nodeValues.length;_i2++){var val=nodeValues[_i2];if(currentLevel.length>0)Math.abs(currentLevel[0].value-val.value)>=levelWidth&&(currentLevel=[],levels.push(currentLevel));currentLevel.push(val)}var minDist=maxNodeSize+options.minNodeSpacing;if(!options.avoidOverlap){var firstLvlHasMulti=levels.length>0&&levels[0].length>1,rStep=(Math.min(bb.w,bb.h)/2-minDist)/(levels.length+firstLvlHasMulti?1:0);minDist=Math.min(minDist,rStep)}for(var r=0,_i3=0;_i3<levels.length;_i3++){var level=levels[_i3],sweep=void 0===options.sweep?2*Math.PI-2*Math.PI/level.length:options.sweep,dTheta=level.dTheta=sweep/Math.max(1,level.length-1);if(level.length>1&&options.avoidOverlap){var dcos=Math.cos(dTheta)-Math.cos(0),dsin=Math.sin(dTheta)-Math.sin(0),rMin=Math.sqrt(minDist*minDist/(dcos*dcos+dsin*dsin));r=Math.max(rMin,r)}level.r=r,r+=minDist}if(options.equidistant){for(var rDeltaMax=0,_r=0,_i4=0;_i4<levels.length;_i4++){var rDelta=levels[_i4].r-_r;rDeltaMax=Math.max(rDeltaMax,rDelta)}_r=0;for(var _i5=0;_i5<levels.length;_i5++){var _level2=levels[_i5];0===_i5&&(_r=_level2.r),_level2.r=_r,_r+=rDeltaMax}}for(var pos={},_i6=0;_i6<levels.length;_i6++)for(var _level3=levels[_i6],_dTheta=_level3.dTheta,_r2=_level3.r,j=0;j<_level3.length;j++){var _val=_level3[j],theta=options.startAngle+(clockwise?1:-1)*_dTheta*j,p={x:center_x+_r2*Math.cos(theta),y:center_y+_r2*Math.sin(theta)};pos[_val.node.id()]=p}return eles.nodes().layoutPositions(this,options,(function(ele){var id=ele.id();return pos[id]})),this};var defaults$c={ready:function ready(){},stop:function stop(){},animate:!0,animationEasing:void 0,animationDuration:void 0,animateFilter:function animateFilter(node,i){return!0},animationThreshold:250,refresh:20,fit:!0,padding:30,boundingBox:void 0,nodeDimensionsIncludeLabels:!1,randomize:!1,componentSpacing:40,nodeRepulsion:function nodeRepulsion(node){return 2048},nodeOverlap:4,idealEdgeLength:function idealEdgeLength(edge){return 32},edgeElasticity:function edgeElasticity(edge){return 32},nestingFactor:1.2,gravity:1,numIter:1e3,initialTemp:1e3,coolingFactor:.99,minTemp:1};function CoseLayout(options){this.options=extend({},defaults$c,options),this.options.layout=this}CoseLayout.prototype.run=function(){var options=this.options,cy=options.cy,layout=this;layout.stopped=!1,!0!==options.animate&&!1!==options.animate||layout.emit({type:"layoutstart",layout:layout}),DEBUG=!0===options.debug;var layoutInfo=createLayoutInfo(cy,layout,options);DEBUG&&undefined(layoutInfo),options.randomize&&randomizePositions(layoutInfo);var startTime=performanceNow(),refresh=function refresh(){refreshPositions(layoutInfo,cy,options),!0===options.fit&&cy.fit(options.padding)},mainLoop=function mainLoop(i){return!(layout.stopped||i>=options.numIter)&&(step$1(layoutInfo,options),layoutInfo.temperature=layoutInfo.temperature*options.coolingFactor,!(layoutInfo.temperature<options.minTemp))},done=function done(){if(!0===options.animate||!1===options.animate)refresh(),layout.one("layoutstop",options.stop),layout.emit({type:"layoutstop",layout:layout});else{var nodes=options.eles.nodes(),getScaledPos=getScaleInBoundsFn(layoutInfo,options,nodes);nodes.layoutPositions(layout,options,getScaledPos)}},i=0,loopRet=!0;if(!0===options.animate){!function frame(){for(var f=0;loopRet&&f<options.refresh;)loopRet=mainLoop(i),i++,f++;loopRet?(performanceNow()-startTime>=options.animationThreshold&&refresh(),requestAnimationFrame(frame)):(separateComponents(layoutInfo,options),done())}()}else{for(;loopRet;)loopRet=mainLoop(i),i++;separateComponents(layoutInfo,options),done()}return this},CoseLayout.prototype.stop=function(){return this.stopped=!0,this.thread&&this.thread.stop(),this.emit("layoutstop"),this},CoseLayout.prototype.destroy=function(){return this.thread&&this.thread.stop(),this};var createLayoutInfo=function createLayoutInfo(cy,layout,options){for(var edges=options.eles.edges(),nodes=options.eles.nodes(),layoutInfo={isCompound:cy.hasCompoundNodes(),layoutNodes:[],idToIndex:{},nodeSize:nodes.size(),graphSet:[],indexToGraph:[],layoutEdges:[],edgeSize:edges.size(),temperature:options.initialTemp,clientWidth:cy.width(),clientHeight:cy.width(),boundingBox:makeBoundingBox(options.boundingBox?options.boundingBox:{x1:0,y1:0,w:cy.width(),h:cy.height()})},components=options.eles.components(),id2cmptId={},i=0;i<components.length;i++)for(var component=components[i],j=0;j<component.length;j++){id2cmptId[component[j].id()]=i}for(i=0;i<layoutInfo.nodeSize;i++){var nbb=(n=nodes[i]).layoutDimensions(options);(tempNode={}).isLocked=n.locked(),tempNode.id=n.data("id"),tempNode.parentId=n.data("parent"),tempNode.cmptId=id2cmptId[n.id()],tempNode.children=[],tempNode.positionX=n.position("x"),tempNode.positionY=n.position("y"),tempNode.offsetX=0,tempNode.offsetY=0,tempNode.height=nbb.w,tempNode.width=nbb.h,tempNode.maxX=tempNode.positionX+tempNode.width/2,tempNode.minX=tempNode.positionX-tempNode.width/2,tempNode.maxY=tempNode.positionY+tempNode.height/2,tempNode.minY=tempNode.positionY-tempNode.height/2,tempNode.padLeft=parseFloat(n.style("padding")),tempNode.padRight=parseFloat(n.style("padding")),tempNode.padTop=parseFloat(n.style("padding")),tempNode.padBottom=parseFloat(n.style("padding")),tempNode.nodeRepulsion=fn(options.nodeRepulsion)?options.nodeRepulsion(n):options.nodeRepulsion,layoutInfo.layoutNodes.push(tempNode),layoutInfo.idToIndex[tempNode.id]=i}var queue=[],start=0,end=-1,tempGraph=[];for(i=0;i<layoutInfo.nodeSize;i++){var n,p_id=(n=layoutInfo.layoutNodes[i]).parentId;null!=p_id?layoutInfo.layoutNodes[layoutInfo.idToIndex[p_id]].children.push(n.id):(queue[++end]=n.id,tempGraph.push(n.id))}for(layoutInfo.graphSet.push(tempGraph);start<=end;){var node_id=queue[start++],node_ix=layoutInfo.idToIndex[node_id],children=layoutInfo.layoutNodes[node_ix].children;if(children.length>0){layoutInfo.graphSet.push(children);for(i=0;i<children.length;i++)queue[++end]=children[i]}}for(i=0;i<layoutInfo.graphSet.length;i++){var graph=layoutInfo.graphSet[i];for(j=0;j<graph.length;j++){var index=layoutInfo.idToIndex[graph[j]];layoutInfo.indexToGraph[index]=i}}for(i=0;i<layoutInfo.edgeSize;i++){var e=edges[i],tempEdge={};tempEdge.id=e.data("id"),tempEdge.sourceId=e.data("source"),tempEdge.targetId=e.data("target");var idealLength=fn(options.idealEdgeLength)?options.idealEdgeLength(e):options.idealEdgeLength,elasticity=fn(options.edgeElasticity)?options.edgeElasticity(e):options.edgeElasticity,sourceIx=layoutInfo.idToIndex[tempEdge.sourceId],targetIx=layoutInfo.idToIndex[tempEdge.targetId];if(layoutInfo.indexToGraph[sourceIx]!=layoutInfo.indexToGraph[targetIx]){for(var lca=findLCA(tempEdge.sourceId,tempEdge.targetId,layoutInfo),lcaGraph=layoutInfo.graphSet[lca],depth=0,tempNode=layoutInfo.layoutNodes[sourceIx];-1===lcaGraph.indexOf(tempNode.id);)tempNode=layoutInfo.layoutNodes[layoutInfo.idToIndex[tempNode.parentId]],depth++;for(tempNode=layoutInfo.layoutNodes[targetIx];-1===lcaGraph.indexOf(tempNode.id);)tempNode=layoutInfo.layoutNodes[layoutInfo.idToIndex[tempNode.parentId]],depth++;idealLength*=depth*options.nestingFactor}tempEdge.idealLength=idealLength,tempEdge.elasticity=elasticity,layoutInfo.layoutEdges.push(tempEdge)}return layoutInfo},findLCA=function findLCA(node1,node2,layoutInfo){var res=findLCA_aux(node1,node2,0,layoutInfo);return 2>res.count?0:res.graph},findLCA_aux=function findLCA_aux(node1,node2,graphIx,layoutInfo){var graph=layoutInfo.graphSet[graphIx];if(-1<graph.indexOf(node1)&&-1<graph.indexOf(node2))return{count:2,graph:graphIx};for(var c=0,i=0;i<graph.length;i++){var nodeId=graph[i],nodeIx=layoutInfo.idToIndex[nodeId],children=layoutInfo.layoutNodes[nodeIx].children;if(0!==children.length){var result=findLCA_aux(node1,node2,layoutInfo.indexToGraph[layoutInfo.idToIndex[children[0]]],layoutInfo);if(0!==result.count){if(1!==result.count)return result;if(2===++c)break}}}return{count:c,graph:graphIx}},randomizePositions=function randomizePositions(layoutInfo,cy){for(var width=layoutInfo.clientWidth,height=layoutInfo.clientHeight,i=0;i<layoutInfo.nodeSize;i++){var n=layoutInfo.layoutNodes[i];0!==n.children.length||n.isLocked||(n.positionX=Math.random()*width,n.positionY=Math.random()*height)}},getScaleInBoundsFn=function getScaleInBoundsFn(layoutInfo,options,nodes){var bb=layoutInfo.boundingBox,coseBB={x1:1/0,x2:-1/0,y1:1/0,y2:-1/0};return options.boundingBox&&(nodes.forEach((function(node){var lnode=layoutInfo.layoutNodes[layoutInfo.idToIndex[node.data("id")]];coseBB.x1=Math.min(coseBB.x1,lnode.positionX),coseBB.x2=Math.max(coseBB.x2,lnode.positionX),coseBB.y1=Math.min(coseBB.y1,lnode.positionY),coseBB.y2=Math.max(coseBB.y2,lnode.positionY)})),coseBB.w=coseBB.x2-coseBB.x1,coseBB.h=coseBB.y2-coseBB.y1),function(ele,i){var lnode=layoutInfo.layoutNodes[layoutInfo.idToIndex[ele.data("id")]];if(options.boundingBox){var pctX=(lnode.positionX-coseBB.x1)/coseBB.w,pctY=(lnode.positionY-coseBB.y1)/coseBB.h;return{x:bb.x1+pctX*bb.w,y:bb.y1+pctY*bb.h}}return{x:lnode.positionX,y:lnode.positionY}}},refreshPositions=function refreshPositions(layoutInfo,cy,options){var layout=options.layout,nodes=options.eles.nodes(),getScaledPos=getScaleInBoundsFn(layoutInfo,options,nodes);nodes.positions(getScaledPos),!0!==layoutInfo.ready&&(layoutInfo.ready=!0,layout.one("layoutready",options.ready),layout.emit({type:"layoutready",layout:this}))},step$1=function step(layoutInfo,options,_step){calculateNodeForces(layoutInfo,options),calculateEdgeForces(layoutInfo),calculateGravityForces(layoutInfo,options),propagateForces(layoutInfo),updatePositions(layoutInfo)},calculateNodeForces=function calculateNodeForces(layoutInfo,options){for(var i=0;i<layoutInfo.graphSet.length;i++)for(var graph=layoutInfo.graphSet[i],numNodes=graph.length,j=0;j<numNodes;j++)for(var node1=layoutInfo.layoutNodes[layoutInfo.idToIndex[graph[j]]],k=j+1;k<numNodes;k++){var node2=layoutInfo.layoutNodes[layoutInfo.idToIndex[graph[k]]];nodeRepulsion(node1,node2,layoutInfo,options)}},randomDistance=function randomDistance(max){return-max+2*max*Math.random()},nodeRepulsion=function nodeRepulsion(node1,node2,layoutInfo,options){if(node1.cmptId===node2.cmptId||layoutInfo.isCompound){var directionX=node2.positionX-node1.positionX,directionY=node2.positionY-node1.positionY;0===directionX&&0===directionY&&(directionX=randomDistance(1),directionY=randomDistance(1));var overlap=nodesOverlap(node1,node2,directionX,directionY);if(overlap>0)var forceX=(force=options.nodeOverlap*overlap)*directionX/(distance=Math.sqrt(directionX*directionX+directionY*directionY)),forceY=force*directionY/distance;else{var force,point1=findClippingPoint(node1,directionX,directionY),point2=findClippingPoint(node2,-1*directionX,-1*directionY),distanceX=point2.x-point1.x,distanceY=point2.y-point1.y,distanceSqr=distanceX*distanceX+distanceY*distanceY,distance=Math.sqrt(distanceSqr);forceX=(force=(node1.nodeRepulsion+node2.nodeRepulsion)/distanceSqr)*distanceX/distance,forceY=force*distanceY/distance}node1.isLocked||(node1.offsetX-=forceX,node1.offsetY-=forceY),node2.isLocked||(node2.offsetX+=forceX,node2.offsetY+=forceY)}},nodesOverlap=function nodesOverlap(node1,node2,dX,dY){if(dX>0)var overlapX=node1.maxX-node2.minX;else overlapX=node2.maxX-node1.minX;if(dY>0)var overlapY=node1.maxY-node2.minY;else overlapY=node2.maxY-node1.minY;return overlapX>=0&&overlapY>=0?Math.sqrt(overlapX*overlapX+overlapY*overlapY):0},findClippingPoint=function findClippingPoint(node,dX,dY){var X=node.positionX,Y=node.positionY,H=node.height||1,W=node.width||1,dirSlope=dY/dX,nodeSlope=H/W,res={};return 0===dX&&0<dY||0===dX&&0>dY?(res.x=X,res.y=Y+H/2,res):0<dX&&-1*nodeSlope<=dirSlope&&dirSlope<=nodeSlope?(res.x=X+W/2,res.y=Y+W*dY/2/dX,res):0>dX&&-1*nodeSlope<=dirSlope&&dirSlope<=nodeSlope?(res.x=X-W/2,res.y=Y-W*dY/2/dX,res):0<dY&&(dirSlope<=-1*nodeSlope||dirSlope>=nodeSlope)?(res.x=X+H*dX/2/dY,res.y=Y+H/2,res):0>dY&&(dirSlope<=-1*nodeSlope||dirSlope>=nodeSlope)?(res.x=X-H*dX/2/dY,res.y=Y-H/2,res):res},calculateEdgeForces=function calculateEdgeForces(layoutInfo,options){for(var i=0;i<layoutInfo.edgeSize;i++){var edge=layoutInfo.layoutEdges[i],sourceIx=layoutInfo.idToIndex[edge.sourceId],source=layoutInfo.layoutNodes[sourceIx],targetIx=layoutInfo.idToIndex[edge.targetId],target=layoutInfo.layoutNodes[targetIx],directionX=target.positionX-source.positionX,directionY=target.positionY-source.positionY;if(0!==directionX||0!==directionY){var point1=findClippingPoint(source,directionX,directionY),point2=findClippingPoint(target,-1*directionX,-1*directionY),lx=point2.x-point1.x,ly=point2.y-point1.y,l=Math.sqrt(lx*lx+ly*ly),force=Math.pow(edge.idealLength-l,2)/edge.elasticity;if(0!==l)var forceX=force*lx/l,forceY=force*ly/l;else forceX=0,forceY=0;source.isLocked||(source.offsetX+=forceX,source.offsetY+=forceY),target.isLocked||(target.offsetX-=forceX,target.offsetY-=forceY)}}},calculateGravityForces=function calculateGravityForces(layoutInfo,options){if(0!==options.gravity)for(var i=0;i<layoutInfo.graphSet.length;i++){var graph=layoutInfo.graphSet[i],numNodes=graph.length;if(0===i)var centerX=layoutInfo.clientHeight/2,centerY=layoutInfo.clientWidth/2;else{var temp=layoutInfo.layoutNodes[layoutInfo.idToIndex[graph[0]]],parent=layoutInfo.layoutNodes[layoutInfo.idToIndex[temp.parentId]];centerX=parent.positionX,centerY=parent.positionY}for(var j=0;j<numNodes;j++){var node=layoutInfo.layoutNodes[layoutInfo.idToIndex[graph[j]]];if(!node.isLocked){var dx=centerX-node.positionX,dy=centerY-node.positionY,d=Math.sqrt(dx*dx+dy*dy);if(d>1){var fx=options.gravity*dx/d,fy=options.gravity*dy/d;node.offsetX+=fx,node.offsetY+=fy}}}}},propagateForces=function propagateForces(layoutInfo,options){var queue=[],start=0,end=-1;for(queue.push.apply(queue,layoutInfo.graphSet[0]),end+=layoutInfo.graphSet[0].length;start<=end;){var nodeId=queue[start++],nodeIndex=layoutInfo.idToIndex[nodeId],node=layoutInfo.layoutNodes[nodeIndex],children=node.children;if(0<children.length&&!node.isLocked){for(var offX=node.offsetX,offY=node.offsetY,i=0;i<children.length;i++){var childNode=layoutInfo.layoutNodes[layoutInfo.idToIndex[children[i]]];childNode.offsetX+=offX,childNode.offsetY+=offY,queue[++end]=children[i]}node.offsetX=0,node.offsetY=0}}},updatePositions=function updatePositions(layoutInfo,options){for(var i=0;i<layoutInfo.nodeSize;i++){0<(n=layoutInfo.layoutNodes[i]).children.length&&(n.maxX=void 0,n.minX=void 0,n.maxY=void 0,n.minY=void 0)}for(i=0;i<layoutInfo.nodeSize;i++){if(!(0<(n=layoutInfo.layoutNodes[i]).children.length||n.isLocked)){var tempForce=limitForce(n.offsetX,n.offsetY,layoutInfo.temperature);n.positionX+=tempForce.x,n.positionY+=tempForce.y,n.offsetX=0,n.offsetY=0,n.minX=n.positionX-n.width,n.maxX=n.positionX+n.width,n.minY=n.positionY-n.height,n.maxY=n.positionY+n.height,updateAncestryBoundaries(n,layoutInfo)}}for(i=0;i<layoutInfo.nodeSize;i++){var n;0<(n=layoutInfo.layoutNodes[i]).children.length&&!n.isLocked&&(n.positionX=(n.maxX+n.minX)/2,n.positionY=(n.maxY+n.minY)/2,n.width=n.maxX-n.minX,n.height=n.maxY-n.minY)}},limitForce=function limitForce(forceX,forceY,max){var force=Math.sqrt(forceX*forceX+forceY*forceY);if(force>max)var res={x:max*forceX/force,y:max*forceY/force};else res={x:forceX,y:forceY};return res},updateAncestryBoundaries=function updateAncestryBoundaries(node,layoutInfo){var parentId=node.parentId;if(null!=parentId){var p=layoutInfo.layoutNodes[layoutInfo.idToIndex[parentId]],flag=!1;return(null==p.maxX||node.maxX+p.padRight>p.maxX)&&(p.maxX=node.maxX+p.padRight,flag=!0),(null==p.minX||node.minX-p.padLeft<p.minX)&&(p.minX=node.minX-p.padLeft,flag=!0),(null==p.maxY||node.maxY+p.padBottom>p.maxY)&&(p.maxY=node.maxY+p.padBottom,flag=!0),(null==p.minY||node.minY-p.padTop<p.minY)&&(p.minY=node.minY-p.padTop,flag=!0),flag?updateAncestryBoundaries(p,layoutInfo):void 0}},separateComponents=function separateComponents(layoutInfo,options){for(var nodes=layoutInfo.layoutNodes,components=[],i=0;i<nodes.length;i++){var node=nodes[i],cid=node.cmptId;(components[cid]=components[cid]||[]).push(node)}var totalA=0;for(i=0;i<components.length;i++){if(c=components[i]){c.x1=1/0,c.x2=-1/0,c.y1=1/0,c.y2=-1/0;for(var j=0;j<c.length;j++){var n=c[j];c.x1=Math.min(c.x1,n.positionX-n.width/2),c.x2=Math.max(c.x2,n.positionX+n.width/2),c.y1=Math.min(c.y1,n.positionY-n.height/2),c.y2=Math.max(c.y2,n.positionY+n.height/2)}c.w=c.x2-c.x1,c.h=c.y2-c.y1,totalA+=c.w*c.h}}components.sort((function(c1,c2){return c2.w*c2.h-c1.w*c1.h}));var x=0,y=0,usedW=0,rowH=0,maxRowW=Math.sqrt(totalA)*layoutInfo.clientWidth/layoutInfo.clientHeight;for(i=0;i<components.length;i++){var c;if(c=components[i]){for(j=0;j<c.length;j++){(n=c[j]).isLocked||(n.positionX+=x-c.x1,n.positionY+=y-c.y1)}x+=c.w+options.componentSpacing,usedW+=c.w+options.componentSpacing,rowH=Math.max(rowH,c.h),usedW>maxRowW&&(y+=rowH+options.componentSpacing,x=0,usedW=0,rowH=0)}}},defaults$d={fit:!0,padding:30,boundingBox:void 0,avoidOverlap:!0,avoidOverlapPadding:10,nodeDimensionsIncludeLabels:!1,spacingFactor:void 0,condense:!1,rows:void 0,cols:void 0,position:function position(node){},sort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function animateFilter(node,i){return!0},ready:void 0,stop:void 0,transform:function transform(node,position){return position}};function GridLayout(options){this.options=extend({},defaults$d,options)}GridLayout.prototype.run=function(){var params=this.options,options=params,cy=params.cy,eles=options.eles,nodes=eles.nodes().not(":parent");options.sort&&(nodes=nodes.sort(options.sort));var bb=makeBoundingBox(options.boundingBox?options.boundingBox:{x1:0,y1:0,w:cy.width(),h:cy.height()});if(0===bb.h||0===bb.w)eles.nodes().layoutPositions(this,options,(function(ele){return{x:bb.x1,y:bb.y1}}));else{var cells=nodes.size(),splits=Math.sqrt(cells*bb.h/bb.w),rows=Math.round(splits),cols=Math.round(bb.w/bb.h*splits),small=function small(val){if(null==val)return Math.min(rows,cols);Math.min(rows,cols)==rows?rows=val:cols=val},large=function large(val){if(null==val)return Math.max(rows,cols);Math.max(rows,cols)==rows?rows=val:cols=val},oRows=options.rows,oCols=null!=options.cols?options.cols:options.columns;if(null!=oRows&&null!=oCols)rows=oRows,cols=oCols;else if(null!=oRows&&null==oCols)rows=oRows,cols=Math.ceil(cells/rows);else if(null==oRows&&null!=oCols)cols=oCols,rows=Math.ceil(cells/cols);else if(cols*rows>cells){var sm=small(),lg=large();(sm-1)*lg>=cells?small(sm-1):(lg-1)*sm>=cells&&large(lg-1)}else for(;cols*rows<cells;){var _sm=small(),_lg=large();(_lg+1)*_sm>=cells?large(_lg+1):small(_sm+1)}var cellWidth=bb.w/cols,cellHeight=bb.h/rows;if(options.condense&&(cellWidth=0,cellHeight=0),options.avoidOverlap)for(var i=0;i<nodes.length;i++){var node=nodes[i],pos=node._private.position;null!=pos.x&&null!=pos.y||(pos.x=0,pos.y=0);var nbb=node.layoutDimensions(options),p=options.avoidOverlapPadding,w=nbb.w+p,h=nbb.h+p;cellWidth=Math.max(cellWidth,w),cellHeight=Math.max(cellHeight,h)}for(var cellUsed={},used=function used(row,col){return!!cellUsed["c-"+row+"-"+col]},use=function use(row,col){cellUsed["c-"+row+"-"+col]=!0},row=0,col=0,moveToNextCell=function moveToNextCell(){++col>=cols&&(col=0,row++)},id2manPos={},_i=0;_i<nodes.length;_i++){var _node=nodes[_i],rcPos=options.position(_node);if(rcPos&&(void 0!==rcPos.row||void 0!==rcPos.col)){var _pos={row:rcPos.row,col:rcPos.col};if(void 0===_pos.col)for(_pos.col=0;used(_pos.row,_pos.col);)_pos.col++;else if(void 0===_pos.row)for(_pos.row=0;used(_pos.row,_pos.col);)_pos.row++;id2manPos[_node.id()]=_pos,use(_pos.row,_pos.col)}}nodes.layoutPositions(this,options,(function getPos(element,i){var x,y;if(element.locked()||element.isParent())return!1;var rcPos=id2manPos[element.id()];if(rcPos)x=rcPos.col*cellWidth+cellWidth/2+bb.x1,y=rcPos.row*cellHeight+cellHeight/2+bb.y1;else{for(;used(row,col);)moveToNextCell();x=col*cellWidth+cellWidth/2+bb.x1,y=row*cellHeight+cellHeight/2+bb.y1,use(row,col),moveToNextCell()}return{x:x,y:y}}))}return this};var defaults$e={ready:function ready(){},stop:function stop(){}};function NullLayout(options){this.options=extend({},defaults$e,options)}NullLayout.prototype.run=function(){var options=this.options,eles=options.eles;options.cy;return this.emit("layoutstart"),eles.nodes().positions((function(){return{x:0,y:0}})),this.one("layoutready",options.ready),this.emit("layoutready"),this.one("layoutstop",options.stop),this.emit("layoutstop"),this},NullLayout.prototype.stop=function(){return this};var defaults$f={positions:void 0,zoom:void 0,pan:void 0,fit:!0,padding:30,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function animateFilter(node,i){return!0},ready:void 0,stop:void 0,transform:function transform(node,position){return position}};function PresetLayout(options){this.options=extend({},defaults$f,options)}PresetLayout.prototype.run=function(){var options=this.options,nodes=options.eles.nodes(),posIsFn=fn(options.positions);return nodes.layoutPositions(this,options,(function(node,i){var position=function getPosition(node){if(null==options.positions)return function copyPosition(p){return{x:p.x,y:p.y}}(node.position());if(posIsFn)return options.positions(node);var pos=options.positions[node._private.data.id];return null==pos?null:pos}(node);return!node.locked()&&null!=position&&position})),this};var defaults$g={fit:!0,padding:30,boundingBox:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function animateFilter(node,i){return!0},ready:void 0,stop:void 0,transform:function transform(node,position){return position}};function RandomLayout(options){this.options=extend({},defaults$g,options)}RandomLayout.prototype.run=function(){var options=this.options,cy=options.cy,eles=options.eles,bb=makeBoundingBox(options.boundingBox?options.boundingBox:{x1:0,y1:0,w:cy.width(),h:cy.height()});return eles.nodes().layoutPositions(this,options,(function getPos(node,i){return{x:bb.x1+Math.round(Math.random()*bb.w),y:bb.y1+Math.round(Math.random()*bb.h)}})),this};var layout=[{name:"breadthfirst",impl:BreadthFirstLayout},{name:"circle",impl:CircleLayout},{name:"concentric",impl:ConcentricLayout},{name:"cose",impl:CoseLayout},{name:"grid",impl:GridLayout},{name:"null",impl:NullLayout},{name:"preset",impl:PresetLayout},{name:"random",impl:RandomLayout}];function NullRenderer(options){this.options=options,this.notifications=0}var noop$1=function noop(){},throwImgErr=function throwImgErr(){throw new Error("A headless instance can not render images")};NullRenderer.prototype={recalculateRenderedStyle:noop$1,notify:function notify(){this.notifications++},init:noop$1,isHeadless:function isHeadless(){return!0},png:throwImgErr,jpg:throwImgErr};var BRp={arrowShapeWidth:.3,registerArrowShapes:function(){var arrowShapes=this.arrowShapes={},renderer=this,bbCollide=function bbCollide(x,y,size,angle,translation,edgeWidth,padding){var x1=translation.x-size/2-padding,x2=translation.x+size/2+padding,y1=translation.y-size/2-padding,y2=translation.y+size/2+padding;return x1<=x&&x<=x2&&y1<=y&&y<=y2},transform=function transform(x,y,size,angle,translation){var xRotated=x*Math.cos(angle)-y*Math.sin(angle),yScaled=(x*Math.sin(angle)+y*Math.cos(angle))*size;return{x:xRotated*size+translation.x,y:yScaled+translation.y}},transformPoints=function transformPoints(pts,size,angle,translation){for(var retPts=[],i=0;i<pts.length;i+=2){var x=pts[i],y=pts[i+1];retPts.push(transform(x,y,size,angle,translation))}return retPts},pointsToArr=function pointsToArr(pts){for(var ret=[],i=0;i<pts.length;i++){var p=pts[i];ret.push(p.x,p.y)}return ret},standardGap=function standardGap(edge){return edge.pstyle("width").pfValue*edge.pstyle("arrow-scale").pfValue*2},defineArrowShape=function defineArrowShape(name,defn){string(defn)&&(defn=arrowShapes[defn]),arrowShapes[name]=extend({name:name,points:[-.15,-.3,.15,-.3,.15,.3,-.15,.3],collide:function collide(x,y,size,angle,translation,padding){var points=pointsToArr(transformPoints(this.points,size+2*padding,angle,translation));return pointInsidePolygonPoints(x,y,points)},roughCollide:bbCollide,draw:function draw(context,size,angle,translation){var points=transformPoints(this.points,size,angle,translation);renderer.arrowShapeImpl("polygon")(context,points)},spacing:function spacing(edge){return 0},gap:standardGap},defn)};defineArrowShape("none",{collide:falsify,roughCollide:falsify,draw:noop,spacing:zeroify,gap:zeroify}),defineArrowShape("triangle",{points:[-.15,-.3,0,0,.15,-.3]}),defineArrowShape("arrow","triangle"),defineArrowShape("triangle-backcurve",{points:arrowShapes.triangle.points,controlPoint:[0,-.15],roughCollide:bbCollide,draw:function draw(context,size,angle,translation,edgeWidth){var ptsTrans=transformPoints(this.points,size,angle,translation),ctrlPt=this.controlPoint,ctrlPtTrans=transform(ctrlPt[0],ctrlPt[1],size,angle,translation);renderer.arrowShapeImpl(this.name)(context,ptsTrans,ctrlPtTrans)},gap:function gap(edge){return.8*standardGap(edge)}}),defineArrowShape("triangle-tee",{points:[0,0,.15,-.3,-.15,-.3,0,0],pointsTee:[-.15,-.4,-.15,-.5,.15,-.5,.15,-.4],collide:function collide(x,y,size,angle,translation,edgeWidth,padding){var triPts=pointsToArr(transformPoints(this.points,size+2*padding,angle,translation)),teePts=pointsToArr(transformPoints(this.pointsTee,size+2*padding,angle,translation));return pointInsidePolygonPoints(x,y,triPts)||pointInsidePolygonPoints(x,y,teePts)},draw:function draw(context,size,angle,translation,edgeWidth){var triPts=transformPoints(this.points,size,angle,translation),teePts=transformPoints(this.pointsTee,size,angle,translation);renderer.arrowShapeImpl(this.name)(context,triPts,teePts)}}),defineArrowShape("circle-triangle",{radius:.15,pointsTr:[0,-.15,.15,-.45,-.15,-.45,0,-.15],collide:function collide(x,y,size,angle,translation,edgeWidth,padding){var t=translation,circleInside=Math.pow(t.x-x,2)+Math.pow(t.y-y,2)<=Math.pow((size+2*padding)*this.radius,2),triPts=pointsToArr(transformPoints(this.points,size+2*padding,angle,translation));return pointInsidePolygonPoints(x,y,triPts)||circleInside},draw:function draw(context,size,angle,translation,edgeWidth){var triPts=transformPoints(this.pointsTr,size,angle,translation);renderer.arrowShapeImpl(this.name)(context,triPts,translation.x,translation.y,this.radius*size)},spacing:function spacing(edge){return renderer.getArrowWidth(edge.pstyle("width").pfValue,edge.pstyle("arrow-scale").value)*this.radius}}),defineArrowShape("triangle-cross",{points:[0,0,.15,-.3,-.15,-.3,0,0],baseCrossLinePts:[-.15,-.4,-.15,-.4,.15,-.4,.15,-.4],crossLinePts:function crossLinePts(size,edgeWidth){var p=this.baseCrossLinePts.slice(),shiftFactor=edgeWidth/size;return p[3]=p[3]-shiftFactor,p[5]=p[5]-shiftFactor,p},collide:function collide(x,y,size,angle,translation,edgeWidth,padding){var triPts=pointsToArr(transformPoints(this.points,size+2*padding,angle,translation)),teePts=pointsToArr(transformPoints(this.crossLinePts(size,edgeWidth),size+2*padding,angle,translation));return pointInsidePolygonPoints(x,y,triPts)||pointInsidePolygonPoints(x,y,teePts)},draw:function draw(context,size,angle,translation,edgeWidth){var triPts=transformPoints(this.points,size,angle,translation),crossLinePts=transformPoints(this.crossLinePts(size,edgeWidth),size,angle,translation);renderer.arrowShapeImpl(this.name)(context,triPts,crossLinePts)}}),defineArrowShape("vee",{points:[-.15,-.3,0,0,.15,-.3,0,-.15],gap:function gap(edge){return.525*standardGap(edge)}}),defineArrowShape("circle",{radius:.15,collide:function collide(x,y,size,angle,translation,edgeWidth,padding){var t=translation;return Math.pow(t.x-x,2)+Math.pow(t.y-y,2)<=Math.pow((size+2*padding)*this.radius,2)},draw:function draw(context,size,angle,translation,edgeWidth){renderer.arrowShapeImpl(this.name)(context,translation.x,translation.y,this.radius*size)},spacing:function spacing(edge){return renderer.getArrowWidth(edge.pstyle("width").pfValue,edge.pstyle("arrow-scale").value)*this.radius}}),defineArrowShape("tee",{points:[-.15,0,-.15,-.1,.15,-.1,.15,0],spacing:function spacing(edge){return 1},gap:function gap(edge){return 1}}),defineArrowShape("square",{points:[-.15,0,.15,0,.15,-.3,-.15,-.3]}),defineArrowShape("diamond",{points:[-.15,-.15,0,-.3,.15,-.15,0,0],gap:function gap(edge){return edge.pstyle("width").pfValue*edge.pstyle("arrow-scale").value}}),defineArrowShape("chevron",{points:[0,0,-.15,-.15,-.1,-.2,0,-.1,.1,-.2,.15,-.15],gap:function gap(edge){return.95*edge.pstyle("width").pfValue*edge.pstyle("arrow-scale").value}})}},BRp$1={projectIntoViewport:function(clientX,clientY){var cy=this.cy,offsets=this.findContainerClientCoords(),offsetLeft=offsets[0],offsetTop=offsets[1],scale=offsets[4],pan=cy.pan(),zoom=cy.zoom();return[((clientX-offsetLeft)/scale-pan.x)/zoom,((clientY-offsetTop)/scale-pan.y)/zoom]},findContainerClientCoords:function(){if(this.containerBB)return this.containerBB;var container=this.container,rect=container.getBoundingClientRect(),style=window$1.getComputedStyle(container),styleValue=function styleValue(name){return parseFloat(style.getPropertyValue(name))},padding_left=styleValue("padding-left"),padding_right=styleValue("padding-right"),padding_top=styleValue("padding-top"),padding_bottom=styleValue("padding-bottom"),border_left=styleValue("border-left-width"),border_right=styleValue("border-right-width"),border_top=styleValue("border-top-width"),clientWidth=(styleValue("border-bottom-width"),container.clientWidth),clientHeight=container.clientHeight,paddingHor=padding_left+padding_right,paddingVer=padding_top+padding_bottom,borderHor=border_left+border_right,scale=rect.width/(clientWidth+borderHor),unscaledW=clientWidth-paddingHor,unscaledH=clientHeight-paddingVer,left=rect.left+padding_left+border_left,top=rect.top+padding_top+border_top;return this.containerBB=[left,top,unscaledW,unscaledH,scale]},invalidateContainerClientCoordsCache:function(){this.containerBB=null},findNearestElement:function(x,y,interactiveElementsOnly,isTouch){return this.findNearestElements(x,y,interactiveElementsOnly,isTouch)[0]},findNearestElements:function(x,y,interactiveElementsOnly,isTouch){var nearEdge,nearNode,self=this,r=this,eles=r.getCachedZSortedEles(),near=[],zoom=r.cy.zoom(),hasCompounds=r.cy.hasCompoundNodes(),edgeThreshold=(isTouch?24:8)/zoom,nodeThreshold=(isTouch?8:2)/zoom,labelThreshold=(isTouch?8:2)/zoom,minSqDist=1/0;function addEle(ele,sqDist){if(ele.isNode()){if(nearNode)return;nearNode=ele,near.push(ele)}if(ele.isEdge()&&(null==sqDist||sqDist<minSqDist))if(nearEdge){if(nearEdge.pstyle("z-compound-depth").value===ele.pstyle("z-compound-depth").value&&nearEdge.pstyle("z-compound-depth").value===ele.pstyle("z-compound-depth").value)for(var i=0;i<near.length;i++)if(near[i].isEdge()){near[i]=ele,nearEdge=ele,minSqDist=null!=sqDist?sqDist:minSqDist;break}}else near.push(ele),nearEdge=ele,minSqDist=null!=sqDist?sqDist:minSqDist}function checkNode(node){var width=node.outerWidth()+2*nodeThreshold,height=node.outerHeight()+2*nodeThreshold,hw=width/2,hh=height/2,pos=node.position();if(pos.x-hw<=x&&x<=pos.x+hw&&pos.y-hh<=y&&y<=pos.y+hh&&r.nodeShapes[self.getNodeShape(node)].checkPoint(x,y,0,width,height,pos.x,pos.y))return addEle(node,0),!0}function checkEdge(edge){var sqDist,_p=edge._private,rs=_p.rscratch,styleWidth=edge.pstyle("width").pfValue,scale=edge.pstyle("arrow-scale").value,width=styleWidth/2+edgeThreshold,widthSq=width*width,width2=2*width,src=_p.source,tgt=_p.target;if("segments"===rs.edgeType||"straight"===rs.edgeType||"haystack"===rs.edgeType){for(var pts=rs.allpts,i=0;i+3<pts.length;i+=2)if(inLineVicinity(x,y,pts[i],pts[i+1],pts[i+2],pts[i+3],width2)&&widthSq>(sqDist=sqdistToFiniteLine(x,y,pts[i],pts[i+1],pts[i+2],pts[i+3])))return addEle(edge,sqDist),!0}else if("bezier"===rs.edgeType||"multibezier"===rs.edgeType||"self"===rs.edgeType||"compound"===rs.edgeType)for(pts=rs.allpts,i=0;i+5<rs.allpts.length;i+=4)if(inBezierVicinity(x,y,pts[i],pts[i+1],pts[i+2],pts[i+3],pts[i+4],pts[i+5],width2)&&widthSq>(sqDist=sqdistToQuadraticBezier(x,y,pts[i],pts[i+1],pts[i+2],pts[i+3],pts[i+4],pts[i+5])))return addEle(edge,sqDist),!0;src=src||_p.source,tgt=tgt||_p.target;var arSize=self.getArrowWidth(styleWidth,scale),arrows=[{name:"source",x:rs.arrowStartX,y:rs.arrowStartY,angle:rs.srcArrowAngle},{name:"target",x:rs.arrowEndX,y:rs.arrowEndY,angle:rs.tgtArrowAngle},{name:"mid-source",x:rs.midX,y:rs.midY,angle:rs.midsrcArrowAngle},{name:"mid-target",x:rs.midX,y:rs.midY,angle:rs.midtgtArrowAngle}];for(i=0;i<arrows.length;i++){var ar=arrows[i],shape=r.arrowShapes[edge.pstyle(ar.name+"-arrow-shape").value],edgeWidth=edge.pstyle("width").pfValue;if(shape.roughCollide(x,y,arSize,ar.angle,{x:ar.x,y:ar.y},edgeWidth,edgeThreshold)&&shape.collide(x,y,arSize,ar.angle,{x:ar.x,y:ar.y},edgeWidth,edgeThreshold))return addEle(edge),!0}hasCompounds&&near.length>0&&(checkNode(src),checkNode(tgt))}function preprop(obj,name,pre){return getPrefixedProperty(obj,name,pre)}function checkLabel(ele,prefix){var prefixDash,_p=ele._private,th=labelThreshold;prefixDash=prefix?prefix+"-":"",ele.boundingBox();var bb=_p.labelBounds[prefix||"main"],text=ele.pstyle(prefixDash+"label").value;if("yes"===ele.pstyle("text-events").strValue&&text){var lx=preprop(_p.rscratch,"labelX",prefix),ly=preprop(_p.rscratch,"labelY",prefix),theta=preprop(_p.rscratch,"labelAngle",prefix),ox=ele.pstyle(prefixDash+"text-margin-x").pfValue,oy=ele.pstyle(prefixDash+"text-margin-y").pfValue,lx1=bb.x1-th-ox,lx2=bb.x2+th-ox,ly1=bb.y1-th-oy,ly2=bb.y2+th-oy;if(theta){var cos=Math.cos(theta),sin=Math.sin(theta),rotate=function rotate(x,y){return{x:(x-=lx)*cos-(y-=ly)*sin+lx,y:x*sin+y*cos+ly}},px1y1=rotate(lx1,ly1),px1y2=rotate(lx1,ly2),px2y1=rotate(lx2,ly1),px2y2=rotate(lx2,ly2),points=[px1y1.x+ox,px1y1.y+oy,px2y1.x+ox,px2y1.y+oy,px2y2.x+ox,px2y2.y+oy,px1y2.x+ox,px1y2.y+oy];if(pointInsidePolygonPoints(x,y,points))return addEle(ele),!0}else if(inBoundingBox(bb,x,y))return addEle(ele),!0}}interactiveElementsOnly&&(eles=eles.interactive);for(var i=eles.length-1;i>=0;i--){var ele=eles[i];ele.isNode()?checkNode(ele)||checkLabel(ele):checkEdge(ele)||checkLabel(ele)||checkLabel(ele,"source")||checkLabel(ele,"target")}return near},getAllInBox:function(x1,y1,x2,y2){for(var eles=this.getCachedZSortedEles().interactive,box=[],x1c=Math.min(x1,x2),x2c=Math.max(x1,x2),y1c=Math.min(y1,y2),y2c=Math.max(y1,y2),boxBb=makeBoundingBox({x1:x1=x1c,y1:y1=y1c,x2:x2=x2c,y2:y2=y2c}),e=0;e<eles.length;e++){var ele=eles[e];if(ele.isNode()){var node=ele,nodeBb=node.boundingBox({includeNodes:!0,includeEdges:!1,includeLabels:!1});boundingBoxesIntersect(boxBb,nodeBb)&&!boundingBoxInBoundingBox(nodeBb,boxBb)&&box.push(node)}else{var edge=ele,_p=edge._private,rs=_p.rscratch;if(null!=rs.startX&&null!=rs.startY&&!inBoundingBox(boxBb,rs.startX,rs.startY))continue;if(null!=rs.endX&&null!=rs.endY&&!inBoundingBox(boxBb,rs.endX,rs.endY))continue;if("bezier"===rs.edgeType||"multibezier"===rs.edgeType||"self"===rs.edgeType||"compound"===rs.edgeType||"segments"===rs.edgeType||"haystack"===rs.edgeType){for(var pts=_p.rstyle.bezierPts||_p.rstyle.linePts||_p.rstyle.haystackPts,allInside=!0,i=0;i<pts.length;i++)if(!pointInBoundingBox(boxBb,pts[i])){allInside=!1;break}allInside&&box.push(edge)}else"haystack"!==rs.edgeType&&"straight"!==rs.edgeType||box.push(edge)}}return box}},BRp$2={calculateArrowAngles:function(edge){var dispX,dispY,startX,startY,endX,endY,rs=edge._private.rscratch,isHaystack="haystack"===rs.edgeType,isBezier="bezier"===rs.edgeType,isMultibezier="multibezier"===rs.edgeType,isSegments="segments"===rs.edgeType,isCompound="compound"===rs.edgeType,isSelf="self"===rs.edgeType;if(isHaystack?(startX=rs.haystackPts[0],startY=rs.haystackPts[1],endX=rs.haystackPts[2],endY=rs.haystackPts[3]):(startX=rs.arrowStartX,startY=rs.arrowStartY,endX=rs.arrowEndX,endY=rs.arrowEndY),midX=rs.midX,midY=rs.midY,isSegments)dispX=startX-rs.segpts[0],dispY=startY-rs.segpts[1];else if(isMultibezier||isCompound||isSelf||isBezier){var pts=rs.allpts;dispX=startX-qbezierAt(pts[0],pts[2],pts[4],.1),dispY=startY-qbezierAt(pts[1],pts[3],pts[5],.1)}else dispX=startX-midX,dispY=startY-midY;rs.srcArrowAngle=getAngleFromDisp(dispX,dispY);var midX=rs.midX,midY=rs.midY;if(isHaystack&&(midX=(startX+endX)/2,midY=(startY+endY)/2),dispX=endX-startX,dispY=endY-startY,isSegments)if((pts=rs.allpts).length/2%2==0){var i1=(i2=pts.length/2)-2;dispX=pts[i2]-pts[i1],dispY=pts[i2+1]-pts[i1+1]}else{i1=(i2=pts.length/2-1)-2;var i2,i3=i2+2;dispX=pts[i2]-pts[i1],dispY=pts[i2+1]-pts[i1+1]}else if(isMultibezier||isCompound||isSelf){var bp0x,bp0y,bp1x,bp1y,pts=rs.allpts;if(rs.ctrlpts.length/2%2==0){var p1=(ic=(p0=pts.length/2-1)+2)+2;bp0x=qbezierAt(pts[p0],pts[ic],pts[p1],0),bp0y=qbezierAt(pts[p0+1],pts[ic+1],pts[p1+1],0),bp1x=qbezierAt(pts[p0],pts[ic],pts[p1],1e-4),bp1y=qbezierAt(pts[p0+1],pts[ic+1],pts[p1+1],1e-4)}else{var ic,p0;p1=(ic=pts.length/2-1)+2;bp0x=qbezierAt(pts[p0=ic-2],pts[ic],pts[p1],.4999),bp0y=qbezierAt(pts[p0+1],pts[ic+1],pts[p1+1],.4999),bp1x=qbezierAt(pts[p0],pts[ic],pts[p1],.5),bp1y=qbezierAt(pts[p0+1],pts[ic+1],pts[p1+1],.5)}dispX=bp1x-bp0x,dispY=bp1y-bp0y}(rs.midtgtArrowAngle=getAngleFromDisp(dispX,dispY),rs.midDispX=dispX,rs.midDispY=dispY,dispX*=-1,dispY*=-1,isSegments)&&((pts=rs.allpts).length/2%2==0||(dispX=-(pts[i3=(i2=pts.length/2-1)+2]-pts[i2]),dispY=-(pts[i3+1]-pts[i2+1])));if(rs.midsrcArrowAngle=getAngleFromDisp(dispX,dispY),isSegments)dispX=endX-rs.segpts[rs.segpts.length-2],dispY=endY-rs.segpts[rs.segpts.length-1];else if(isMultibezier||isCompound||isSelf||isBezier){var l=(pts=rs.allpts).length;dispX=endX-qbezierAt(pts[l-6],pts[l-4],pts[l-2],.9),dispY=endY-qbezierAt(pts[l-5],pts[l-3],pts[l-1],.9)}else dispX=endX-midX,dispY=endY-midY;rs.tgtArrowAngle=getAngleFromDisp(dispX,dispY)}};BRp$2.getArrowWidth=BRp$2.getArrowHeight=function(edgeWidth,scale){var cache=this.arrowWidthCache=this.arrowWidthCache||{},cachedVal=cache[edgeWidth+", "+scale];return cachedVal||(cachedVal=Math.max(Math.pow(13.37*edgeWidth,.9),29)*scale,cache[edgeWidth+", "+scale]=cachedVal,cachedVal)};var BRp$3={};function getPts(pts){var retPts=[];if(null!=pts){for(var i=0;i<pts.length;i+=2){var x=pts[i],y=pts[i+1];retPts.push({x:x,y:y})}return retPts}}BRp$3.findHaystackPoints=function(edges){for(var i=0;i<edges.length;i++){var edge=edges[i],_p=edge._private,rs=_p.rscratch;if(!rs.haystack){var angle=2*Math.random()*Math.PI;rs.source={x:Math.cos(angle),y:Math.sin(angle)},angle=2*Math.random()*Math.PI,rs.target={x:Math.cos(angle),y:Math.sin(angle)}}var src=_p.source,tgt=_p.target,srcPos=src.position(),tgtPos=tgt.position(),srcW=src.width(),tgtW=tgt.width(),srcH=src.height(),tgtH=tgt.height(),halfRadius=edge.pstyle("haystack-radius").value/2;rs.haystackPts=rs.allpts=[rs.source.x*srcW*halfRadius+srcPos.x,rs.source.y*srcH*halfRadius+srcPos.y,rs.target.x*tgtW*halfRadius+tgtPos.x,rs.target.y*tgtH*halfRadius+tgtPos.y],rs.midX=(rs.allpts[0]+rs.allpts[2])/2,rs.midY=(rs.allpts[1]+rs.allpts[3])/2,rs.edgeType="haystack",rs.haystack=!0,this.storeEdgeProjections(edge),this.calculateArrowAngles(edge),this.recalculateEdgeLabelProjections(edge),this.calculateLabelAngles(edge)}},BRp$3.findSegmentsPoints=function(edge,pairInfo){var rs=edge._private.rscratch,posPts=pairInfo.posPts,intersectionPts=pairInfo.intersectionPts,vectorNormInverse=pairInfo.vectorNormInverse,edgeDistances=edge.pstyle("edge-distances").value,segmentWs=edge.pstyle("segment-weights"),segmentDs=edge.pstyle("segment-distances"),segmentsN=Math.min(segmentWs.pfValue.length,segmentDs.pfValue.length);rs.edgeType="segments",rs.segpts=[];for(var s=0;s<segmentsN;s++){var w=segmentWs.pfValue[s],d=segmentDs.pfValue[s],w1=1-w,w2=w,midptPts="node-position"===edgeDistances?posPts:intersectionPts,adjustedMidpt={x:midptPts.x1*w1+midptPts.x2*w2,y:midptPts.y1*w1+midptPts.y2*w2};rs.segpts.push(adjustedMidpt.x+vectorNormInverse.x*d,adjustedMidpt.y+vectorNormInverse.y*d)}},BRp$3.findLoopPoints=function(edge,pairInfo,i,edgeIsUnbundled){var rs=edge._private.rscratch,dirCounts=pairInfo.dirCounts,srcPos=pairInfo.srcPos,ctrlptDists=edge.pstyle("control-point-distances"),ctrlptDist=ctrlptDists?ctrlptDists.pfValue[0]:void 0,loopDir=edge.pstyle("loop-direction").pfValue,loopSwp=edge.pstyle("loop-sweep").pfValue,stepSize=edge.pstyle("control-point-step-size").pfValue;rs.edgeType="self";var j=i,loopDist=stepSize;edgeIsUnbundled&&(j=0,loopDist=ctrlptDist);var loopAngle=loopDir-Math.PI/2,outAngle=loopAngle-loopSwp/2,inAngle=loopAngle+loopSwp/2,dc=String(loopDir+"_"+loopSwp);j=void 0===dirCounts[dc]?dirCounts[dc]=0:++dirCounts[dc],rs.ctrlpts=[srcPos.x+1.4*Math.cos(outAngle)*loopDist*(j/3+1),srcPos.y+1.4*Math.sin(outAngle)*loopDist*(j/3+1),srcPos.x+1.4*Math.cos(inAngle)*loopDist*(j/3+1),srcPos.y+1.4*Math.sin(inAngle)*loopDist*(j/3+1)]},BRp$3.findCompoundLoopPoints=function(edge,pairInfo,i,edgeIsUnbundled){var rs=edge._private.rscratch;rs.edgeType="compound";var srcPos=pairInfo.srcPos,tgtPos=pairInfo.tgtPos,srcW=pairInfo.srcW,srcH=pairInfo.srcH,tgtW=pairInfo.tgtW,tgtH=pairInfo.tgtH,stepSize=edge.pstyle("control-point-step-size").pfValue,ctrlptDists=edge.pstyle("control-point-distances"),ctrlptDist=ctrlptDists?ctrlptDists.pfValue[0]:void 0,j=i,loopDist=stepSize;edgeIsUnbundled&&(j=0,loopDist=ctrlptDist);var loopaPos={x:srcPos.x-srcW/2,y:srcPos.y-srcH/2},loopbPos={x:tgtPos.x-tgtW/2,y:tgtPos.y-tgtH/2},loopPos={x:Math.min(loopaPos.x,loopbPos.x),y:Math.min(loopaPos.y,loopbPos.y)},compoundStretchA=Math.max(.5,Math.log(.01*srcW)),compoundStretchB=Math.max(.5,Math.log(.01*tgtW));rs.ctrlpts=[loopPos.x,loopPos.y-(1+Math.pow(50,1.12)/100)*loopDist*(j/3+1)*compoundStretchA,loopPos.x-(1+Math.pow(50,1.12)/100)*loopDist*(j/3+1)*compoundStretchB,loopPos.y]},BRp$3.findStraightEdgePoints=function(edge){edge._private.rscratch.edgeType="straight"},BRp$3.findBezierPoints=function(edge,pairInfo,i,edgeIsUnbundled,edgeIsSwapped){var rs=edge._private.rscratch,vectorNormInverse=pairInfo.vectorNormInverse,posPts=pairInfo.posPts,intersectionPts=pairInfo.intersectionPts,edgeDistances=edge.pstyle("edge-distances").value,stepSize=edge.pstyle("control-point-step-size").pfValue,ctrlptDists=edge.pstyle("control-point-distances"),ctrlptWs=edge.pstyle("control-point-weights"),bezierN=ctrlptDists&&ctrlptWs?Math.min(ctrlptDists.value.length,ctrlptWs.value.length):1,ctrlptDist=ctrlptDists?ctrlptDists.pfValue[0]:void 0,ctrlptWeight=ctrlptWs.value[0],multi=edgeIsUnbundled;rs.edgeType=multi?"multibezier":"bezier",rs.ctrlpts=[];for(var b=0;b<bezierN;b++){var normctrlptDist=(.5-pairInfo.eles.length/2+i)*stepSize*(edgeIsSwapped?-1:1),manctrlptDist=void 0,sign=signum(normctrlptDist);multi&&(ctrlptDist=ctrlptDists?ctrlptDists.pfValue[b]:stepSize,ctrlptWeight=ctrlptWs.value[b]);var distanceFromMidpoint=void 0!==(manctrlptDist=edgeIsUnbundled?ctrlptDist:void 0!==ctrlptDist?sign*ctrlptDist:void 0)?manctrlptDist:normctrlptDist,w1=1-ctrlptWeight,w2=ctrlptWeight,midptPts="node-position"===edgeDistances?posPts:intersectionPts,adjustedMidpt={x:midptPts.x1*w1+midptPts.x2*w2,y:midptPts.y1*w1+midptPts.y2*w2};rs.ctrlpts.push(adjustedMidpt.x+vectorNormInverse.x*distanceFromMidpoint,adjustedMidpt.y+vectorNormInverse.y*distanceFromMidpoint)}},BRp$3.findTaxiPoints=function(edge,pairInfo){var rs=edge._private.rscratch;rs.edgeType="segments";var posPts=pairInfo.posPts,srcW=pairInfo.srcW,srcH=pairInfo.srcH,tgtW=pairInfo.tgtW,tgtH=pairInfo.tgtH,dIncludesNodeBody="node-position"!==edge.pstyle("edge-distances").value,taxiDir=edge.pstyle("taxi-direction").value,rawTaxiDir=taxiDir,taxiTurn=edge.pstyle("taxi-turn"),turnIsPercent="%"===taxiTurn.units,taxiTurnPfVal=taxiTurn.pfValue,turnIsNegative=taxiTurnPfVal<0,minD=edge.pstyle("taxi-turn-min-distance").pfValue,dw=dIncludesNodeBody?(srcW+tgtW)/2:0,dh=dIncludesNodeBody?(srcH+tgtH)/2:0,pdx=posPts.x2-posPts.x1,pdy=posPts.y2-posPts.y1,subDWH=function subDWH(dxy,dwh){return dxy>0?Math.max(dxy-dwh,0):Math.min(dxy+dwh,0)},dx=subDWH(pdx,dw),dy=subDWH(pdy,dh),isExplicitDir=!1;"auto"===rawTaxiDir?taxiDir=Math.abs(dx)>Math.abs(dy)?"horizontal":"vertical":"upward"===rawTaxiDir||"downward"===rawTaxiDir?(taxiDir="vertical",isExplicitDir=!0):"leftward"!==rawTaxiDir&&"rightward"!==rawTaxiDir||(taxiDir="horizontal",isExplicitDir=!0);var d,isVert="vertical"===taxiDir,l=isVert?dy:dx,pl=isVert?pdy:pdx,sgnL=signum(pl),forcedDir=!1;(isExplicitDir&&(turnIsPercent||turnIsNegative)||!("downward"===rawTaxiDir&&pl<0||"upward"===rawTaxiDir&&pl>0||"leftward"===rawTaxiDir&&pl>0||"rightward"===rawTaxiDir&&pl<0)||(l=(sgnL*=-1)*Math.abs(l),forcedDir=!0),turnIsPercent)?d=(taxiTurnPfVal<0?1+taxiTurnPfVal:taxiTurnPfVal)*l:d=(taxiTurnPfVal<0?l:0)+taxiTurnPfVal*sgnL;var getIsTooClose=function getIsTooClose(d){return Math.abs(d)<minD||Math.abs(d)>=Math.abs(l)},isTooCloseSrc=getIsTooClose(d),isTooCloseTgt=getIsTooClose(Math.abs(l)-Math.abs(d));if((isTooCloseSrc||isTooCloseTgt)&&!forcedDir)if(isVert){var lShapeInsideSrc=Math.abs(pl)<=srcH/2,lShapeInsideTgt=Math.abs(pdx)<=tgtW/2;if(lShapeInsideSrc){var x=(posPts.x1+posPts.x2)/2,y1=posPts.y1,y2=posPts.y2;rs.segpts=[x,y1,x,y2]}else if(lShapeInsideTgt){var y=(posPts.y1+posPts.y2)/2,x1=posPts.x1,x2=posPts.x2;rs.segpts=[x1,y,x2,y]}else rs.segpts=[posPts.x1,posPts.y2]}else{var _lShapeInsideSrc=Math.abs(pl)<=srcW/2,_lShapeInsideTgt=Math.abs(pdy)<=tgtH/2;if(_lShapeInsideSrc){var _y=(posPts.y1+posPts.y2)/2,_x=posPts.x1,_x2=posPts.x2;rs.segpts=[_x,_y,_x2,_y]}else if(_lShapeInsideTgt){var _x3=(posPts.x1+posPts.x2)/2,_y2=posPts.y1,_y3=posPts.y2;rs.segpts=[_x3,_y2,_x3,_y3]}else rs.segpts=[posPts.x2,posPts.y1]}else if(isVert){var _y4=posPts.y1+d+(dIncludesNodeBody?srcH/2*sgnL:0),_x4=posPts.x1,_x5=posPts.x2;rs.segpts=[_x4,_y4,_x5,_y4]}else{var _x6=posPts.x1+d+(dIncludesNodeBody?srcW/2*sgnL:0),_y5=posPts.y1,_y6=posPts.y2;rs.segpts=[_x6,_y5,_x6,_y6]}},BRp$3.tryToCorrectInvalidPoints=function(edge,pairInfo){var rs=edge._private.rscratch;if("bezier"===rs.edgeType){var srcPos=pairInfo.srcPos,tgtPos=pairInfo.tgtPos,srcW=pairInfo.srcW,srcH=pairInfo.srcH,tgtW=pairInfo.tgtW,tgtH=pairInfo.tgtH,srcShape=pairInfo.srcShape,tgtShape=pairInfo.tgtShape,badStart=!number(rs.startX)||!number(rs.startY),badAStart=!number(rs.arrowStartX)||!number(rs.arrowStartY),badEnd=!number(rs.endX)||!number(rs.endY),badAEnd=!number(rs.arrowEndX)||!number(rs.arrowEndY),minCpADist=3*(this.getArrowWidth(edge.pstyle("width").pfValue,edge.pstyle("arrow-scale").value)*this.arrowShapeWidth),startACpDist=dist({x:rs.ctrlpts[0],y:rs.ctrlpts[1]},{x:rs.startX,y:rs.startY}),closeStartACp=startACpDist<minCpADist,endACpDist=dist({x:rs.ctrlpts[0],y:rs.ctrlpts[1]},{x:rs.endX,y:rs.endY}),closeEndACp=endACpDist<minCpADist,overlapping=!1;if(badStart||badAStart||closeStartACp){overlapping=!0;var cpD={x:rs.ctrlpts[0]-srcPos.x,y:rs.ctrlpts[1]-srcPos.y},cpL=Math.sqrt(cpD.x*cpD.x+cpD.y*cpD.y),cpM={x:cpD.x/cpL,y:cpD.y/cpL},radius=Math.max(srcW,srcH),cpProj={x:rs.ctrlpts[0]+2*cpM.x*radius,y:rs.ctrlpts[1]+2*cpM.y*radius},srcCtrlPtIntn=srcShape.intersectLine(srcPos.x,srcPos.y,srcW,srcH,cpProj.x,cpProj.y,0);closeStartACp?(rs.ctrlpts[0]=rs.ctrlpts[0]+cpM.x*(minCpADist-startACpDist),rs.ctrlpts[1]=rs.ctrlpts[1]+cpM.y*(minCpADist-startACpDist)):(rs.ctrlpts[0]=srcCtrlPtIntn[0]+cpM.x*minCpADist,rs.ctrlpts[1]=srcCtrlPtIntn[1]+cpM.y*minCpADist)}if(badEnd||badAEnd||closeEndACp){overlapping=!0;var _cpD={x:rs.ctrlpts[0]-tgtPos.x,y:rs.ctrlpts[1]-tgtPos.y},_cpL=Math.sqrt(_cpD.x*_cpD.x+_cpD.y*_cpD.y),_cpM={x:_cpD.x/_cpL,y:_cpD.y/_cpL},_radius=Math.max(srcW,srcH),_cpProj={x:rs.ctrlpts[0]+2*_cpM.x*_radius,y:rs.ctrlpts[1]+2*_cpM.y*_radius},tgtCtrlPtIntn=tgtShape.intersectLine(tgtPos.x,tgtPos.y,tgtW,tgtH,_cpProj.x,_cpProj.y,0);closeEndACp?(rs.ctrlpts[0]=rs.ctrlpts[0]+_cpM.x*(minCpADist-endACpDist),rs.ctrlpts[1]=rs.ctrlpts[1]+_cpM.y*(minCpADist-endACpDist)):(rs.ctrlpts[0]=tgtCtrlPtIntn[0]+_cpM.x*minCpADist,rs.ctrlpts[1]=tgtCtrlPtIntn[1]+_cpM.y*minCpADist)}overlapping&&this.findEndpoints(edge)}},BRp$3.storeAllpts=function(edge){var rs=edge._private.rscratch;if("multibezier"===rs.edgeType||"bezier"===rs.edgeType||"self"===rs.edgeType||"compound"===rs.edgeType){rs.allpts=[],rs.allpts.push(rs.startX,rs.startY);for(var b=0;b+1<rs.ctrlpts.length;b+=2)rs.allpts.push(rs.ctrlpts[b],rs.ctrlpts[b+1]),b+3<rs.ctrlpts.length&&rs.allpts.push((rs.ctrlpts[b]+rs.ctrlpts[b+2])/2,(rs.ctrlpts[b+1]+rs.ctrlpts[b+3])/2);var m;rs.allpts.push(rs.endX,rs.endY),rs.ctrlpts.length/2%2==0?(m=rs.allpts.length/2-1,rs.midX=rs.allpts[m],rs.midY=rs.allpts[m+1]):(m=rs.allpts.length/2-3,.5,rs.midX=qbezierAt(rs.allpts[m],rs.allpts[m+2],rs.allpts[m+4],.5),rs.midY=qbezierAt(rs.allpts[m+1],rs.allpts[m+3],rs.allpts[m+5],.5))}else if("straight"===rs.edgeType)rs.allpts=[rs.startX,rs.startY,rs.endX,rs.endY],rs.midX=(rs.startX+rs.endX+rs.arrowStartX+rs.arrowEndX)/4,rs.midY=(rs.startY+rs.endY+rs.arrowStartY+rs.arrowEndY)/4;else if("segments"===rs.edgeType)if(rs.allpts=[],rs.allpts.push(rs.startX,rs.startY),rs.allpts.push.apply(rs.allpts,rs.segpts),rs.allpts.push(rs.endX,rs.endY),rs.segpts.length%4==0){var i2=rs.segpts.length/2,i1=i2-2;rs.midX=(rs.segpts[i1]+rs.segpts[i2])/2,rs.midY=(rs.segpts[i1+1]+rs.segpts[i2+1])/2}else{var _i=rs.segpts.length/2-1;rs.midX=rs.segpts[_i],rs.midY=rs.segpts[_i+1]}},BRp$3.checkForInvalidEdgeWarning=function(edge){var rs=edge[0]._private.rscratch;rs.nodesOverlap||number(rs.startX)&&number(rs.startY)&&number(rs.endX)&&number(rs.endY)?rs.loggedErr=!1:rs.loggedErr||(rs.loggedErr=!0,warn("Edge `"+edge.id()+"` has invalid endpoints and so it is impossible to draw.  Adjust your edge style (e.g. control points) accordingly or use an alternative edge type.  This is expected behaviour when the source node and the target node overlap."))},BRp$3.findEdgeControlPoints=function(edges){var _this=this;if(edges&&0!==edges.length){for(var r=this,hasCompounds=r.cy.hasCompoundNodes(),hashTable={map:new Map$1,get:function get(pairId){var map2=this.map.get(pairId[0]);return null!=map2?map2.get(pairId[1]):null},set:function set(pairId,val){var map2=this.map.get(pairId[0]);null==map2&&(map2=new Map$1,this.map.set(pairId[0],map2)),map2.set(pairId[1],val)}},pairIds=[],haystackEdges=[],i=0;i<edges.length;i++){var edge=edges[i],_p=edge._private,curveStyle=edge.pstyle("curve-style").value;if(!edge.removed()&&edge.takesUpSpace())if("haystack"!==curveStyle){var edgeIsUnbundled="unbundled-bezier"===curveStyle||"segments"===curveStyle||"straight"===curveStyle||"straight-triangle"===curveStyle||"taxi"===curveStyle,edgeIsBezier="unbundled-bezier"===curveStyle||"bezier"===curveStyle,src=_p.source,tgt=_p.target,pairId=[src.poolIndex(),tgt.poolIndex()].sort(),tableEntry=hashTable.get(pairId);null==tableEntry&&(tableEntry={eles:[]},hashTable.set(pairId,tableEntry),pairIds.push(pairId)),tableEntry.eles.push(edge),edgeIsUnbundled&&(tableEntry.hasUnbundled=!0),edgeIsBezier&&(tableEntry.hasBezier=!0)}else haystackEdges.push(edge)}for(var _loop=function _loop(p){var pairId=pairIds[p],pairInfo=hashTable.get(pairId),swappedpairInfo=void 0;if(!pairInfo.hasUnbundled){var pllEdges=pairInfo.eles[0].parallelEdges().filter((function(e){return e.isBundledBezier()}));clearArray(pairInfo.eles),pllEdges.forEach((function(edge){return pairInfo.eles.push(edge)})),pairInfo.eles.sort((function(edge1,edge2){return edge1.poolIndex()-edge2.poolIndex()}))}var firstEdge=pairInfo.eles[0],src=firstEdge.source(),tgt=firstEdge.target();if(src.poolIndex()>tgt.poolIndex()){var temp=src;src=tgt,tgt=temp}var srcPos=pairInfo.srcPos=src.position(),tgtPos=pairInfo.tgtPos=tgt.position(),srcW=pairInfo.srcW=src.outerWidth(),srcH=pairInfo.srcH=src.outerHeight(),tgtW=pairInfo.tgtW=tgt.outerWidth(),tgtH=pairInfo.tgtH=tgt.outerHeight(),srcShape=pairInfo.srcShape=r.nodeShapes[_this.getNodeShape(src)],tgtShape=pairInfo.tgtShape=r.nodeShapes[_this.getNodeShape(tgt)];pairInfo.dirCounts={north:0,west:0,south:0,east:0,northwest:0,southwest:0,northeast:0,southeast:0};for(var _i2=0;_i2<pairInfo.eles.length;_i2++){var _edge=pairInfo.eles[_i2],rs=_edge[0]._private.rscratch,_curveStyle=_edge.pstyle("curve-style").value,_edgeIsUnbundled="unbundled-bezier"===_curveStyle||"segments"===_curveStyle||"taxi"===_curveStyle,edgeIsSwapped=!src.same(_edge.source());if(!pairInfo.calculatedIntersection&&src!==tgt&&(pairInfo.hasBezier||pairInfo.hasUnbundled)){pairInfo.calculatedIntersection=!0;var srcOutside=srcShape.intersectLine(srcPos.x,srcPos.y,srcW,srcH,tgtPos.x,tgtPos.y,0),srcIntn=pairInfo.srcIntn=srcOutside,tgtOutside=tgtShape.intersectLine(tgtPos.x,tgtPos.y,tgtW,tgtH,srcPos.x,srcPos.y,0),tgtIntn=pairInfo.tgtIntn=tgtOutside,intersectionPts=pairInfo.intersectionPts={x1:srcOutside[0],x2:tgtOutside[0],y1:srcOutside[1],y2:tgtOutside[1]},posPts=pairInfo.posPts={x1:srcPos.x,x2:tgtPos.x,y1:srcPos.y,y2:tgtPos.y},dy=tgtOutside[1]-srcOutside[1],dx=tgtOutside[0]-srcOutside[0],l=Math.sqrt(dx*dx+dy*dy),vector=pairInfo.vector={x:dx,y:dy},vectorNorm=pairInfo.vectorNorm={x:vector.x/l,y:vector.y/l},vectorNormInverse={x:-vectorNorm.y,y:vectorNorm.x};pairInfo.nodesOverlap=!number(l)||tgtShape.checkPoint(srcOutside[0],srcOutside[1],0,tgtW,tgtH,tgtPos.x,tgtPos.y)||srcShape.checkPoint(tgtOutside[0],tgtOutside[1],0,srcW,srcH,srcPos.x,srcPos.y),pairInfo.vectorNormInverse=vectorNormInverse,swappedpairInfo={nodesOverlap:pairInfo.nodesOverlap,dirCounts:pairInfo.dirCounts,calculatedIntersection:!0,hasBezier:pairInfo.hasBezier,hasUnbundled:pairInfo.hasUnbundled,eles:pairInfo.eles,srcPos:tgtPos,tgtPos:srcPos,srcW:tgtW,srcH:tgtH,tgtW:srcW,tgtH:srcH,srcIntn:tgtIntn,tgtIntn:srcIntn,srcShape:tgtShape,tgtShape:srcShape,posPts:{x1:posPts.x2,y1:posPts.y2,x2:posPts.x1,y2:posPts.y1},intersectionPts:{x1:intersectionPts.x2,y1:intersectionPts.y2,x2:intersectionPts.x1,y2:intersectionPts.y1},vector:{x:-vector.x,y:-vector.y},vectorNorm:{x:-vectorNorm.x,y:-vectorNorm.y},vectorNormInverse:{x:-vectorNormInverse.x,y:-vectorNormInverse.y}}}var passedPairInfo=edgeIsSwapped?swappedpairInfo:pairInfo;rs.nodesOverlap=passedPairInfo.nodesOverlap,rs.srcIntn=passedPairInfo.srcIntn,rs.tgtIntn=passedPairInfo.tgtIntn,hasCompounds&&(src.isParent()||src.isChild()||tgt.isParent()||tgt.isChild())&&(src.parents().anySame(tgt)||tgt.parents().anySame(src)||src.same(tgt)&&src.isParent())?_this.findCompoundLoopPoints(_edge,passedPairInfo,_i2,_edgeIsUnbundled):src===tgt?_this.findLoopPoints(_edge,passedPairInfo,_i2,_edgeIsUnbundled):"segments"===_curveStyle?_this.findSegmentsPoints(_edge,passedPairInfo):"taxi"===_curveStyle?_this.findTaxiPoints(_edge,passedPairInfo):"straight"===_curveStyle||!_edgeIsUnbundled&&pairInfo.eles.length%2==1&&_i2===Math.floor(pairInfo.eles.length/2)?_this.findStraightEdgePoints(_edge):_this.findBezierPoints(_edge,passedPairInfo,_i2,_edgeIsUnbundled,edgeIsSwapped),_this.findEndpoints(_edge),_this.tryToCorrectInvalidPoints(_edge,passedPairInfo),_this.checkForInvalidEdgeWarning(_edge),_this.storeAllpts(_edge),_this.storeEdgeProjections(_edge),_this.calculateArrowAngles(_edge),_this.recalculateEdgeLabelProjections(_edge),_this.calculateLabelAngles(_edge)}},p=0;p<pairIds.length;p++)_loop(p);this.findHaystackPoints(haystackEdges)}},BRp$3.getSegmentPoints=function(edge){var rs=edge[0]._private.rscratch;if("segments"===rs.edgeType)return this.recalculateRenderedStyle(edge),getPts(rs.segpts)},BRp$3.getControlPoints=function(edge){var rs=edge[0]._private.rscratch,type=rs.edgeType;if("bezier"===type||"multibezier"===type||"self"===type||"compound"===type)return this.recalculateRenderedStyle(edge),getPts(rs.ctrlpts)},BRp$3.getEdgeMidpoint=function(edge){var rs=edge[0]._private.rscratch;return this.recalculateRenderedStyle(edge),{x:rs.midX,y:rs.midY}};var BRp$4={manualEndptToPx:function(node,prop){var npos=node.position(),w=node.outerWidth(),h=node.outerHeight();if(2===prop.value.length){var p=[prop.pfValue[0],prop.pfValue[1]];return"%"===prop.units[0]&&(p[0]=p[0]*w),"%"===prop.units[1]&&(p[1]=p[1]*h),p[0]+=npos.x,p[1]+=npos.y,p}var angle=prop.pfValue[0];angle=-Math.PI/2+angle;var l=2*Math.max(w,h),_p=[npos.x+Math.cos(angle)*l,npos.y+Math.sin(angle)*l];return this.nodeShapes[this.getNodeShape(node)].intersectLine(npos.x,npos.y,w,h,_p[0],_p[1],0)},findEndpoints:function(edge){var intersect,p1,p2,p1_i,p2_i,r=this,source=edge.source()[0],target=edge.target()[0],srcPos=source.position(),tgtPos=target.position(),tgtArShape=edge.pstyle("target-arrow-shape").value,srcArShape=edge.pstyle("source-arrow-shape").value,tgtDist=edge.pstyle("target-distance-from-node").pfValue,srcDist=edge.pstyle("source-distance-from-node").pfValue,curveStyle=edge.pstyle("curve-style").value,rs=edge._private.rscratch,et=rs.edgeType,self="self"===et||"compound"===et,bezier="bezier"===et||"multibezier"===et||self,multi="bezier"!==et,lines="straight"===et||"segments"===et,segments="segments"===et,hasEndpts=bezier||multi||lines,overrideEndpts=self||"taxi"===curveStyle,srcManEndpt=edge.pstyle("source-endpoint"),srcManEndptVal=overrideEndpts?"outside-to-node":srcManEndpt.value,tgtManEndpt=edge.pstyle("target-endpoint"),tgtManEndptVal=overrideEndpts?"outside-to-node":tgtManEndpt.value;if(rs.srcManEndpt=srcManEndpt,rs.tgtManEndpt=tgtManEndpt,bezier){var cpStart=[rs.ctrlpts[0],rs.ctrlpts[1]];p1=multi?[rs.ctrlpts[rs.ctrlpts.length-2],rs.ctrlpts[rs.ctrlpts.length-1]]:cpStart,p2=cpStart}else if(lines){var srcArrowFromPt=segments?rs.segpts.slice(0,2):[tgtPos.x,tgtPos.y];p1=segments?rs.segpts.slice(rs.segpts.length-2):[srcPos.x,srcPos.y],p2=srcArrowFromPt}if("inside-to-node"===tgtManEndptVal)intersect=[tgtPos.x,tgtPos.y];else if(tgtManEndpt.units)intersect=this.manualEndptToPx(target,tgtManEndpt);else if("outside-to-line"===tgtManEndptVal)intersect=rs.tgtIntn;else if("outside-to-node"===tgtManEndptVal||"outside-to-node-or-label"===tgtManEndptVal?p1_i=p1:"outside-to-line"!==tgtManEndptVal&&"outside-to-line-or-label"!==tgtManEndptVal||(p1_i=[srcPos.x,srcPos.y]),intersect=r.nodeShapes[this.getNodeShape(target)].intersectLine(tgtPos.x,tgtPos.y,target.outerWidth(),target.outerHeight(),p1_i[0],p1_i[1],0),"outside-to-node-or-label"===tgtManEndptVal||"outside-to-line-or-label"===tgtManEndptVal){var trs=target._private.rscratch,lw=trs.labelWidth,lh=trs.labelHeight,lx=trs.labelX,ly=trs.labelY,lw2=lw/2,lh2=lh/2,va=target.pstyle("text-valign").value;"top"===va?ly-=lh2:"bottom"===va&&(ly+=lh2);var ha=target.pstyle("text-halign").value;"left"===ha?lx-=lw2:"right"===ha&&(lx+=lw2);var labelIntersect=polygonIntersectLine(p1_i[0],p1_i[1],[lx-lw2,ly-lh2,lx+lw2,ly-lh2,lx+lw2,ly+lh2,lx-lw2,ly+lh2],tgtPos.x,tgtPos.y);if(labelIntersect.length>0){var refPt=srcPos,intSqdist=sqdist(refPt,array2point(intersect)),labIntSqdist=sqdist(refPt,array2point(labelIntersect)),minSqDist=intSqdist;if(labIntSqdist<intSqdist&&(intersect=labelIntersect,minSqDist=labIntSqdist),labelIntersect.length>2)sqdist(refPt,{x:labelIntersect[2],y:labelIntersect[3]})<minSqDist&&(intersect=[labelIntersect[2],labelIntersect[3]])}}var arrowEnd=shortenIntersection(intersect,p1,r.arrowShapes[tgtArShape].spacing(edge)+tgtDist),edgeEnd=shortenIntersection(intersect,p1,r.arrowShapes[tgtArShape].gap(edge)+tgtDist);if(rs.endX=edgeEnd[0],rs.endY=edgeEnd[1],rs.arrowEndX=arrowEnd[0],rs.arrowEndY=arrowEnd[1],"inside-to-node"===srcManEndptVal)intersect=[srcPos.x,srcPos.y];else if(srcManEndpt.units)intersect=this.manualEndptToPx(source,srcManEndpt);else if("outside-to-line"===srcManEndptVal)intersect=rs.srcIntn;else if("outside-to-node"===srcManEndptVal||"outside-to-node-or-label"===srcManEndptVal?p2_i=p2:"outside-to-line"!==srcManEndptVal&&"outside-to-line-or-label"!==srcManEndptVal||(p2_i=[tgtPos.x,tgtPos.y]),intersect=r.nodeShapes[this.getNodeShape(source)].intersectLine(srcPos.x,srcPos.y,source.outerWidth(),source.outerHeight(),p2_i[0],p2_i[1],0),"outside-to-node-or-label"===srcManEndptVal||"outside-to-line-or-label"===srcManEndptVal){var srs=source._private.rscratch,_lw=srs.labelWidth,_lh=srs.labelHeight,_lx=srs.labelX,_ly=srs.labelY,_lw2=_lw/2,_lh2=_lh/2,_va=source.pstyle("text-valign").value;"top"===_va?_ly-=_lh2:"bottom"===_va&&(_ly+=_lh2);var _ha=source.pstyle("text-halign").value;"left"===_ha?_lx-=_lw2:"right"===_ha&&(_lx+=_lw2);var _labelIntersect=polygonIntersectLine(p2_i[0],p2_i[1],[_lx-_lw2,_ly-_lh2,_lx+_lw2,_ly-_lh2,_lx+_lw2,_ly+_lh2,_lx-_lw2,_ly+_lh2],srcPos.x,srcPos.y);if(_labelIntersect.length>0){var _refPt=tgtPos,_intSqdist=sqdist(_refPt,array2point(intersect)),_labIntSqdist=sqdist(_refPt,array2point(_labelIntersect)),_minSqDist=_intSqdist;if(_labIntSqdist<_intSqdist&&(intersect=[_labelIntersect[0],_labelIntersect[1]],_minSqDist=_labIntSqdist),_labelIntersect.length>2)sqdist(_refPt,{x:_labelIntersect[2],y:_labelIntersect[3]})<_minSqDist&&(intersect=[_labelIntersect[2],_labelIntersect[3]])}}var arrowStart=shortenIntersection(intersect,p2,r.arrowShapes[srcArShape].spacing(edge)+srcDist),edgeStart=shortenIntersection(intersect,p2,r.arrowShapes[srcArShape].gap(edge)+srcDist);rs.startX=edgeStart[0],rs.startY=edgeStart[1],rs.arrowStartX=arrowStart[0],rs.arrowStartY=arrowStart[1],hasEndpts&&(number(rs.startX)&&number(rs.startY)&&number(rs.endX)&&number(rs.endY)?rs.badLine=!1:rs.badLine=!0)},getSourceEndpoint:function(edge){var rs=edge[0]._private.rscratch;return this.recalculateRenderedStyle(edge),"haystack"===rs.edgeType?{x:rs.haystackPts[0],y:rs.haystackPts[1]}:{x:rs.arrowStartX,y:rs.arrowStartY}},getTargetEndpoint:function(edge){var rs=edge[0]._private.rscratch;return this.recalculateRenderedStyle(edge),"haystack"===rs.edgeType?{x:rs.haystackPts[2],y:rs.haystackPts[3]}:{x:rs.arrowEndX,y:rs.arrowEndY}}},BRp$5={};function pushBezierPts(r,edge,pts){for(var qbezierAt$1=function qbezierAt$1(p1,p2,p3,t){return qbezierAt(p1,p2,p3,t)},bpts=edge._private.rstyle.bezierPts,i=0;i<r.bezierProjPcts.length;i++){var p=r.bezierProjPcts[i];bpts.push({x:qbezierAt$1(pts[0],pts[2],pts[4],p),y:qbezierAt$1(pts[1],pts[3],pts[5],p)})}}BRp$5.storeEdgeProjections=function(edge){var _p=edge._private,rs=_p.rscratch,et=rs.edgeType;if(_p.rstyle.bezierPts=null,_p.rstyle.linePts=null,_p.rstyle.haystackPts=null,"multibezier"===et||"bezier"===et||"self"===et||"compound"===et){_p.rstyle.bezierPts=[];for(var i=0;i+5<rs.allpts.length;i+=4)pushBezierPts(this,edge,rs.allpts.slice(i,i+6))}else if("segments"===et){var lpts=_p.rstyle.linePts=[];for(i=0;i+1<rs.allpts.length;i+=2)lpts.push({x:rs.allpts[i],y:rs.allpts[i+1]})}else if("haystack"===et){var hpts=rs.haystackPts;_p.rstyle.haystackPts=[{x:hpts[0],y:hpts[1]},{x:hpts[2],y:hpts[3]}]}_p.rstyle.arrowWidth=this.getArrowWidth(edge.pstyle("width").pfValue,edge.pstyle("arrow-scale").value)*this.arrowShapeWidth},BRp$5.recalculateEdgeProjections=function(edges){this.findEdgeControlPoints(edges)};var BRp$6={recalculateNodeLabelProjection:function(node){var content=node.pstyle("label").strValue;if(!emptyString(content)){var textX,textY,_p=node._private,nodeWidth=node.width(),nodeHeight=node.height(),padding=node.padding(),nodePos=node.position(),textHalign=node.pstyle("text-halign").strValue,textValign=node.pstyle("text-valign").strValue,rs=_p.rscratch,rstyle=_p.rstyle;switch(textHalign){case"left":textX=nodePos.x-nodeWidth/2-padding;break;case"right":textX=nodePos.x+nodeWidth/2+padding;break;default:textX=nodePos.x}switch(textValign){case"top":textY=nodePos.y-nodeHeight/2-padding;break;case"bottom":textY=nodePos.y+nodeHeight/2+padding;break;default:textY=nodePos.y}rs.labelX=textX,rs.labelY=textY,rstyle.labelX=textX,rstyle.labelY=textY,this.calculateLabelAngles(node),this.applyLabelDimensions(node)}}},lineAngleFromDelta=function lineAngleFromDelta(dx,dy){var angle=Math.atan(dy/dx);return 0===dx&&angle<0&&(angle*=-1),angle},lineAngle=function lineAngle(p0,p1){var dx=p1.x-p0.x,dy=p1.y-p0.y;return lineAngleFromDelta(dx,dy)};BRp$6.recalculateEdgeLabelProjections=function(edge){var p,_p=edge._private,rs=_p.rscratch,r=this,content={mid:edge.pstyle("label").strValue,source:edge.pstyle("source-label").strValue,target:edge.pstyle("target-label").strValue};if(content.mid||content.source||content.target){p={x:rs.midX,y:rs.midY};var setRs=function setRs(propName,prefix,value){setPrefixedProperty(_p.rscratch,propName,prefix,value),setPrefixedProperty(_p.rstyle,propName,prefix,value)};setRs("labelX",null,p.x),setRs("labelY",null,p.y);var midAngle=lineAngleFromDelta(rs.midDispX,rs.midDispY);setRs("labelAutoAngle",null,midAngle);var createControlPointInfo=function createControlPointInfo(){if(createControlPointInfo.cache)return createControlPointInfo.cache;for(var ctrlpts=[],i=0;i+5<rs.allpts.length;i+=4){var p0={x:rs.allpts[i],y:rs.allpts[i+1]},p1={x:rs.allpts[i+2],y:rs.allpts[i+3]},p2={x:rs.allpts[i+4],y:rs.allpts[i+5]};ctrlpts.push({p0:p0,p1:p1,p2:p2,startDist:0,length:0,segments:[]})}var bpts=_p.rstyle.bezierPts,nProjs=r.bezierProjPcts.length;function addSegment(cp,p0,p1,t0,t1){var length=dist(p0,p1),prevSegment=cp.segments[cp.segments.length-1],segment={p0:p0,p1:p1,t0:t0,t1:t1,startDist:prevSegment?prevSegment.startDist+prevSegment.length:0,length:length};cp.segments.push(segment),cp.length+=length}for(var _i=0;_i<ctrlpts.length;_i++){var cp=ctrlpts[_i],prevCp=ctrlpts[_i-1];prevCp&&(cp.startDist=prevCp.startDist+prevCp.length),addSegment(cp,cp.p0,bpts[_i*nProjs],0,r.bezierProjPcts[0]);for(var j=0;j<nProjs-1;j++)addSegment(cp,bpts[_i*nProjs+j],bpts[_i*nProjs+j+1],r.bezierProjPcts[j],r.bezierProjPcts[j+1]);addSegment(cp,bpts[_i*nProjs+nProjs-1],cp.p2,r.bezierProjPcts[nProjs-1],1)}return createControlPointInfo.cache=ctrlpts},calculateEndProjection=function calculateEndProjection(prefix){var angle,isSrc="source"===prefix;if(content[prefix]){var offset=edge.pstyle(prefix+"-text-offset").pfValue;switch(rs.edgeType){case"self":case"compound":case"bezier":case"multibezier":for(var selected,cps=createControlPointInfo(),startDist=0,totalDist=0,i=0;i<cps.length;i++){for(var _cp=cps[isSrc?i:cps.length-1-i],j=0;j<_cp.segments.length;j++){var _seg=_cp.segments[isSrc?j:_cp.segments.length-1-j],lastSeg=i===cps.length-1&&j===_cp.segments.length-1;if(startDist=totalDist,(totalDist+=_seg.length)>=offset||lastSeg){selected={cp:_cp,segment:_seg};break}}if(selected)break}var cp=selected.cp,seg=selected.segment,tSegment=(offset-startDist)/seg.length,segDt=seg.t1-seg.t0,t=isSrc?seg.t0+segDt*tSegment:seg.t1-segDt*tSegment;t=bound(0,t,1),p=qbezierPtAt(cp.p0,cp.p1,cp.p2,t),angle=function bezierAngle(p0,p1,p2,t){var t0=bound(0,t-.001,1),t1=bound(0,t+.001,1),lp0=qbezierPtAt(p0,p1,p2,t0),lp1=qbezierPtAt(p0,p1,p2,t1);return lineAngle(lp0,lp1)}(cp.p0,cp.p1,cp.p2,t);break;case"straight":case"segments":case"haystack":for(var di,d0,p0,p1,d=0,l=rs.allpts.length,_i2=0;_i2+3<l&&(isSrc?(p0={x:rs.allpts[_i2],y:rs.allpts[_i2+1]},p1={x:rs.allpts[_i2+2],y:rs.allpts[_i2+3]}):(p0={x:rs.allpts[l-2-_i2],y:rs.allpts[l-1-_i2]},p1={x:rs.allpts[l-4-_i2],y:rs.allpts[l-3-_i2]}),d0=d,!((d+=di=dist(p0,p1))>=offset));_i2+=2);var _t=(offset-d0)/di;_t=bound(0,_t,1),p=function lineAt(p0,p1,t,d){var vec_x=p1.x-p0.x,vec_y=p1.y-p0.y,vecDist=dist(p0,p1),normVec_x=vec_x/vecDist,normVec_y=vec_y/vecDist;return t=null==t?0:t,d=null!=d?d:t*vecDist,{x:p0.x+normVec_x*d,y:p0.y+normVec_y*d}}(p0,p1,_t),angle=lineAngle(p0,p1)}setRs("labelX",prefix,p.x),setRs("labelY",prefix,p.y),setRs("labelAutoAngle",prefix,angle)}};calculateEndProjection("source"),calculateEndProjection("target"),this.applyLabelDimensions(edge)}},BRp$6.applyLabelDimensions=function(ele){this.applyPrefixedLabelDimensions(ele),ele.isEdge()&&(this.applyPrefixedLabelDimensions(ele,"source"),this.applyPrefixedLabelDimensions(ele,"target"))},BRp$6.applyPrefixedLabelDimensions=function(ele,prefix){var _p=ele._private,text=this.getLabelText(ele,prefix),labelDims=this.calculateLabelDimensions(ele,text),lineHeight=ele.pstyle("line-height").pfValue,textWrap=ele.pstyle("text-wrap").strValue,lines=getPrefixedProperty(_p.rscratch,"labelWrapCachedLines",prefix)||[],numLines="wrap"!==textWrap?1:Math.max(lines.length,1),normPerLineHeight=labelDims.height/numLines,labelLineHeight=normPerLineHeight*lineHeight,width=labelDims.width,height=labelDims.height+(numLines-1)*(lineHeight-1)*normPerLineHeight;setPrefixedProperty(_p.rstyle,"labelWidth",prefix,width),setPrefixedProperty(_p.rscratch,"labelWidth",prefix,width),setPrefixedProperty(_p.rstyle,"labelHeight",prefix,height),setPrefixedProperty(_p.rscratch,"labelHeight",prefix,height),setPrefixedProperty(_p.rscratch,"labelLineHeight",prefix,labelLineHeight)},BRp$6.getLabelText=function(ele,prefix){var _p=ele._private,pfd=prefix?prefix+"-":"",text=ele.pstyle(pfd+"label").strValue,textTransform=ele.pstyle("text-transform").value,rscratch=function rscratch(propName,value){return value?(setPrefixedProperty(_p.rscratch,propName,prefix,value),value):getPrefixedProperty(_p.rscratch,propName,prefix)};if(!text)return"";"none"==textTransform||("uppercase"==textTransform?text=text.toUpperCase():"lowercase"==textTransform&&(text=text.toLowerCase()));var wrapStyle=ele.pstyle("text-wrap").value;if("wrap"===wrapStyle){var labelKey=rscratch("labelKey");if(null!=labelKey&&rscratch("labelWrapKey")===labelKey)return rscratch("labelWrapCachedText");for(var lines=text.split("\n"),maxW=ele.pstyle("text-max-width").pfValue,overflowAny="anywhere"===ele.pstyle("text-overflow-wrap").value,wrappedLines=[],wordsRegex=/[\s\u200b]+/,wordSeparator=overflowAny?"":" ",l=0;l<lines.length;l++){var line=lines[l],lineW=this.calculateLabelDimensions(ele,line).width;if(overflowAny){var processedLine=line.split("").join("");line=processedLine}if(lineW>maxW){for(var words=line.split(wordsRegex),subline="",w=0;w<words.length;w++){var word=words[w],testLine=0===subline.length?word:subline+wordSeparator+word;this.calculateLabelDimensions(ele,testLine).width<=maxW?subline+=word+wordSeparator:(subline&&wrappedLines.push(subline),subline=word+wordSeparator)}subline.match(/^[\s\u200b]+$/)||wrappedLines.push(subline)}else wrappedLines.push(line)}rscratch("labelWrapCachedLines",wrappedLines),text=rscratch("labelWrapCachedText",wrappedLines.join("\n")),rscratch("labelWrapKey",labelKey)}else if("ellipsis"===wrapStyle){var _maxW=ele.pstyle("text-max-width").pfValue,ellipsized="",incLastCh=!1;if(this.calculateLabelDimensions(ele,text).width<_maxW)return text;for(var i=0;i<text.length;i++){if(this.calculateLabelDimensions(ele,ellipsized+text[i]+"").width>_maxW)break;ellipsized+=text[i],i===text.length-1&&(incLastCh=!0)}return incLastCh||(ellipsized+=""),ellipsized}return text},BRp$6.getLabelJustification=function(ele){var justification=ele.pstyle("text-justification").strValue,textHalign=ele.pstyle("text-halign").strValue;if("auto"!==justification)return justification;if(!ele.isNode())return"center";switch(textHalign){case"left":return"right";case"right":return"left";default:return"center"}},BRp$6.calculateLabelDimensions=function(ele,text){var cacheKey=hashString(text,ele._private.labelDimsKey),cache=this.labelDimCache||(this.labelDimCache=[]),existingVal=cache[cacheKey];if(null!=existingVal)return existingVal;var fStyle=ele.pstyle("font-style").strValue,size=ele.pstyle("font-size").pfValue,family=ele.pstyle("font-family").strValue,weight=ele.pstyle("font-weight").strValue,canvas=this.labelCalcCanvas,c2d=this.labelCalcCanvasContext;if(!canvas){canvas=this.labelCalcCanvas=document.createElement("canvas"),c2d=this.labelCalcCanvasContext=canvas.getContext("2d");var ds=canvas.style;ds.position="absolute",ds.left="-9999px",ds.top="-9999px",ds.zIndex="-1",ds.visibility="hidden",ds.pointerEvents="none"}c2d.font="".concat(fStyle," ").concat(weight," ").concat(size,"px ").concat(family);for(var width=0,height=0,lines=text.split("\n"),i=0;i<lines.length;i++){var line=lines[i],metrics=c2d.measureText(line),w=Math.ceil(metrics.width),h=size;width=Math.max(w,width),height+=h}return width+=0,height+=0,cache[cacheKey]={width:width,height:height}},BRp$6.calculateLabelAngle=function(ele,prefix){var rs=ele._private.rscratch,isEdge=ele.isEdge(),prefixDash=prefix?prefix+"-":"",rot=ele.pstyle(prefixDash+"text-rotation"),rotStr=rot.strValue;return"none"===rotStr?0:isEdge&&"autorotate"===rotStr?rs.labelAutoAngle:"autorotate"===rotStr?0:rot.pfValue},BRp$6.calculateLabelAngles=function(ele){var r=this,isEdge=ele.isEdge(),rs=ele._private.rscratch;rs.labelAngle=r.calculateLabelAngle(ele),isEdge&&(rs.sourceLabelAngle=r.calculateLabelAngle(ele,"source"),rs.targetLabelAngle=r.calculateLabelAngle(ele,"target"))};var BRp$7={},warnedCutRect=!1;BRp$7.getNodeShape=function(node){var shape=node.pstyle("shape").value;if("cutrectangle"===shape&&(node.width()<28||node.height()<28))return warnedCutRect||(warn("The `cutrectangle` node shape can not be used at small sizes so `rectangle` is used instead"),warnedCutRect=!0),"rectangle";if(node.isParent())return"rectangle"===shape||"roundrectangle"===shape||"round-rectangle"===shape||"cutrectangle"===shape||"cut-rectangle"===shape||"barrel"===shape?shape:"rectangle";if("polygon"===shape){var points=node.pstyle("shape-polygon-points").value;return this.nodeShapes.makePolygon(points).name}return shape};var BRp$8={registerCalculationListeners:function(){var cy=this.cy,elesToUpdate=cy.collection(),r=this,enqueue=function enqueue(eles){var dirtyStyleCaches=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(elesToUpdate.merge(eles),dirtyStyleCaches)for(var i=0;i<eles.length;i++){var ele=eles[i],_p=ele._private,rstyle=_p.rstyle;rstyle.clean=!1,rstyle.cleanConnected=!1}};r.binder(cy).on("bounds.* dirty.*",(function onDirtyBounds(e){var ele=e.target;enqueue(ele)})).on("style.* background.*",(function onDirtyStyle(e){var ele=e.target;enqueue(ele,!1)}));var updateEleCalcs=function updateEleCalcs(willDraw){if(willDraw){var fns=r.onUpdateEleCalcsFns;elesToUpdate.cleanStyle();for(var i=0;i<elesToUpdate.length;i++){var ele=elesToUpdate[i],rstyle=ele._private.rstyle;ele.isNode()&&!rstyle.cleanConnected&&(enqueue(ele.connectedEdges()),rstyle.cleanConnected=!0)}if(fns)for(var _i=0;_i<fns.length;_i++){(0,fns[_i])(willDraw,elesToUpdate)}r.recalculateRenderedStyle(elesToUpdate),elesToUpdate=cy.collection()}};r.flushRenderedStyleQueue=function(){updateEleCalcs(!0)},r.beforeRender(updateEleCalcs,r.beforeRenderPriorities.eleCalcs)},onUpdateEleCalcs:function(fn){(this.onUpdateEleCalcsFns=this.onUpdateEleCalcsFns||[]).push(fn)},recalculateRenderedStyle:function(eles,useCache){var isCleanConnected=function isCleanConnected(ele){return ele._private.rstyle.cleanConnected},edges=[],nodes=[];if(!this.destroyed){void 0===useCache&&(useCache=!0);for(var i=0;i<eles.length;i++){var ele=eles[i],_p=ele._private,rstyle=_p.rstyle;!ele.isEdge()||isCleanConnected(ele.source())&&isCleanConnected(ele.target())||(rstyle.clean=!1),useCache&&rstyle.clean||ele.removed()||"none"!==ele.pstyle("display").value&&("nodes"===_p.group?nodes.push(ele):edges.push(ele),rstyle.clean=!0)}for(var _i2=0;_i2<nodes.length;_i2++){var _ele=nodes[_i2],_rstyle=_ele._private.rstyle,pos=_ele.position();this.recalculateNodeLabelProjection(_ele),_rstyle.nodeX=pos.x,_rstyle.nodeY=pos.y,_rstyle.nodeW=_ele.pstyle("width").pfValue,_rstyle.nodeH=_ele.pstyle("height").pfValue}this.recalculateEdgeProjections(edges);for(var _i3=0;_i3<edges.length;_i3++){var _p3=edges[_i3]._private,_rstyle2=_p3.rstyle,rs=_p3.rscratch;_rstyle2.srcX=rs.arrowStartX,_rstyle2.srcY=rs.arrowStartY,_rstyle2.tgtX=rs.arrowEndX,_rstyle2.tgtY=rs.arrowEndY,_rstyle2.midX=rs.midX,_rstyle2.midY=rs.midY,_rstyle2.labelAngle=rs.labelAngle,_rstyle2.sourceLabelAngle=rs.sourceLabelAngle,_rstyle2.targetLabelAngle=rs.targetLabelAngle}}}},BRp$9={updateCachedGrabbedEles:function(){var eles=this.cachedZSortedEles;if(eles){eles.drag=[],eles.nondrag=[];for(var grabTargets=[],i=0;i<eles.length;i++){var rs=(ele=eles[i])._private.rscratch;ele.grabbed()&&!ele.isParent()?grabTargets.push(ele):rs.inDragLayer?eles.drag.push(ele):eles.nondrag.push(ele)}for(i=0;i<grabTargets.length;i++){var ele=grabTargets[i];eles.drag.push(ele)}}},invalidateCachedZSortedEles:function(){this.cachedZSortedEles=null},getCachedZSortedEles:function(forceRecalc){if(forceRecalc||!this.cachedZSortedEles){var eles=this.cy.mutableElements().toArray();eles.sort(zIndexSort),eles.interactive=eles.filter((function(ele){return ele.interactive()})),this.cachedZSortedEles=eles,this.updateCachedGrabbedEles()}else eles=this.cachedZSortedEles;return eles}},BRp$a={};[BRp$1,BRp$2,BRp$3,BRp$4,BRp$5,BRp$6,BRp$7,BRp$8,BRp$9].forEach((function(props){extend(BRp$a,props)}));var BRp$b={getCachedImage:function(url,crossOrigin,onLoad){var imageCache=this.imageCache=this.imageCache||{},cache=imageCache[url];if(cache)return cache.image.complete||cache.image.addEventListener("load",onLoad),cache.image;var image=(cache=imageCache[url]=imageCache[url]||{}).image=new Image;image.addEventListener("load",onLoad),image.addEventListener("error",(function(){image.error=!0}));return"data:"===url.substring(0,"data:".length).toLowerCase()||(image.crossOrigin=crossOrigin),image.src=url,image}},BRp$c={registerBinding:function(target,event,handler,useCapture){var args=Array.prototype.slice.apply(arguments,[1]),b=this.binder(target);return b.on.apply(b,args)}};BRp$c.binder=function(tgt){var r=this,tgtIsDom=tgt===window||tgt===document||tgt===document.body||function domElement(obj){return"undefined"!=typeof HTMLElement&&obj instanceof HTMLElement}(tgt);if(null==r.supportsPassiveEvents){var supportsPassive=!1;try{var opts=Object.defineProperty({},"passive",{get:function get(){return supportsPassive=!0,!0}});window.addEventListener("test",null,opts)}catch(err){}r.supportsPassiveEvents=supportsPassive}var on=function on(event,handler,useCapture){var args=Array.prototype.slice.call(arguments);return tgtIsDom&&r.supportsPassiveEvents&&(args[2]={capture:null!=useCapture&&useCapture,passive:!1,once:!1}),r.bindings.push({target:tgt,args:args}),(tgt.addEventListener||tgt.on).apply(tgt,args),this};return{on:on,addEventListener:on,addListener:on,bind:on}},BRp$c.nodeIsDraggable=function(node){return node&&node.isNode()&&!node.locked()&&node.grabbable()},BRp$c.nodeIsGrabbable=function(node){return this.nodeIsDraggable(node)&&node.interactive()},BRp$c.load=function(){var r=this,isSelected=function isSelected(ele){return ele.selected()},triggerEvents=function triggerEvents(target,names,e,position){null==target&&(target=r.cy);for(var i=0;i<names.length;i++){var name=names[i];target.emit({originalEvent:e,type:name,position:position})}},isMultSelKeyDown=function isMultSelKeyDown(e){return e.shiftKey||e.metaKey||e.ctrlKey},allowPanningPassthrough=function allowPanningPassthrough(down,downs){var allowPassthrough=!0;if(r.cy.hasCompoundNodes()&&down&&down.pannable())for(var i=0;downs&&i<downs.length;i++){if((down=downs[i]).isNode()&&down.isParent()&&!down.pannable()){allowPassthrough=!1;break}}else allowPassthrough=!0;return allowPassthrough},setInDragLayer=function setInDragLayer(ele){ele[0]._private.rscratch.inDragLayer=!0},setGrabTarget=function setGrabTarget(ele){ele[0]._private.rscratch.isGrabTarget=!0},addToDragList=function addToDragList(ele,opts){var list=opts.addToList;list.has(ele)||!ele.grabbable()||ele.locked()||(list.merge(ele),function setGrabbed(ele){ele[0]._private.grabbed=!0}(ele))},addNodesToDrag=function addNodesToDrag(nodes,opts){opts=opts||{};var hasCompoundNodes=nodes.cy().hasCompoundNodes();opts.inDragLayer&&(nodes.forEach(setInDragLayer),nodes.neighborhood().stdFilter((function(ele){return!hasCompoundNodes||ele.isEdge()})).forEach(setInDragLayer)),opts.addToList&&nodes.forEach((function(ele){addToDragList(ele,opts)})),function addDescendantsToDrag(node,opts){if(node.cy().hasCompoundNodes()&&(null!=opts.inDragLayer||null!=opts.addToList)){var innerNodes=node.descendants();opts.inDragLayer&&(innerNodes.forEach(setInDragLayer),innerNodes.connectedEdges().forEach(setInDragLayer)),opts.addToList&&addToDragList(innerNodes,opts)}}(nodes,opts),updateAncestorsInDragLayer(nodes,{inDragLayer:opts.inDragLayer}),r.updateCachedGrabbedEles()},addNodeToDrag=addNodesToDrag,freeDraggedElements=function freeDraggedElements(grabbedEles){grabbedEles&&(r.getCachedZSortedEles().forEach((function(ele){!function setFreed(ele){ele[0]._private.grabbed=!1}(ele),function setOutDragLayer(ele){ele[0]._private.rscratch.inDragLayer=!1}(ele),function removeGrabTarget(ele){ele[0]._private.rscratch.isGrabTarget=!1}(ele)})),r.updateCachedGrabbedEles())},updateAncestorsInDragLayer=function updateAncestorsInDragLayer(node,opts){if((null!=opts.inDragLayer||null!=opts.addToList)&&node.cy().hasCompoundNodes()){var parent=node.ancestors().orphans();if(!parent.same(node)){var nodes=parent.descendants().spawnSelf().merge(parent).unmerge(node).unmerge(node.descendants()),edges=nodes.connectedEdges();opts.inDragLayer&&(edges.forEach(setInDragLayer),nodes.forEach(setInDragLayer)),opts.addToList&&nodes.forEach((function(ele){addToDragList(ele,opts)}))}}},blurActiveDomElement=function blurActiveDomElement(){null!=document.activeElement&&null!=document.activeElement.blur&&document.activeElement.blur()},haveMutationsApi="undefined"!=typeof MutationObserver,haveResizeObserverApi="undefined"!=typeof ResizeObserver;haveMutationsApi?(r.removeObserver=new MutationObserver((function(mutns){for(var i=0;i<mutns.length;i++){var rNodes=mutns[i].removedNodes;if(rNodes)for(var j=0;j<rNodes.length;j++){if(rNodes[j]===r.container){r.destroy();break}}}})),r.container.parentNode&&r.removeObserver.observe(r.container.parentNode,{childList:!0})):r.registerBinding(r.container,"DOMNodeRemoved",(function(e){r.destroy()}));var onResize=util((function(){r.cy.resize()}),100);haveMutationsApi&&(r.styleObserver=new MutationObserver(onResize),r.styleObserver.observe(r.container,{attributes:!0})),r.registerBinding(window,"resize",onResize),haveResizeObserverApi&&(r.resizeObserver=new ResizeObserver(onResize),r.resizeObserver.observe(r.container));var invalidateCoords=function invalidateCoords(){r.invalidateContainerClientCoordsCache()};!function forEachUp(domEle,fn){for(;null!=domEle;)fn(domEle),domEle=domEle.parentNode}(r.container,(function(domEle){r.registerBinding(domEle,"transitionend",invalidateCoords),r.registerBinding(domEle,"animationend",invalidateCoords),r.registerBinding(domEle,"scroll",invalidateCoords)})),r.registerBinding(r.container,"contextmenu",(function(e){e.preventDefault()}));var clickTimeout,didDoubleClick,prevClickTimeStamp,eventInContainer=function eventInContainer(e){for(var containerPageCoords=r.findContainerClientCoords(),x=containerPageCoords[0],y=containerPageCoords[1],width=containerPageCoords[2],height=containerPageCoords[3],positions=e.touches?e.touches:[e],atLeastOnePosInside=!1,i=0;i<positions.length;i++){var p=positions[i];if(x<=p.clientX&&p.clientX<=x+width&&y<=p.clientY&&p.clientY<=y+height){atLeastOnePosInside=!0;break}}if(!atLeastOnePosInside)return!1;for(var container=r.container,tParent=e.target.parentNode,containerIsTarget=!1;tParent;){if(tParent===container){containerIsTarget=!0;break}tParent=tParent.parentNode}return!!containerIsTarget};r.registerBinding(r.container,"mousedown",(function mousedownHandler(e){if(eventInContainer(e)){e.preventDefault(),blurActiveDomElement(),r.hoverData.capture=!0,r.hoverData.which=e.which;var cy=r.cy,gpos=[e.clientX,e.clientY],pos=r.projectIntoViewport(gpos[0],gpos[1]),select=r.selection,nears=r.findNearestElements(pos[0],pos[1],!0,!1),near=nears[0],draggedElements=r.dragData.possibleDragElements;r.hoverData.mdownPos=pos,r.hoverData.mdownGPos=gpos;if(3==e.which){r.hoverData.cxtStarted=!0;var cxtEvt={originalEvent:e,type:"cxttapstart",position:{x:pos[0],y:pos[1]}};near?(near.activate(),near.emit(cxtEvt),r.hoverData.down=near):cy.emit(cxtEvt),r.hoverData.downTime=(new Date).getTime(),r.hoverData.cxtDragged=!1}else if(1==e.which){if(near&&near.activate(),null!=near&&r.nodeIsGrabbable(near)){var makeEvent=function makeEvent(type){return{originalEvent:e,type:type,position:{x:pos[0],y:pos[1]}}};if(setGrabTarget(near),near.selected()){draggedElements=r.dragData.possibleDragElements=cy.collection();var selectedNodes=cy.$((function(ele){return ele.isNode()&&ele.selected()&&r.nodeIsGrabbable(ele)}));addNodesToDrag(selectedNodes,{addToList:draggedElements}),near.emit(makeEvent("grabon")),selectedNodes.forEach((function triggerGrab(ele){ele.emit(makeEvent("grab"))}))}else draggedElements=r.dragData.possibleDragElements=cy.collection(),addNodeToDrag(near,{addToList:draggedElements}),near.emit(makeEvent("grabon")).emit(makeEvent("grab"));r.redrawHint("eles",!0),r.redrawHint("drag",!0)}r.hoverData.down=near,r.hoverData.downs=nears,r.hoverData.downTime=(new Date).getTime(),triggerEvents(near,["mousedown","tapstart","vmousedown"],e,{x:pos[0],y:pos[1]}),null==near?(select[4]=1,r.data.bgActivePosistion={x:pos[0],y:pos[1]},r.redrawHint("select",!0),r.redraw()):near.pannable()&&(select[4]=1),function checkForTaphold(){r.hoverData.tapholdCancelled=!1,clearTimeout(r.hoverData.tapholdTimeout),r.hoverData.tapholdTimeout=setTimeout((function(){if(!r.hoverData.tapholdCancelled){var ele=r.hoverData.down;ele?ele.emit({originalEvent:e,type:"taphold",position:{x:pos[0],y:pos[1]}}):cy.emit({originalEvent:e,type:"taphold",position:{x:pos[0],y:pos[1]}})}}),r.tapholdDuration)}()}select[0]=select[2]=pos[0],select[1]=select[3]=pos[1]}}),!1),r.registerBinding(window,"mousemove",(function mousemoveHandler(e){if(r.hoverData.capture||eventInContainer(e)){var preventDefault=!1,cy=r.cy,zoom=cy.zoom(),gpos=[e.clientX,e.clientY],pos=r.projectIntoViewport(gpos[0],gpos[1]),mdownPos=r.hoverData.mdownPos,mdownGPos=r.hoverData.mdownGPos,select=r.selection,near=null;r.hoverData.draggingEles||r.hoverData.dragging||r.hoverData.selecting||(near=r.findNearestElement(pos[0],pos[1],!0,!1));var isOverThresholdDrag,last=r.hoverData.last,down=r.hoverData.down,disp=[pos[0]-select[2],pos[1]-select[3]],draggedElements=r.dragData.possibleDragElements;if(mdownGPos){var dx=gpos[0]-mdownGPos[0],dx2=dx*dx,dy=gpos[1]-mdownGPos[1],dist2=dx2+dy*dy;r.hoverData.isOverThresholdDrag=isOverThresholdDrag=dist2>=r.desktopTapThreshold2}var multSelKeyDown=isMultSelKeyDown(e);isOverThresholdDrag&&(r.hoverData.tapholdCancelled=!0);preventDefault=!0,triggerEvents(near,["mousemove","vmousemove","tapdrag"],e,{x:pos[0],y:pos[1]});var goIntoBoxMode=function goIntoBoxMode(){r.data.bgActivePosistion=void 0,r.hoverData.selecting||cy.emit({originalEvent:e,type:"boxstart",position:{x:pos[0],y:pos[1]}}),select[4]=1,r.hoverData.selecting=!0,r.redrawHint("select",!0),r.redraw()};if(3===r.hoverData.which){if(isOverThresholdDrag){var cxtEvt={originalEvent:e,type:"cxtdrag",position:{x:pos[0],y:pos[1]}};down?down.emit(cxtEvt):cy.emit(cxtEvt),r.hoverData.cxtDragged=!0,r.hoverData.cxtOver&&near===r.hoverData.cxtOver||(r.hoverData.cxtOver&&r.hoverData.cxtOver.emit({originalEvent:e,type:"cxtdragout",position:{x:pos[0],y:pos[1]}}),r.hoverData.cxtOver=near,near&&near.emit({originalEvent:e,type:"cxtdragover",position:{x:pos[0],y:pos[1]}}))}}else if(r.hoverData.dragging){if(preventDefault=!0,cy.panningEnabled()&&cy.userPanningEnabled()){var deltaP;if(r.hoverData.justStartedPan){var mdPos=r.hoverData.mdownPos;deltaP={x:(pos[0]-mdPos[0])*zoom,y:(pos[1]-mdPos[1])*zoom},r.hoverData.justStartedPan=!1}else deltaP={x:disp[0]*zoom,y:disp[1]*zoom};cy.panBy(deltaP),cy.emit("dragpan"),r.hoverData.dragged=!0}pos=r.projectIntoViewport(e.clientX,e.clientY)}else if(1!=select[4]||null!=down&&!down.pannable()){if(down&&down.pannable()&&down.active()&&down.unactivate(),down&&down.grabbed()||near==last||(last&&triggerEvents(last,["mouseout","tapdragout"],e,{x:pos[0],y:pos[1]}),near&&triggerEvents(near,["mouseover","tapdragover"],e,{x:pos[0],y:pos[1]}),r.hoverData.last=near),down)if(isOverThresholdDrag){if(cy.boxSelectionEnabled()&&multSelKeyDown)down&&down.grabbed()&&(freeDraggedElements(draggedElements),down.emit("freeon"),draggedElements.emit("free"),r.dragData.didDrag&&(down.emit("dragfreeon"),draggedElements.emit("dragfree"))),goIntoBoxMode();else if(down&&down.grabbed()&&r.nodeIsDraggable(down)){var justStartedDrag=!r.dragData.didDrag;justStartedDrag&&r.redrawHint("eles",!0),r.dragData.didDrag=!0,r.hoverData.draggingEles||addNodesToDrag(draggedElements,{inDragLayer:!0});var totalShift={x:0,y:0};if(number(disp[0])&&number(disp[1])&&(totalShift.x+=disp[0],totalShift.y+=disp[1],justStartedDrag)){var dragDelta=r.hoverData.dragDelta;dragDelta&&number(dragDelta[0])&&number(dragDelta[1])&&(totalShift.x+=dragDelta[0],totalShift.y+=dragDelta[1])}r.hoverData.draggingEles=!0,draggedElements.silentShift(totalShift).emit("position drag"),r.redrawHint("drag",!0),r.redraw()}}else!function updateDragDelta(){var dragDelta=r.hoverData.dragDelta=r.hoverData.dragDelta||[];0===dragDelta.length?(dragDelta.push(disp[0]),dragDelta.push(disp[1])):(dragDelta[0]+=disp[0],dragDelta[1]+=disp[1])}();preventDefault=!0}else if(isOverThresholdDrag){if(r.hoverData.dragging||!cy.boxSelectionEnabled()||!multSelKeyDown&&cy.panningEnabled()&&cy.userPanningEnabled()){if(!r.hoverData.selecting&&cy.panningEnabled()&&cy.userPanningEnabled()){allowPanningPassthrough(down,r.hoverData.downs)&&(r.hoverData.dragging=!0,r.hoverData.justStartedPan=!0,select[4]=0,r.data.bgActivePosistion=array2point(mdownPos),r.redrawHint("select",!0),r.redraw())}}else goIntoBoxMode();down&&down.pannable()&&down.active()&&down.unactivate()}return select[2]=pos[0],select[3]=pos[1],preventDefault?(e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),!1):void 0}}),!1),r.registerBinding(window,"mouseup",(function mouseupHandler(e){if(r.hoverData.capture){r.hoverData.capture=!1;var cy=r.cy,pos=r.projectIntoViewport(e.clientX,e.clientY),select=r.selection,near=r.findNearestElement(pos[0],pos[1],!0,!1),draggedElements=r.dragData.possibleDragElements,down=r.hoverData.down,multSelKeyDown=isMultSelKeyDown(e);if(r.data.bgActivePosistion&&(r.redrawHint("select",!0),r.redraw()),r.hoverData.tapholdCancelled=!0,r.data.bgActivePosistion=void 0,down&&down.unactivate(),3===r.hoverData.which){var cxtEvt={originalEvent:e,type:"cxttapend",position:{x:pos[0],y:pos[1]}};if(down?down.emit(cxtEvt):cy.emit(cxtEvt),!r.hoverData.cxtDragged){var cxtTap={originalEvent:e,type:"cxttap",position:{x:pos[0],y:pos[1]}};down?down.emit(cxtTap):cy.emit(cxtTap)}r.hoverData.cxtDragged=!1,r.hoverData.which=null}else if(1===r.hoverData.which){if(triggerEvents(near,["mouseup","tapend","vmouseup"],e,{x:pos[0],y:pos[1]}),r.dragData.didDrag||r.hoverData.dragged||r.hoverData.selecting||r.hoverData.isOverThresholdDrag||(triggerEvents(down,["click","tap","vclick"],e,{x:pos[0],y:pos[1]}),didDoubleClick=!1,e.timeStamp-prevClickTimeStamp<=cy.multiClickDebounceTime()?(clickTimeout&&clearTimeout(clickTimeout),didDoubleClick=!0,prevClickTimeStamp=null,triggerEvents(down,["dblclick","dbltap","vdblclick"],e,{x:pos[0],y:pos[1]})):(clickTimeout=setTimeout((function(){didDoubleClick||triggerEvents(down,["oneclick","onetap","voneclick"],e,{x:pos[0],y:pos[1]})}),cy.multiClickDebounceTime()),prevClickTimeStamp=e.timeStamp)),null!=down||r.dragData.didDrag||r.hoverData.selecting||r.hoverData.dragged||isMultSelKeyDown(e)||(cy.$(isSelected).unselect(["tapunselect"]),draggedElements.length>0&&r.redrawHint("eles",!0),r.dragData.possibleDragElements=draggedElements=cy.collection()),near!=down||r.dragData.didDrag||r.hoverData.selecting||null!=near&&near._private.selectable&&(r.hoverData.dragging||("additive"===cy.selectionType()||multSelKeyDown?near.selected()?near.unselect(["tapunselect"]):near.select(["tapselect"]):multSelKeyDown||(cy.$(isSelected).unmerge(near).unselect(["tapunselect"]),near.select(["tapselect"]))),r.redrawHint("eles",!0)),r.hoverData.selecting){var box=cy.collection(r.getAllInBox(select[0],select[1],select[2],select[3]));r.redrawHint("select",!0),box.length>0&&r.redrawHint("eles",!0),cy.emit({type:"boxend",originalEvent:e,position:{x:pos[0],y:pos[1]}});var eleWouldBeSelected=function eleWouldBeSelected(ele){return ele.selectable()&&!ele.selected()};"additive"===cy.selectionType()||multSelKeyDown||cy.$(isSelected).unmerge(box).unselect(),box.emit("box").stdFilter(eleWouldBeSelected).select().emit("boxselect"),r.redraw()}if(r.hoverData.dragging&&(r.hoverData.dragging=!1,r.redrawHint("select",!0),r.redrawHint("eles",!0),r.redraw()),!select[4]){r.redrawHint("drag",!0),r.redrawHint("eles",!0);var downWasGrabbed=down&&down.grabbed();freeDraggedElements(draggedElements),downWasGrabbed&&(down.emit("freeon"),draggedElements.emit("free"),r.dragData.didDrag&&(down.emit("dragfreeon"),draggedElements.emit("dragfree")))}}select[4]=0,r.hoverData.down=null,r.hoverData.cxtStarted=!1,r.hoverData.draggingEles=!1,r.hoverData.selecting=!1,r.hoverData.isOverThresholdDrag=!1,r.dragData.didDrag=!1,r.hoverData.dragged=!1,r.hoverData.dragDelta=[],r.hoverData.mdownPos=null,r.hoverData.mdownGPos=null}}),!1);var f1x1,f1y1,f2x1,f2y1,distance1,distance1Sq,center1,modelCenter1,offsetLeft,offsetTop,containerWidth,containerHeight,twoFingersStartInside,wheelHandler=function wheelHandler(e){if(!r.scrollingPage){var cy=r.cy,zoom=cy.zoom(),pan=cy.pan(),pos=r.projectIntoViewport(e.clientX,e.clientY),rpos=[pos[0]*zoom+pan.x,pos[1]*zoom+pan.y];if(r.hoverData.draggingEles||r.hoverData.dragging||r.hoverData.cxtStarted||function inBoxSelection(){return 0!==r.selection[4]}())e.preventDefault();else if(cy.panningEnabled()&&cy.userPanningEnabled()&&cy.zoomingEnabled()&&cy.userZoomingEnabled()){var diff;e.preventDefault(),r.data.wheelZooming=!0,clearTimeout(r.data.wheelTimeout),r.data.wheelTimeout=setTimeout((function(){r.data.wheelZooming=!1,r.redrawHint("eles",!0),r.redraw()}),150),diff=null!=e.deltaY?e.deltaY/-250:null!=e.wheelDeltaY?e.wheelDeltaY/1e3:e.wheelDelta/1e3,diff*=r.wheelSensitivity,1===e.deltaMode&&(diff*=33);var newZoom=cy.zoom()*Math.pow(10,diff);"gesturechange"===e.type&&(newZoom=r.gestureStartZoom*e.scale),cy.zoom({level:newZoom,renderedPosition:{x:rpos[0],y:rpos[1]}}),cy.emit("gesturechange"===e.type?"pinchzoom":"scrollzoom")}}};r.registerBinding(r.container,"wheel",wheelHandler,!0),r.registerBinding(window,"scroll",(function scrollHandler(e){r.scrollingPage=!0,clearTimeout(r.scrollingPageTimeout),r.scrollingPageTimeout=setTimeout((function(){r.scrollingPage=!1}),250)}),!0),r.registerBinding(r.container,"gesturestart",(function gestureStartHandler(e){r.gestureStartZoom=r.cy.zoom(),r.hasTouchStarted||e.preventDefault()}),!0),r.registerBinding(r.container,"gesturechange",(function(e){r.hasTouchStarted||wheelHandler(e)}),!0),r.registerBinding(r.container,"mouseout",(function mouseOutHandler(e){var pos=r.projectIntoViewport(e.clientX,e.clientY);r.cy.emit({originalEvent:e,type:"mouseout",position:{x:pos[0],y:pos[1]}})}),!1),r.registerBinding(r.container,"mouseover",(function mouseOverHandler(e){var pos=r.projectIntoViewport(e.clientX,e.clientY);r.cy.emit({originalEvent:e,type:"mouseover",position:{x:pos[0],y:pos[1]}})}),!1);var touchstartHandler,touchmoveHandler,touchcancelHandler,touchendHandler,didDoubleTouch,touchTimeout,prevTouchTimeStamp,distance=function distance(x1,y1,x2,y2){return Math.sqrt((x2-x1)*(x2-x1)+(y2-y1)*(y2-y1))},distanceSq=function distanceSq(x1,y1,x2,y2){return(x2-x1)*(x2-x1)+(y2-y1)*(y2-y1)};if(r.registerBinding(r.container,"touchstart",touchstartHandler=function touchstartHandler(e){if(r.hasTouchStarted=!0,eventInContainer(e)){blurActiveDomElement(),r.touchData.capture=!0,r.data.bgActivePosistion=void 0;var cy=r.cy,now=r.touchData.now,earlier=r.touchData.earlier;if(e.touches[0]){var pos=r.projectIntoViewport(e.touches[0].clientX,e.touches[0].clientY);now[0]=pos[0],now[1]=pos[1]}if(e.touches[1]){pos=r.projectIntoViewport(e.touches[1].clientX,e.touches[1].clientY);now[2]=pos[0],now[3]=pos[1]}if(e.touches[2]){pos=r.projectIntoViewport(e.touches[2].clientX,e.touches[2].clientY);now[4]=pos[0],now[5]=pos[1]}if(e.touches[1]){r.touchData.singleTouchMoved=!0,freeDraggedElements(r.dragData.touchDragEles);var offsets=r.findContainerClientCoords();offsetLeft=offsets[0],offsetTop=offsets[1],containerWidth=offsets[2],containerHeight=offsets[3],f1x1=e.touches[0].clientX-offsetLeft,f1y1=e.touches[0].clientY-offsetTop,f2x1=e.touches[1].clientX-offsetLeft,f2y1=e.touches[1].clientY-offsetTop,twoFingersStartInside=0<=f1x1&&f1x1<=containerWidth&&0<=f2x1&&f2x1<=containerWidth&&0<=f1y1&&f1y1<=containerHeight&&0<=f2y1&&f2y1<=containerHeight;var pan=cy.pan(),zoom=cy.zoom();distance1=distance(f1x1,f1y1,f2x1,f2y1),distance1Sq=distanceSq(f1x1,f1y1,f2x1,f2y1),modelCenter1=[((center1=[(f1x1+f2x1)/2,(f1y1+f2y1)/2])[0]-pan.x)/zoom,(center1[1]-pan.y)/zoom];if(distance1Sq<4e4&&!e.touches[2]){var near1=r.findNearestElement(now[0],now[1],!0,!0),near2=r.findNearestElement(now[2],now[3],!0,!0);return near1&&near1.isNode()?(near1.activate().emit({originalEvent:e,type:"cxttapstart",position:{x:now[0],y:now[1]}}),r.touchData.start=near1):near2&&near2.isNode()?(near2.activate().emit({originalEvent:e,type:"cxttapstart",position:{x:now[0],y:now[1]}}),r.touchData.start=near2):cy.emit({originalEvent:e,type:"cxttapstart",position:{x:now[0],y:now[1]}}),r.touchData.start&&(r.touchData.start._private.grabbed=!1),r.touchData.cxt=!0,r.touchData.cxtDragged=!1,r.data.bgActivePosistion=void 0,void r.redraw()}}if(e.touches[2])cy.boxSelectionEnabled()&&e.preventDefault();else if(e.touches[1]);else if(e.touches[0]){var nears=r.findNearestElements(now[0],now[1],!0,!0),near=nears[0];if(null!=near&&(near.activate(),r.touchData.start=near,r.touchData.starts=nears,r.nodeIsGrabbable(near))){var draggedEles=r.dragData.touchDragEles=cy.collection(),selectedNodes=null;r.redrawHint("eles",!0),r.redrawHint("drag",!0),near.selected()?(selectedNodes=cy.$((function(ele){return ele.selected()&&r.nodeIsGrabbable(ele)})),addNodesToDrag(selectedNodes,{addToList:draggedEles})):addNodeToDrag(near,{addToList:draggedEles}),setGrabTarget(near);var makeEvent=function makeEvent(type){return{originalEvent:e,type:type,position:{x:now[0],y:now[1]}}};near.emit(makeEvent("grabon")),selectedNodes?selectedNodes.forEach((function(n){n.emit(makeEvent("grab"))})):near.emit(makeEvent("grab"))}triggerEvents(near,["touchstart","tapstart","vmousedown"],e,{x:now[0],y:now[1]}),null==near&&(r.data.bgActivePosistion={x:pos[0],y:pos[1]},r.redrawHint("select",!0),r.redraw()),r.touchData.singleTouchMoved=!1,r.touchData.singleTouchStartTime=+new Date,clearTimeout(r.touchData.tapholdTimeout),r.touchData.tapholdTimeout=setTimeout((function(){!1!==r.touchData.singleTouchMoved||r.pinching||r.touchData.selecting||triggerEvents(r.touchData.start,["taphold"],e,{x:now[0],y:now[1]})}),r.tapholdDuration)}if(e.touches.length>=1){for(var sPos=r.touchData.startPosition=[],i=0;i<now.length;i++)sPos[i]=earlier[i]=now[i];var touch0=e.touches[0];r.touchData.startGPosition=[touch0.clientX,touch0.clientY]}}},!1),r.registerBinding(window,"touchmove",touchmoveHandler=function touchmoveHandler(e){var capture=r.touchData.capture;if(capture||eventInContainer(e)){var select=r.selection,cy=r.cy,now=r.touchData.now,earlier=r.touchData.earlier,zoom=cy.zoom();if(e.touches[0]){var pos=r.projectIntoViewport(e.touches[0].clientX,e.touches[0].clientY);now[0]=pos[0],now[1]=pos[1]}if(e.touches[1]){pos=r.projectIntoViewport(e.touches[1].clientX,e.touches[1].clientY);now[2]=pos[0],now[3]=pos[1]}if(e.touches[2]){pos=r.projectIntoViewport(e.touches[2].clientX,e.touches[2].clientY);now[4]=pos[0],now[5]=pos[1]}var isOverThresholdDrag,startGPos=r.touchData.startGPosition;if(capture&&e.touches[0]&&startGPos){for(var disp=[],j=0;j<now.length;j++)disp[j]=now[j]-earlier[j];var dx=e.touches[0].clientX-startGPos[0],dx2=dx*dx,dy=e.touches[0].clientY-startGPos[1];isOverThresholdDrag=dx2+dy*dy>=r.touchTapThreshold2}if(capture&&r.touchData.cxt){e.preventDefault();var f1x2=e.touches[0].clientX-offsetLeft,f1y2=e.touches[0].clientY-offsetTop,f2x2=e.touches[1].clientX-offsetLeft,f2y2=e.touches[1].clientY-offsetTop,distance2Sq=distanceSq(f1x2,f1y2,f2x2,f2y2);if(distance2Sq/distance1Sq>=2.25||distance2Sq>=22500){r.touchData.cxt=!1,r.data.bgActivePosistion=void 0,r.redrawHint("select",!0);var cxtEvt={originalEvent:e,type:"cxttapend",position:{x:now[0],y:now[1]}};r.touchData.start?(r.touchData.start.unactivate().emit(cxtEvt),r.touchData.start=null):cy.emit(cxtEvt)}}if(capture&&r.touchData.cxt){cxtEvt={originalEvent:e,type:"cxtdrag",position:{x:now[0],y:now[1]}};r.data.bgActivePosistion=void 0,r.redrawHint("select",!0),r.touchData.start?r.touchData.start.emit(cxtEvt):cy.emit(cxtEvt),r.touchData.start&&(r.touchData.start._private.grabbed=!1),r.touchData.cxtDragged=!0;var near=r.findNearestElement(now[0],now[1],!0,!0);r.touchData.cxtOver&&near===r.touchData.cxtOver||(r.touchData.cxtOver&&r.touchData.cxtOver.emit({originalEvent:e,type:"cxtdragout",position:{x:now[0],y:now[1]}}),r.touchData.cxtOver=near,near&&near.emit({originalEvent:e,type:"cxtdragover",position:{x:now[0],y:now[1]}}))}else if(capture&&e.touches[2]&&cy.boxSelectionEnabled())e.preventDefault(),r.data.bgActivePosistion=void 0,this.lastThreeTouch=+new Date,r.touchData.selecting||cy.emit({originalEvent:e,type:"boxstart",position:{x:now[0],y:now[1]}}),r.touchData.selecting=!0,r.touchData.didSelect=!0,select[4]=1,select&&0!==select.length&&void 0!==select[0]?(select[2]=(now[0]+now[2]+now[4])/3,select[3]=(now[1]+now[3]+now[5])/3):(select[0]=(now[0]+now[2]+now[4])/3,select[1]=(now[1]+now[3]+now[5])/3,select[2]=(now[0]+now[2]+now[4])/3+1,select[3]=(now[1]+now[3]+now[5])/3+1),r.redrawHint("select",!0),r.redraw();else if(capture&&e.touches[1]&&!r.touchData.didSelect&&cy.zoomingEnabled()&&cy.panningEnabled()&&cy.userZoomingEnabled()&&cy.userPanningEnabled()){if(e.preventDefault(),r.data.bgActivePosistion=void 0,r.redrawHint("select",!0),draggedEles=r.dragData.touchDragEles){r.redrawHint("drag",!0);for(var i=0;i<draggedEles.length;i++){var de_p=draggedEles[i]._private;de_p.grabbed=!1,de_p.rscratch.inDragLayer=!1}}var _start=r.touchData.start,distance2=(f1x2=e.touches[0].clientX-offsetLeft,f1y2=e.touches[0].clientY-offsetTop,f2x2=e.touches[1].clientX-offsetLeft,f2y2=e.touches[1].clientY-offsetTop,distance(f1x2,f1y2,f2x2,f2y2)),factor=distance2/distance1;if(twoFingersStartInside){var tx=(f1x2-f1x1+(f2x2-f2x1))/2,ty=(f1y2-f1y1+(f2y2-f2y1))/2,zoom1=cy.zoom(),zoom2=zoom1*factor,pan1=cy.pan(),ctrx=modelCenter1[0]*zoom1+pan1.x,ctry=modelCenter1[1]*zoom1+pan1.y,pan2={x:-zoom2/zoom1*(ctrx-pan1.x-tx)+ctrx,y:-zoom2/zoom1*(ctry-pan1.y-ty)+ctry};if(_start&&_start.active()){var draggedEles=r.dragData.touchDragEles;freeDraggedElements(draggedEles),r.redrawHint("drag",!0),r.redrawHint("eles",!0),_start.unactivate().emit("freeon"),draggedEles.emit("free"),r.dragData.didDrag&&(_start.emit("dragfreeon"),draggedEles.emit("dragfree"))}cy.viewport({zoom:zoom2,pan:pan2,cancelOnFailedZoom:!0}),cy.emit("pinchzoom"),distance1=distance2,f1x1=f1x2,f1y1=f1y2,f2x1=f2x2,f2y1=f2y2,r.pinching=!0}if(e.touches[0]){pos=r.projectIntoViewport(e.touches[0].clientX,e.touches[0].clientY);now[0]=pos[0],now[1]=pos[1]}if(e.touches[1]){pos=r.projectIntoViewport(e.touches[1].clientX,e.touches[1].clientY);now[2]=pos[0],now[3]=pos[1]}if(e.touches[2]){pos=r.projectIntoViewport(e.touches[2].clientX,e.touches[2].clientY);now[4]=pos[0],now[5]=pos[1]}}else if(e.touches[0]&&!r.touchData.didSelect){var start=r.touchData.start,last=r.touchData.last;if(r.hoverData.draggingEles||r.swipePanning||(near=r.findNearestElement(now[0],now[1],!0,!0)),capture&&null!=start&&e.preventDefault(),capture&&null!=start&&r.nodeIsDraggable(start))if(isOverThresholdDrag){draggedEles=r.dragData.touchDragEles;var justStartedDrag=!r.dragData.didDrag;justStartedDrag&&addNodesToDrag(draggedEles,{inDragLayer:!0}),r.dragData.didDrag=!0;var totalShift={x:0,y:0};if(number(disp[0])&&number(disp[1]))if(totalShift.x+=disp[0],totalShift.y+=disp[1],justStartedDrag)r.redrawHint("eles",!0),(dragDelta=r.touchData.dragDelta)&&number(dragDelta[0])&&number(dragDelta[1])&&(totalShift.x+=dragDelta[0],totalShift.y+=dragDelta[1]);r.hoverData.draggingEles=!0,draggedEles.silentShift(totalShift).emit("position drag"),r.redrawHint("drag",!0),r.touchData.startPosition[0]==earlier[0]&&r.touchData.startPosition[1]==earlier[1]&&r.redrawHint("eles",!0),r.redraw()}else{var dragDelta;0===(dragDelta=r.touchData.dragDelta=r.touchData.dragDelta||[]).length?(dragDelta.push(disp[0]),dragDelta.push(disp[1])):(dragDelta[0]+=disp[0],dragDelta[1]+=disp[1])}if(triggerEvents(start||near,["touchmove","tapdrag","vmousemove"],e,{x:now[0],y:now[1]}),start&&start.grabbed()||near==last||(last&&last.emit({originalEvent:e,type:"tapdragout",position:{x:now[0],y:now[1]}}),near&&near.emit({originalEvent:e,type:"tapdragover",position:{x:now[0],y:now[1]}})),r.touchData.last=near,capture)for(i=0;i<now.length;i++)now[i]&&r.touchData.startPosition[i]&&isOverThresholdDrag&&(r.touchData.singleTouchMoved=!0);if(capture&&(null==start||start.pannable())&&cy.panningEnabled()&&cy.userPanningEnabled()){allowPanningPassthrough(start,r.touchData.starts)&&(e.preventDefault(),r.data.bgActivePosistion||(r.data.bgActivePosistion=array2point(r.touchData.startPosition)),r.swipePanning?(cy.panBy({x:disp[0]*zoom,y:disp[1]*zoom}),cy.emit("dragpan")):isOverThresholdDrag&&(r.swipePanning=!0,cy.panBy({x:dx*zoom,y:dy*zoom}),cy.emit("dragpan"),start&&(start.unactivate(),r.redrawHint("select",!0),r.touchData.start=null)));pos=r.projectIntoViewport(e.touches[0].clientX,e.touches[0].clientY);now[0]=pos[0],now[1]=pos[1]}}for(j=0;j<now.length;j++)earlier[j]=now[j];capture&&e.touches.length>0&&!r.hoverData.draggingEles&&!r.swipePanning&&null!=r.data.bgActivePosistion&&(r.data.bgActivePosistion=void 0,r.redrawHint("select",!0),r.redraw())}},!1),r.registerBinding(window,"touchcancel",touchcancelHandler=function touchcancelHandler(e){var start=r.touchData.start;r.touchData.capture=!1,start&&start.unactivate()}),r.registerBinding(window,"touchend",touchendHandler=function touchendHandler(e){var start=r.touchData.start;if(r.touchData.capture){0===e.touches.length&&(r.touchData.capture=!1),e.preventDefault();var select=r.selection;r.swipePanning=!1,r.hoverData.draggingEles=!1;var ctxTapend,cy=r.cy,zoom=cy.zoom(),now=r.touchData.now,earlier=r.touchData.earlier;if(e.touches[0]){var pos=r.projectIntoViewport(e.touches[0].clientX,e.touches[0].clientY);now[0]=pos[0],now[1]=pos[1]}if(e.touches[1]){pos=r.projectIntoViewport(e.touches[1].clientX,e.touches[1].clientY);now[2]=pos[0],now[3]=pos[1]}if(e.touches[2]){pos=r.projectIntoViewport(e.touches[2].clientX,e.touches[2].clientY);now[4]=pos[0],now[5]=pos[1]}if(start&&start.unactivate(),r.touchData.cxt){if(ctxTapend={originalEvent:e,type:"cxttapend",position:{x:now[0],y:now[1]}},start?start.emit(ctxTapend):cy.emit(ctxTapend),!r.touchData.cxtDragged){var ctxTap={originalEvent:e,type:"cxttap",position:{x:now[0],y:now[1]}};start?start.emit(ctxTap):cy.emit(ctxTap)}return r.touchData.start&&(r.touchData.start._private.grabbed=!1),r.touchData.cxt=!1,r.touchData.start=null,void r.redraw()}if(!e.touches[2]&&cy.boxSelectionEnabled()&&r.touchData.selecting){r.touchData.selecting=!1;var box=cy.collection(r.getAllInBox(select[0],select[1],select[2],select[3]));select[0]=void 0,select[1]=void 0,select[2]=void 0,select[3]=void 0,select[4]=0,r.redrawHint("select",!0),cy.emit({type:"boxend",originalEvent:e,position:{x:now[0],y:now[1]}});box.emit("box").stdFilter((function eleWouldBeSelected(ele){return ele.selectable()&&!ele.selected()})).select().emit("boxselect"),box.nonempty()&&r.redrawHint("eles",!0),r.redraw()}if(null!=start&&start.unactivate(),e.touches[2])r.data.bgActivePosistion=void 0,r.redrawHint("select",!0);else if(e.touches[1]);else if(e.touches[0]);else if(!e.touches[0]){r.data.bgActivePosistion=void 0,r.redrawHint("select",!0);var draggedEles=r.dragData.touchDragEles;if(null!=start){var startWasGrabbed=start._private.grabbed;freeDraggedElements(draggedEles),r.redrawHint("drag",!0),r.redrawHint("eles",!0),startWasGrabbed&&(start.emit("freeon"),draggedEles.emit("free"),r.dragData.didDrag&&(start.emit("dragfreeon"),draggedEles.emit("dragfree"))),triggerEvents(start,["touchend","tapend","vmouseup","tapdragout"],e,{x:now[0],y:now[1]}),start.unactivate(),r.touchData.start=null}else{var near=r.findNearestElement(now[0],now[1],!0,!0);triggerEvents(near,["touchend","tapend","vmouseup","tapdragout"],e,{x:now[0],y:now[1]})}var dx=r.touchData.startPosition[0]-now[0],dx2=dx*dx,dy=r.touchData.startPosition[1]-now[1],rdist2=(dx2+dy*dy)*zoom*zoom;r.touchData.singleTouchMoved||(start||cy.$(":selected").unselect(["tapunselect"]),triggerEvents(start,["tap","vclick"],e,{x:now[0],y:now[1]}),didDoubleTouch=!1,e.timeStamp-prevTouchTimeStamp<=cy.multiClickDebounceTime()?(touchTimeout&&clearTimeout(touchTimeout),didDoubleTouch=!0,prevTouchTimeStamp=null,triggerEvents(start,["dbltap","vdblclick"],e,{x:now[0],y:now[1]})):(touchTimeout=setTimeout((function(){didDoubleTouch||triggerEvents(start,["onetap","voneclick"],e,{x:now[0],y:now[1]})}),cy.multiClickDebounceTime()),prevTouchTimeStamp=e.timeStamp)),null!=start&&!r.dragData.didDrag&&start._private.selectable&&rdist2<r.touchTapThreshold2&&!r.pinching&&("single"===cy.selectionType()?(cy.$(isSelected).unmerge(start).unselect(["tapunselect"]),start.select(["tapselect"])):start.selected()?start.unselect(["tapunselect"]):start.select(["tapselect"]),r.redrawHint("eles",!0)),r.touchData.singleTouchMoved=!0}for(var j=0;j<now.length;j++)earlier[j]=now[j];r.dragData.didDrag=!1,0===e.touches.length&&(r.touchData.dragDelta=[],r.touchData.startPosition=null,r.touchData.startGPosition=null,r.touchData.didSelect=!1),e.touches.length<2&&(1===e.touches.length&&(r.touchData.startGPosition=[e.touches[0].clientX,e.touches[0].clientY]),r.pinching=!1,r.redrawHint("eles",!0),r.redraw())}},!1),"undefined"==typeof TouchEvent){var pointers=[],makeTouch=function makeTouch(e){return{clientX:e.clientX,clientY:e.clientY,force:1,identifier:e.pointerId,pageX:e.pageX,pageY:e.pageY,radiusX:e.width/2,radiusY:e.height/2,screenX:e.screenX,screenY:e.screenY,target:e.target}},addPointer=function addPointer(e){pointers.push(function makePointer(e){return{event:e,touch:makeTouch(e)}}(e))},removePointer=function removePointer(e){for(var i=0;i<pointers.length;i++){if(pointers[i].event.pointerId===e.pointerId)return void pointers.splice(i,1)}},addTouchesToEvent=function addTouchesToEvent(e){e.touches=pointers.map((function(p){return p.touch}))},pointerIsMouse=function pointerIsMouse(e){return"mouse"===e.pointerType||4===e.pointerType};r.registerBinding(r.container,"pointerdown",(function(e){pointerIsMouse(e)||(e.preventDefault(),addPointer(e),addTouchesToEvent(e),touchstartHandler(e))})),r.registerBinding(r.container,"pointerup",(function(e){pointerIsMouse(e)||(removePointer(e),addTouchesToEvent(e),touchendHandler(e))})),r.registerBinding(r.container,"pointercancel",(function(e){pointerIsMouse(e)||(removePointer(e),addTouchesToEvent(e),touchcancelHandler())})),r.registerBinding(r.container,"pointermove",(function(e){pointerIsMouse(e)||(e.preventDefault(),function updatePointer(e){var p=pointers.filter((function(p){return p.event.pointerId===e.pointerId}))[0];p.event=e,p.touch=makeTouch(e)}(e),addTouchesToEvent(e),touchmoveHandler(e))}))}};var BRp$d={generatePolygon:function(name,points){return this.nodeShapes[name]={renderer:this,name:name,points:points,draw:function draw(context,centerX,centerY,width,height){this.renderer.nodeShapeImpl("polygon",context,centerX,centerY,width,height,this.points)},intersectLine:function intersectLine(nodeX,nodeY,width,height,x,y,padding){return polygonIntersectLine(x,y,this.points,nodeX,nodeY,width/2,height/2,padding)},checkPoint:function checkPoint(x,y,padding,width,height,centerX,centerY){return pointInsidePolygon(x,y,this.points,centerX,centerY,width,height,[0,-1],padding)}}}};BRp$d.generateEllipse=function(){return this.nodeShapes.ellipse={renderer:this,name:"ellipse",draw:function draw(context,centerX,centerY,width,height){this.renderer.nodeShapeImpl(this.name,context,centerX,centerY,width,height)},intersectLine:function intersectLine(nodeX,nodeY,width,height,x,y,padding){return function intersectLineEllipse(x,y,centerX,centerY,ellipseWradius,ellipseHradius){var dispX=centerX-x,dispY=centerY-y;dispX/=ellipseWradius,dispY/=ellipseHradius;var len=Math.sqrt(dispX*dispX+dispY*dispY),newLength=len-1;if(newLength<0)return[];var lenProportion=newLength/len;return[(centerX-x)*lenProportion+x,(centerY-y)*lenProportion+y]}(x,y,nodeX,nodeY,width/2+padding,height/2+padding)},checkPoint:function checkPoint(x,y,padding,width,height,centerX,centerY){return checkInEllipse(x,y,width,height,centerX,centerY,padding)}}},BRp$d.generateRoundPolygon=function(name,points){for(var allPoints=new Array(2*points.length),i=0;i<points.length/2;i++){var sourceIndex=2*i,destIndex=void 0;destIndex=i<points.length/2-1?2*(i+1):0,allPoints[4*i]=points[sourceIndex],allPoints[4*i+1]=points[sourceIndex+1];var xDest=points[destIndex]-points[sourceIndex],yDest=points[destIndex+1]-points[sourceIndex+1],norm=Math.sqrt(xDest*xDest+yDest*yDest);allPoints[4*i+2]=xDest/norm,allPoints[4*i+3]=yDest/norm}return this.nodeShapes[name]={renderer:this,name:name,points:allPoints,draw:function draw(context,centerX,centerY,width,height){this.renderer.nodeShapeImpl("round-polygon",context,centerX,centerY,width,height,this.points)},intersectLine:function intersectLine(nodeX,nodeY,width,height,x,y,padding){return function roundPolygonIntersectLine(x,y,basePoints,centerX,centerY,width,height,padding){for(var intersection,intersections=[],lines=new Array(basePoints.length),halfW=width/2,halfH=height/2,cornerRadius=getRoundPolygonRadius(width,height),i=0;i<basePoints.length/4;i++){var destUv,sourceUv=void 0;sourceUv=0===i?basePoints.length-2:4*i-2,destUv=4*i+2;var px=centerX+halfW*basePoints[4*i],py=centerY+halfH*basePoints[4*i+1],cosTheta=-basePoints[sourceUv]*basePoints[destUv]-basePoints[sourceUv+1]*basePoints[destUv+1],offset=cornerRadius/Math.tan(Math.acos(cosTheta)/2),cp0x=px-offset*basePoints[sourceUv],cp0y=py-offset*basePoints[sourceUv+1],cp1x=px+offset*basePoints[destUv],cp1y=py+offset*basePoints[destUv+1];0===i?(lines[basePoints.length-2]=cp0x,lines[basePoints.length-1]=cp0y):(lines[4*i-2]=cp0x,lines[4*i-1]=cp0y),lines[4*i]=cp1x,lines[4*i+1]=cp1y;var orthx=basePoints[sourceUv+1],orthy=-basePoints[sourceUv];orthx*basePoints[destUv]+orthy*basePoints[destUv+1]<0&&(orthx*=-1,orthy*=-1),0!==(intersection=intersectLineCircle(x,y,centerX,centerY,cp0x+orthx*cornerRadius,cp0y+orthy*cornerRadius,cornerRadius)).length&&intersections.push(intersection[0],intersection[1])}for(var _i3=0;_i3<lines.length/4;_i3++)0!==(intersection=finiteLinesIntersect(x,y,centerX,centerY,lines[4*_i3],lines[4*_i3+1],lines[4*_i3+2],lines[4*_i3+3],!1)).length&&intersections.push(intersection[0],intersection[1]);if(intersections.length>2){for(var lowestIntersection=[intersections[0],intersections[1]],lowestSquaredDistance=Math.pow(lowestIntersection[0]-x,2)+Math.pow(lowestIntersection[1]-y,2),_i4=1;_i4<intersections.length/2;_i4++){var squaredDistance=Math.pow(intersections[2*_i4]-x,2)+Math.pow(intersections[2*_i4+1]-y,2);squaredDistance<=lowestSquaredDistance&&(lowestIntersection[0]=intersections[2*_i4],lowestIntersection[1]=intersections[2*_i4+1],lowestSquaredDistance=squaredDistance)}return lowestIntersection}return intersections}(x,y,this.points,nodeX,nodeY,width,height)},checkPoint:function checkPoint(x,y,padding,width,height,centerX,centerY){return function pointInsideRoundPolygon(x,y,basePoints,centerX,centerY,width,height){for(var cutPolygonPoints=new Array(basePoints.length),halfW=width/2,halfH=height/2,cornerRadius=getRoundPolygonRadius(width,height),squaredCornerRadius=cornerRadius*cornerRadius,i=0;i<basePoints.length/4;i++){var destUv,sourceUv=void 0;sourceUv=0===i?basePoints.length-2:4*i-2,destUv=4*i+2;var px=centerX+halfW*basePoints[4*i],py=centerY+halfH*basePoints[4*i+1],cosTheta=-basePoints[sourceUv]*basePoints[destUv]-basePoints[sourceUv+1]*basePoints[destUv+1],offset=cornerRadius/Math.tan(Math.acos(cosTheta)/2),cp0x=px-offset*basePoints[sourceUv],cp0y=py-offset*basePoints[sourceUv+1],cp1x=px+offset*basePoints[destUv],cp1y=py+offset*basePoints[destUv+1];cutPolygonPoints[4*i]=cp0x,cutPolygonPoints[4*i+1]=cp0y,cutPolygonPoints[4*i+2]=cp1x,cutPolygonPoints[4*i+3]=cp1y;var orthx=basePoints[sourceUv+1],orthy=-basePoints[sourceUv];orthx*basePoints[destUv]+orthy*basePoints[destUv+1]<0&&(orthx*=-1,orthy*=-1);var cx=cp0x+orthx*cornerRadius,cy=cp0y+orthy*cornerRadius;if(Math.pow(cx-x,2)+Math.pow(cy-y,2)<=squaredCornerRadius)return!0}return pointInsidePolygonPoints(x,y,cutPolygonPoints)}(x,y,this.points,centerX,centerY,width,height)}}},BRp$d.generateRoundRectangle=function(){return this.nodeShapes["round-rectangle"]=this.nodeShapes.roundrectangle={renderer:this,name:"round-rectangle",points:generateUnitNgonPointsFitToSquare(4,0),draw:function draw(context,centerX,centerY,width,height){this.renderer.nodeShapeImpl(this.name,context,centerX,centerY,width,height)},intersectLine:function intersectLine(nodeX,nodeY,width,height,x,y,padding){return roundRectangleIntersectLine(x,y,nodeX,nodeY,width,height,padding)},checkPoint:function checkPoint(x,y,padding,width,height,centerX,centerY){var cornerRadius=getRoundRectangleRadius(width,height),diam=2*cornerRadius;return!!pointInsidePolygon(x,y,this.points,centerX,centerY,width,height-diam,[0,-1],padding)||(!!pointInsidePolygon(x,y,this.points,centerX,centerY,width-diam,height,[0,-1],padding)||(!!checkInEllipse(x,y,diam,diam,centerX-width/2+cornerRadius,centerY-height/2+cornerRadius,padding)||(!!checkInEllipse(x,y,diam,diam,centerX+width/2-cornerRadius,centerY-height/2+cornerRadius,padding)||(!!checkInEllipse(x,y,diam,diam,centerX+width/2-cornerRadius,centerY+height/2-cornerRadius,padding)||!!checkInEllipse(x,y,diam,diam,centerX-width/2+cornerRadius,centerY+height/2-cornerRadius,padding)))))}}},BRp$d.generateCutRectangle=function(){return this.nodeShapes["cut-rectangle"]=this.nodeShapes.cutrectangle={renderer:this,name:"cut-rectangle",cornerLength:8,points:generateUnitNgonPointsFitToSquare(4,0),draw:function draw(context,centerX,centerY,width,height){this.renderer.nodeShapeImpl(this.name,context,centerX,centerY,width,height)},generateCutTrianglePts:function generateCutTrianglePts(width,height,centerX,centerY){var cl=this.cornerLength,hh=height/2,hw=width/2,xBegin=centerX-hw,xEnd=centerX+hw,yBegin=centerY-hh,yEnd=centerY+hh;return{topLeft:[xBegin,yBegin+cl,xBegin+cl,yBegin,xBegin+cl,yBegin+cl],topRight:[xEnd-cl,yBegin,xEnd,yBegin+cl,xEnd-cl,yBegin+cl],bottomRight:[xEnd,yEnd-cl,xEnd-cl,yEnd,xEnd-cl,yEnd-cl],bottomLeft:[xBegin+cl,yEnd,xBegin,yEnd-cl,xBegin+cl,yEnd-cl]}},intersectLine:function intersectLine(nodeX,nodeY,width,height,x,y,padding){var cPts=this.generateCutTrianglePts(width+2*padding,height+2*padding,nodeX,nodeY),pts=[].concat.apply([],[cPts.topLeft.splice(0,4),cPts.topRight.splice(0,4),cPts.bottomRight.splice(0,4),cPts.bottomLeft.splice(0,4)]);return polygonIntersectLine(x,y,pts,nodeX,nodeY)},checkPoint:function checkPoint(x,y,padding,width,height,centerX,centerY){if(pointInsidePolygon(x,y,this.points,centerX,centerY,width,height-2*this.cornerLength,[0,-1],padding))return!0;if(pointInsidePolygon(x,y,this.points,centerX,centerY,width-2*this.cornerLength,height,[0,-1],padding))return!0;var cutTrianglePts=this.generateCutTrianglePts(width,height,centerX,centerY);return pointInsidePolygonPoints(x,y,cutTrianglePts.topLeft)||pointInsidePolygonPoints(x,y,cutTrianglePts.topRight)||pointInsidePolygonPoints(x,y,cutTrianglePts.bottomRight)||pointInsidePolygonPoints(x,y,cutTrianglePts.bottomLeft)}}},BRp$d.generateBarrel=function(){return this.nodeShapes.barrel={renderer:this,name:"barrel",points:generateUnitNgonPointsFitToSquare(4,0),draw:function draw(context,centerX,centerY,width,height){this.renderer.nodeShapeImpl(this.name,context,centerX,centerY,width,height)},intersectLine:function intersectLine(nodeX,nodeY,width,height,x,y,padding){var bPts=this.generateBarrelBezierPts(width+2*padding,height+2*padding,nodeX,nodeY),approximateBarrelCurvePts=function approximateBarrelCurvePts(pts){var m0=qbezierPtAt({x:pts[0],y:pts[1]},{x:pts[2],y:pts[3]},{x:pts[4],y:pts[5]},.15),m1=qbezierPtAt({x:pts[0],y:pts[1]},{x:pts[2],y:pts[3]},{x:pts[4],y:pts[5]},.5),m2=qbezierPtAt({x:pts[0],y:pts[1]},{x:pts[2],y:pts[3]},{x:pts[4],y:pts[5]},.85);return[pts[0],pts[1],m0.x,m0.y,m1.x,m1.y,m2.x,m2.y,pts[4],pts[5]]},pts=[].concat(approximateBarrelCurvePts(bPts.topLeft),approximateBarrelCurvePts(bPts.topRight),approximateBarrelCurvePts(bPts.bottomRight),approximateBarrelCurvePts(bPts.bottomLeft));return polygonIntersectLine(x,y,pts,nodeX,nodeY)},generateBarrelBezierPts:function generateBarrelBezierPts(width,height,centerX,centerY){var hh=height/2,hw=width/2,xBegin=centerX-hw,xEnd=centerX+hw,yBegin=centerY-hh,yEnd=centerY+hh,curveConstants=getBarrelCurveConstants(width,height),hOffset=curveConstants.heightOffset,wOffset=curveConstants.widthOffset,ctrlPtXOffset=curveConstants.ctrlPtOffsetPct*width,pts={topLeft:[xBegin,yBegin+hOffset,xBegin+ctrlPtXOffset,yBegin,xBegin+wOffset,yBegin],topRight:[xEnd-wOffset,yBegin,xEnd-ctrlPtXOffset,yBegin,xEnd,yBegin+hOffset],bottomRight:[xEnd,yEnd-hOffset,xEnd-ctrlPtXOffset,yEnd,xEnd-wOffset,yEnd],bottomLeft:[xBegin+wOffset,yEnd,xBegin+ctrlPtXOffset,yEnd,xBegin,yEnd-hOffset]};return pts.topLeft.isTop=!0,pts.topRight.isTop=!0,pts.bottomLeft.isBottom=!0,pts.bottomRight.isBottom=!0,pts},checkPoint:function checkPoint(x,y,padding,width,height,centerX,centerY){var curveConstants=getBarrelCurveConstants(width,height),hOffset=curveConstants.heightOffset,wOffset=curveConstants.widthOffset;if(pointInsidePolygon(x,y,this.points,centerX,centerY,width,height-2*hOffset,[0,-1],padding))return!0;if(pointInsidePolygon(x,y,this.points,centerX,centerY,width-2*wOffset,height,[0,-1],padding))return!0;for(var barrelCurvePts=this.generateBarrelBezierPts(width,height,centerX,centerY),getCurveT=function getCurveT(x,y,curvePts){var x0=curvePts[4],x1=curvePts[2],x2=curvePts[0],y0=curvePts[5],y2=curvePts[1],xMin=Math.min(x0,x2),xMax=Math.max(x0,x2),yMin=Math.min(y0,y2),yMax=Math.max(y0,y2);if(xMin<=x&&x<=xMax&&yMin<=y&&y<=yMax){var coeff=function bezierPtsToQuadCoeff(p0,p1,p2){return[p0-2*p1+p2,2*(p1-p0),p0]}(x0,x1,x2),validRoots=function solveQuadratic(a,b,c,val){var r=b*b-4*a*(c-=val);if(r<0)return[];var sqrtR=Math.sqrt(r),denom=2*a;return[(-b+sqrtR)/denom,(-b-sqrtR)/denom]}(coeff[0],coeff[1],coeff[2],x).filter((function(r){return 0<=r&&r<=1}));if(validRoots.length>0)return validRoots[0]}return null},curveRegions=Object.keys(barrelCurvePts),i=0;i<curveRegions.length;i++){var cornerPts=barrelCurvePts[curveRegions[i]],t=getCurveT(x,y,cornerPts);if(null!=t){var y0=cornerPts[5],y1=cornerPts[3],y2=cornerPts[1],bezY=qbezierAt(y0,y1,y2,t);if(cornerPts.isTop&&bezY<=y)return!0;if(cornerPts.isBottom&&y<=bezY)return!0}}return!1}}},BRp$d.generateBottomRoundrectangle=function(){return this.nodeShapes["bottom-round-rectangle"]=this.nodeShapes.bottomroundrectangle={renderer:this,name:"bottom-round-rectangle",points:generateUnitNgonPointsFitToSquare(4,0),draw:function draw(context,centerX,centerY,width,height){this.renderer.nodeShapeImpl(this.name,context,centerX,centerY,width,height)},intersectLine:function intersectLine(nodeX,nodeY,width,height,x,y,padding){var topStartY=nodeY-(height/2+padding),topIntersections=finiteLinesIntersect(x,y,nodeX,nodeY,nodeX-(width/2+padding),topStartY,nodeX+(width/2+padding),topStartY,!1);return topIntersections.length>0?topIntersections:roundRectangleIntersectLine(x,y,nodeX,nodeY,width,height,padding)},checkPoint:function checkPoint(x,y,padding,width,height,centerX,centerY){var cornerRadius=getRoundRectangleRadius(width,height),diam=2*cornerRadius;if(pointInsidePolygon(x,y,this.points,centerX,centerY,width,height-diam,[0,-1],padding))return!0;if(pointInsidePolygon(x,y,this.points,centerX,centerY,width-diam,height,[0,-1],padding))return!0;var outerWidth=width/2+2*padding,outerHeight=height/2+2*padding;return!!pointInsidePolygonPoints(x,y,[centerX-outerWidth,centerY-outerHeight,centerX-outerWidth,centerY,centerX+outerWidth,centerY,centerX+outerWidth,centerY-outerHeight])||(!!checkInEllipse(x,y,diam,diam,centerX+width/2-cornerRadius,centerY+height/2-cornerRadius,padding)||!!checkInEllipse(x,y,diam,diam,centerX-width/2+cornerRadius,centerY+height/2-cornerRadius,padding))}}},BRp$d.registerNodeShapes=function(){var nodeShapes=this.nodeShapes={},renderer=this;this.generateEllipse(),this.generatePolygon("triangle",generateUnitNgonPointsFitToSquare(3,0)),this.generateRoundPolygon("round-triangle",generateUnitNgonPointsFitToSquare(3,0)),this.generatePolygon("rectangle",generateUnitNgonPointsFitToSquare(4,0)),nodeShapes.square=nodeShapes.rectangle,this.generateRoundRectangle(),this.generateCutRectangle(),this.generateBarrel(),this.generateBottomRoundrectangle();var diamondPoints=[0,1,1,0,0,-1,-1,0];this.generatePolygon("diamond",diamondPoints),this.generateRoundPolygon("round-diamond",diamondPoints),this.generatePolygon("pentagon",generateUnitNgonPointsFitToSquare(5,0)),this.generateRoundPolygon("round-pentagon",generateUnitNgonPointsFitToSquare(5,0)),this.generatePolygon("hexagon",generateUnitNgonPointsFitToSquare(6,0)),this.generateRoundPolygon("round-hexagon",generateUnitNgonPointsFitToSquare(6,0)),this.generatePolygon("heptagon",generateUnitNgonPointsFitToSquare(7,0)),this.generateRoundPolygon("round-heptagon",generateUnitNgonPointsFitToSquare(7,0)),this.generatePolygon("octagon",generateUnitNgonPointsFitToSquare(8,0)),this.generateRoundPolygon("round-octagon",generateUnitNgonPointsFitToSquare(8,0));var star5Points=new Array(20),outerPoints=generateUnitNgonPoints(5,0),innerPoints=generateUnitNgonPoints(5,Math.PI/5),innerRadius=.5*(3-Math.sqrt(5));innerRadius*=1.57;for(var i=0;i<innerPoints.length/2;i++)innerPoints[2*i]*=innerRadius,innerPoints[2*i+1]*=innerRadius;for(i=0;i<5;i++)star5Points[4*i]=outerPoints[2*i],star5Points[4*i+1]=outerPoints[2*i+1],star5Points[4*i+2]=innerPoints[2*i],star5Points[4*i+3]=innerPoints[2*i+1];star5Points=fitPolygonToSquare(star5Points),this.generatePolygon("star",star5Points),this.generatePolygon("vee",[-1,-1,0,-.333,1,-1,0,1]),this.generatePolygon("rhomboid",[-1,-1,.333,-1,1,1,-.333,1]),this.nodeShapes.concavehexagon=this.generatePolygon("concave-hexagon",[-1,-.95,-.75,0,-1,.95,1,.95,.75,0,1,-.95]);var tagPoints=[-1,-1,.25,-1,1,0,.25,1,-1,1];this.generatePolygon("tag",tagPoints),this.generateRoundPolygon("round-tag",tagPoints),nodeShapes.makePolygon=function(points){var shape,name="polygon-"+points.join("$");return(shape=this[name])?shape:renderer.generatePolygon(name,points)}};var BRp$e={timeToRender:function(){return this.redrawTotalTime/this.redrawCount},redraw:function(options){options=options||staticEmptyObject();var r=this;void 0===r.averageRedrawTime&&(r.averageRedrawTime=0),void 0===r.lastRedrawTime&&(r.lastRedrawTime=0),void 0===r.lastDrawTime&&(r.lastDrawTime=0),r.requestedFrame=!0,r.renderOptions=options},beforeRender:function(fn,priority){if(!this.destroyed){null==priority&&error("Priority is not optional for beforeRender");var cbs=this.beforeRenderCallbacks;cbs.push({fn:fn,priority:priority}),cbs.sort((function(a,b){return b.priority-a.priority}))}}},beforeRenderCallbacks=function beforeRenderCallbacks(r,willDraw,startTime){for(var cbs=r.beforeRenderCallbacks,i=0;i<cbs.length;i++)cbs[i].fn(willDraw,startTime)};BRp$e.startRenderLoop=function(){var r=this,cy=r.cy;if(!r.renderLoopStarted){r.renderLoopStarted=!0;requestAnimationFrame((function renderFn(requestTime){if(!r.destroyed){if(cy.batching());else if(r.requestedFrame&&!r.skipFrame){beforeRenderCallbacks(r,!0,requestTime);var startTime=performanceNow();r.render(r.renderOptions);var endTime=r.lastDrawTime=performanceNow();void 0===r.averageRedrawTime&&(r.averageRedrawTime=endTime-startTime),void 0===r.redrawCount&&(r.redrawCount=0),r.redrawCount++,void 0===r.redrawTotalTime&&(r.redrawTotalTime=0);var duration=endTime-startTime;r.redrawTotalTime+=duration,r.lastRedrawTime=duration,r.averageRedrawTime=r.averageRedrawTime/2+duration/2,r.requestedFrame=!1}else beforeRenderCallbacks(r,!1,requestTime);r.skipFrame=!1,requestAnimationFrame(renderFn)}}))}};var BR=function BaseRenderer(options){this.init(options)},BRp$f=BR.prototype;BRp$f.clientFunctions=["redrawHint","render","renderTo","matchCanvasSize","nodeShapeImpl","arrowShapeImpl"],BRp$f.init=function(options){var r=this;r.options=options,r.cy=options.cy;var ctr=r.container=options.cy.container();if(window$1){var document=window$1.document,head=document.head,className="__________cytoscape_container",stylesheetAlreadyExists=null!=document.getElementById("__________cytoscape_stylesheet");if(ctr.className.indexOf(className)<0&&(ctr.className=(ctr.className||"")+" "+className),!stylesheetAlreadyExists){var stylesheet=document.createElement("style");stylesheet.id="__________cytoscape_stylesheet",stylesheet.innerHTML="."+className+" { position: relative; }",head.insertBefore(stylesheet,head.children[0])}"static"===window$1.getComputedStyle(ctr).getPropertyValue("position")&&warn("A Cytoscape container has style position:static and so can not use UI extensions properly")}r.selection=[void 0,void 0,void 0,void 0,0],r.bezierProjPcts=[.05,.225,.4,.5,.6,.775,.95],r.hoverData={down:null,last:null,downTime:null,triggerMode:null,dragging:!1,initialPan:[null,null],capture:!1},r.dragData={possibleDragElements:[]},r.touchData={start:null,capture:!1,startPosition:[null,null,null,null,null,null],singleTouchStartTime:null,singleTouchMoved:!0,now:[null,null,null,null,null,null],earlier:[null,null,null,null,null,null]},r.redraws=0,r.showFps=options.showFps,r.debug=options.debug,r.hideEdgesOnViewport=options.hideEdgesOnViewport,r.textureOnViewport=options.textureOnViewport,r.wheelSensitivity=options.wheelSensitivity,r.motionBlurEnabled=options.motionBlur,r.forcedPixelRatio=number(options.pixelRatio)?options.pixelRatio:null,r.motionBlur=options.motionBlur,r.motionBlurOpacity=options.motionBlurOpacity,r.motionBlurTransparency=1-r.motionBlurOpacity,r.motionBlurPxRatio=1,r.mbPxRBlurry=1,r.minMbLowQualFrames=4,r.fullQualityMb=!1,r.clearedForMotionBlur=[],r.desktopTapThreshold=options.desktopTapThreshold,r.desktopTapThreshold2=options.desktopTapThreshold*options.desktopTapThreshold,r.touchTapThreshold=options.touchTapThreshold,r.touchTapThreshold2=options.touchTapThreshold*options.touchTapThreshold,r.tapholdDuration=500,r.bindings=[],r.beforeRenderCallbacks=[],r.beforeRenderPriorities={animations:400,eleCalcs:300,eleTxrDeq:200,lyrTxrDeq:150,lyrTxrSkip:100},r.registerNodeShapes(),r.registerArrowShapes(),r.registerCalculationListeners()},BRp$f.notify=function(eventName,eles){var r=this,cy=r.cy;this.destroyed||("init"!==eventName?"destroy"!==eventName?(("add"===eventName||"remove"===eventName||"move"===eventName&&cy.hasCompoundNodes()||"load"===eventName||"zorder"===eventName||"mount"===eventName)&&r.invalidateCachedZSortedEles(),"viewport"===eventName&&r.redrawHint("select",!0),"load"!==eventName&&"resize"!==eventName&&"mount"!==eventName||(r.invalidateContainerClientCoordsCache(),r.matchCanvasSize(r.container)),r.redrawHint("eles",!0),r.redrawHint("drag",!0),this.startRenderLoop(),this.redraw()):r.destroy():r.load())},BRp$f.destroy=function(){var r=this;r.destroyed=!0,r.cy.stopAnimationLoop();for(var i=0;i<r.bindings.length;i++){var b=r.bindings[i],tgt=b.target;(tgt.off||tgt.removeEventListener).apply(tgt,b.args)}if(r.bindings=[],r.beforeRenderCallbacks=[],r.onUpdateEleCalcsFns=[],r.removeObserver&&r.removeObserver.disconnect(),r.styleObserver&&r.styleObserver.disconnect(),r.resizeObserver&&r.resizeObserver.disconnect(),r.labelCalcDiv)try{document.body.removeChild(r.labelCalcDiv)}catch(e){}},BRp$f.isHeadless=function(){return!1},[BRp,BRp$a,BRp$b,BRp$c,BRp$d,BRp$e].forEach((function(props){extend(BRp$f,props)}));var defs_setupDequeueing=function setupDequeueing(opts){return function setupDequeueingImpl(){var self=this,r=this.renderer;if(!self.dequeueingSetup){self.dequeueingSetup=!0;var queueRedraw=util((function(){r.redrawHint("eles",!0),r.redrawHint("drag",!0),r.redraw()}),opts.deqRedrawThreshold),priority=opts.priority||noop;r.beforeRender((function dequeue(willDraw,frameStartTime){var startTime=performanceNow(),avgRenderTime=r.averageRedrawTime,renderTime=r.lastRedrawTime,deqd=[],extent=r.cy.extent(),pixelRatio=r.getPixelRatio();for(willDraw||r.flushRenderedStyleQueue();;){var now=performanceNow(),duration=now-startTime,frameDuration=now-frameStartTime;if(renderTime<16.666666666666668){var timeAvailable=16.666666666666668-(willDraw?avgRenderTime:0);if(frameDuration>=opts.deqFastCost*timeAvailable)break}else if(willDraw){if(duration>=opts.deqCost*renderTime||duration>=opts.deqAvgCost*avgRenderTime)break}else if(frameDuration>=16.666666666666668*opts.deqNoDrawCost)break;var thisDeqd=opts.deq(self,pixelRatio,extent);if(!(thisDeqd.length>0))break;for(var i=0;i<thisDeqd.length;i++)deqd.push(thisDeqd[i])}deqd.length>0&&(opts.onDeqd(self,deqd),!willDraw&&opts.shouldRedraw(self,deqd,pixelRatio,extent)&&queueRedraw())}),priority(self))}}},ElementTextureCacheLookup=function(){function ElementTextureCacheLookup(getKey){var doesEleInvalidateKey=arguments.length>1&&void 0!==arguments[1]?arguments[1]:falsify;_classCallCheck(this,ElementTextureCacheLookup),this.idsByKey=new Map$1,this.keyForId=new Map$1,this.cachesByLvl=new Map$1,this.lvls=[],this.getKey=getKey,this.doesEleInvalidateKey=doesEleInvalidateKey}return _createClass(ElementTextureCacheLookup,[{key:"getIdsFor",value:function getIdsFor(key){null==key&&error("Can not get id list for null key");var idsByKey=this.idsByKey,ids=this.idsByKey.get(key);return ids||(ids=new Set$1,idsByKey.set(key,ids)),ids}},{key:"addIdForKey",value:function addIdForKey(key,id){null!=key&&this.getIdsFor(key).add(id)}},{key:"deleteIdForKey",value:function deleteIdForKey(key,id){null!=key&&this.getIdsFor(key).delete(id)}},{key:"getNumberOfIdsForKey",value:function getNumberOfIdsForKey(key){return null==key?0:this.getIdsFor(key).size}},{key:"updateKeyMappingFor",value:function updateKeyMappingFor(ele){var id=ele.id(),prevKey=this.keyForId.get(id),currKey=this.getKey(ele);this.deleteIdForKey(prevKey,id),this.addIdForKey(currKey,id),this.keyForId.set(id,currKey)}},{key:"deleteKeyMappingFor",value:function deleteKeyMappingFor(ele){var id=ele.id(),prevKey=this.keyForId.get(id);this.deleteIdForKey(prevKey,id),this.keyForId.delete(id)}},{key:"keyHasChangedFor",value:function keyHasChangedFor(ele){var id=ele.id();return this.keyForId.get(id)!==this.getKey(ele)}},{key:"isInvalid",value:function isInvalid(ele){return this.keyHasChangedFor(ele)||this.doesEleInvalidateKey(ele)}},{key:"getCachesAt",value:function getCachesAt(lvl){var cachesByLvl=this.cachesByLvl,lvls=this.lvls,caches=cachesByLvl.get(lvl);return caches||(caches=new Map$1,cachesByLvl.set(lvl,caches),lvls.push(lvl)),caches}},{key:"getCache",value:function getCache(key,lvl){return this.getCachesAt(lvl).get(key)}},{key:"get",value:function get(ele,lvl){var key=this.getKey(ele),cache=this.getCache(key,lvl);return null!=cache&&this.updateKeyMappingFor(ele),cache}},{key:"getForCachedKey",value:function getForCachedKey(ele,lvl){var key=this.keyForId.get(ele.id());return this.getCache(key,lvl)}},{key:"hasCache",value:function hasCache(key,lvl){return this.getCachesAt(lvl).has(key)}},{key:"has",value:function has(ele,lvl){var key=this.getKey(ele);return this.hasCache(key,lvl)}},{key:"setCache",value:function setCache(key,lvl,cache){cache.key=key,this.getCachesAt(lvl).set(key,cache)}},{key:"set",value:function set(ele,lvl,cache){var key=this.getKey(ele);this.setCache(key,lvl,cache),this.updateKeyMappingFor(ele)}},{key:"deleteCache",value:function deleteCache(key,lvl){this.getCachesAt(lvl).delete(key)}},{key:"delete",value:function _delete(ele,lvl){var key=this.getKey(ele);this.deleteCache(key,lvl)}},{key:"invalidateKey",value:function invalidateKey(key){var _this=this;this.lvls.forEach((function(lvl){return _this.deleteCache(key,lvl)}))}},{key:"invalidate",value:function invalidate(ele){var id=ele.id(),key=this.keyForId.get(id);this.deleteKeyMappingFor(ele);var entireKeyInvalidated=this.doesEleInvalidateKey(ele);return entireKeyInvalidated&&this.invalidateKey(key),entireKeyInvalidated||0===this.getNumberOfIdsForKey(key)}}]),ElementTextureCacheLookup}(),getTxrReasons={dequeue:"dequeue",downscale:"downscale",highQuality:"highQuality"},initDefaults=defaults({getKey:null,doesEleInvalidateKey:falsify,drawElement:null,getBoundingBox:null,getRotationPoint:null,getRotationOffset:null,isVisible:trueify,allowEdgeTxrCaching:!0,allowParentTxrCaching:!0}),ElementTextureCache=function ElementTextureCache(renderer,initOptions){this.renderer=renderer,this.onDequeues=[];var opts=initDefaults(initOptions);extend(this,opts),this.lookup=new ElementTextureCacheLookup(opts.getKey,opts.doesEleInvalidateKey),this.setupDequeueing()},ETCp=ElementTextureCache.prototype;ETCp.reasons=getTxrReasons,ETCp.getTextureQueue=function(txrH){return this.eleImgCaches=this.eleImgCaches||{},this.eleImgCaches[txrH]=this.eleImgCaches[txrH]||[]},ETCp.getRetiredTextureQueue=function(txrH){var rtxtrQs=this.eleImgCaches.retired=this.eleImgCaches.retired||{};return rtxtrQs[txrH]=rtxtrQs[txrH]||[]},ETCp.getElementQueue=function(){return this.eleCacheQueue=this.eleCacheQueue||new Heap((function(a,b){return b.reqs-a.reqs}))},ETCp.getElementKeyToQueue=function(){return this.eleKeyToCacheQueue=this.eleKeyToCacheQueue||{}},ETCp.getElement=function(ele,bb,pxRatio,lvl,reason){var self=this,r=this.renderer,zoom=r.cy.zoom(),lookup=this.lookup;if(!bb||0===bb.w||0===bb.h||isNaN(bb.w)||isNaN(bb.h)||!ele.visible()||ele.removed())return null;if(!self.allowEdgeTxrCaching&&ele.isEdge()||!self.allowParentTxrCaching&&ele.isParent())return null;if(null==lvl&&(lvl=Math.ceil(log2(zoom*pxRatio))),lvl<-4)lvl=-4;else if(zoom>=7.99||lvl>3)return null;var scale=Math.pow(2,lvl),eleScaledH=bb.h*scale,eleScaledW=bb.w*scale,scaledLabelShown=r.eleTextBiggerThanMin(ele,scale);if(!this.isVisible(ele,scaledLabelShown))return null;var txrH,eleCache=lookup.get(ele,lvl);if(eleCache&&eleCache.invalidated&&(eleCache.invalidated=!1,eleCache.texture.invalidatedWidth-=eleCache.width),eleCache)return eleCache;if(txrH=eleScaledH<=25?25:eleScaledH<=50?50:50*Math.ceil(eleScaledH/50),eleScaledH>1024||eleScaledW>1024)return null;var txrQ=self.getTextureQueue(txrH),txr=txrQ[txrQ.length-2],addNewTxr=function addNewTxr(){return self.recycleTexture(txrH,eleScaledW)||self.addTexture(txrH,eleScaledW)};txr||(txr=txrQ[txrQ.length-1]),txr||(txr=addNewTxr()),txr.width-txr.usedWidth<eleScaledW&&(txr=addNewTxr());for(var higherCache,scalableFrom=function scalableFrom(otherCache){return otherCache&&otherCache.scaledLabelShown===scaledLabelShown},deqing=reason&&reason===getTxrReasons.dequeue,highQualityReq=reason&&reason===getTxrReasons.highQuality,downscaleReq=reason&&reason===getTxrReasons.downscale,l=lvl+1;l<=3;l++){var c=lookup.get(ele,l);if(c){higherCache=c;break}}var oneUpCache=higherCache&&higherCache.level===lvl+1?higherCache:null,downscale=function downscale(){txr.context.drawImage(oneUpCache.texture.canvas,oneUpCache.x,0,oneUpCache.width,oneUpCache.height,txr.usedWidth,0,eleScaledW,eleScaledH)};if(txr.context.setTransform(1,0,0,1,0,0),txr.context.clearRect(txr.usedWidth,0,eleScaledW,txrH),scalableFrom(oneUpCache))downscale();else if(scalableFrom(higherCache)){if(!highQualityReq)return self.queueElement(ele,higherCache.level-1),higherCache;for(var _l=higherCache.level;_l>lvl;_l--)oneUpCache=self.getElement(ele,bb,pxRatio,_l,getTxrReasons.downscale);downscale()}else{var lowerCache;if(!deqing&&!highQualityReq&&!downscaleReq)for(var _l2=lvl-1;_l2>=-4;_l2--){var _c=lookup.get(ele,_l2);if(_c){lowerCache=_c;break}}if(scalableFrom(lowerCache))return self.queueElement(ele,lvl),lowerCache;txr.context.translate(txr.usedWidth,0),txr.context.scale(scale,scale),this.drawElement(txr.context,ele,bb,scaledLabelShown,!1),txr.context.scale(1/scale,1/scale),txr.context.translate(-txr.usedWidth,0)}return eleCache={x:txr.usedWidth,texture:txr,level:lvl,scale:scale,width:eleScaledW,height:eleScaledH,scaledLabelShown:scaledLabelShown},txr.usedWidth+=Math.ceil(eleScaledW+8),txr.eleCaches.push(eleCache),lookup.set(ele,lvl,eleCache),self.checkTextureFullness(txr),eleCache},ETCp.invalidateElements=function(eles){for(var i=0;i<eles.length;i++)this.invalidateElement(eles[i])},ETCp.invalidateElement=function(ele){var lookup=this.lookup,caches=[];if(lookup.isInvalid(ele)){for(var lvl=-4;lvl<=3;lvl++){var cache=lookup.getForCachedKey(ele,lvl);cache&&caches.push(cache)}if(lookup.invalidate(ele))for(var i=0;i<caches.length;i++){var _cache=caches[i],txr=_cache.texture;txr.invalidatedWidth+=_cache.width,_cache.invalidated=!0,this.checkTextureUtility(txr)}this.removeFromQueue(ele)}},ETCp.checkTextureUtility=function(txr){txr.invalidatedWidth>=.2*txr.width&&this.retireTexture(txr)},ETCp.checkTextureFullness=function(txr){var txrQ=this.getTextureQueue(txr.height);txr.usedWidth/txr.width>.8&&txr.fullnessChecks>=10?removeFromArray(txrQ,txr):txr.fullnessChecks++},ETCp.retireTexture=function(txr){var txrH=txr.height,txrQ=this.getTextureQueue(txrH),lookup=this.lookup;removeFromArray(txrQ,txr),txr.retired=!0;for(var eleCaches=txr.eleCaches,i=0;i<eleCaches.length;i++){var eleCache=eleCaches[i];lookup.deleteCache(eleCache.key,eleCache.level)}clearArray(eleCaches),this.getRetiredTextureQueue(txrH).push(txr)},ETCp.addTexture=function(txrH,minW){var txr={};return this.getTextureQueue(txrH).push(txr),txr.eleCaches=[],txr.height=txrH,txr.width=Math.max(1024,minW),txr.usedWidth=0,txr.invalidatedWidth=0,txr.fullnessChecks=0,txr.canvas=this.renderer.makeOffscreenCanvas(txr.width,txr.height),txr.context=txr.canvas.getContext("2d"),txr},ETCp.recycleTexture=function(txrH,minW){for(var txrQ=this.getTextureQueue(txrH),rtxtrQ=this.getRetiredTextureQueue(txrH),i=0;i<rtxtrQ.length;i++){var txr=rtxtrQ[i];if(txr.width>=minW)return txr.retired=!1,txr.usedWidth=0,txr.invalidatedWidth=0,txr.fullnessChecks=0,clearArray(txr.eleCaches),txr.context.setTransform(1,0,0,1,0,0),txr.context.clearRect(0,0,txr.width,txr.height),removeFromArray(rtxtrQ,txr),txrQ.push(txr),txr}},ETCp.queueElement=function(ele,lvl){var q=this.getElementQueue(),k2q=this.getElementKeyToQueue(),key=this.getKey(ele),existingReq=k2q[key];if(existingReq)existingReq.level=Math.max(existingReq.level,lvl),existingReq.eles.merge(ele),existingReq.reqs++,q.updateItem(existingReq);else{var req={eles:ele.spawn().merge(ele),level:lvl,reqs:1,key:key};q.push(req),k2q[key]=req}},ETCp.dequeue=function(pxRatio){for(var q=this.getElementQueue(),k2q=this.getElementKeyToQueue(),dequeued=[],lookup=this.lookup,i=0;i<1&&q.size()>0;i++){var req=q.pop(),key=req.key,ele=req.eles[0],cacheExists=lookup.hasCache(ele,req.level);if(k2q[key]=null,!cacheExists){dequeued.push(req);var bb=this.getBoundingBox(ele);this.getElement(ele,bb,pxRatio,req.level,getTxrReasons.dequeue)}}return dequeued},ETCp.removeFromQueue=function(ele){var q=this.getElementQueue(),k2q=this.getElementKeyToQueue(),key=this.getKey(ele),req=k2q[key];null!=req&&(1===req.eles.length?(req.reqs=MAX_INT,q.updateItem(req),q.pop(),k2q[key]=null):req.eles.unmerge(ele))},ETCp.onDequeue=function(fn){this.onDequeues.push(fn)},ETCp.offDequeue=function(fn){removeFromArray(this.onDequeues,fn)},ETCp.setupDequeueing=defs_setupDequeueing({deqRedrawThreshold:100,deqCost:.15,deqAvgCost:.1,deqNoDrawCost:.9,deqFastCost:.9,deq:function deq(self,pxRatio,extent){return self.dequeue(pxRatio,extent)},onDeqd:function onDeqd(self,deqd){for(var i=0;i<self.onDequeues.length;i++){(0,self.onDequeues[i])(deqd)}},shouldRedraw:function shouldRedraw(self,deqd,pxRatio,extent){for(var i=0;i<deqd.length;i++)for(var eles=deqd[i].eles,j=0;j<eles.length;j++){var bb=eles[j].boundingBox();if(boundingBoxesIntersect(bb,extent))return!0}return!1},priority:function priority(self){return self.renderer.beforeRenderPriorities.eleTxrDeq}});var LayeredTextureCache=function LayeredTextureCache(renderer){var self=this,r=self.renderer=renderer,cy=r.cy;self.layersByLevel={},self.firstGet=!0,self.lastInvalidationTime=performanceNow()-500,self.skipping=!1,self.eleTxrDeqs=cy.collection(),self.scheduleElementRefinement=util((function(){self.refineElementTextures(self.eleTxrDeqs),self.eleTxrDeqs.unmerge(self.eleTxrDeqs)}),50),r.beforeRender((function(willDraw,now){now-self.lastInvalidationTime<=250?self.skipping=!0:self.skipping=!1}),r.beforeRenderPriorities.lyrTxrSkip);self.layersQueue=new Heap((function qSort(a,b){return b.reqs-a.reqs})),self.setupDequeueing()},LTCp=LayeredTextureCache.prototype,layerIdPool=0,MAX_INT$1=Math.pow(2,53)-1;LTCp.makeLayer=function(bb,lvl){var scale=Math.pow(2,lvl),w=Math.ceil(bb.w*scale),h=Math.ceil(bb.h*scale),canvas=this.renderer.makeOffscreenCanvas(w,h),layer={id:layerIdPool=++layerIdPool%MAX_INT$1,bb:bb,level:lvl,width:w,height:h,canvas:canvas,context:canvas.getContext("2d"),eles:[],elesQueue:[],reqs:0},cxt=layer.context,dx=-layer.bb.x1,dy=-layer.bb.y1;return cxt.scale(scale,scale),cxt.translate(dx,dy),layer},LTCp.getLayers=function(eles,pxRatio,lvl){var self=this,zoom=self.renderer.cy.zoom(),firstGet=self.firstGet;if(self.firstGet=!1,null==lvl)if((lvl=Math.ceil(log2(zoom*pxRatio)))<-4)lvl=-4;else if(zoom>=3.99||lvl>2)return null;self.validateLayersElesOrdering(lvl,eles);var bb,tmpLayers,layersByLvl=self.layersByLevel,scale=Math.pow(2,lvl),layers=layersByLvl[lvl]=layersByLvl[lvl]||[];if(self.levelIsComplete(lvl,eles))return layers;!function checkTempLevels(){var canUseAsTmpLvl=function canUseAsTmpLvl(l){if(self.validateLayersElesOrdering(l,eles),self.levelIsComplete(l,eles))return tmpLayers=layersByLvl[l],!0},checkLvls=function checkLvls(dir){if(!tmpLayers)for(var l=lvl+dir;-4<=l&&l<=2&&!canUseAsTmpLvl(l);l+=dir);};checkLvls(1),checkLvls(-1);for(var i=layers.length-1;i>=0;i--){var layer=layers[i];layer.invalid&&removeFromArray(layers,layer)}}();var makeLayer=function makeLayer(opts){var after=(opts=opts||{}).after;if(function getBb(){if(!bb){bb=makeBoundingBox();for(var i=0;i<eles.length;i++)updateBoundingBox(bb,eles[i].boundingBox())}}(),bb.w*scale*(bb.h*scale)>16e6)return null;var layer=self.makeLayer(bb,lvl);if(null!=after){var index=layers.indexOf(after)+1;layers.splice(index,0,layer)}else(void 0===opts.insert||opts.insert)&&layers.unshift(layer);return layer};if(self.skipping&&!firstGet)return null;for(var layer=null,maxElesPerLayer=eles.length/1,allowLazyQueueing=!firstGet,i=0;i<eles.length;i++){var ele=eles[i],rs=ele._private.rscratch,caches=rs.imgLayerCaches=rs.imgLayerCaches||{},existingLayer=caches[lvl];if(existingLayer)layer=existingLayer;else{if((!layer||layer.eles.length>=maxElesPerLayer||!boundingBoxInBoundingBox(layer.bb,ele.boundingBox()))&&!(layer=makeLayer({insert:!0,after:layer})))return null;tmpLayers||allowLazyQueueing?self.queueLayer(layer,ele):self.drawEleInLayer(layer,ele,lvl,pxRatio),layer.eles.push(ele),caches[lvl]=layer}}return tmpLayers||(allowLazyQueueing?null:layers)},LTCp.getEleLevelForLayerLevel=function(lvl,pxRatio){return lvl},LTCp.drawEleInLayer=function(layer,ele,lvl,pxRatio){var r=this.renderer,context=layer.context,bb=ele.boundingBox();0!==bb.w&&0!==bb.h&&ele.visible()&&(lvl=this.getEleLevelForLayerLevel(lvl,pxRatio),r.setImgSmoothing(context,!1),r.drawCachedElement(context,ele,null,null,lvl,true),r.setImgSmoothing(context,!0))},LTCp.levelIsComplete=function(lvl,eles){var layers=this.layersByLevel[lvl];if(!layers||0===layers.length)return!1;for(var numElesInLayers=0,i=0;i<layers.length;i++){var layer=layers[i];if(layer.reqs>0)return!1;if(layer.invalid)return!1;numElesInLayers+=layer.eles.length}return numElesInLayers===eles.length},LTCp.validateLayersElesOrdering=function(lvl,eles){var layers=this.layersByLevel[lvl];if(layers)for(var i=0;i<layers.length;i++){for(var layer=layers[i],offset=-1,j=0;j<eles.length;j++)if(layer.eles[0]===eles[j]){offset=j;break}if(offset<0)this.invalidateLayer(layer);else{var o=offset;for(j=0;j<layer.eles.length;j++)if(layer.eles[j]!==eles[o+j]){this.invalidateLayer(layer);break}}}},LTCp.updateElementsInLayers=function(eles,update){for(var isEles=element(eles[0]),i=0;i<eles.length;i++)for(var req=isEles?null:eles[i],ele=isEles?eles[i]:eles[i].ele,rs=ele._private.rscratch,caches=rs.imgLayerCaches=rs.imgLayerCaches||{},l=-4;l<=2;l++){var layer=caches[l];layer&&(req&&this.getEleLevelForLayerLevel(layer.level)!==req.level||update(layer,ele,req))}},LTCp.haveLayers=function(){for(var haveLayers=!1,l=-4;l<=2;l++){var layers=this.layersByLevel[l];if(layers&&layers.length>0){haveLayers=!0;break}}return haveLayers},LTCp.invalidateElements=function(eles){var self=this;0!==eles.length&&(self.lastInvalidationTime=performanceNow(),0!==eles.length&&self.haveLayers()&&self.updateElementsInLayers(eles,(function invalAssocLayers(layer,ele,req){self.invalidateLayer(layer)})))},LTCp.invalidateLayer=function(layer){if(this.lastInvalidationTime=performanceNow(),!layer.invalid){var lvl=layer.level,eles=layer.eles,layers=this.layersByLevel[lvl];removeFromArray(layers,layer),layer.elesQueue=[],layer.invalid=!0,layer.replacement&&(layer.replacement.invalid=!0);for(var i=0;i<eles.length;i++){var caches=eles[i]._private.rscratch.imgLayerCaches;caches&&(caches[lvl]=null)}}},LTCp.refineElementTextures=function(eles){var self=this;self.updateElementsInLayers(eles,(function refineEachEle(layer,ele,req){var rLyr=layer.replacement;if(rLyr||((rLyr=layer.replacement=self.makeLayer(layer.bb,layer.level)).replaces=layer,rLyr.eles=layer.eles),!rLyr.reqs)for(var i=0;i<rLyr.eles.length;i++)self.queueLayer(rLyr,rLyr.eles[i])}))},LTCp.enqueueElementRefinement=function(ele){this.eleTxrDeqs.merge(ele),this.scheduleElementRefinement()},LTCp.queueLayer=function(layer,ele){var q=this.layersQueue,elesQ=layer.elesQueue,hasId=elesQ.hasId=elesQ.hasId||{};if(!layer.replacement){if(ele){if(hasId[ele.id()])return;elesQ.push(ele),hasId[ele.id()]=!0}layer.reqs?(layer.reqs++,q.updateItem(layer)):(layer.reqs=1,q.push(layer))}},LTCp.dequeue=function(pxRatio){for(var q=this.layersQueue,deqd=[],eleDeqs=0;eleDeqs<1&&0!==q.size();){var layer=q.peek();if(layer.replacement)q.pop();else if(layer.replaces&&layer!==layer.replaces.replacement)q.pop();else if(layer.invalid)q.pop();else{var ele=layer.elesQueue.shift();ele&&(this.drawEleInLayer(layer,ele,layer.level,pxRatio),eleDeqs++),0===deqd.length&&deqd.push(!0),0===layer.elesQueue.length&&(q.pop(),layer.reqs=0,layer.replaces&&this.applyLayerReplacement(layer),this.requestRedraw())}}return deqd},LTCp.applyLayerReplacement=function(layer){var layersInLevel=this.layersByLevel[layer.level],replaced=layer.replaces,index=layersInLevel.indexOf(replaced);if(!(index<0||replaced.invalid)){layersInLevel[index]=layer;for(var i=0;i<layer.eles.length;i++){var _p=layer.eles[i]._private,cache=_p.imgLayerCaches=_p.imgLayerCaches||{};cache&&(cache[layer.level]=layer)}this.requestRedraw()}},LTCp.requestRedraw=util((function(){var r=this.renderer;r.redrawHint("eles",!0),r.redrawHint("drag",!0),r.redraw()}),100),LTCp.setupDequeueing=defs_setupDequeueing({deqRedrawThreshold:50,deqCost:.15,deqAvgCost:.1,deqNoDrawCost:.9,deqFastCost:.9,deq:function deq(self,pxRatio){return self.dequeue(pxRatio)},onDeqd:noop,shouldRedraw:trueify,priority:function priority(self){return self.renderer.beforeRenderPriorities.lyrTxrDeq}});var impl,CRp={};function polygon(context,points){for(var i=0;i<points.length;i++){var pt=points[i];context.lineTo(pt.x,pt.y)}}function triangleBackcurve(context,points,controlPoint){for(var firstPt,i=0;i<points.length;i++){var pt=points[i];0===i&&(firstPt=pt),context.lineTo(pt.x,pt.y)}context.quadraticCurveTo(controlPoint.x,controlPoint.y,firstPt.x,firstPt.y)}function triangleTee(context,trianglePoints,teePoints){context.beginPath&&context.beginPath();for(var triPts=trianglePoints,i=0;i<triPts.length;i++){var pt=triPts[i];context.lineTo(pt.x,pt.y)}var teePts=teePoints,firstTeePt=teePoints[0];context.moveTo(firstTeePt.x,firstTeePt.y);for(i=1;i<teePts.length;i++){pt=teePts[i];context.lineTo(pt.x,pt.y)}context.closePath&&context.closePath()}function circleTriangle(context,trianglePoints,rx,ry,r){context.beginPath&&context.beginPath(),context.arc(rx,ry,r,0,2*Math.PI,!1);var triPts=trianglePoints,firstTrPt=triPts[0];context.moveTo(firstTrPt.x,firstTrPt.y);for(var i=0;i<triPts.length;i++){var pt=triPts[i];context.lineTo(pt.x,pt.y)}context.closePath&&context.closePath()}function circle(context,rx,ry,r){context.arc(rx,ry,r,0,2*Math.PI,!1)}CRp.arrowShapeImpl=function(name){return(impl||(impl={polygon:polygon,"triangle-backcurve":triangleBackcurve,"triangle-tee":triangleTee,"circle-triangle":circleTriangle,"triangle-cross":triangleTee,circle:circle}))[name]};var CRp$1={drawElement:function(context,ele,shiftToOriginWithBb,showLabel,showOverlay,showOpacity){ele.isNode()?this.drawNode(context,ele,shiftToOriginWithBb,showLabel,showOverlay,showOpacity):this.drawEdge(context,ele,shiftToOriginWithBb,showLabel,showOverlay,showOpacity)},drawElementOverlay:function(context,ele){ele.isNode()?this.drawNodeOverlay(context,ele):this.drawEdgeOverlay(context,ele)},drawElementUnderlay:function(context,ele){ele.isNode()?this.drawNodeUnderlay(context,ele):this.drawEdgeUnderlay(context,ele)},drawCachedElementPortion:function(context,ele,eleTxrCache,pxRatio,lvl,reason,getRotation,getOpacity){var r=this,bb=eleTxrCache.getBoundingBox(ele);if(0!==bb.w&&0!==bb.h){var eleCache=eleTxrCache.getElement(ele,bb,pxRatio,lvl,reason);if(null!=eleCache){var opacity=getOpacity(r,ele);if(0===opacity)return;var x,y,sx,sy,smooth,oldGlobalAlpha,theta=getRotation(r,ele),x1=bb.x1,y1=bb.y1,w=bb.w,h=bb.h;if(0!==theta){var rotPt=eleTxrCache.getRotationPoint(ele);sx=rotPt.x,sy=rotPt.y,context.translate(sx,sy),context.rotate(theta),(smooth=r.getImgSmoothing(context))||r.setImgSmoothing(context,!0);var off=eleTxrCache.getRotationOffset(ele);x=off.x,y=off.y}else x=x1,y=y1;1!==opacity&&(oldGlobalAlpha=context.globalAlpha,context.globalAlpha=oldGlobalAlpha*opacity),context.drawImage(eleCache.texture.canvas,eleCache.x,0,eleCache.width,eleCache.height,x,y,w,h),1!==opacity&&(context.globalAlpha=oldGlobalAlpha),0!==theta&&(context.rotate(-theta),context.translate(-sx,-sy),smooth||r.setImgSmoothing(context,!1))}else eleTxrCache.drawElement(context,ele)}}},getZeroRotation=function getZeroRotation(){return 0},getLabelRotation=function getLabelRotation(r,ele){return r.getTextAngle(ele,null)},getSourceLabelRotation=function getSourceLabelRotation(r,ele){return r.getTextAngle(ele,"source")},getTargetLabelRotation=function getTargetLabelRotation(r,ele){return r.getTextAngle(ele,"target")},getOpacity=function getOpacity(r,ele){return ele.effectiveOpacity()},getTextOpacity=function getTextOpacity(e,ele){return ele.pstyle("text-opacity").pfValue*ele.effectiveOpacity()};CRp$1.drawCachedElement=function(context,ele,pxRatio,extent,lvl,requestHighQuality){var r=this,_r$data=r.data,eleTxrCache=_r$data.eleTxrCache,lblTxrCache=_r$data.lblTxrCache,slbTxrCache=_r$data.slbTxrCache,tlbTxrCache=_r$data.tlbTxrCache,bb=ele.boundingBox(),reason=!0===requestHighQuality?eleTxrCache.reasons.highQuality:null;if(0!==bb.w&&0!==bb.h&&ele.visible()&&(!extent||boundingBoxesIntersect(bb,extent))){var isEdge=ele.isEdge(),badLine=ele.element()._private.rscratch.badLine;r.drawElementUnderlay(context,ele),r.drawCachedElementPortion(context,ele,eleTxrCache,pxRatio,lvl,reason,getZeroRotation,getOpacity),isEdge&&badLine||r.drawCachedElementPortion(context,ele,lblTxrCache,pxRatio,lvl,reason,getLabelRotation,getTextOpacity),isEdge&&!badLine&&(r.drawCachedElementPortion(context,ele,slbTxrCache,pxRatio,lvl,reason,getSourceLabelRotation,getTextOpacity),r.drawCachedElementPortion(context,ele,tlbTxrCache,pxRatio,lvl,reason,getTargetLabelRotation,getTextOpacity)),r.drawElementOverlay(context,ele)}},CRp$1.drawElements=function(context,eles){for(var i=0;i<eles.length;i++){var ele=eles[i];this.drawElement(context,ele)}},CRp$1.drawCachedElements=function(context,eles,pxRatio,extent){for(var i=0;i<eles.length;i++){var ele=eles[i];this.drawCachedElement(context,ele,pxRatio,extent)}},CRp$1.drawCachedNodes=function(context,eles,pxRatio,extent){for(var i=0;i<eles.length;i++){var ele=eles[i];ele.isNode()&&this.drawCachedElement(context,ele,pxRatio,extent)}},CRp$1.drawLayeredElements=function(context,eles,pxRatio,extent){var layers=this.data.lyrTxrCache.getLayers(eles,pxRatio);if(layers)for(var i=0;i<layers.length;i++){var layer=layers[i],bb=layer.bb;0!==bb.w&&0!==bb.h&&context.drawImage(layer.canvas,bb.x1,bb.y1,bb.w,bb.h)}else this.drawCachedElements(context,eles,pxRatio,extent)};var CRp$2={drawEdge:function(context,edge,shiftToOriginWithBb){var drawLabel=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],shouldDrawOverlay=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],shouldDrawOpacity=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],r=this,rs=edge._private.rscratch;if((!shouldDrawOpacity||edge.visible())&&!rs.badLine&&null!=rs.allpts&&!isNaN(rs.allpts[0])){var bb;shiftToOriginWithBb&&(bb=shiftToOriginWithBb,context.translate(-bb.x1,-bb.y1));var opacity=shouldDrawOpacity?edge.pstyle("opacity").value:1,lineOpacity=shouldDrawOpacity?edge.pstyle("line-opacity").value:1,curveStyle=edge.pstyle("curve-style").value,lineStyle=edge.pstyle("line-style").value,edgeWidth=edge.pstyle("width").pfValue,lineCap=edge.pstyle("line-cap").value,effectiveLineOpacity=opacity*lineOpacity,effectiveArrowOpacity=opacity*lineOpacity,drawLine=function drawLine(){var strokeOpacity=arguments.length>0&&void 0!==arguments[0]?arguments[0]:effectiveLineOpacity;"straight-triangle"===curveStyle?(r.eleStrokeStyle(context,edge,strokeOpacity),r.drawEdgeTrianglePath(edge,context,rs.allpts)):(context.lineWidth=edgeWidth,context.lineCap=lineCap,r.eleStrokeStyle(context,edge,strokeOpacity),r.drawEdgePath(edge,context,rs.allpts,lineStyle),context.lineCap="butt")},drawOverlay=function drawOverlay(){shouldDrawOverlay&&r.drawEdgeOverlay(context,edge)},drawUnderlay=function drawUnderlay(){shouldDrawOverlay&&r.drawEdgeUnderlay(context,edge)},drawArrows=function drawArrows(){var arrowOpacity=arguments.length>0&&void 0!==arguments[0]?arguments[0]:effectiveArrowOpacity;r.drawArrowheads(context,edge,arrowOpacity)},drawText=function drawText(){r.drawElementText(context,edge,null,drawLabel)};context.lineJoin="round";var ghost="yes"===edge.pstyle("ghost").value;if(ghost){var gx=edge.pstyle("ghost-offset-x").pfValue,gy=edge.pstyle("ghost-offset-y").pfValue,ghostOpacity=edge.pstyle("ghost-opacity").value,effectiveGhostOpacity=effectiveLineOpacity*ghostOpacity;context.translate(gx,gy),drawLine(effectiveGhostOpacity),drawArrows(effectiveGhostOpacity),context.translate(-gx,-gy)}drawUnderlay(),drawLine(),drawArrows(),drawOverlay(),drawText(),shiftToOriginWithBb&&context.translate(bb.x1,bb.y1)}}},drawEdgeOverlayUnderlay=function drawEdgeOverlayUnderlay(overlayOrUnderlay){if(!["overlay","underlay"].includes(overlayOrUnderlay))throw new Error("Invalid state");return function(context,edge){if(edge.visible()){var opacity=edge.pstyle("".concat(overlayOrUnderlay,"-opacity")).value;if(0!==opacity){var r=this,usePaths=r.usePaths(),rs=edge._private.rscratch,width=2*edge.pstyle("".concat(overlayOrUnderlay,"-padding")).pfValue,color=edge.pstyle("".concat(overlayOrUnderlay,"-color")).value;context.lineWidth=width,"self"!==rs.edgeType||usePaths?context.lineCap="round":context.lineCap="butt",r.colorStrokeStyle(context,color[0],color[1],color[2],opacity),r.drawEdgePath(edge,context,rs.allpts,"solid")}}}};CRp$2.drawEdgeOverlay=drawEdgeOverlayUnderlay("overlay"),CRp$2.drawEdgeUnderlay=drawEdgeOverlayUnderlay("underlay"),CRp$2.drawEdgePath=function(edge,context,pts,type){var path,rs=edge._private.rscratch,canvasCxt=context,pathCacheHit=!1,usePaths=this.usePaths(),lineDashPattern=edge.pstyle("line-dash-pattern").pfValue,lineDashOffset=edge.pstyle("line-dash-offset").pfValue;if(usePaths){var pathCacheKey=pts.join("$");rs.pathCacheKey&&rs.pathCacheKey===pathCacheKey?(path=context=rs.pathCache,pathCacheHit=!0):(path=context=new Path2D,rs.pathCacheKey=pathCacheKey,rs.pathCache=path)}if(canvasCxt.setLineDash)switch(type){case"dotted":canvasCxt.setLineDash([1,1]);break;case"dashed":canvasCxt.setLineDash(lineDashPattern),canvasCxt.lineDashOffset=lineDashOffset;break;case"solid":canvasCxt.setLineDash([])}if(!pathCacheHit&&!rs.badLine)switch(context.beginPath&&context.beginPath(),context.moveTo(pts[0],pts[1]),rs.edgeType){case"bezier":case"self":case"compound":case"multibezier":for(var i=2;i+3<pts.length;i+=4)context.quadraticCurveTo(pts[i],pts[i+1],pts[i+2],pts[i+3]);break;case"straight":case"segments":case"haystack":for(var _i=2;_i+1<pts.length;_i+=2)context.lineTo(pts[_i],pts[_i+1])}context=canvasCxt,usePaths?context.stroke(path):context.stroke(),context.setLineDash&&context.setLineDash([])},CRp$2.drawEdgeTrianglePath=function(edge,context,pts){context.fillStyle=context.strokeStyle;for(var edgeWidth=edge.pstyle("width").pfValue,i=0;i+1<pts.length;i+=2){var vector=[pts[i+2]-pts[i],pts[i+3]-pts[i+1]],length=Math.sqrt(vector[0]*vector[0]+vector[1]*vector[1]),normal=[vector[1]/length,-vector[0]/length],triangleHead=[normal[0]*edgeWidth/2,normal[1]*edgeWidth/2];context.beginPath(),context.moveTo(pts[i]-triangleHead[0],pts[i+1]-triangleHead[1]),context.lineTo(pts[i]+triangleHead[0],pts[i+1]+triangleHead[1]),context.lineTo(pts[i+2],pts[i+3]),context.closePath(),context.fill()}},CRp$2.drawArrowheads=function(context,edge,opacity){var rs=edge._private.rscratch,isHaystack="haystack"===rs.edgeType;isHaystack||this.drawArrowhead(context,edge,"source",rs.arrowStartX,rs.arrowStartY,rs.srcArrowAngle,opacity),this.drawArrowhead(context,edge,"mid-target",rs.midX,rs.midY,rs.midtgtArrowAngle,opacity),this.drawArrowhead(context,edge,"mid-source",rs.midX,rs.midY,rs.midsrcArrowAngle,opacity),isHaystack||this.drawArrowhead(context,edge,"target",rs.arrowEndX,rs.arrowEndY,rs.tgtArrowAngle,opacity)},CRp$2.drawArrowhead=function(context,edge,prefix,x,y,angle,opacity){if(!(isNaN(x)||null==x||isNaN(y)||null==y||isNaN(angle)||null==angle)){var arrowShape=edge.pstyle(prefix+"-arrow-shape").value;if("none"!==arrowShape){var arrowClearFill="hollow"===edge.pstyle(prefix+"-arrow-fill").value?"both":"filled",arrowFill=edge.pstyle(prefix+"-arrow-fill").value,edgeWidth=edge.pstyle("width").pfValue,edgeOpacity=edge.pstyle("opacity").value;void 0===opacity&&(opacity=edgeOpacity);var gco=context.globalCompositeOperation;1===opacity&&"hollow"!==arrowFill||(context.globalCompositeOperation="destination-out",this.colorFillStyle(context,255,255,255,1),this.colorStrokeStyle(context,255,255,255,1),this.drawArrowShape(edge,context,arrowClearFill,edgeWidth,arrowShape,x,y,angle),context.globalCompositeOperation=gco);var color=edge.pstyle(prefix+"-arrow-color").value;this.colorFillStyle(context,color[0],color[1],color[2],opacity),this.colorStrokeStyle(context,color[0],color[1],color[2],opacity),this.drawArrowShape(edge,context,arrowFill,edgeWidth,arrowShape,x,y,angle)}}},CRp$2.drawArrowShape=function(edge,context,fill,edgeWidth,shape,x,y,angle){var path,r=this,usePaths=this.usePaths()&&"triangle-cross"!==shape,pathCacheHit=!1,canvasContext=context,translation={x:x,y:y},scale=edge.pstyle("arrow-scale").value,size=this.getArrowWidth(edgeWidth,scale),shapeImpl=r.arrowShapes[shape];if(usePaths){var cache=r.arrowPathCache=r.arrowPathCache||[],key=hashString(shape),cachedPath=cache[key];null!=cachedPath?(path=context=cachedPath,pathCacheHit=!0):(path=context=new Path2D,cache[key]=path)}pathCacheHit||(context.beginPath&&context.beginPath(),usePaths?shapeImpl.draw(context,1,0,{x:0,y:0},1):shapeImpl.draw(context,size,angle,translation,edgeWidth),context.closePath&&context.closePath()),context=canvasContext,usePaths&&(context.translate(x,y),context.rotate(angle),context.scale(size,size)),"filled"!==fill&&"both"!==fill||(usePaths?context.fill(path):context.fill()),"hollow"!==fill&&"both"!==fill||(context.lineWidth=(shapeImpl.matchEdgeWidth?edgeWidth:1)/(usePaths?size:1),context.lineJoin="miter",usePaths?context.stroke(path):context.stroke()),usePaths&&(context.scale(1/size,1/size),context.rotate(-angle),context.translate(-x,-y))};var CRp$3={safeDrawImage:function(context,img,ix,iy,iw,ih,x,y,w,h){iw<=0||ih<=0||w<=0||h<=0||context.drawImage(img,ix,iy,iw,ih,x,y,w,h)},drawInscribedImage:function(context,img,node,index,nodeOpacity){var r=this,pos=node.position(),nodeX=pos.x,nodeY=pos.y,styleObj=node.cy().style(),getIndexedStyle=styleObj.getIndexedStyle.bind(styleObj),fit=getIndexedStyle(node,"background-fit","value",index),repeat=getIndexedStyle(node,"background-repeat","value",index),nodeW=node.width(),nodeH=node.height(),paddingX2=2*node.padding(),nodeTW=nodeW+("inner"===getIndexedStyle(node,"background-width-relative-to","value",index)?0:paddingX2),nodeTH=nodeH+("inner"===getIndexedStyle(node,"background-height-relative-to","value",index)?0:paddingX2),rs=node._private.rscratch,shouldClip="node"===getIndexedStyle(node,"background-clip","value",index),imgOpacity=getIndexedStyle(node,"background-image-opacity","value",index)*nodeOpacity,smooth=getIndexedStyle(node,"background-image-smoothing","value",index),imgW=img.width||img.cachedW,imgH=img.height||img.cachedH;null!=imgW&&null!=imgH||(document.body.appendChild(img),imgW=img.cachedW=img.width||img.offsetWidth,imgH=img.cachedH=img.height||img.offsetHeight,document.body.removeChild(img));var w=imgW,h=imgH;if("auto"!==getIndexedStyle(node,"background-width","value",index)&&(w="%"===getIndexedStyle(node,"background-width","units",index)?getIndexedStyle(node,"background-width","pfValue",index)*nodeTW:getIndexedStyle(node,"background-width","pfValue",index)),"auto"!==getIndexedStyle(node,"background-height","value",index)&&(h="%"===getIndexedStyle(node,"background-height","units",index)?getIndexedStyle(node,"background-height","pfValue",index)*nodeTH:getIndexedStyle(node,"background-height","pfValue",index)),0!==w&&0!==h){if("contain"===fit)w*=scale=Math.min(nodeTW/w,nodeTH/h),h*=scale;else if("cover"===fit){var scale;w*=scale=Math.max(nodeTW/w,nodeTH/h),h*=scale}var x=nodeX-nodeTW/2,posXUnits=getIndexedStyle(node,"background-position-x","units",index),posXPfVal=getIndexedStyle(node,"background-position-x","pfValue",index);x+="%"===posXUnits?(nodeTW-w)*posXPfVal:posXPfVal;var offXUnits=getIndexedStyle(node,"background-offset-x","units",index),offXPfVal=getIndexedStyle(node,"background-offset-x","pfValue",index);x+="%"===offXUnits?(nodeTW-w)*offXPfVal:offXPfVal;var y=nodeY-nodeTH/2,posYUnits=getIndexedStyle(node,"background-position-y","units",index),posYPfVal=getIndexedStyle(node,"background-position-y","pfValue",index);y+="%"===posYUnits?(nodeTH-h)*posYPfVal:posYPfVal;var offYUnits=getIndexedStyle(node,"background-offset-y","units",index),offYPfVal=getIndexedStyle(node,"background-offset-y","pfValue",index);y+="%"===offYUnits?(nodeTH-h)*offYPfVal:offYPfVal,rs.pathCache&&(x-=nodeX,y-=nodeY,nodeX=0,nodeY=0);var gAlpha=context.globalAlpha;context.globalAlpha=imgOpacity;var smoothingEnabled=r.getImgSmoothing(context),isSmoothingSwitched=!1;if("no"===smooth&&smoothingEnabled?(r.setImgSmoothing(context,!1),isSmoothingSwitched=!0):"yes"!==smooth||smoothingEnabled||(r.setImgSmoothing(context,!0),isSmoothingSwitched=!0),"no-repeat"===repeat)shouldClip&&(context.save(),rs.pathCache?context.clip(rs.pathCache):(r.nodeShapes[r.getNodeShape(node)].draw(context,nodeX,nodeY,nodeTW,nodeTH),context.clip())),r.safeDrawImage(context,img,0,0,imgW,imgH,x,y,w,h),shouldClip&&context.restore();else{var pattern=context.createPattern(img,repeat);context.fillStyle=pattern,r.nodeShapes[r.getNodeShape(node)].draw(context,nodeX,nodeY,nodeTW,nodeTH),context.translate(x,y),context.fill(),context.translate(-x,-y)}context.globalAlpha=gAlpha,isSmoothingSwitched&&r.setImgSmoothing(context,smoothingEnabled)}}},CRp$4={};function roundRect(ctx,x,y,width,height){var radius=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5;ctx.beginPath(),ctx.moveTo(x+radius,y),ctx.lineTo(x+width-radius,y),ctx.quadraticCurveTo(x+width,y,x+width,y+radius),ctx.lineTo(x+width,y+height-radius),ctx.quadraticCurveTo(x+width,y+height,x+width-radius,y+height),ctx.lineTo(x+radius,y+height),ctx.quadraticCurveTo(x,y+height,x,y+height-radius),ctx.lineTo(x,y+radius),ctx.quadraticCurveTo(x,y,x+radius,y),ctx.closePath(),ctx.fill()}CRp$4.eleTextBiggerThanMin=function(ele,scale){if(!scale){var zoom=ele.cy().zoom(),pxRatio=this.getPixelRatio(),lvl=Math.ceil(log2(zoom*pxRatio));scale=Math.pow(2,lvl)}return!(ele.pstyle("font-size").pfValue*scale<ele.pstyle("min-zoomed-font-size").pfValue)},CRp$4.drawElementText=function(context,ele,shiftToOriginWithBb,force,prefix){var useEleOpacity=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],r=this;if(null==force){if(useEleOpacity&&!r.eleTextBiggerThanMin(ele))return}else if(!1===force)return;if(ele.isNode()){var label=ele.pstyle("label");if(!label||!label.value)return;var justification=r.getLabelJustification(ele);context.textAlign=justification,context.textBaseline="bottom"}else{var badLine=ele.element()._private.rscratch.badLine,_label=ele.pstyle("label"),srcLabel=ele.pstyle("source-label"),tgtLabel=ele.pstyle("target-label");if(badLine||(!_label||!_label.value)&&(!srcLabel||!srcLabel.value)&&(!tgtLabel||!tgtLabel.value))return;context.textAlign="center",context.textBaseline="bottom"}var bb,applyRotation=!shiftToOriginWithBb;shiftToOriginWithBb&&(bb=shiftToOriginWithBb,context.translate(-bb.x1,-bb.y1)),null==prefix?(r.drawText(context,ele,null,applyRotation,useEleOpacity),ele.isEdge()&&(r.drawText(context,ele,"source",applyRotation,useEleOpacity),r.drawText(context,ele,"target",applyRotation,useEleOpacity))):r.drawText(context,ele,prefix,applyRotation,useEleOpacity),shiftToOriginWithBb&&context.translate(bb.x1,bb.y1)},CRp$4.getFontCache=function(context){var cache;this.fontCaches=this.fontCaches||[];for(var i=0;i<this.fontCaches.length;i++)if((cache=this.fontCaches[i]).context===context)return cache;return cache={context:context},this.fontCaches.push(cache),cache},CRp$4.setupTextStyle=function(context,ele){var useEleOpacity=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],labelStyle=ele.pstyle("font-style").strValue,labelSize=ele.pstyle("font-size").pfValue+"px",labelFamily=ele.pstyle("font-family").strValue,labelWeight=ele.pstyle("font-weight").strValue,opacity=useEleOpacity?ele.effectiveOpacity()*ele.pstyle("text-opacity").value:1,outlineOpacity=ele.pstyle("text-outline-opacity").value*opacity,color=ele.pstyle("color").value,outlineColor=ele.pstyle("text-outline-color").value;context.font=labelStyle+" "+labelWeight+" "+labelSize+" "+labelFamily,context.lineJoin="round",this.colorFillStyle(context,color[0],color[1],color[2],opacity),this.colorStrokeStyle(context,outlineColor[0],outlineColor[1],outlineColor[2],outlineOpacity)},CRp$4.getTextAngle=function(ele,prefix){var rscratch=ele._private.rscratch,pdash=prefix?prefix+"-":"",rotation=ele.pstyle(pdash+"text-rotation"),textAngle=getPrefixedProperty(rscratch,"labelAngle",prefix);return"autorotate"===rotation.strValue?ele.isEdge()?textAngle:0:"none"===rotation.strValue?0:rotation.pfValue},CRp$4.drawText=function(context,ele,prefix){var applyRotation=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],useEleOpacity=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],_p=ele._private,rscratch=_p.rscratch,parentOpacity=useEleOpacity?ele.effectiveOpacity():1;if(!useEleOpacity||0!==parentOpacity&&0!==ele.pstyle("text-opacity").value){"main"===prefix&&(prefix=null);var orgTextX,orgTextY,textX=getPrefixedProperty(rscratch,"labelX",prefix),textY=getPrefixedProperty(rscratch,"labelY",prefix),text=this.getLabelText(ele,prefix);if(null!=text&&""!==text&&!isNaN(textX)&&!isNaN(textY)){this.setupTextStyle(context,ele,useEleOpacity);var theta,pdash=prefix?prefix+"-":"",textW=getPrefixedProperty(rscratch,"labelWidth",prefix),textH=getPrefixedProperty(rscratch,"labelHeight",prefix),marginX=ele.pstyle(pdash+"text-margin-x").pfValue,marginY=ele.pstyle(pdash+"text-margin-y").pfValue,isEdge=ele.isEdge(),halign=ele.pstyle("text-halign").value,valign=ele.pstyle("text-valign").value;switch(isEdge&&(halign="center",valign="center"),textX+=marginX,textY+=marginY,0!==(theta=applyRotation?this.getTextAngle(ele,prefix):0)&&(orgTextX=textX,orgTextY=textY,context.translate(orgTextX,orgTextY),context.rotate(theta),textX=0,textY=0),valign){case"top":break;case"center":textY+=textH/2;break;case"bottom":textY+=textH}var backgroundOpacity=ele.pstyle("text-background-opacity").value,borderOpacity=ele.pstyle("text-border-opacity").value,textBorderWidth=ele.pstyle("text-border-width").pfValue,backgroundPadding=ele.pstyle("text-background-padding").pfValue;if(backgroundOpacity>0||textBorderWidth>0&&borderOpacity>0){var bgX=textX-backgroundPadding;switch(halign){case"left":bgX-=textW;break;case"center":bgX-=textW/2}var bgY=textY-textH-backgroundPadding,bgW=textW+2*backgroundPadding,bgH=textH+2*backgroundPadding;if(backgroundOpacity>0){var textFill=context.fillStyle,textBackgroundColor=ele.pstyle("text-background-color").value;context.fillStyle="rgba("+textBackgroundColor[0]+","+textBackgroundColor[1]+","+textBackgroundColor[2]+","+backgroundOpacity*parentOpacity+")";var styleShape=ele.pstyle("text-background-shape").strValue;0===styleShape.indexOf("round")?roundRect(context,bgX,bgY,bgW,bgH,2):context.fillRect(bgX,bgY,bgW,bgH),context.fillStyle=textFill}if(textBorderWidth>0&&borderOpacity>0){var textStroke=context.strokeStyle,textLineWidth=context.lineWidth,textBorderColor=ele.pstyle("text-border-color").value,textBorderStyle=ele.pstyle("text-border-style").value;if(context.strokeStyle="rgba("+textBorderColor[0]+","+textBorderColor[1]+","+textBorderColor[2]+","+borderOpacity*parentOpacity+")",context.lineWidth=textBorderWidth,context.setLineDash)switch(textBorderStyle){case"dotted":context.setLineDash([1,1]);break;case"dashed":context.setLineDash([4,2]);break;case"double":context.lineWidth=textBorderWidth/4,context.setLineDash([]);break;case"solid":context.setLineDash([])}if(context.strokeRect(bgX,bgY,bgW,bgH),"double"===textBorderStyle){var whiteWidth=textBorderWidth/2;context.strokeRect(bgX+whiteWidth,bgY+whiteWidth,bgW-2*whiteWidth,bgH-2*whiteWidth)}context.setLineDash&&context.setLineDash([]),context.lineWidth=textLineWidth,context.strokeStyle=textStroke}}var lineWidth=2*ele.pstyle("text-outline-width").pfValue;if(lineWidth>0&&(context.lineWidth=lineWidth),"wrap"===ele.pstyle("text-wrap").value){var lines=getPrefixedProperty(rscratch,"labelWrapCachedLines",prefix),lineHeight=getPrefixedProperty(rscratch,"labelLineHeight",prefix),halfTextW=textW/2,justification=this.getLabelJustification(ele);switch("auto"===justification||("left"===halign?"left"===justification?textX+=-textW:"center"===justification&&(textX+=-halfTextW):"center"===halign?"left"===justification?textX+=-halfTextW:"right"===justification&&(textX+=halfTextW):"right"===halign&&("center"===justification?textX+=halfTextW:"right"===justification&&(textX+=textW))),valign){case"top":case"center":case"bottom":textY-=(lines.length-1)*lineHeight}for(var l=0;l<lines.length;l++)lineWidth>0&&context.strokeText(lines[l],textX,textY),context.fillText(lines[l],textX,textY),textY+=lineHeight}else lineWidth>0&&context.strokeText(text,textX,textY),context.fillText(text,textX,textY);0!==theta&&(context.rotate(-theta),context.translate(-orgTextX,-orgTextY))}}};var CRp$5={drawNode:function(context,node,shiftToOriginWithBb){var nodeWidth,nodeHeight,drawLabel=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],shouldDrawOverlay=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],shouldDrawOpacity=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],r=this,_p=node._private,rs=_p.rscratch,pos=node.position();if(number(pos.x)&&number(pos.y)&&(!shouldDrawOpacity||node.visible())){var path,bb,eleOpacity=shouldDrawOpacity?node.effectiveOpacity():1,usePaths=r.usePaths(),pathCacheHit=!1,padding=node.padding();nodeWidth=node.width()+2*padding,nodeHeight=node.height()+2*padding,shiftToOriginWithBb&&(bb=shiftToOriginWithBb,context.translate(-bb.x1,-bb.y1));for(var bgImgProp=node.pstyle("background-image"),urls=bgImgProp.value,urlDefined=new Array(urls.length),image=new Array(urls.length),numImages=0,i=0;i<urls.length;i++){var url=urls[i],defd=urlDefined[i]=null!=url&&"none"!==url;if(defd){var bgImgCrossOrigin=node.cy().style().getIndexedStyle(node,"background-image-crossorigin","value",i);numImages++,image[i]=r.getCachedImage(url,bgImgCrossOrigin,(function(){_p.backgroundTimestamp=Date.now(),node.emitAndNotify("background")}))}}var darkness=node.pstyle("background-blacken").value,borderWidth=node.pstyle("border-width").pfValue,bgOpacity=node.pstyle("background-opacity").value*eleOpacity,borderColor=node.pstyle("border-color").value,borderStyle=node.pstyle("border-style").value,borderOpacity=node.pstyle("border-opacity").value*eleOpacity;context.lineJoin="miter";var setupShapeColor=function setupShapeColor(){var bgOpy=arguments.length>0&&void 0!==arguments[0]?arguments[0]:bgOpacity;r.eleFillStyle(context,node,bgOpy)},setupBorderColor=function setupBorderColor(){var bdrOpy=arguments.length>0&&void 0!==arguments[0]?arguments[0]:borderOpacity;r.colorStrokeStyle(context,borderColor[0],borderColor[1],borderColor[2],bdrOpy)},styleShape=node.pstyle("shape").strValue,shapePts=node.pstyle("shape-polygon-points").pfValue;if(usePaths){context.translate(pos.x,pos.y);var pathCache=r.nodePathCache=r.nodePathCache||[],key=hashStrings("polygon"===styleShape?styleShape+","+shapePts.join(","):styleShape,""+nodeHeight,""+nodeWidth),cachedPath=pathCache[key];null!=cachedPath?(path=cachedPath,pathCacheHit=!0,rs.pathCache=path):(path=new Path2D,pathCache[key]=rs.pathCache=path)}var drawShape=function drawShape(){if(!pathCacheHit){var npos=pos;usePaths&&(npos={x:0,y:0}),r.nodeShapes[r.getNodeShape(node)].draw(path||context,npos.x,npos.y,nodeWidth,nodeHeight)}usePaths?context.fill(path):context.fill()},drawImages=function drawImages(){for(var nodeOpacity=arguments.length>0&&void 0!==arguments[0]?arguments[0]:eleOpacity,inside=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],prevBging=_p.backgrounding,totalCompleted=0,_i=0;_i<image.length;_i++){var bgContainment=node.cy().style().getIndexedStyle(node,"background-image-containment","value",_i);inside&&"over"===bgContainment||!inside&&"inside"===bgContainment?totalCompleted++:urlDefined[_i]&&image[_i].complete&&!image[_i].error&&(totalCompleted++,r.drawInscribedImage(context,image[_i],node,_i,nodeOpacity))}_p.backgrounding=!(totalCompleted===numImages),prevBging!==_p.backgrounding&&node.updateStyle(!1)},drawPie=function drawPie(){var redrawShape=arguments.length>0&&void 0!==arguments[0]&&arguments[0],pieOpacity=arguments.length>1&&void 0!==arguments[1]?arguments[1]:eleOpacity;r.hasPie(node)&&(r.drawPie(context,node,pieOpacity),redrawShape&&(usePaths||r.nodeShapes[r.getNodeShape(node)].draw(context,pos.x,pos.y,nodeWidth,nodeHeight)))},darken=function darken(){var darkenOpacity=arguments.length>0&&void 0!==arguments[0]?arguments[0]:eleOpacity,opacity=(darkness>0?darkness:-darkness)*darkenOpacity,c=darkness>0?0:255;0!==darkness&&(r.colorFillStyle(context,c,c,c,opacity),usePaths?context.fill(path):context.fill())},drawBorder=function drawBorder(){if(borderWidth>0){if(context.lineWidth=borderWidth,context.lineCap="butt",context.setLineDash)switch(borderStyle){case"dotted":context.setLineDash([1,1]);break;case"dashed":context.setLineDash([4,2]);break;case"solid":case"double":context.setLineDash([])}if(usePaths?context.stroke(path):context.stroke(),"double"===borderStyle){context.lineWidth=borderWidth/3;var gco=context.globalCompositeOperation;context.globalCompositeOperation="destination-out",usePaths?context.stroke(path):context.stroke(),context.globalCompositeOperation=gco}context.setLineDash&&context.setLineDash([])}},drawOverlay=function drawOverlay(){shouldDrawOverlay&&r.drawNodeOverlay(context,node,pos,nodeWidth,nodeHeight)},drawUnderlay=function drawUnderlay(){shouldDrawOverlay&&r.drawNodeUnderlay(context,node,pos,nodeWidth,nodeHeight)},drawText=function drawText(){r.drawElementText(context,node,null,drawLabel)},ghost="yes"===node.pstyle("ghost").value;if(ghost){var gx=node.pstyle("ghost-offset-x").pfValue,gy=node.pstyle("ghost-offset-y").pfValue,ghostOpacity=node.pstyle("ghost-opacity").value,effGhostOpacity=ghostOpacity*eleOpacity;context.translate(gx,gy),setupShapeColor(ghostOpacity*bgOpacity),drawShape(),drawImages(effGhostOpacity,!0),setupBorderColor(ghostOpacity*borderOpacity),drawBorder(),drawPie(0!==darkness||0!==borderWidth),drawImages(effGhostOpacity,!1),darken(effGhostOpacity),context.translate(-gx,-gy)}usePaths&&context.translate(-pos.x,-pos.y),drawUnderlay(),usePaths&&context.translate(pos.x,pos.y),setupShapeColor(),drawShape(),drawImages(eleOpacity,!0),setupBorderColor(),drawBorder(),drawPie(0!==darkness||0!==borderWidth),drawImages(eleOpacity,!1),darken(),usePaths&&context.translate(-pos.x,-pos.y),drawText(),drawOverlay(),shiftToOriginWithBb&&context.translate(bb.x1,bb.y1)}}},drawNodeOverlayUnderlay=function drawNodeOverlayUnderlay(overlayOrUnderlay){if(!["overlay","underlay"].includes(overlayOrUnderlay))throw new Error("Invalid state");return function(context,node,pos,nodeWidth,nodeHeight){if(node.visible()){var padding=node.pstyle("".concat(overlayOrUnderlay,"-padding")).pfValue,opacity=node.pstyle("".concat(overlayOrUnderlay,"-opacity")).value,color=node.pstyle("".concat(overlayOrUnderlay,"-color")).value,shape=node.pstyle("".concat(overlayOrUnderlay,"-shape")).value;if(opacity>0){if(pos=pos||node.position(),null==nodeWidth||null==nodeHeight){var _padding=node.padding();nodeWidth=node.width()+2*_padding,nodeHeight=node.height()+2*_padding}this.colorFillStyle(context,color[0],color[1],color[2],opacity),this.nodeShapes[shape].draw(context,pos.x,pos.y,nodeWidth+2*padding,nodeHeight+2*padding),context.fill()}}}};CRp$5.drawNodeOverlay=drawNodeOverlayUnderlay("overlay"),CRp$5.drawNodeUnderlay=drawNodeOverlayUnderlay("underlay"),CRp$5.hasPie=function(node){return(node=node[0])._private.hasPie},CRp$5.drawPie=function(context,node,nodeOpacity,pos){node=node[0],pos=pos||node.position();var cyStyle=node.cy().style(),pieSize=node.pstyle("pie-size"),x=pos.x,y=pos.y,nodeW=node.width(),nodeH=node.height(),radius=Math.min(nodeW,nodeH)/2,lastPercent=0;this.usePaths()&&(x=0,y=0),"%"===pieSize.units?radius*=pieSize.pfValue:void 0!==pieSize.pfValue&&(radius=pieSize.pfValue/2);for(var i=1;i<=cyStyle.pieBackgroundN;i++){var size=node.pstyle("pie-"+i+"-background-size").value,color=node.pstyle("pie-"+i+"-background-color").value,opacity=node.pstyle("pie-"+i+"-background-opacity").value*nodeOpacity,percent=size/100;percent+lastPercent>1&&(percent=1-lastPercent);var angleStart=1.5*Math.PI+2*Math.PI*lastPercent,angleEnd=angleStart+2*Math.PI*percent;0===size||lastPercent>=1||lastPercent+percent>1||(context.beginPath(),context.moveTo(x,y),context.arc(x,y,radius,angleStart,angleEnd),context.closePath(),this.colorFillStyle(context,color[0],color[1],color[2],opacity),context.fill(),lastPercent+=percent)}};var CRp$6={};CRp$6.getPixelRatio=function(){var context=this.data.contexts[0];if(null!=this.forcedPixelRatio)return this.forcedPixelRatio;var backingStore=context.backingStorePixelRatio||context.webkitBackingStorePixelRatio||context.mozBackingStorePixelRatio||context.msBackingStorePixelRatio||context.oBackingStorePixelRatio||context.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/backingStore},CRp$6.paintCache=function(context){for(var cache,caches=this.paintCaches=this.paintCaches||[],needToCreateCache=!0,i=0;i<caches.length;i++)if((cache=caches[i]).context===context){needToCreateCache=!1;break}return needToCreateCache&&(cache={context:context},caches.push(cache)),cache},CRp$6.createGradientStyleFor=function(context,shapeStyleName,ele,fill,opacity){var gradientStyle,usePaths=this.usePaths(),colors=ele.pstyle(shapeStyleName+"-gradient-stop-colors").value,positions=ele.pstyle(shapeStyleName+"-gradient-stop-positions").pfValue;if("radial-gradient"===fill)if(ele.isEdge()){var start=ele.sourceEndpoint(),end=ele.targetEndpoint(),mid=ele.midpoint(),d1=dist(start,mid),d2=dist(end,mid);gradientStyle=context.createRadialGradient(mid.x,mid.y,0,mid.x,mid.y,Math.max(d1,d2))}else{var pos=usePaths?{x:0,y:0}:ele.position(),width=ele.paddedWidth(),height=ele.paddedHeight();gradientStyle=context.createRadialGradient(pos.x,pos.y,0,pos.x,pos.y,Math.max(width,height))}else if(ele.isEdge()){var _start=ele.sourceEndpoint(),_end=ele.targetEndpoint();gradientStyle=context.createLinearGradient(_start.x,_start.y,_end.x,_end.y)}else{var _pos=usePaths?{x:0,y:0}:ele.position(),halfWidth=ele.paddedWidth()/2,halfHeight=ele.paddedHeight()/2;switch(ele.pstyle("background-gradient-direction").value){case"to-bottom":gradientStyle=context.createLinearGradient(_pos.x,_pos.y-halfHeight,_pos.x,_pos.y+halfHeight);break;case"to-top":gradientStyle=context.createLinearGradient(_pos.x,_pos.y+halfHeight,_pos.x,_pos.y-halfHeight);break;case"to-left":gradientStyle=context.createLinearGradient(_pos.x+halfWidth,_pos.y,_pos.x-halfWidth,_pos.y);break;case"to-right":gradientStyle=context.createLinearGradient(_pos.x-halfWidth,_pos.y,_pos.x+halfWidth,_pos.y);break;case"to-bottom-right":case"to-right-bottom":gradientStyle=context.createLinearGradient(_pos.x-halfWidth,_pos.y-halfHeight,_pos.x+halfWidth,_pos.y+halfHeight);break;case"to-top-right":case"to-right-top":gradientStyle=context.createLinearGradient(_pos.x-halfWidth,_pos.y+halfHeight,_pos.x+halfWidth,_pos.y-halfHeight);break;case"to-bottom-left":case"to-left-bottom":gradientStyle=context.createLinearGradient(_pos.x+halfWidth,_pos.y-halfHeight,_pos.x-halfWidth,_pos.y+halfHeight);break;case"to-top-left":case"to-left-top":gradientStyle=context.createLinearGradient(_pos.x+halfWidth,_pos.y+halfHeight,_pos.x-halfWidth,_pos.y-halfHeight)}}if(!gradientStyle)return null;for(var hasPositions=positions.length===colors.length,length=colors.length,i=0;i<length;i++)gradientStyle.addColorStop(hasPositions?positions[i]:i/(length-1),"rgba("+colors[i][0]+","+colors[i][1]+","+colors[i][2]+","+opacity+")");return gradientStyle},CRp$6.gradientFillStyle=function(context,ele,fill,opacity){var gradientStyle=this.createGradientStyleFor(context,"background",ele,fill,opacity);if(!gradientStyle)return null;context.fillStyle=gradientStyle},CRp$6.colorFillStyle=function(context,r,g,b,a){context.fillStyle="rgba("+r+","+g+","+b+","+a+")"},CRp$6.eleFillStyle=function(context,ele,opacity){var backgroundFill=ele.pstyle("background-fill").value;if("linear-gradient"===backgroundFill||"radial-gradient"===backgroundFill)this.gradientFillStyle(context,ele,backgroundFill,opacity);else{var backgroundColor=ele.pstyle("background-color").value;this.colorFillStyle(context,backgroundColor[0],backgroundColor[1],backgroundColor[2],opacity)}},CRp$6.gradientStrokeStyle=function(context,ele,fill,opacity){var gradientStyle=this.createGradientStyleFor(context,"line",ele,fill,opacity);if(!gradientStyle)return null;context.strokeStyle=gradientStyle},CRp$6.colorStrokeStyle=function(context,r,g,b,a){context.strokeStyle="rgba("+r+","+g+","+b+","+a+")"},CRp$6.eleStrokeStyle=function(context,ele,opacity){var lineFill=ele.pstyle("line-fill").value;if("linear-gradient"===lineFill||"radial-gradient"===lineFill)this.gradientStrokeStyle(context,ele,lineFill,opacity);else{var lineColor=ele.pstyle("line-color").value;this.colorStrokeStyle(context,lineColor[0],lineColor[1],lineColor[2],opacity)}},CRp$6.matchCanvasSize=function(container){var r=this,data=r.data,bb=r.findContainerClientCoords(),width=bb[2],height=bb[3],pixelRatio=r.getPixelRatio(),mbPxRatio=r.motionBlurPxRatio;container!==r.data.bufferCanvases[r.MOTIONBLUR_BUFFER_NODE]&&container!==r.data.bufferCanvases[r.MOTIONBLUR_BUFFER_DRAG]||(pixelRatio=mbPxRatio);var canvas,canvasWidth=width*pixelRatio,canvasHeight=height*pixelRatio;if(canvasWidth!==r.canvasWidth||canvasHeight!==r.canvasHeight){r.fontCaches=null;var canvasContainer=data.canvasContainer;canvasContainer.style.width=width+"px",canvasContainer.style.height=height+"px";for(var i=0;i<r.CANVAS_LAYERS;i++)(canvas=data.canvases[i]).width=canvasWidth,canvas.height=canvasHeight,canvas.style.width=width+"px",canvas.style.height=height+"px";for(i=0;i<r.BUFFER_COUNT;i++)(canvas=data.bufferCanvases[i]).width=canvasWidth,canvas.height=canvasHeight,canvas.style.width=width+"px",canvas.style.height=height+"px";r.textureMult=1,pixelRatio<=1&&(canvas=data.bufferCanvases[r.TEXTURE_BUFFER],r.textureMult=2,canvas.width=canvasWidth*r.textureMult,canvas.height=canvasHeight*r.textureMult),r.canvasWidth=canvasWidth,r.canvasHeight=canvasHeight}},CRp$6.renderTo=function(cxt,zoom,pan,pxRatio){this.render({forcedContext:cxt,forcedZoom:zoom,forcedPan:pan,drawAllLayers:!0,forcedPxRatio:pxRatio})},CRp$6.render=function(options){var forcedContext=(options=options||staticEmptyObject()).forcedContext,drawAllLayers=options.drawAllLayers,drawOnlyNodeLayer=options.drawOnlyNodeLayer,forcedZoom=options.forcedZoom,forcedPan=options.forcedPan,r=this,pixelRatio=void 0===options.forcedPxRatio?this.getPixelRatio():options.forcedPxRatio,cy=r.cy,data=r.data,needDraw=data.canvasNeedsRedraw,textureDraw=r.textureOnViewport&&!forcedContext&&(r.pinching||r.hoverData.dragging||r.swipePanning||r.data.wheelZooming),motionBlur=void 0!==options.motionBlur?options.motionBlur:r.motionBlur,mbPxRatio=r.motionBlurPxRatio,hasCompoundNodes=cy.hasCompoundNodes(),inNodeDragGesture=r.hoverData.draggingEles,inBoxSelection=!(!r.hoverData.selecting&&!r.touchData.selecting),motionBlurFadeEffect=motionBlur=motionBlur&&!forcedContext&&r.motionBlurEnabled&&!inBoxSelection;forcedContext||(r.prevPxRatio!==pixelRatio&&(r.invalidateContainerClientCoordsCache(),r.matchCanvasSize(r.container),r.redrawHint("eles",!0),r.redrawHint("drag",!0)),r.prevPxRatio=pixelRatio),!forcedContext&&r.motionBlurTimeout&&clearTimeout(r.motionBlurTimeout),motionBlur&&(null==r.mbFrames&&(r.mbFrames=0),r.mbFrames++,r.mbFrames<3&&(motionBlurFadeEffect=!1),r.mbFrames>r.minMbLowQualFrames&&(r.motionBlurPxRatio=r.mbPxRBlurry)),r.clearingMotionBlur&&(r.motionBlurPxRatio=1),r.textureDrawLastFrame&&!textureDraw&&(needDraw[r.NODE]=!0,needDraw[r.SELECT_BOX]=!0);var style=cy.style(),zoom=cy.zoom(),effectiveZoom=void 0!==forcedZoom?forcedZoom:zoom,pan=cy.pan(),effectivePan={x:pan.x,y:pan.y},vp={zoom:zoom,pan:{x:pan.x,y:pan.y}},prevVp=r.prevViewport;void 0===prevVp||vp.zoom!==prevVp.zoom||vp.pan.x!==prevVp.pan.x||vp.pan.y!==prevVp.pan.y||inNodeDragGesture&&!hasCompoundNodes||(r.motionBlurPxRatio=1),forcedPan&&(effectivePan=forcedPan),effectiveZoom*=pixelRatio,effectivePan.x*=pixelRatio,effectivePan.y*=pixelRatio;var eles=r.getCachedZSortedEles();function mbclear(context,x,y,w,h){var gco=context.globalCompositeOperation;context.globalCompositeOperation="destination-out",r.colorFillStyle(context,255,255,255,r.motionBlurTransparency),context.fillRect(x,y,w,h),context.globalCompositeOperation=gco}function setContextTransform(context,clear){var ePan,eZoom,w,h;r.clearingMotionBlur||context!==data.bufferContexts[r.MOTIONBLUR_BUFFER_NODE]&&context!==data.bufferContexts[r.MOTIONBLUR_BUFFER_DRAG]?(ePan=effectivePan,eZoom=effectiveZoom,w=r.canvasWidth,h=r.canvasHeight):(ePan={x:pan.x*mbPxRatio,y:pan.y*mbPxRatio},eZoom=zoom*mbPxRatio,w=r.canvasWidth*mbPxRatio,h=r.canvasHeight*mbPxRatio),context.setTransform(1,0,0,1,0,0),"motionBlur"===clear?mbclear(context,0,0,w,h):forcedContext||void 0!==clear&&!clear||context.clearRect(0,0,w,h),drawAllLayers||(context.translate(ePan.x,ePan.y),context.scale(eZoom,eZoom)),forcedPan&&context.translate(forcedPan.x,forcedPan.y),forcedZoom&&context.scale(forcedZoom,forcedZoom)}if(textureDraw||(r.textureDrawLastFrame=!1),textureDraw){if(r.textureDrawLastFrame=!0,!r.textureCache){r.textureCache={},r.textureCache.bb=cy.mutableElements().boundingBox(),r.textureCache.texture=r.data.bufferCanvases[r.TEXTURE_BUFFER];var cxt=r.data.bufferContexts[r.TEXTURE_BUFFER];cxt.setTransform(1,0,0,1,0,0),cxt.clearRect(0,0,r.canvasWidth*r.textureMult,r.canvasHeight*r.textureMult),r.render({forcedContext:cxt,drawOnlyNodeLayer:!0,forcedPxRatio:pixelRatio*r.textureMult}),(vp=r.textureCache.viewport={zoom:cy.zoom(),pan:cy.pan(),width:r.canvasWidth,height:r.canvasHeight}).mpan={x:(0-vp.pan.x)/vp.zoom,y:(0-vp.pan.y)/vp.zoom}}needDraw[r.DRAG]=!1,needDraw[r.NODE]=!1;var context=data.contexts[r.NODE],texture=r.textureCache.texture;vp=r.textureCache.viewport;context.setTransform(1,0,0,1,0,0),motionBlur?mbclear(context,0,0,vp.width,vp.height):context.clearRect(0,0,vp.width,vp.height);var outsideBgColor=style.core("outside-texture-bg-color").value,outsideBgOpacity=style.core("outside-texture-bg-opacity").value;r.colorFillStyle(context,outsideBgColor[0],outsideBgColor[1],outsideBgColor[2],outsideBgOpacity),context.fillRect(0,0,vp.width,vp.height);zoom=cy.zoom();setContextTransform(context,!1),context.clearRect(vp.mpan.x,vp.mpan.y,vp.width/vp.zoom/pixelRatio,vp.height/vp.zoom/pixelRatio),context.drawImage(texture,vp.mpan.x,vp.mpan.y,vp.width/vp.zoom/pixelRatio,vp.height/vp.zoom/pixelRatio)}else r.textureOnViewport&&!forcedContext&&(r.textureCache=null);var extent=cy.extent(),vpManip=r.pinching||r.hoverData.dragging||r.swipePanning||r.data.wheelZooming||r.hoverData.draggingEles||r.cy.animated(),hideEdges=r.hideEdgesOnViewport&&vpManip,needMbClear=[];if(needMbClear[r.NODE]=!needDraw[r.NODE]&&motionBlur&&!r.clearedForMotionBlur[r.NODE]||r.clearingMotionBlur,needMbClear[r.NODE]&&(r.clearedForMotionBlur[r.NODE]=!0),needMbClear[r.DRAG]=!needDraw[r.DRAG]&&motionBlur&&!r.clearedForMotionBlur[r.DRAG]||r.clearingMotionBlur,needMbClear[r.DRAG]&&(r.clearedForMotionBlur[r.DRAG]=!0),needDraw[r.NODE]||drawAllLayers||drawOnlyNodeLayer||needMbClear[r.NODE]){var useBuffer=motionBlur&&!needMbClear[r.NODE]&&1!==mbPxRatio;setContextTransform(context=forcedContext||(useBuffer?r.data.bufferContexts[r.MOTIONBLUR_BUFFER_NODE]:data.contexts[r.NODE]),motionBlur&&!useBuffer?"motionBlur":void 0),hideEdges?r.drawCachedNodes(context,eles.nondrag,pixelRatio,extent):r.drawLayeredElements(context,eles.nondrag,pixelRatio,extent),r.debug&&r.drawDebugPoints(context,eles.nondrag),drawAllLayers||motionBlur||(needDraw[r.NODE]=!1)}if(!drawOnlyNodeLayer&&(needDraw[r.DRAG]||drawAllLayers||needMbClear[r.DRAG])){useBuffer=motionBlur&&!needMbClear[r.DRAG]&&1!==mbPxRatio;setContextTransform(context=forcedContext||(useBuffer?r.data.bufferContexts[r.MOTIONBLUR_BUFFER_DRAG]:data.contexts[r.DRAG]),motionBlur&&!useBuffer?"motionBlur":void 0),hideEdges?r.drawCachedNodes(context,eles.drag,pixelRatio,extent):r.drawCachedElements(context,eles.drag,pixelRatio,extent),r.debug&&r.drawDebugPoints(context,eles.drag),drawAllLayers||motionBlur||(needDraw[r.DRAG]=!1)}if(r.showFps||!drawOnlyNodeLayer&&needDraw[r.SELECT_BOX]&&!drawAllLayers){if(setContextTransform(context=forcedContext||data.contexts[r.SELECT_BOX]),1==r.selection[4]&&(r.hoverData.selecting||r.touchData.selecting)){zoom=r.cy.zoom();var borderWidth=style.core("selection-box-border-width").value/zoom;context.lineWidth=borderWidth,context.fillStyle="rgba("+style.core("selection-box-color").value[0]+","+style.core("selection-box-color").value[1]+","+style.core("selection-box-color").value[2]+","+style.core("selection-box-opacity").value+")",context.fillRect(r.selection[0],r.selection[1],r.selection[2]-r.selection[0],r.selection[3]-r.selection[1]),borderWidth>0&&(context.strokeStyle="rgba("+style.core("selection-box-border-color").value[0]+","+style.core("selection-box-border-color").value[1]+","+style.core("selection-box-border-color").value[2]+","+style.core("selection-box-opacity").value+")",context.strokeRect(r.selection[0],r.selection[1],r.selection[2]-r.selection[0],r.selection[3]-r.selection[1]))}if(data.bgActivePosistion&&!r.hoverData.selecting){zoom=r.cy.zoom();var pos=data.bgActivePosistion;context.fillStyle="rgba("+style.core("active-bg-color").value[0]+","+style.core("active-bg-color").value[1]+","+style.core("active-bg-color").value[2]+","+style.core("active-bg-opacity").value+")",context.beginPath(),context.arc(pos.x,pos.y,style.core("active-bg-size").pfValue/zoom,0,2*Math.PI),context.fill()}var timeToRender=r.lastRedrawTime;if(r.showFps&&timeToRender){timeToRender=Math.round(timeToRender);var fps=Math.round(1e3/timeToRender);context.setTransform(1,0,0,1,0,0),context.fillStyle="rgba(255, 0, 0, 0.75)",context.strokeStyle="rgba(255, 0, 0, 0.75)",context.lineWidth=1,context.fillText("1 frame = "+timeToRender+" ms = "+fps+" fps",0,20);context.strokeRect(0,30,250,20),context.fillRect(0,30,250*Math.min(fps/60,1),20)}drawAllLayers||(needDraw[r.SELECT_BOX]=!1)}if(motionBlur&&1!==mbPxRatio){var cxtNode=data.contexts[r.NODE],txtNode=r.data.bufferCanvases[r.MOTIONBLUR_BUFFER_NODE],cxtDrag=data.contexts[r.DRAG],txtDrag=r.data.bufferCanvases[r.MOTIONBLUR_BUFFER_DRAG],drawMotionBlur=function drawMotionBlur(cxt,txt,needClear){cxt.setTransform(1,0,0,1,0,0),needClear||!motionBlurFadeEffect?cxt.clearRect(0,0,r.canvasWidth,r.canvasHeight):mbclear(cxt,0,0,r.canvasWidth,r.canvasHeight);var pxr=mbPxRatio;cxt.drawImage(txt,0,0,r.canvasWidth*pxr,r.canvasHeight*pxr,0,0,r.canvasWidth,r.canvasHeight)};(needDraw[r.NODE]||needMbClear[r.NODE])&&(drawMotionBlur(cxtNode,txtNode,needMbClear[r.NODE]),needDraw[r.NODE]=!1),(needDraw[r.DRAG]||needMbClear[r.DRAG])&&(drawMotionBlur(cxtDrag,txtDrag,needMbClear[r.DRAG]),needDraw[r.DRAG]=!1)}r.prevViewport=vp,r.clearingMotionBlur&&(r.clearingMotionBlur=!1,r.motionBlurCleared=!0,r.motionBlur=!0),motionBlur&&(r.motionBlurTimeout=setTimeout((function(){r.motionBlurTimeout=null,r.clearedForMotionBlur[r.NODE]=!1,r.clearedForMotionBlur[r.DRAG]=!1,r.motionBlur=!1,r.clearingMotionBlur=!textureDraw,r.mbFrames=0,needDraw[r.NODE]=!0,needDraw[r.DRAG]=!0,r.redraw()}),100)),forcedContext||cy.emit("render")};for(var CRp$7={drawPolygonPath:function(context,x,y,width,height,points){var halfW=width/2,halfH=height/2;context.beginPath&&context.beginPath(),context.moveTo(x+halfW*points[0],y+halfH*points[1]);for(var i=1;i<points.length/2;i++)context.lineTo(x+halfW*points[2*i],y+halfH*points[2*i+1]);context.closePath()},drawRoundPolygonPath:function(context,x,y,width,height,points){var halfW=width/2,halfH=height/2,cornerRadius=getRoundPolygonRadius(width,height);context.beginPath&&context.beginPath();for(var _i=0;_i<points.length/4;_i++){var destUv,sourceUv=void 0;sourceUv=0===_i?points.length-2:4*_i-2,destUv=4*_i+2;var px=x+halfW*points[4*_i],py=y+halfH*points[4*_i+1],cosTheta=-points[sourceUv]*points[destUv]-points[sourceUv+1]*points[destUv+1],offset=cornerRadius/Math.tan(Math.acos(cosTheta)/2),cp0x=px-offset*points[sourceUv],cp0y=py-offset*points[sourceUv+1],cp1x=px+offset*points[destUv],cp1y=py+offset*points[destUv+1];0===_i?context.moveTo(cp0x,cp0y):context.lineTo(cp0x,cp0y),context.arcTo(px,py,cp1x,cp1y,cornerRadius)}context.closePath()},drawRoundRectanglePath:function(context,x,y,width,height){var halfWidth=width/2,halfHeight=height/2,cornerRadius=getRoundRectangleRadius(width,height);context.beginPath&&context.beginPath(),context.moveTo(x,y-halfHeight),context.arcTo(x+halfWidth,y-halfHeight,x+halfWidth,y,cornerRadius),context.arcTo(x+halfWidth,y+halfHeight,x,y+halfHeight,cornerRadius),context.arcTo(x-halfWidth,y+halfHeight,x-halfWidth,y,cornerRadius),context.arcTo(x-halfWidth,y-halfHeight,x,y-halfHeight,cornerRadius),context.lineTo(x,y-halfHeight),context.closePath()},drawBottomRoundRectanglePath:function(context,x,y,width,height){var halfWidth=width/2,halfHeight=height/2,cornerRadius=getRoundRectangleRadius(width,height);context.beginPath&&context.beginPath(),context.moveTo(x,y-halfHeight),context.lineTo(x+halfWidth,y-halfHeight),context.lineTo(x+halfWidth,y),context.arcTo(x+halfWidth,y+halfHeight,x,y+halfHeight,cornerRadius),context.arcTo(x-halfWidth,y+halfHeight,x-halfWidth,y,cornerRadius),context.lineTo(x-halfWidth,y-halfHeight),context.lineTo(x,y-halfHeight),context.closePath()},drawCutRectanglePath:function(context,x,y,width,height){var halfWidth=width/2,halfHeight=height/2;context.beginPath&&context.beginPath(),context.moveTo(x-halfWidth+8,y-halfHeight),context.lineTo(x+halfWidth-8,y-halfHeight),context.lineTo(x+halfWidth,y-halfHeight+8),context.lineTo(x+halfWidth,y+halfHeight-8),context.lineTo(x+halfWidth-8,y+halfHeight),context.lineTo(x-halfWidth+8,y+halfHeight),context.lineTo(x-halfWidth,y+halfHeight-8),context.lineTo(x-halfWidth,y-halfHeight+8),context.closePath()},drawBarrelPath:function(context,x,y,width,height){var halfWidth=width/2,halfHeight=height/2,xBegin=x-halfWidth,xEnd=x+halfWidth,yBegin=y-halfHeight,yEnd=y+halfHeight,barrelCurveConstants=getBarrelCurveConstants(width,height),wOffset=barrelCurveConstants.widthOffset,hOffset=barrelCurveConstants.heightOffset,ctrlPtXOffset=barrelCurveConstants.ctrlPtOffsetPct*wOffset;context.beginPath&&context.beginPath(),context.moveTo(xBegin,yBegin+hOffset),context.lineTo(xBegin,yEnd-hOffset),context.quadraticCurveTo(xBegin+ctrlPtXOffset,yEnd,xBegin+wOffset,yEnd),context.lineTo(xEnd-wOffset,yEnd),context.quadraticCurveTo(xEnd-ctrlPtXOffset,yEnd,xEnd,yEnd-hOffset),context.lineTo(xEnd,yBegin+hOffset),context.quadraticCurveTo(xEnd-ctrlPtXOffset,yBegin,xEnd-wOffset,yBegin),context.lineTo(xBegin+wOffset,yBegin),context.quadraticCurveTo(xBegin+ctrlPtXOffset,yBegin,xBegin,yBegin+hOffset),context.closePath()}},sin0=Math.sin(0),cos0=Math.cos(0),sin={},cos={},ellipseStepSize=Math.PI/40,i=0*Math.PI;i<2*Math.PI;i+=ellipseStepSize)sin[i]=Math.sin(i),cos[i]=Math.cos(i);CRp$7.drawEllipsePath=function(context,centerX,centerY,width,height){if(context.beginPath&&context.beginPath(),context.ellipse)context.ellipse(centerX,centerY,width/2,height/2,0,0,2*Math.PI);else for(var xPos,yPos,rw=width/2,rh=height/2,i=0*Math.PI;i<2*Math.PI;i+=ellipseStepSize)xPos=centerX-rw*sin[i]*sin0+rw*cos[i]*cos0,yPos=centerY+rh*cos[i]*sin0+rh*sin[i]*cos0,0===i?context.moveTo(xPos,yPos):context.lineTo(xPos,yPos);context.closePath()};var CRp$8={};function b64UriToB64(b64uri){var i=b64uri.indexOf(",");return b64uri.substr(i+1)}function output(options,canvas,mimeType){var getB64Uri=function getB64Uri(){return canvas.toDataURL(mimeType,options.quality)};switch(options.output){case"blob-promise":return new Promise$1((function(resolve,reject){try{canvas.toBlob((function(blob){null!=blob?resolve(blob):reject(new Error("`canvas.toBlob()` sent a null value in its callback"))}),mimeType,options.quality)}catch(err){reject(err)}}));case"blob":return function b64ToBlob(b64,mimeType){for(var bytes=atob(b64),buff=new ArrayBuffer(bytes.length),buffUint8=new Uint8Array(buff),i=0;i<bytes.length;i++)buffUint8[i]=bytes.charCodeAt(i);return new Blob([buff],{type:mimeType})}(b64UriToB64(getB64Uri()),mimeType);case"base64":return b64UriToB64(getB64Uri());default:return getB64Uri()}}CRp$8.createBuffer=function(w,h){var buffer=document.createElement("canvas");return buffer.width=w,buffer.height=h,[buffer,buffer.getContext("2d")]},CRp$8.bufferCanvasImage=function(options){var cy=this.cy,bb=cy.mutableElements().boundingBox(),ctrRect=this.findContainerClientCoords(),width=options.full?Math.ceil(bb.w):ctrRect[2],height=options.full?Math.ceil(bb.h):ctrRect[3],specdMaxDims=number(options.maxWidth)||number(options.maxHeight),pxRatio=this.getPixelRatio(),scale=1;if(void 0!==options.scale)width*=options.scale,height*=options.scale,scale=options.scale;else if(specdMaxDims){var maxScaleW=1/0,maxScaleH=1/0;number(options.maxWidth)&&(maxScaleW=scale*options.maxWidth/width),number(options.maxHeight)&&(maxScaleH=scale*options.maxHeight/height),width*=scale=Math.min(maxScaleW,maxScaleH),height*=scale}specdMaxDims||(width*=pxRatio,height*=pxRatio,scale*=pxRatio);var buffCanvas=document.createElement("canvas");buffCanvas.width=width,buffCanvas.height=height,buffCanvas.style.width=width+"px",buffCanvas.style.height=height+"px";var buffCxt=buffCanvas.getContext("2d");if(width>0&&height>0){buffCxt.clearRect(0,0,width,height),buffCxt.globalCompositeOperation="source-over";var zsortedEles=this.getCachedZSortedEles();if(options.full)buffCxt.translate(-bb.x1*scale,-bb.y1*scale),buffCxt.scale(scale,scale),this.drawElements(buffCxt,zsortedEles),buffCxt.scale(1/scale,1/scale),buffCxt.translate(bb.x1*scale,bb.y1*scale);else{var pan=cy.pan(),translation={x:pan.x*scale,y:pan.y*scale};scale*=cy.zoom(),buffCxt.translate(translation.x,translation.y),buffCxt.scale(scale,scale),this.drawElements(buffCxt,zsortedEles),buffCxt.scale(1/scale,1/scale),buffCxt.translate(-translation.x,-translation.y)}options.bg&&(buffCxt.globalCompositeOperation="destination-over",buffCxt.fillStyle=options.bg,buffCxt.rect(0,0,width,height),buffCxt.fill())}return buffCanvas},CRp$8.png=function(options){return output(options,this.bufferCanvasImage(options),"image/png")},CRp$8.jpg=function(options){return output(options,this.bufferCanvasImage(options),"image/jpeg")};var CRp$9={nodeShapeImpl:function(name,context,centerX,centerY,width,height,points){switch(name){case"ellipse":return this.drawEllipsePath(context,centerX,centerY,width,height);case"polygon":return this.drawPolygonPath(context,centerX,centerY,width,height,points);case"round-polygon":return this.drawRoundPolygonPath(context,centerX,centerY,width,height,points);case"roundrectangle":case"round-rectangle":return this.drawRoundRectanglePath(context,centerX,centerY,width,height);case"cutrectangle":case"cut-rectangle":return this.drawCutRectanglePath(context,centerX,centerY,width,height);case"bottomroundrectangle":case"bottom-round-rectangle":return this.drawBottomRoundRectanglePath(context,centerX,centerY,width,height);case"barrel":return this.drawBarrelPath(context,centerX,centerY,width,height)}}},CR=CanvasRenderer,CRp$a=CanvasRenderer.prototype;function CanvasRenderer(options){var r=this;r.data={canvases:new Array(CRp$a.CANVAS_LAYERS),contexts:new Array(CRp$a.CANVAS_LAYERS),canvasNeedsRedraw:new Array(CRp$a.CANVAS_LAYERS),bufferCanvases:new Array(CRp$a.BUFFER_COUNT),bufferContexts:new Array(CRp$a.CANVAS_LAYERS)};r.data.canvasContainer=document.createElement("div");var containerStyle=r.data.canvasContainer.style;r.data.canvasContainer.style["-webkit-tap-highlight-color"]="rgba(0,0,0,0)",containerStyle.position="relative",containerStyle.zIndex="0",containerStyle.overflow="hidden";var container=options.cy.container();container.appendChild(r.data.canvasContainer),container.style["-webkit-tap-highlight-color"]="rgba(0,0,0,0)";var styleMap={"-webkit-user-select":"none","-moz-user-select":"-moz-none","user-select":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)","outline-style":"none"};(function ms(){return navigator&&navigator.userAgent.match(/msie|trident|edge/i)})()&&(styleMap["-ms-touch-action"]="none",styleMap["touch-action"]="none");for(var i=0;i<CRp$a.CANVAS_LAYERS;i++){var canvas=r.data.canvases[i]=document.createElement("canvas");r.data.contexts[i]=canvas.getContext("2d"),Object.keys(styleMap).forEach((function(k){canvas.style[k]=styleMap[k]})),canvas.style.position="absolute",canvas.setAttribute("data-id","layer"+i),canvas.style.zIndex=String(CRp$a.CANVAS_LAYERS-i),r.data.canvasContainer.appendChild(canvas),r.data.canvasNeedsRedraw[i]=!1}r.data.topCanvas=r.data.canvases[0],r.data.canvases[CRp$a.NODE].setAttribute("data-id","layer"+CRp$a.NODE+"-node"),r.data.canvases[CRp$a.SELECT_BOX].setAttribute("data-id","layer"+CRp$a.SELECT_BOX+"-selectbox"),r.data.canvases[CRp$a.DRAG].setAttribute("data-id","layer"+CRp$a.DRAG+"-drag");for(i=0;i<CRp$a.BUFFER_COUNT;i++)r.data.bufferCanvases[i]=document.createElement("canvas"),r.data.bufferContexts[i]=r.data.bufferCanvases[i].getContext("2d"),r.data.bufferCanvases[i].style.position="absolute",r.data.bufferCanvases[i].setAttribute("data-id","buffer"+i),r.data.bufferCanvases[i].style.zIndex=String(-i-1),r.data.bufferCanvases[i].style.visibility="hidden";r.pathsEnabled=!0;var emptyBb=makeBoundingBox(),getCenterOffset=function getCenterOffset(bb){return{x:-bb.w/2,y:-bb.h/2}},getElementBox=function getElementBox(ele){return ele.boundingBox(),ele[0]._private.bodyBounds},getLabelBox=function getLabelBox(ele){return ele.boundingBox(),ele[0]._private.labelBounds.main||emptyBb},getSourceLabelBox=function getSourceLabelBox(ele){return ele.boundingBox(),ele[0]._private.labelBounds.source||emptyBb},getTargetLabelBox=function getTargetLabelBox(ele){return ele.boundingBox(),ele[0]._private.labelBounds.target||emptyBb},isLabelVisibleAtScale=function isLabelVisibleAtScale(ele,scaledLabelShown){return scaledLabelShown},addTextMargin=function addTextMargin(prefix,pt,ele){var pre=prefix?prefix+"-":"";return{x:pt.x+ele.pstyle(pre+"text-margin-x").pfValue,y:pt.y+ele.pstyle(pre+"text-margin-y").pfValue}},getRsPt=function getRsPt(ele,x,y){var rs=ele[0]._private.rscratch;return{x:rs[x],y:rs[y]}},eleTxrCache=r.data.eleTxrCache=new ElementTextureCache(r,{getKey:function getStyleKey(ele){return ele[0]._private.nodeKey},doesEleInvalidateKey:function backgroundTimestampHasChanged(ele){var _p=ele[0]._private;return!(_p.oldBackgroundTimestamp===_p.backgroundTimestamp)},drawElement:function drawElement(context,ele,bb,scaledLabelShown,useEleOpacity){return r.drawElement(context,ele,bb,!1,!1,useEleOpacity)},getBoundingBox:getElementBox,getRotationPoint:function getElementRotationPoint(ele){return function getBoxCenter(bb){return{x:(bb.x1+bb.x2)/2,y:(bb.y1+bb.y2)/2}}(getElementBox(ele))},getRotationOffset:function getElementRotationOffset(ele){return getCenterOffset(getElementBox(ele))},allowEdgeTxrCaching:!1,allowParentTxrCaching:!1}),lblTxrCache=r.data.lblTxrCache=new ElementTextureCache(r,{getKey:function getLabelKey(ele){return ele[0]._private.labelStyleKey},drawElement:function drawLabel(context,ele,bb,scaledLabelShown,useEleOpacity){return r.drawElementText(context,ele,bb,scaledLabelShown,"main",useEleOpacity)},getBoundingBox:getLabelBox,getRotationPoint:function getLabelRotationPoint(ele){return addTextMargin("",getRsPt(ele,"labelX","labelY"),ele)},getRotationOffset:function getLabelRotationOffset(ele){var bb=getLabelBox(ele),p=getCenterOffset(getLabelBox(ele));if(ele.isNode()){switch(ele.pstyle("text-halign").value){case"left":p.x=-bb.w;break;case"right":p.x=0}switch(ele.pstyle("text-valign").value){case"top":p.y=-bb.h;break;case"bottom":p.y=0}}return p},isVisible:isLabelVisibleAtScale}),slbTxrCache=r.data.slbTxrCache=new ElementTextureCache(r,{getKey:function getSourceLabelKey(ele){return ele[0]._private.sourceLabelStyleKey},drawElement:function drawSourceLabel(context,ele,bb,scaledLabelShown,useEleOpacity){return r.drawElementText(context,ele,bb,scaledLabelShown,"source",useEleOpacity)},getBoundingBox:getSourceLabelBox,getRotationPoint:function getSourceLabelRotationPoint(ele){return addTextMargin("source",getRsPt(ele,"sourceLabelX","sourceLabelY"),ele)},getRotationOffset:function getSourceLabelRotationOffset(ele){return getCenterOffset(getSourceLabelBox(ele))},isVisible:isLabelVisibleAtScale}),tlbTxrCache=r.data.tlbTxrCache=new ElementTextureCache(r,{getKey:function getTargetLabelKey(ele){return ele[0]._private.targetLabelStyleKey},drawElement:function drawTargetLabel(context,ele,bb,scaledLabelShown,useEleOpacity){return r.drawElementText(context,ele,bb,scaledLabelShown,"target",useEleOpacity)},getBoundingBox:getTargetLabelBox,getRotationPoint:function getTargetLabelRotationPoint(ele){return addTextMargin("target",getRsPt(ele,"targetLabelX","targetLabelY"),ele)},getRotationOffset:function getTargetLabelRotationOffset(ele){return getCenterOffset(getTargetLabelBox(ele))},isVisible:isLabelVisibleAtScale}),lyrTxrCache=r.data.lyrTxrCache=new LayeredTextureCache(r);r.onUpdateEleCalcs((function invalidateTextureCaches(willDraw,eles){eleTxrCache.invalidateElements(eles),lblTxrCache.invalidateElements(eles),slbTxrCache.invalidateElements(eles),tlbTxrCache.invalidateElements(eles),lyrTxrCache.invalidateElements(eles);for(var _i=0;_i<eles.length;_i++){var _p=eles[_i]._private;_p.oldBackgroundTimestamp=_p.backgroundTimestamp}}));var refineInLayers=function refineInLayers(reqs){for(var i=0;i<reqs.length;i++)lyrTxrCache.enqueueElementRefinement(reqs[i].ele)};eleTxrCache.onDequeue(refineInLayers),lblTxrCache.onDequeue(refineInLayers),slbTxrCache.onDequeue(refineInLayers),tlbTxrCache.onDequeue(refineInLayers)}CRp$a.CANVAS_LAYERS=3,CRp$a.SELECT_BOX=0,CRp$a.DRAG=1,CRp$a.NODE=2,CRp$a.BUFFER_COUNT=3,CRp$a.TEXTURE_BUFFER=0,CRp$a.MOTIONBLUR_BUFFER_NODE=1,CRp$a.MOTIONBLUR_BUFFER_DRAG=2,CRp$a.redrawHint=function(group,bool){var r=this;switch(group){case"eles":r.data.canvasNeedsRedraw[CRp$a.NODE]=bool;break;case"drag":r.data.canvasNeedsRedraw[CRp$a.DRAG]=bool;break;case"select":r.data.canvasNeedsRedraw[CRp$a.SELECT_BOX]=bool}};var pathsImpld="undefined"!=typeof Path2D;CRp$a.path2dEnabled=function(on){if(void 0===on)return this.pathsEnabled;this.pathsEnabled=!!on},CRp$a.usePaths=function(){return pathsImpld&&this.pathsEnabled},CRp$a.setImgSmoothing=function(context,bool){null!=context.imageSmoothingEnabled?context.imageSmoothingEnabled=bool:(context.webkitImageSmoothingEnabled=bool,context.mozImageSmoothingEnabled=bool,context.msImageSmoothingEnabled=bool)},CRp$a.getImgSmoothing=function(context){return null!=context.imageSmoothingEnabled?context.imageSmoothingEnabled:context.webkitImageSmoothingEnabled||context.mozImageSmoothingEnabled||context.msImageSmoothingEnabled},CRp$a.makeOffscreenCanvas=function(width,height){var canvas;return"undefined"!==("undefined"==typeof OffscreenCanvas?"undefined":_typeof(OffscreenCanvas))?canvas=new OffscreenCanvas(width,height):((canvas=document.createElement("canvas")).width=width,canvas.height=height),canvas},[CRp,CRp$1,CRp$2,CRp$3,CRp$4,CRp$5,CRp$6,CRp$7,CRp$8,CRp$9].forEach((function(props){extend(CRp$a,props)}));var incExts=[{type:"layout",extensions:layout},{type:"renderer",extensions:[{name:"null",impl:NullRenderer},{name:"base",impl:BR},{name:"canvas",impl:CR}]}],extensions={},modules={};function setExtension(type,name,registrant){var ext=registrant,overrideErr=function overrideErr(field){warn("Can not register `"+name+"` for `"+type+"` since `"+field+"` already exists in the prototype and can not be overridden")};if("core"===type){if(Core.prototype[name])return overrideErr(name);Core.prototype[name]=registrant}else if("collection"===type){if(Collection.prototype[name])return overrideErr(name);Collection.prototype[name]=registrant}else if("layout"===type){for(var Layout=function Layout(options){this.options=options,registrant.call(this,options),plainObject(this._private)||(this._private={}),this._private.cy=options.cy,this._private.listeners=[],this.createEmitter()},layoutProto=Layout.prototype=Object.create(registrant.prototype),optLayoutFns=[],i=0;i<optLayoutFns.length;i++){var fnName=optLayoutFns[i];layoutProto[fnName]=layoutProto[fnName]||function(){return this}}layoutProto.start&&!layoutProto.run?layoutProto.run=function(){return this.start(),this}:!layoutProto.start&&layoutProto.run&&(layoutProto.start=function(){return this.run(),this});var regStop=registrant.prototype.stop;layoutProto.stop=function(){var opts=this.options;if(opts&&opts.animate){var anis=this.animations;if(anis)for(var _i=0;_i<anis.length;_i++)anis[_i].stop()}return regStop?regStop.call(this):this.emit("layoutstop"),this},layoutProto.destroy||(layoutProto.destroy=function(){return this}),layoutProto.cy=function(){return this._private.cy};var getCy=function getCy(layout){return layout._private.cy},emitterOpts={addEventFields:function addEventFields(layout,evt){evt.layout=layout,evt.cy=getCy(layout),evt.target=layout},bubble:function bubble(){return!0},parent:function parent(layout){return getCy(layout)}};extend(layoutProto,{createEmitter:function createEmitter(){return this._private.emitter=new Emitter(emitterOpts,this),this},emitter:function emitter(){return this._private.emitter},on:function on(evt,cb){return this.emitter().on(evt,cb),this},one:function one(evt,cb){return this.emitter().one(evt,cb),this},once:function once(evt,cb){return this.emitter().one(evt,cb),this},removeListener:function removeListener(evt,cb){return this.emitter().removeListener(evt,cb),this},removeAllListeners:function removeAllListeners(){return this.emitter().removeAllListeners(),this},emit:function emit(evt,params){return this.emitter().emit(evt,params),this}}),define$3.eventAliasesOn(layoutProto),ext=Layout}else if("renderer"===type&&"null"!==name&&"base"!==name){var BaseRenderer=getExtension("renderer","base"),bProto=BaseRenderer.prototype,RegistrantRenderer=registrant,rProto=registrant.prototype,Renderer=function Renderer(){BaseRenderer.apply(this,arguments),RegistrantRenderer.apply(this,arguments)},proto=Renderer.prototype;for(var pName in bProto){var pVal=bProto[pName];if(null!=rProto[pName])return overrideErr(pName);proto[pName]=pVal}for(var _pName in rProto)proto[_pName]=rProto[_pName];bProto.clientFunctions.forEach((function(name){proto[name]=proto[name]||function(){error("Renderer does not implement `renderer."+name+"()` on its prototype")}})),ext=Renderer}else if("__proto__"===type||"constructor"===type||"prototype"===type)return error(type+" is an illegal type to be registered, possibly lead to prototype pollutions");return setMap({map:extensions,keys:[type,name],value:ext})}function getExtension(type,name){return getMap({map:extensions,keys:[type,name]})}function setModule(type,name,moduleType,moduleName,registrant){return setMap({map:modules,keys:[type,name,moduleType,moduleName],value:registrant})}function getModule(type,name,moduleType,moduleName){return getMap({map:modules,keys:[type,name,moduleType,moduleName]})}var extension=function extension(){return 2===arguments.length?getExtension.apply(null,arguments):3===arguments.length?setExtension.apply(null,arguments):4===arguments.length?getModule.apply(null,arguments):5===arguments.length?setModule.apply(null,arguments):void error("Invalid extension access syntax")};Core.prototype.extension=extension,incExts.forEach((function(group){group.extensions.forEach((function(ext){setExtension(group.type,ext.name,ext.impl)}))}));var Stylesheet=function Stylesheet(){if(!(this instanceof Stylesheet))return new Stylesheet;this.length=0},sheetfn=Stylesheet.prototype;sheetfn.instanceString=function(){return"stylesheet"},sheetfn.selector=function(selector){return this[this.length++]={selector:selector,properties:[]},this},sheetfn.css=function(name,value){var i=this.length-1;if(string(name))this[i].properties.push({name:name,value:value});else if(plainObject(name))for(var map=name,propNames=Object.keys(map),j=0;j<propNames.length;j++){var key=propNames[j],mapVal=map[key];if(null!=mapVal){var prop=Style.properties[key]||Style.properties[dash2camel(key)];if(null!=prop){var _name=prop.name,_value=mapVal;this[i].properties.push({name:_name,value:_value})}}}return this},sheetfn.style=sheetfn.css,sheetfn.generateStyle=function(cy){var style=new Style(cy);return this.appendToStyle(style)},sheetfn.appendToStyle=function(style){for(var i=0;i<this.length;i++){var context=this[i],selector=context.selector,props=context.properties;style.selector(selector);for(var j=0;j<props.length;j++){var prop=props[j];style.css(prop.name,prop.value)}}return style};var cytoscape=function cytoscape(options){return void 0===options&&(options={}),plainObject(options)?new Core(options):string(options)?extension.apply(extension,arguments):void 0};cytoscape.use=function(ext){var args=Array.prototype.slice.call(arguments,1);return args.unshift(cytoscape),ext.apply(null,args),this},cytoscape.warnings=function(bool){return warnings(bool)},cytoscape.version="3.21.1",cytoscape.stylesheet=cytoscape.Stylesheet=Stylesheet,module.exports=cytoscape},485:function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__(894)},894:function(module,exports){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;(function(){var Heap,defaultCmp,floor,heapify,heappop,heappush,heappushpop,heapreplace,insort,min,nlargest,nsmallest,updateItem,_siftdown,_siftup;floor=Math.floor,min=Math.min,defaultCmp=function(x,y){return x<y?-1:x>y?1:0},insort=function(a,x,lo,hi,cmp){var mid;if(null==lo&&(lo=0),null==cmp&&(cmp=defaultCmp),lo<0)throw new Error("lo must be non-negative");for(null==hi&&(hi=a.length);lo<hi;)cmp(x,a[mid=floor((lo+hi)/2)])<0?hi=mid:lo=mid+1;return[].splice.apply(a,[lo,lo-lo].concat(x)),x},heappush=function(array,item,cmp){return null==cmp&&(cmp=defaultCmp),array.push(item),_siftdown(array,0,array.length-1,cmp)},heappop=function(array,cmp){var lastelt,returnitem;return null==cmp&&(cmp=defaultCmp),lastelt=array.pop(),array.length?(returnitem=array[0],array[0]=lastelt,_siftup(array,0,cmp)):returnitem=lastelt,returnitem},heapreplace=function(array,item,cmp){var returnitem;return null==cmp&&(cmp=defaultCmp),returnitem=array[0],array[0]=item,_siftup(array,0,cmp),returnitem},heappushpop=function(array,item,cmp){var _ref;return null==cmp&&(cmp=defaultCmp),array.length&&cmp(array[0],item)<0&&(item=(_ref=[array[0],item])[0],array[0]=_ref[1],_siftup(array,0,cmp)),item},heapify=function(array,cmp){var i,_i,_len,_ref1,_results,_results1;for(null==cmp&&(cmp=defaultCmp),_ref1=function(){_results1=[];for(var _j=0,_ref=floor(array.length/2);0<=_ref?_j<_ref:_j>_ref;0<=_ref?_j++:_j--)_results1.push(_j);return _results1}.apply(this).reverse(),_results=[],_i=0,_len=_ref1.length;_i<_len;_i++)i=_ref1[_i],_results.push(_siftup(array,i,cmp));return _results},updateItem=function(array,item,cmp){var pos;if(null==cmp&&(cmp=defaultCmp),-1!==(pos=array.indexOf(item)))return _siftdown(array,0,pos,cmp),_siftup(array,pos,cmp)},nlargest=function(array,n,cmp){var elem,result,_i,_len,_ref;if(null==cmp&&(cmp=defaultCmp),!(result=array.slice(0,n)).length)return result;for(heapify(result,cmp),_i=0,_len=(_ref=array.slice(n)).length;_i<_len;_i++)elem=_ref[_i],heappushpop(result,elem,cmp);return result.sort(cmp).reverse()},nsmallest=function(array,n,cmp){var elem,los,result,_i,_j,_len,_ref,_ref1,_results;if(null==cmp&&(cmp=defaultCmp),10*n<=array.length){if(!(result=array.slice(0,n).sort(cmp)).length)return result;for(los=result[result.length-1],_i=0,_len=(_ref=array.slice(n)).length;_i<_len;_i++)cmp(elem=_ref[_i],los)<0&&(insort(result,elem,0,null,cmp),result.pop(),los=result[result.length-1]);return result}for(heapify(array,cmp),_results=[],_j=0,_ref1=min(n,array.length);0<=_ref1?_j<_ref1:_j>_ref1;0<=_ref1?++_j:--_j)_results.push(heappop(array,cmp));return _results},_siftdown=function(array,startpos,pos,cmp){var newitem,parent,parentpos;for(null==cmp&&(cmp=defaultCmp),newitem=array[pos];pos>startpos&&cmp(newitem,parent=array[parentpos=pos-1>>1])<0;)array[pos]=parent,pos=parentpos;return array[pos]=newitem},_siftup=function(array,pos,cmp){var childpos,endpos,newitem,rightpos,startpos;for(null==cmp&&(cmp=defaultCmp),endpos=array.length,startpos=pos,newitem=array[pos],childpos=2*pos+1;childpos<endpos;)(rightpos=childpos+1)<endpos&&!(cmp(array[childpos],array[rightpos])<0)&&(childpos=rightpos),array[pos]=array[childpos],childpos=2*(pos=childpos)+1;return array[pos]=newitem,_siftdown(array,startpos,pos,cmp)},Heap=function(){function Heap(cmp){this.cmp=null!=cmp?cmp:defaultCmp,this.nodes=[]}return Heap.push=heappush,Heap.pop=heappop,Heap.replace=heapreplace,Heap.pushpop=heappushpop,Heap.heapify=heapify,Heap.updateItem=updateItem,Heap.nlargest=nlargest,Heap.nsmallest=nsmallest,Heap.prototype.push=function(x){return heappush(this.nodes,x,this.cmp)},Heap.prototype.pop=function(){return heappop(this.nodes,this.cmp)},Heap.prototype.peek=function(){return this.nodes[0]},Heap.prototype.contains=function(x){return-1!==this.nodes.indexOf(x)},Heap.prototype.replace=function(x){return heapreplace(this.nodes,x,this.cmp)},Heap.prototype.pushpop=function(x){return heappushpop(this.nodes,x,this.cmp)},Heap.prototype.heapify=function(){return heapify(this.nodes,this.cmp)},Heap.prototype.updateItem=function(x){return updateItem(this.nodes,x,this.cmp)},Heap.prototype.clear=function(){return this.nodes=[]},Heap.prototype.empty=function(){return 0===this.nodes.length},Heap.prototype.size=function(){return this.nodes.length},Heap.prototype.clone=function(){var heap;return(heap=new Heap).nodes=this.nodes.slice(0),heap},Heap.prototype.toArray=function(){return this.nodes.slice(0)},Heap.prototype.insert=Heap.prototype.push,Heap.prototype.top=Heap.prototype.peek,Heap.prototype.front=Heap.prototype.peek,Heap.prototype.has=Heap.prototype.contains,Heap.prototype.copy=Heap.prototype.clone,Heap}(),__WEBPACK_AMD_DEFINE_ARRAY__=[],void 0===(__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof(__WEBPACK_AMD_DEFINE_FACTORY__=function(){return Heap})?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__)||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)}).call(this)},296:function(module,__unused_webpack_exports,__webpack_require__){var reTrim=/^\s+|\s+$/g,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt,freeGlobal="object"==typeof __webpack_require__.g&&__webpack_require__.g&&__webpack_require__.g.Object===Object&&__webpack_require__.g,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")(),objectToString=Object.prototype.toString,nativeMax=Math.max,nativeMin=Math.min,now=function(){return root.Date.now()};function isObject(value){var type=typeof value;return!!value&&("object"==type||"function"==type)}function toNumber(value){if("number"==typeof value)return value;if(function isSymbol(value){return"symbol"==typeof value||function isObjectLike(value){return!!value&&"object"==typeof value}(value)&&"[object Symbol]"==objectToString.call(value)}(value))return NaN;if(isObject(value)){var other="function"==typeof value.valueOf?value.valueOf():value;value=isObject(other)?other+"":other}if("string"!=typeof value)return 0===value?value:+value;value=value.replace(reTrim,"");var isBinary=reIsBinary.test(value);return isBinary||reIsOctal.test(value)?freeParseInt(value.slice(2),isBinary?2:8):reIsBadHex.test(value)?NaN:+value}module.exports=function debounce(func,wait,options){var lastArgs,lastThis,maxWait,result,timerId,lastCallTime,lastInvokeTime=0,leading=!1,maxing=!1,trailing=!0;if("function"!=typeof func)throw new TypeError("Expected a function");function invokeFunc(time){var args=lastArgs,thisArg=lastThis;return lastArgs=lastThis=void 0,lastInvokeTime=time,result=func.apply(thisArg,args)}function leadingEdge(time){return lastInvokeTime=time,timerId=setTimeout(timerExpired,wait),leading?invokeFunc(time):result}function shouldInvoke(time){var timeSinceLastCall=time-lastCallTime;return void 0===lastCallTime||timeSinceLastCall>=wait||timeSinceLastCall<0||maxing&&time-lastInvokeTime>=maxWait}function timerExpired(){var time=now();if(shouldInvoke(time))return trailingEdge(time);timerId=setTimeout(timerExpired,function remainingWait(time){var result=wait-(time-lastCallTime);return maxing?nativeMin(result,maxWait-(time-lastInvokeTime)):result}(time))}function trailingEdge(time){return timerId=void 0,trailing&&lastArgs?invokeFunc(time):(lastArgs=lastThis=void 0,result)}function debounced(){var time=now(),isInvoking=shouldInvoke(time);if(lastArgs=arguments,lastThis=this,lastCallTime=time,isInvoking){if(void 0===timerId)return leadingEdge(lastCallTime);if(maxing)return timerId=setTimeout(timerExpired,wait),invokeFunc(lastCallTime)}return void 0===timerId&&(timerId=setTimeout(timerExpired,wait)),result}return wait=toNumber(wait)||0,isObject(options)&&(leading=!!options.leading,maxWait=(maxing="maxWait"in options)?nativeMax(toNumber(options.maxWait)||0,wait):maxWait,trailing="trailing"in options?!!options.trailing:trailing),debounced.cancel=function cancel(){void 0!==timerId&&clearTimeout(timerId),lastInvokeTime=0,lastArgs=lastCallTime=lastThis=timerId=void 0},debounced.flush=function flush(){return void 0===timerId?result:trailingEdge(now())},debounced}},208:function(module,__unused_webpack_exports,__webpack_require__){var genTag="[object GeneratorFunction]",reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/,reLeadingDot=/^\./,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,reEscapeChar=/\\(\\)?/g,reIsHostCtor=/^\[object .+?Constructor\]$/,freeGlobal="object"==typeof __webpack_require__.g&&__webpack_require__.g&&__webpack_require__.g.Object===Object&&__webpack_require__.g,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")();var uid,arrayProto=Array.prototype,funcProto=Function.prototype,objectProto=Object.prototype,coreJsData=root["__core-js_shared__"],maskSrcKey=(uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||""))?"Symbol(src)_1."+uid:"",funcToString=funcProto.toString,hasOwnProperty=objectProto.hasOwnProperty,objectToString=objectProto.toString,reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Symbol=root.Symbol,splice=arrayProto.splice,Map=getNative(root,"Map"),nativeCreate=getNative(Object,"create"),symbolProto=Symbol?Symbol.prototype:void 0,symbolToString=symbolProto?symbolProto.toString:void 0;function Hash(entries){var index=-1,length=entries?entries.length:0;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}function ListCache(entries){var index=-1,length=entries?entries.length:0;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}function MapCache(entries){var index=-1,length=entries?entries.length:0;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}function assocIndexOf(array,key){for(var value,other,length=array.length;length--;)if((value=array[length][0])===(other=key)||value!=value&&other!=other)return length;return-1}function baseGet(object,path){path=function isKey(value,object){if(isArray(value))return!1;var type=typeof value;if("number"==type||"symbol"==type||"boolean"==type||null==value||isSymbol(value))return!0;return reIsPlainProp.test(value)||!reIsDeepProp.test(value)||null!=object&&value in Object(object)}(path,object)?[path]:function castPath(value){return isArray(value)?value:stringToPath(value)}(path);for(var index=0,length=path.length;null!=object&&index<length;)object=object[toKey(path[index++])];return index&&index==length?object:void 0}function baseIsNative(value){if(!isObject(value)||function isMasked(func){return!!maskSrcKey&&maskSrcKey in func}(value))return!1;var pattern=function isFunction(value){var tag=isObject(value)?objectToString.call(value):"";return"[object Function]"==tag||tag==genTag}(value)||function isHostObject(value){var result=!1;if(null!=value&&"function"!=typeof value.toString)try{result=!!(value+"")}catch(e){}return result}(value)?reIsNative:reIsHostCtor;return pattern.test(function toSource(func){if(null!=func){try{return funcToString.call(func)}catch(e){}try{return func+""}catch(e){}}return""}(value))}function getMapData(map,key){var data=map.__data__;return function isKeyable(value){var type=typeof value;return"string"==type||"number"==type||"symbol"==type||"boolean"==type?"__proto__"!==value:null===value}(key)?data["string"==typeof key?"string":"hash"]:data.map}function getNative(object,key){var value=function getValue(object,key){return null==object?void 0:object[key]}(object,key);return baseIsNative(value)?value:void 0}Hash.prototype.clear=function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{}},Hash.prototype.delete=function hashDelete(key){return this.has(key)&&delete this.__data__[key]},Hash.prototype.get=function hashGet(key){var data=this.__data__;if(nativeCreate){var result=data[key];return"__lodash_hash_undefined__"===result?void 0:result}return hasOwnProperty.call(data,key)?data[key]:void 0},Hash.prototype.has=function hashHas(key){var data=this.__data__;return nativeCreate?void 0!==data[key]:hasOwnProperty.call(data,key)},Hash.prototype.set=function hashSet(key,value){return this.__data__[key]=nativeCreate&&void 0===value?"__lodash_hash_undefined__":value,this},ListCache.prototype.clear=function listCacheClear(){this.__data__=[]},ListCache.prototype.delete=function listCacheDelete(key){var data=this.__data__,index=assocIndexOf(data,key);return!(index<0)&&(index==data.length-1?data.pop():splice.call(data,index,1),!0)},ListCache.prototype.get=function listCacheGet(key){var data=this.__data__,index=assocIndexOf(data,key);return index<0?void 0:data[index][1]},ListCache.prototype.has=function listCacheHas(key){return assocIndexOf(this.__data__,key)>-1},ListCache.prototype.set=function listCacheSet(key,value){var data=this.__data__,index=assocIndexOf(data,key);return index<0?data.push([key,value]):data[index][1]=value,this},MapCache.prototype.clear=function mapCacheClear(){this.__data__={hash:new Hash,map:new(Map||ListCache),string:new Hash}},MapCache.prototype.delete=function mapCacheDelete(key){return getMapData(this,key).delete(key)},MapCache.prototype.get=function mapCacheGet(key){return getMapData(this,key).get(key)},MapCache.prototype.has=function mapCacheHas(key){return getMapData(this,key).has(key)},MapCache.prototype.set=function mapCacheSet(key,value){return getMapData(this,key).set(key,value),this};var stringToPath=memoize((function(string){string=function toString(value){return null==value?"":function baseToString(value){if("string"==typeof value)return value;if(isSymbol(value))return symbolToString?symbolToString.call(value):"";var result=value+"";return"0"==result&&1/value==-1/0?"-0":result}(value)}(string);var result=[];return reLeadingDot.test(string)&&result.push(""),string.replace(rePropName,(function(match,number,quote,string){result.push(quote?string.replace(reEscapeChar,"$1"):number||match)})),result}));function toKey(value){if("string"==typeof value||isSymbol(value))return value;var result=value+"";return"0"==result&&1/value==-Infinity?"-0":result}function memoize(func,resolver){if("function"!=typeof func||resolver&&"function"!=typeof resolver)throw new TypeError("Expected a function");var memoized=function(){var args=arguments,key=resolver?resolver.apply(this,args):args[0],cache=memoized.cache;if(cache.has(key))return cache.get(key);var result=func.apply(this,args);return memoized.cache=cache.set(key,result),result};return memoized.cache=new(memoize.Cache||MapCache),memoized}memoize.Cache=MapCache;var isArray=Array.isArray;function isObject(value){var type=typeof value;return!!value&&("object"==type||"function"==type)}function isSymbol(value){return"symbol"==typeof value||function isObjectLike(value){return!!value&&"object"==typeof value}(value)&&"[object Symbol]"==objectToString.call(value)}module.exports=function get(object,path,defaultValue){var result=null==object?void 0:baseGet(object,path);return void 0===result?defaultValue:result}},468:function(module,__unused_webpack_exports,__webpack_require__){var genTag="[object GeneratorFunction]",reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/,reLeadingDot=/^\./,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,reEscapeChar=/\\(\\)?/g,reIsHostCtor=/^\[object .+?Constructor\]$/,reIsUint=/^(?:0|[1-9]\d*)$/,freeGlobal="object"==typeof __webpack_require__.g&&__webpack_require__.g&&__webpack_require__.g.Object===Object&&__webpack_require__.g,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")();var uid,arrayProto=Array.prototype,funcProto=Function.prototype,objectProto=Object.prototype,coreJsData=root["__core-js_shared__"],maskSrcKey=(uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||""))?"Symbol(src)_1."+uid:"",funcToString=funcProto.toString,hasOwnProperty=objectProto.hasOwnProperty,objectToString=objectProto.toString,reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Symbol=root.Symbol,splice=arrayProto.splice,Map=getNative(root,"Map"),nativeCreate=getNative(Object,"create"),symbolProto=Symbol?Symbol.prototype:void 0,symbolToString=symbolProto?symbolProto.toString:void 0;function Hash(entries){var index=-1,length=entries?entries.length:0;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}function ListCache(entries){var index=-1,length=entries?entries.length:0;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}function MapCache(entries){var index=-1,length=entries?entries.length:0;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}function assignValue(object,key,value){var objValue=object[key];hasOwnProperty.call(object,key)&&eq(objValue,value)&&(void 0!==value||key in object)||(object[key]=value)}function assocIndexOf(array,key){for(var length=array.length;length--;)if(eq(array[length][0],key))return length;return-1}function baseIsNative(value){if(!isObject(value)||function isMasked(func){return!!maskSrcKey&&maskSrcKey in func}(value))return!1;var pattern=function isFunction(value){var tag=isObject(value)?objectToString.call(value):"";return"[object Function]"==tag||tag==genTag}(value)||function isHostObject(value){var result=!1;if(null!=value&&"function"!=typeof value.toString)try{result=!!(value+"")}catch(e){}return result}(value)?reIsNative:reIsHostCtor;return pattern.test(function toSource(func){if(null!=func){try{return funcToString.call(func)}catch(e){}try{return func+""}catch(e){}}return""}(value))}function baseSet(object,path,value,customizer){if(!isObject(object))return object;path=function isKey(value,object){if(isArray(value))return!1;var type=typeof value;if("number"==type||"symbol"==type||"boolean"==type||null==value||isSymbol(value))return!0;return reIsPlainProp.test(value)||!reIsDeepProp.test(value)||null!=object&&value in Object(object)}(path,object)?[path]:function castPath(value){return isArray(value)?value:stringToPath(value)}(path);for(var index=-1,length=path.length,lastIndex=length-1,nested=object;null!=nested&&++index<length;){var key=toKey(path[index]),newValue=value;if(index!=lastIndex){var objValue=nested[key];void 0===(newValue=customizer?customizer(objValue,key,nested):void 0)&&(newValue=isObject(objValue)?objValue:isIndex(path[index+1])?[]:{})}assignValue(nested,key,newValue),nested=nested[key]}return object}function getMapData(map,key){var data=map.__data__;return function isKeyable(value){var type=typeof value;return"string"==type||"number"==type||"symbol"==type||"boolean"==type?"__proto__"!==value:null===value}(key)?data["string"==typeof key?"string":"hash"]:data.map}function getNative(object,key){var value=function getValue(object,key){return null==object?void 0:object[key]}(object,key);return baseIsNative(value)?value:void 0}function isIndex(value,length){return!!(length=null==length?9007199254740991:length)&&("number"==typeof value||reIsUint.test(value))&&value>-1&&value%1==0&&value<length}Hash.prototype.clear=function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{}},Hash.prototype.delete=function hashDelete(key){return this.has(key)&&delete this.__data__[key]},Hash.prototype.get=function hashGet(key){var data=this.__data__;if(nativeCreate){var result=data[key];return"__lodash_hash_undefined__"===result?void 0:result}return hasOwnProperty.call(data,key)?data[key]:void 0},Hash.prototype.has=function hashHas(key){var data=this.__data__;return nativeCreate?void 0!==data[key]:hasOwnProperty.call(data,key)},Hash.prototype.set=function hashSet(key,value){return this.__data__[key]=nativeCreate&&void 0===value?"__lodash_hash_undefined__":value,this},ListCache.prototype.clear=function listCacheClear(){this.__data__=[]},ListCache.prototype.delete=function listCacheDelete(key){var data=this.__data__,index=assocIndexOf(data,key);return!(index<0)&&(index==data.length-1?data.pop():splice.call(data,index,1),!0)},ListCache.prototype.get=function listCacheGet(key){var data=this.__data__,index=assocIndexOf(data,key);return index<0?void 0:data[index][1]},ListCache.prototype.has=function listCacheHas(key){return assocIndexOf(this.__data__,key)>-1},ListCache.prototype.set=function listCacheSet(key,value){var data=this.__data__,index=assocIndexOf(data,key);return index<0?data.push([key,value]):data[index][1]=value,this},MapCache.prototype.clear=function mapCacheClear(){this.__data__={hash:new Hash,map:new(Map||ListCache),string:new Hash}},MapCache.prototype.delete=function mapCacheDelete(key){return getMapData(this,key).delete(key)},MapCache.prototype.get=function mapCacheGet(key){return getMapData(this,key).get(key)},MapCache.prototype.has=function mapCacheHas(key){return getMapData(this,key).has(key)},MapCache.prototype.set=function mapCacheSet(key,value){return getMapData(this,key).set(key,value),this};var stringToPath=memoize((function(string){string=function toString(value){return null==value?"":function baseToString(value){if("string"==typeof value)return value;if(isSymbol(value))return symbolToString?symbolToString.call(value):"";var result=value+"";return"0"==result&&1/value==-1/0?"-0":result}(value)}(string);var result=[];return reLeadingDot.test(string)&&result.push(""),string.replace(rePropName,(function(match,number,quote,string){result.push(quote?string.replace(reEscapeChar,"$1"):number||match)})),result}));function toKey(value){if("string"==typeof value||isSymbol(value))return value;var result=value+"";return"0"==result&&1/value==-Infinity?"-0":result}function memoize(func,resolver){if("function"!=typeof func||resolver&&"function"!=typeof resolver)throw new TypeError("Expected a function");var memoized=function(){var args=arguments,key=resolver?resolver.apply(this,args):args[0],cache=memoized.cache;if(cache.has(key))return cache.get(key);var result=func.apply(this,args);return memoized.cache=cache.set(key,result),result};return memoized.cache=new(memoize.Cache||MapCache),memoized}function eq(value,other){return value===other||value!=value&&other!=other}memoize.Cache=MapCache;var isArray=Array.isArray;function isObject(value){var type=typeof value;return!!value&&("object"==type||"function"==type)}function isSymbol(value){return"symbol"==typeof value||function isObjectLike(value){return!!value&&"object"==typeof value}(value)&&"[object Symbol]"==objectToString.call(value)}module.exports=function set(object,path,value){return null==object?object:baseSet(object,path,value)}},782:function(module,__unused_webpack_exports,__webpack_require__){var genTag="[object GeneratorFunction]",reLeadingDot=/^\./,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,reEscapeChar=/\\(\\)?/g,reIsHostCtor=/^\[object .+?Constructor\]$/,freeGlobal="object"==typeof __webpack_require__.g&&__webpack_require__.g&&__webpack_require__.g.Object===Object&&__webpack_require__.g,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")();var uid,arrayProto=Array.prototype,funcProto=Function.prototype,objectProto=Object.prototype,coreJsData=root["__core-js_shared__"],maskSrcKey=(uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||""))?"Symbol(src)_1."+uid:"",funcToString=funcProto.toString,hasOwnProperty=objectProto.hasOwnProperty,objectToString=objectProto.toString,reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Symbol=root.Symbol,splice=arrayProto.splice,Map=getNative(root,"Map"),nativeCreate=getNative(Object,"create"),symbolProto=Symbol?Symbol.prototype:void 0,symbolToString=symbolProto?symbolProto.toString:void 0;function Hash(entries){var index=-1,length=entries?entries.length:0;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}function ListCache(entries){var index=-1,length=entries?entries.length:0;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}function MapCache(entries){var index=-1,length=entries?entries.length:0;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}function assocIndexOf(array,key){for(var value,other,length=array.length;length--;)if((value=array[length][0])===(other=key)||value!=value&&other!=other)return length;return-1}function baseIsNative(value){if(!isObject(value)||function isMasked(func){return!!maskSrcKey&&maskSrcKey in func}(value))return!1;var pattern=function isFunction(value){var tag=isObject(value)?objectToString.call(value):"";return"[object Function]"==tag||tag==genTag}(value)||function isHostObject(value){var result=!1;if(null!=value&&"function"!=typeof value.toString)try{result=!!(value+"")}catch(e){}return result}(value)?reIsNative:reIsHostCtor;return pattern.test(function toSource(func){if(null!=func){try{return funcToString.call(func)}catch(e){}try{return func+""}catch(e){}}return""}(value))}function getMapData(map,key){var data=map.__data__;return function isKeyable(value){var type=typeof value;return"string"==type||"number"==type||"symbol"==type||"boolean"==type?"__proto__"!==value:null===value}(key)?data["string"==typeof key?"string":"hash"]:data.map}function getNative(object,key){var value=function getValue(object,key){return null==object?void 0:object[key]}(object,key);return baseIsNative(value)?value:void 0}Hash.prototype.clear=function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{}},Hash.prototype.delete=function hashDelete(key){return this.has(key)&&delete this.__data__[key]},Hash.prototype.get=function hashGet(key){var data=this.__data__;if(nativeCreate){var result=data[key];return"__lodash_hash_undefined__"===result?void 0:result}return hasOwnProperty.call(data,key)?data[key]:void 0},Hash.prototype.has=function hashHas(key){var data=this.__data__;return nativeCreate?void 0!==data[key]:hasOwnProperty.call(data,key)},Hash.prototype.set=function hashSet(key,value){return this.__data__[key]=nativeCreate&&void 0===value?"__lodash_hash_undefined__":value,this},ListCache.prototype.clear=function listCacheClear(){this.__data__=[]},ListCache.prototype.delete=function listCacheDelete(key){var data=this.__data__,index=assocIndexOf(data,key);return!(index<0)&&(index==data.length-1?data.pop():splice.call(data,index,1),!0)},ListCache.prototype.get=function listCacheGet(key){var data=this.__data__,index=assocIndexOf(data,key);return index<0?void 0:data[index][1]},ListCache.prototype.has=function listCacheHas(key){return assocIndexOf(this.__data__,key)>-1},ListCache.prototype.set=function listCacheSet(key,value){var data=this.__data__,index=assocIndexOf(data,key);return index<0?data.push([key,value]):data[index][1]=value,this},MapCache.prototype.clear=function mapCacheClear(){this.__data__={hash:new Hash,map:new(Map||ListCache),string:new Hash}},MapCache.prototype.delete=function mapCacheDelete(key){return getMapData(this,key).delete(key)},MapCache.prototype.get=function mapCacheGet(key){return getMapData(this,key).get(key)},MapCache.prototype.has=function mapCacheHas(key){return getMapData(this,key).has(key)},MapCache.prototype.set=function mapCacheSet(key,value){return getMapData(this,key).set(key,value),this};var stringToPath=memoize((function(string){string=function toString(value){return null==value?"":function baseToString(value){if("string"==typeof value)return value;if(isSymbol(value))return symbolToString?symbolToString.call(value):"";var result=value+"";return"0"==result&&1/value==-1/0?"-0":result}(value)}(string);var result=[];return reLeadingDot.test(string)&&result.push(""),string.replace(rePropName,(function(match,number,quote,string){result.push(quote?string.replace(reEscapeChar,"$1"):number||match)})),result}));function toKey(value){if("string"==typeof value||isSymbol(value))return value;var result=value+"";return"0"==result&&1/value==-Infinity?"-0":result}function memoize(func,resolver){if("function"!=typeof func||resolver&&"function"!=typeof resolver)throw new TypeError("Expected a function");var memoized=function(){var args=arguments,key=resolver?resolver.apply(this,args):args[0],cache=memoized.cache;if(cache.has(key))return cache.get(key);var result=func.apply(this,args);return memoized.cache=cache.set(key,result),result};return memoized.cache=new(memoize.Cache||MapCache),memoized}memoize.Cache=MapCache;var isArray=Array.isArray;function isObject(value){var type=typeof value;return!!value&&("object"==type||"function"==type)}function isSymbol(value){return"symbol"==typeof value||function isObjectLike(value){return!!value&&"object"==typeof value}(value)&&"[object Symbol]"==objectToString.call(value)}module.exports=function toPath(value){return isArray(value)?function arrayMap(array,iteratee){for(var index=-1,length=array?array.length:0,result=Array(length);++index<length;)result[index]=iteratee(array[index],index,array);return result}(value,toKey):isSymbol(value)?[value]:function copyArray(source,array){var index=-1,length=source.length;for(array||(array=Array(length));++index<length;)array[index]=source[index];return array}(stringToPath(value))}}},__webpack_module_cache__={};function __webpack_require__(moduleId){var cachedModule=__webpack_module_cache__[moduleId];if(void 0!==cachedModule)return cachedModule.exports;var module=__webpack_module_cache__[moduleId]={exports:{}};return __webpack_modules__[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.exports}__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,{a:getter}),getter},__webpack_require__.d=function(exports,definition){for(var key in definition)__webpack_require__.o(definition,key)&&!__webpack_require__.o(exports,key)&&Object.defineProperty(exports,key,{enumerable:!0,get:definition[key]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=function(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)},__webpack_require__.r=function(exports){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})};var __webpack_exports__={};!function(){"use strict";__webpack_require__.d(__webpack_exports__,{$:function(){return nexmap_nexmap}});var bson_browser_esm_namespaceObject={};__webpack_require__.r(bson_browser_esm_namespaceObject),__webpack_require__.d(bson_browser_esm_namespaceObject,{BSONError:function(){return BSONError},BSONRegExp:function(){return BSONRegExp},BSONSymbol:function(){return BSONSymbol},BSONTypeError:function(){return BSONTypeError},BSON_BINARY_SUBTYPE_BYTE_ARRAY:function(){return BSON_BINARY_SUBTYPE_BYTE_ARRAY},BSON_BINARY_SUBTYPE_COLUMN:function(){return BSON_BINARY_SUBTYPE_COLUMN},BSON_BINARY_SUBTYPE_DEFAULT:function(){return BSON_BINARY_SUBTYPE_DEFAULT},BSON_BINARY_SUBTYPE_ENCRYPTED:function(){return BSON_BINARY_SUBTYPE_ENCRYPTED},BSON_BINARY_SUBTYPE_FUNCTION:function(){return BSON_BINARY_SUBTYPE_FUNCTION},BSON_BINARY_SUBTYPE_MD5:function(){return BSON_BINARY_SUBTYPE_MD5},BSON_BINARY_SUBTYPE_USER_DEFINED:function(){return BSON_BINARY_SUBTYPE_USER_DEFINED},BSON_BINARY_SUBTYPE_UUID:function(){return BSON_BINARY_SUBTYPE_UUID},BSON_BINARY_SUBTYPE_UUID_NEW:function(){return BSON_BINARY_SUBTYPE_UUID_NEW},BSON_DATA_ARRAY:function(){return BSON_DATA_ARRAY},BSON_DATA_BINARY:function(){return BSON_DATA_BINARY},BSON_DATA_BOOLEAN:function(){return BSON_DATA_BOOLEAN},BSON_DATA_CODE:function(){return BSON_DATA_CODE},BSON_DATA_CODE_W_SCOPE:function(){return BSON_DATA_CODE_W_SCOPE},BSON_DATA_DATE:function(){return BSON_DATA_DATE},BSON_DATA_DBPOINTER:function(){return BSON_DATA_DBPOINTER},BSON_DATA_DECIMAL128:function(){return BSON_DATA_DECIMAL128},BSON_DATA_INT:function(){return BSON_DATA_INT},BSON_DATA_LONG:function(){return BSON_DATA_LONG},BSON_DATA_MAX_KEY:function(){return BSON_DATA_MAX_KEY},BSON_DATA_MIN_KEY:function(){return BSON_DATA_MIN_KEY},BSON_DATA_NULL:function(){return BSON_DATA_NULL},BSON_DATA_NUMBER:function(){return BSON_DATA_NUMBER},BSON_DATA_OBJECT:function(){return BSON_DATA_OBJECT},BSON_DATA_OID:function(){return BSON_DATA_OID},BSON_DATA_REGEXP:function(){return BSON_DATA_REGEXP},BSON_DATA_STRING:function(){return BSON_DATA_STRING},BSON_DATA_SYMBOL:function(){return BSON_DATA_SYMBOL},BSON_DATA_TIMESTAMP:function(){return BSON_DATA_TIMESTAMP},BSON_DATA_UNDEFINED:function(){return BSON_DATA_UNDEFINED},BSON_INT32_MAX:function(){return BSON_INT32_MAX},BSON_INT32_MIN:function(){return BSON_INT32_MIN},BSON_INT64_MAX:function(){return BSON_INT64_MAX},BSON_INT64_MIN:function(){return BSON_INT64_MIN},Binary:function(){return Binary},Code:function(){return Code},DBRef:function(){return DBRef},Decimal128:function(){return Decimal128},Double:function(){return Double},EJSON:function(){return EJSON},Int32:function(){return Int32},Long:function(){return Long},LongWithoutOverridesClass:function(){return LongWithoutOverridesClass},Map:function(){return bsonMap},MaxKey:function(){return MaxKey},MinKey:function(){return MinKey},ObjectID:function(){return ObjectId},ObjectId:function(){return ObjectId},Timestamp:function(){return Timestamp},UUID:function(){return UUID},calculateObjectSize:function(){return calculateObjectSize},default:function(){return bson_browser_esm},deserialize:function(){return deserialize},deserializeStream:function(){return deserializeStream},serialize:function(){return serialize},serializeWithBufferAndIndex:function(){return serializeWithBufferAndIndex},setInternalBufferSize:function(){return setInternalBufferSize}});var _nexusclient$variable,_nexusclient$variable2,_nexusclient$variable3,_nexusclient$variable4,_nexusclient$variable5,_nexusclient$variable6,_nexusclient$variable7,_nexusclient$variable8,_nexusclient$variable9,_nexusclient$variable10,_nexusclient$variable11,_nexusclient$variable12,_nexusclient$variable13,_nexusclient$variable14,_nexusclient$variable15,_nexusclient$variable16,_nexusclient$variable17,_nexusclient$variable18,bundle_dom_es_namespaceObject={};__webpack_require__.r(bundle_dom_es_namespaceObject),__webpack_require__.d(bundle_dom_es_namespaceObject,{App:function(){return App},BSON:function(){return bson_browser_esm_namespaceObject},Credentials:function(){return Credentials},DEFAULT_BASE_URL:function(){return DEFAULT_BASE_URL},LocalStorage:function(){return LocalStorage},MongoDBRealmError:function(){return MongoDBRealmError},User:function(){return User},UserState:function(){return UserState},UserType:function(){return UserType$1},getApp:function(){return getApp},getEnvironment:function(){return getEnvironment},handleAuthRedirect:function(){return handleAuthRedirect},setEnvironment:function(){return setEnvironment}}),"undefined"==typeof nexusclient&&(window.nexusclient={_variables:{get:function get(){return!1}},variables:function variables(){return this._variables},settings:function settings(){return{echo_input:!0}},add_html_line:function add_html_line(args){console.log("add_html_line(): ".concat(args))},send_commands:function send_commands(args){console.log("send_commands(): ".concat(args))}});var settings_userPreferences={intialConfiguration:(null===(_nexusclient$variable=nexusclient.variables().get("nexMapConfigs"))||void 0===_nexusclient$variable?void 0:_nexusclient$variable.initialConfiguration)||0,commandSeparator:(null===(_nexusclient$variable2=nexusclient.variables().get("nexMapConfigs"))||void 0===_nexusclient$variable2?void 0:_nexusclient$variable2.commandSeparator)||"\\",useDuanathar:(null===(_nexusclient$variable3=nexusclient.variables().get("nexMapConfigs"))||void 0===_nexusclient$variable3?void 0:_nexusclient$variable3.useDuanathar)||!1,useDuanatharan:(null===(_nexusclient$variable4=nexusclient.variables().get("nexMapConfigs"))||void 0===_nexusclient$variable4?void 0:_nexusclient$variable4.useDuanatharan)||!1,duanatharCommand:(null===(_nexusclient$variable5=nexusclient.variables().get("nexMapConfigs"))||void 0===_nexusclient$variable5?void 0:_nexusclient$variable5.duanatharCommand)||"say duanathar",duanatharanCommand:(null===(_nexusclient$variable6=nexusclient.variables().get("nexMapConfigs"))||void 0===_nexusclient$variable6?void 0:_nexusclient$variable6.duanatharanCommand)||"say duanatharan",useSewergrates:(null===(_nexusclient$variable7=nexusclient.variables().get("nexMapConfigs"))||void 0===_nexusclient$variable7?void 0:_nexusclient$variable7.useSewergrates)||!1,useWormholes:(null===(_nexusclient$variable8=nexusclient.variables().get("nexMapConfigs"))||void 0===_nexusclient$variable8?void 0:_nexusclient$variable8.useWormholes)||!1,useUniverse:(null===(_nexusclient$variable9=nexusclient.variables().get("nexMapConfigs"))||void 0===_nexusclient$variable9?void 0:_nexusclient$variable9.useUniverse)||!1,vibratingStick:(null===(_nexusclient$variable10=nexusclient.variables().get("nexMapConfigs"))||void 0===_nexusclient$variable10?void 0:_nexusclient$variable10.vibratingStick)||!1,displayWormholes:(null===(_nexusclient$variable11=nexusclient.variables().get("nexMapConfigs"))||void 0===_nexusclient$variable11?void 0:_nexusclient$variable11.displayWormholes)||!1,currentRoomShape:(null===(_nexusclient$variable12=nexusclient.variables().get("nexMapConfigs"))||void 0===_nexusclient$variable12?void 0:_nexusclient$variable12.currentRoomShape)||"rectangle",currentRoomColor:(null===(_nexusclient$variable13=nexusclient.variables().get("nexMapConfigs"))||void 0===_nexusclient$variable13?void 0:_nexusclient$variable13.currentRoomColor)||"#ff1493",labelDisplay:(null===(_nexusclient$variable14=nexusclient.variables().get("nexMapConfigs"))||void 0===_nexusclient$variable14?void 0:_nexusclient$variable14.labelDisplay)||"name",landmarks:(null===(_nexusclient$variable15=nexusclient.variables().get("nexMapConfigs"))||void 0===_nexusclient$variable15?void 0:_nexusclient$variable15.landmarks)||[],antiWingAreas:(null===(_nexusclient$variable16=nexusclient.variables().get("nexMapConfigs"))||void 0===_nexusclient$variable16?void 0:_nexusclient$variable16.antiWingAreas)||[],antiGareAreas:(null===(_nexusclient$variable17=nexusclient.variables().get("nexMapConfigs"))||void 0===_nexusclient$variable17?void 0:_nexusclient$variable17.antiGareAreas)||[],antiUniverseAreas:(null===(_nexusclient$variable18=nexusclient.variables().get("nexMapConfigs"))||void 0===_nexusclient$variable18?void 0:_nexusclient$variable18.antiUniverseAreas)||[]},settings_save=function save(){settings_userPreferences.initialConfiguration=nexmap_nexmap.version,nexusclient.variables().set("nexMapConfigs",settings_userPreferences)},toggle=function toggle(seting){settings_userPreferences[seting]?settings_userPreferences[seting]=!1:settings_userPreferences[seting]=!0,"useWormholes"===seting?function toggleWormholes(){settings_userPreferences.useWormholes?nexmap_nexmap.wormholes.restore():nexmap_nexmap.wormholes.remove()}():"useSewergrates"===seting&&function toggleSewergrates(){settings_userPreferences.useSewergrates?nexmap_nexmap.sewergrates.restore():nexmap_nexmap.sewergrates.remove()}(),settings_save()},universeRooms={main:{1772:"azdun",25093:"bitterfork",10573:"blackrock",30383:"brasslantern",17678:"caerwitrin",10091:"genji",9124:"manara",1745:"mannaseh",8730:"manusha",39103:"mhojave",25581:"newhope",20386:"newthera",2855:"shastaan",35703:"thraasi"},meropis:{35450:"judgement",1226:"rageteeth",29755:"seleucar",12207:"yggdrasil"}},shortDirs={e:"east",w:"west",s:"south",n:"north",ne:"northeast",nw:"northwest",se:"southeast",sw:"southwest",in:"in",out:"out",d:"down",up:"up"},longDirs={east:"e",west:"w",south:"s",north:"n",northeast:"ne",northwest:"nw",southeast:"se",southeastst:"se",southwest:"sw",in:"in",out:"out",down:"d",up:"up"},areaContinents={Outer:[297,209,207,162,351,191,194,314,193,192,294,206,181,396,317,225],Western_Isles:[209,162,207],Eastern_Isles:[191,180,181,192],Arcadia:[150,153,154],North:[73,74,99,101,108,147,197,199,200,202,204,212,213,214,242,243,244,246,261,262,301,306,307,308,352,353,383,385,109],Northern_Isles:[194,206,294,351],Off:[6,35,105,150,153,154,162,163,166,168,169,170,171,176,180,181,183,190,191,192,193,194,206,207,109,225,245,248,249,252,253,266,271,288,294,297,298,314,317,321,324,351,355,358,359,366,371,382,396,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,419,420,421,422,423,45,184],Main:[2,3,4,5,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,36,37,38,40,41,42,43,44,46,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,68,69,70,71,72,75,76,77,78,79,80,81,82,83,84,85,87,89,90,95,96,102,103,104,106,107,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,142,144,145,148,149,151,152,155,156,157,158,159,160,167,173,174,175,178,179,182,185,186,187,196,198,201,203,205,208,211,235,238,259,263,264,265,267,268,269,270,272,273,274,275,278,279,280,281,290,291,292,293,295,296,299,300,302,303,309,310,311,312,315,316,318,319,320,323,326,346,347,348,349,350,357,361,362,364,365,367,368,372,374,375,376,377,378,379,380,381,384,386,387,388,389,390,391,392,393,394,395,397,398,400,401,402,461,463,105,298],Meropis:[39,67,141,210,215,217,218,256,282,284,285,286,305,322,325,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,399,445],Arena:[228,229,230,231,232,233,369],Island:[91,92,93,94,97,98,100,161,164,165,195,224,240,464]};function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}function _createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function F(){};return{s:F,n:function n(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function e(_e3){throw _e3},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function s(){it=it.call(o)},n:function n(){var step=it.next();return normalCompletion=step.done,step},e:function e(_e4){didErr=!0,err=_e4},f:function f(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||_unsupportedIterableToArray(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return exports};var exports={},Op=Object.prototype,hasOwn=Op.hasOwnProperty,$Symbol="function"==typeof Symbol?Symbol:{},iteratorSymbol=$Symbol.iterator||"@@iterator",asyncIteratorSymbol=$Symbol.asyncIterator||"@@asyncIterator",toStringTagSymbol=$Symbol.toStringTag||"@@toStringTag";function define(obj,key,value){return Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}),obj[key]}try{define({},"")}catch(err){define=function define(obj,key,value){return obj[key]=value}}function wrap(innerFn,outerFn,self,tryLocsList){var protoGenerator=outerFn&&outerFn.prototype instanceof Generator?outerFn:Generator,generator=Object.create(protoGenerator.prototype),context=new Context(tryLocsList||[]);return generator._invoke=function(innerFn,self,context){var state="suspendedStart";return function(method,arg){if("executing"===state)throw new Error("Generator is already running");if("completed"===state){if("throw"===method)throw arg;return doneResult()}for(context.method=method,context.arg=arg;;){var delegate=context.delegate;if(delegate){var delegateResult=maybeInvokeDelegate(delegate,context);if(delegateResult){if(delegateResult===ContinueSentinel)continue;return delegateResult}}if("next"===context.method)context.sent=context._sent=context.arg;else if("throw"===context.method){if("suspendedStart"===state)throw state="completed",context.arg;context.dispatchException(context.arg)}else"return"===context.method&&context.abrupt("return",context.arg);state="executing";var record=tryCatch(innerFn,self,context);if("normal"===record.type){if(state=context.done?"completed":"suspendedYield",record.arg===ContinueSentinel)continue;return{value:record.arg,done:context.done}}"throw"===record.type&&(state="completed",context.method="throw",context.arg=record.arg)}}}(innerFn,self,context),generator}function tryCatch(fn,obj,arg){try{return{type:"normal",arg:fn.call(obj,arg)}}catch(err){return{type:"throw",arg:err}}}exports.wrap=wrap;var ContinueSentinel={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var IteratorPrototype={};define(IteratorPrototype,iteratorSymbol,(function(){return this}));var getProto=Object.getPrototypeOf,NativeIteratorPrototype=getProto&&getProto(getProto(values([])));NativeIteratorPrototype&&NativeIteratorPrototype!==Op&&hasOwn.call(NativeIteratorPrototype,iteratorSymbol)&&(IteratorPrototype=NativeIteratorPrototype);var Gp=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(IteratorPrototype);function defineIteratorMethods(prototype){["next","throw","return"].forEach((function(method){define(prototype,method,(function(arg){return this._invoke(method,arg)}))}))}function AsyncIterator(generator,PromiseImpl){function invoke(method,arg,resolve,reject){var record=tryCatch(generator[method],generator,arg);if("throw"!==record.type){var result=record.arg,value=result.value;return value&&"object"==_typeof(value)&&hasOwn.call(value,"__await")?PromiseImpl.resolve(value.__await).then((function(value){invoke("next",value,resolve,reject)}),(function(err){invoke("throw",err,resolve,reject)})):PromiseImpl.resolve(value).then((function(unwrapped){result.value=unwrapped,resolve(result)}),(function(error){return invoke("throw",error,resolve,reject)}))}reject(record.arg)}var previousPromise;this._invoke=function(method,arg){function callInvokeWithMethodAndArg(){return new PromiseImpl((function(resolve,reject){invoke(method,arg,resolve,reject)}))}return previousPromise=previousPromise?previousPromise.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}}function maybeInvokeDelegate(delegate,context){var method=delegate.iterator[context.method];if(void 0===method){if(context.delegate=null,"throw"===context.method){if(delegate.iterator.return&&(context.method="return",context.arg=void 0,maybeInvokeDelegate(delegate,context),"throw"===context.method))return ContinueSentinel;context.method="throw",context.arg=new TypeError("The iterator does not provide a 'throw' method")}return ContinueSentinel}var record=tryCatch(method,delegate.iterator,context.arg);if("throw"===record.type)return context.method="throw",context.arg=record.arg,context.delegate=null,ContinueSentinel;var info=record.arg;return info?info.done?(context[delegate.resultName]=info.value,context.next=delegate.nextLoc,"return"!==context.method&&(context.method="next",context.arg=void 0),context.delegate=null,ContinueSentinel):info:(context.method="throw",context.arg=new TypeError("iterator result is not an object"),context.delegate=null,ContinueSentinel)}function pushTryEntry(locs){var entry={tryLoc:locs[0]};1 in locs&&(entry.catchLoc=locs[1]),2 in locs&&(entry.finallyLoc=locs[2],entry.afterLoc=locs[3]),this.tryEntries.push(entry)}function resetTryEntry(entry){var record=entry.completion||{};record.type="normal",delete record.arg,entry.completion=record}function Context(tryLocsList){this.tryEntries=[{tryLoc:"root"}],tryLocsList.forEach(pushTryEntry,this),this.reset(!0)}function values(iterable){if(iterable){var iteratorMethod=iterable[iteratorSymbol];if(iteratorMethod)return iteratorMethod.call(iterable);if("function"==typeof iterable.next)return iterable;if(!isNaN(iterable.length)){var i=-1,next=function next(){for(;++i<iterable.length;)if(hasOwn.call(iterable,i))return next.value=iterable[i],next.done=!1,next;return next.value=void 0,next.done=!0,next};return next.next=next}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,define(Gp,"constructor",GeneratorFunctionPrototype),define(GeneratorFunctionPrototype,"constructor",GeneratorFunction),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,toStringTagSymbol,"GeneratorFunction"),exports.isGeneratorFunction=function(genFun){var ctor="function"==typeof genFun&&genFun.constructor;return!!ctor&&(ctor===GeneratorFunction||"GeneratorFunction"===(ctor.displayName||ctor.name))},exports.mark=function(genFun){return Object.setPrototypeOf?Object.setPrototypeOf(genFun,GeneratorFunctionPrototype):(genFun.__proto__=GeneratorFunctionPrototype,define(genFun,toStringTagSymbol,"GeneratorFunction")),genFun.prototype=Object.create(Gp),genFun},exports.awrap=function(arg){return{__await:arg}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,asyncIteratorSymbol,(function(){return this})),exports.AsyncIterator=AsyncIterator,exports.async=function(innerFn,outerFn,self,tryLocsList,PromiseImpl){void 0===PromiseImpl&&(PromiseImpl=Promise);var iter=new AsyncIterator(wrap(innerFn,outerFn,self,tryLocsList),PromiseImpl);return exports.isGeneratorFunction(outerFn)?iter:iter.next().then((function(result){return result.done?result.value:iter.next()}))},defineIteratorMethods(Gp),define(Gp,toStringTagSymbol,"Generator"),define(Gp,iteratorSymbol,(function(){return this})),define(Gp,"toString",(function(){return"[object Generator]"})),exports.keys=function(object){var keys=[];for(var key in object)keys.push(key);return keys.reverse(),function next(){for(;keys.length;){var key=keys.pop();if(key in object)return next.value=key,next.done=!1,next}return next.done=!0,next}},exports.values=values,Context.prototype={constructor:Context,reset:function reset(skipTempReset){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!skipTempReset)for(var name in this)"t"===name.charAt(0)&&hasOwn.call(this,name)&&!isNaN(+name.slice(1))&&(this[name]=void 0)},stop:function stop(){this.done=!0;var rootRecord=this.tryEntries[0].completion;if("throw"===rootRecord.type)throw rootRecord.arg;return this.rval},dispatchException:function dispatchException(exception){if(this.done)throw exception;var context=this;function handle(loc,caught){return record.type="throw",record.arg=exception,context.next=loc,caught&&(context.method="next",context.arg=void 0),!!caught}for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i],record=entry.completion;if("root"===entry.tryLoc)return handle("end");if(entry.tryLoc<=this.prev){var hasCatch=hasOwn.call(entry,"catchLoc"),hasFinally=hasOwn.call(entry,"finallyLoc");if(hasCatch&&hasFinally){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0);if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}else if(hasCatch){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0)}else{if(!hasFinally)throw new Error("try statement without catch or finally");if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}}}},abrupt:function abrupt(type,arg){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc<=this.prev&&hasOwn.call(entry,"finallyLoc")&&this.prev<entry.finallyLoc){var finallyEntry=entry;break}}finallyEntry&&("break"===type||"continue"===type)&&finallyEntry.tryLoc<=arg&&arg<=finallyEntry.finallyLoc&&(finallyEntry=null);var record=finallyEntry?finallyEntry.completion:{};return record.type=type,record.arg=arg,finallyEntry?(this.method="next",this.next=finallyEntry.finallyLoc,ContinueSentinel):this.complete(record)},complete:function complete(record,afterLoc){if("throw"===record.type)throw record.arg;return"break"===record.type||"continue"===record.type?this.next=record.arg:"return"===record.type?(this.rval=this.arg=record.arg,this.method="return",this.next="end"):"normal"===record.type&&afterLoc&&(this.next=afterLoc),ContinueSentinel},finish:function finish(finallyLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.finallyLoc===finallyLoc)return this.complete(entry.completion,entry.afterLoc),resetTryEntry(entry),ContinueSentinel}},catch:function _catch(tryLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc===tryLoc){var record=entry.completion;if("throw"===record.type){var thrown=record.arg;resetTryEntry(entry)}return thrown}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(iterable,resultName,nextLoc){return this.delegate={iterator:values(iterable),resultName:resultName,nextLoc:nextLoc},"next"===this.method&&(this.arg=void 0),ContinueSentinel}},exports}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}var _speedWalk,walker={pathing:!1,pathRooms:[],pathCommands:[],pathRawRooms:[],pathRawCommands:[],pathingStartTime:Date.now(),delay:!1,destination:0,stepCommand:"",placeHolderRooms:["duanathar","duanatharMeropis","universe","universeMeropis","gare"],speedWalk:(_speedWalk=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(s,t){return _regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return nexmap_nexmap.logging&&console.log("nexMap: speedwalk()"),walker.pathingStartTime=Date.now(),clientEcho=window.nexusclient.settings().echo_input,window.nexusclient.settings().echo_input=!1,_context.next=6,determinePath(s,t);case 6:step();case 7:case"end":return _context.stop()}}),_callee)}))),function speedWalk(_x,_x2){return _speedWalk.apply(this,arguments)}),stop:function stop(){nexmap_nexmap.logging&&console.log("nexMap: stop()"),!0===walker.pathing&&(display_notice("Pathing canceled"),window.nexusclient.send_commands("path stop")),walker_reset()},goto:function goto(str){if("number"==typeof str)str=str.toString();else if("string"!=typeof str)return;console.log("str: ".concat(str));var findMark=settings_userPreferences.landmarks.find((function(e){return e.name.toLowerCase()===str.toLowerCase()}));if(findMark)walker.speedWalk(nexmap_nexmap.currentRoom,findMark.roomID);else{console.log("findMark: ".concat(findMark));var areas=nexmap_nexmap.findArea(str);if(console.log("areas: ".concat(areas)),0===areas.length){var findAreas=nexmap_nexmap.findAreas(str);console.log(findAreas);var findMarks=settings_userPreferences.landmarks.filter((function(e){return e.name.toLowerCase().includes(str.toLowerCase())}));return findAreas.length&&nexmap_nexmap.display.generateTable("areaTable",findAreas,str),void(findMarks.length&&nexmap_nexmap.display.generateTable("landmarkTable",findMarks,str))}if(1!==areas.length){var closestArea={id:0,distance:999999};areas.forEach((function(a){var ar=function findAreaNode(areaID){var _aStar$path,_aStar$path$nodes,aStar=cy.elements().aStar({root:"#".concat(nexmap_nexmap.currentRoom),goal:cy.$("[area = ".concat(areaID,"]")),weight:function weight(edge){return edge.data("weight")},directed:!0});return{distance:null==aStar||null===(_aStar$path=aStar.path)||void 0===_aStar$path||null===(_aStar$path$nodes=_aStar$path.nodes())||void 0===_aStar$path$nodes?void 0:_aStar$path$nodes.findIndex((function(e){return e.data("area")===areaID})),id:areaID}}(a.id);ar.distance<closestArea.distance&&(closestArea=ar)})),console.log("closestArea: ".concat(closestArea)),areaWalk(closestArea.id)}else areaWalk(areas[0].id)}}},clientEcho=window.nexusclient.settings().echo_input,areaWalk=function(){var _ref=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(areaID){var target;return _regeneratorRuntime().wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:target=cy.elements().aStar({root:"#".concat(nexmap_nexmap.currentRoom),goal:cy.$("[area = ".concat(areaID,"]")),weight:function weight(edge){return edge.data("weight")},directed:!0}).path.nodes().find((function(n){return n.data("area")===areaID})).data("id"),walker.speedWalk(nexmap_nexmap.currentRoom,target);case 2:case"end":return _context2.stop()}}),_callee2)})));return function areaWalk(_x3){return _ref.apply(this,arguments)}}(),step=function step(){if(nexmap_nexmap.logging&&console.log("nexMap: step()"),0!==walker.pathCommands.length){var index=walker.pathRooms.indexOf(GMCP.Room.Info.num.toString());if(GMCP.Room.Info.num===walker.destination)return walker.pathing=!1,walker_reset(),void display_notice("Pathing complete. ".concat((Date.now()-walker.pathingStartTime)/1e3,"s"));index>=0&&(walker.pathing=!0,walker.stepCommand=walker.pathCommands[index]),nexmap_nexmap.logging&&console.log(walker.stepCommand),window.nexusclient.send_commands("".concat(walker.stepCommand))}else nexmap_nexmap.logging&&console.log("nexMap: step RETURN")},determinePath=function(){var _ref2=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(src,tar){var source,target,baseStar,gare,universe,wings,_yield$Promise$all,_yield$Promise$all2,optimalStar;return _regeneratorRuntime().wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(nexmap_nexmap.logging&&console.log("nexMap: determinePath(".concat(src,", ").concat(tar,")")),walker.pathCommands=[],walker.pathRooms=[],source=src||GMCP.Room.Info.num,target=tar||cy.$(":selected").data("id"),source!==target){_context3.next=10;break}return walker.pathing=!1,walker_reset(),display_notice("Pathing complete. You're already there!"),_context3.abrupt("return");case 10:return walker.destination=parseInt(target),_context3.next=13,aStar(source,target);case 13:if((baseStar=_context3.sent).type="base",nexmap_nexmap.logging&&(console.log(baseStar),window.baseStar=baseStar),cy.$("#".concat(source)).data("area")!==cy.$("#".concat(target)).data("area")){_context3.next=19;break}return hybridPath(baseStar),_context3.abrupt("return",!0);case 19:return _context3.next=21,Promise.all([checkGare(baseStar,target),checkUniverse(baseStar,target),checkClouds(baseStar,target)]);case 21:if(_yield$Promise$all=_context3.sent,_yield$Promise$all2=_slicedToArray(_yield$Promise$all,3),gare=_yield$Promise$all2[0],universe=_yield$Promise$all2[1],wings=_yield$Promise$all2[2],optimalStar=[gare,universe,wings,baseStar].reduce((function(a,b){return a?b&&a.distance>b.distance?b:a:b}))){_context3.next=30;break}return nexmap_nexmap.display.notice("No path to ".concat(target," found.")),_context3.abrupt("return",!1);case 30:if(!["universe","gare"].includes(optimalStar.type)){_context3.next=35;break}return _context3.next=33,checkClouds(optimalStar,target);case 33:wings=_context3.sent,optimalStar=wings.distance<optimalStar.distance?wings:optimalStar;case 35:return _context3.next=37,hybridPath(optimalStar);case 37:return _context3.abrupt("return",!0);case 38:case"end":return _context3.stop()}}),_callee3)})));return function determinePath(_x4,_x5){return _ref2.apply(this,arguments)}}(),aStar=function(){var _ref3=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(source,target){return _regeneratorRuntime().wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.abrupt("return",cy.elements().aStar({root:"#".concat(source),goal:"#".concat(target),weight:function weight(edge){return edge.data("weight")},directed:!0}));case 1:case"end":return _context4.stop()}}),_callee4)})));return function aStar(_x6,_x7){return _ref3.apply(this,arguments)}}(),checkGare=function(){var _ref4=_asyncToGenerator(_regeneratorRuntime().mark((function _callee5(astar,tar){var firstGareRoomIndex,gareStar;return _regeneratorRuntime().wrap((function _callee5$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(nexmap_nexmap.logging&&console.log("nexMap: checkGare(".concat(astar,", ").concat(tar,")")),GMCP.Status.class.includes("Dragon")){_context5.next=3;break}return _context5.abrupt("return",!1);case 3:if(-1!==(firstGareRoomIndex=astar.path.nodes().findIndex((function(e){return!settings_userPreferences.antiGareAreas.includes(e.data("area"))})))){_context5.next=6;break}return _context5.abrupt("return",!1);case 6:return _context5.next=8,aStar("gare",tar);case 8:if(gareStar=_context5.sent){_context5.next=11;break}return _context5.abrupt("return",!1);case 11:return gareStar.distance+=firstGareRoomIndex,gareStar.type="gare",gareStar.path=firstGareRoomIndex>0?astar.path.slice(0,2*firstGareRoomIndex+1).merge(gareStar.path):gareStar.path,_context5.abrupt("return",gareStar);case 15:case"end":return _context5.stop()}}),_callee5)})));return function checkGare(_x8,_x9){return _ref4.apply(this,arguments)}}(),checkUniverse=function(){var _ref5=_asyncToGenerator(_regeneratorRuntime().mark((function _callee6(astar,target){var meropis,firstUniverseRoomIndex,universeStar;return _regeneratorRuntime().wrap((function _callee6$(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:if(nexmap_nexmap.logging&&console.log("nexMap: checkUniverse(".concat(astar,", ").concat(target,")")),settings_userPreferences.useUniverse){_context6.next=3;break}return _context6.abrupt("return");case 3:if(["Jester","Occultist"].includes(GMCP.Status.class)){_context6.next=5;break}return _context6.abrupt("return");case 5:if(meropis=!1,areaContinents.Meropis.includes(nexmap_nexmap.currentArea)&&(meropis="Meropis"),-1!==(firstUniverseRoomIndex=astar.path.nodes().findIndex((function(e){return!settings_userPreferences.antiUniverseAreas.includes(e.data("area"))})))){_context6.next=10;break}return _context6.abrupt("return");case 10:return nexmap_nexmap.logging&&console.log("firstUniverseRoomIndex",firstUniverseRoomIndex),_context6.next=13,aStar("universe",target);case 13:if(universeStar=_context6.sent){_context6.next=16;break}return _context6.abrupt("return",!1);case 16:return universeStar.distance+=firstUniverseRoomIndex,universeStar.type="universe",universeStar.path=firstUniverseRoomIndex>0?astar.path.slice(0,2*firstUniverseRoomIndex+1).merge(universeStar.path):universeStar.path,universeRooms[meropis?"meropis":"main"][universeStar.path.nodes()[1].data("id")],_context6.abrupt("return",universeStar);case 21:case"end":return _context6.stop()}}),_callee6)})));return function checkUniverse(_x10,_x11){return _ref5.apply(this,arguments)}}(),checkClouds=function(){var _ref6=_asyncToGenerator(_regeneratorRuntime().mark((function _callee7(astar,target){var meropis,firstOutdoorRoomIndex,cloudStar,highCloudStar;return _regeneratorRuntime().wrap((function _callee7$(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:if(nexmap_nexmap.logging&&console.log("nexMap: checkClouds()"),settings_userPreferences.useDuanathar||settings_userPreferences.useDuanatharan){_context7.next=3;break}return _context7.abrupt("return");case 3:if(meropis="",areaContinents.Meropis.includes(nexmap_nexmap.currentArea)&&(meropis="Meropis"),-1!==(firstOutdoorRoomIndex=astar.path.nodes().findIndex((function(e){return!settings_userPreferences.antiWingAreas.includes(e.data("area"))&&("y"!==e.data("userData").indoors||"y"===e.data("userData").outdoors)})))){_context7.next=8;break}return _context7.abrupt("return",!1);case 8:return _context7.next=10,aStar("duanathar"+meropis,target);case 10:if((cloudStar=_context7.sent).distance+=firstOutdoorRoomIndex,cloudStar.type="duanathar",cloudStar.path=firstOutdoorRoomIndex>0?astar.path.slice(0,2*firstOutdoorRoomIndex+1).merge(cloudStar.path):cloudStar.path,highCloudStar=!1,!settings_userPreferences.useDuanatharan){_context7.next=22;break}return _context7.next=18,aStar("duanatharan"+meropis,target);case 18:(highCloudStar=_context7.sent).distance+=firstOutdoorRoomIndex,highCloudStar.type="duanatharan",highCloudStar.path=firstOutdoorRoomIndex>0?astar.path.slice(0,2*firstOutdoorRoomIndex+2).merge(highCloudStar.path):highCloudStar.path;case 22:return _context7.abrupt("return",highCloudStar.distance<cloudStar.distance?highCloudStar:cloudStar);case 23:case"end":return _context7.stop()}}),_callee7)})));return function checkClouds(_x12,_x13){return _ref6.apply(this,arguments)}}(),hybridPath=function(){var _ref7=_asyncToGenerator(_regeneratorRuntime().mark((function _callee8(optimalStar){var baseCmds,baseRooms,_iterator,_step,e,_iterator2,_step2,_e2,hybCmds,hybRm,pathTrackDistance,i;return _regeneratorRuntime().wrap((function _callee8$(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:nexmap_nexmap.logging&&console.log("nexMap: hybridPath()"),baseCmds=[],baseRooms=[],_iterator=_createForOfIteratorHelper(optimalStar.path.nodes());try{for(_iterator.s();!(_step=_iterator.n()).done;)e=_step.value,baseRooms.push(e.data("id"))}catch(err){_iterator.e(err)}finally{_iterator.f()}_iterator2=_createForOfIteratorHelper(optimalStar.path.edges());try{for(_iterator2.s();!(_step2=_iterator2.n()).done;)_e2=_step2.value,baseCmds.push(_e2.data("command"))}catch(err){_iterator2.e(err)}finally{_iterator2.f()}shortDirs[baseCmds[0]]||parseInt(baseRooms[0])||baseRooms.unshift(GMCP.Room.Info.num.toString()),nexmap_nexmap.logging&&(console.log("hybridPath() thispc, thispr"),console.log(baseCmds),console.log(baseRooms)),baseRooms=baseRooms.filter((function(e){return parseInt(e)>0})),nexmap_nexmap.logging&&(console.log("hybridPath() SCRUBBED"),console.log(baseCmds),console.log(baseRooms)),hybCmds=[],hybRm=[GMCP.Room.Info.num.toString()],pathTrackDistance=0,i=0;case 15:if(!(i<baseCmds.length)){_context8.next=30;break}if(++pathTrackDistance,shortDirs[baseCmds[i]]){_context8.next=21;break}return hybRm.push(baseRooms[i+1]),hybCmds.push(baseCmds[i]),_context8.abrupt("continue",27);case 21:if(!shortDirs[baseCmds[i]]||shortDirs[baseCmds[i+1]]){_context8.next=26;break}return hybRm.push(baseRooms[i+1]),hybCmds.push("path track ".concat(baseRooms[i+1])),pathTrackDistance=0,_context8.abrupt("continue",27);case 26:pathTrackDistance>90&&(hybRm.push(baseRooms[i]),hybCmds.push("path track ".concat(baseRooms[i])),pathTrackDistance=0);case 27:i++,_context8.next=15;break;case 30:return nexmap_nexmap.logging&&(console.log("hybridPath() hybCmds, hybRm"),console.log(hybCmds),console.log(hybRm)),walker.pathCommands=[].concat(hybCmds),walker.pathRooms=[].concat(hybRm),nexmap_nexmap.logging&&(console.log("FINAL hybridPath() thispc, thispr"),console.log(walker.pathCommands),console.log(walker.pathRooms)),_context8.abrupt("return",!0);case 35:case"end":return _context8.stop()}}),_callee8)})));return function hybridPath(_x14){return _ref7.apply(this,arguments)}}(),walker_reset=function reset(){nexmap_nexmap.logging&&console.log("nexMap: reset()"),!1,walker.pathing=!1,cy.$(":selected").unselect(),walker.pathCommands=[],walker.pathRooms=[],walker.destination=0,walker.stepCommand="",walker.delay=!1,window.nexusclient.settings().echo_input=clientEcho},pageIndex=0,displayCap={},displayEntries={},display_printHTML=function printHTML(html){window.nexusclient.add_html_line(html),document.getElementById("htmlTest").innerHTML+=html},display_notice=function notice(txt){var html=arguments.length>1&&void 0!==arguments[1]&&arguments[1],msg=document.createElement("span");msg.setAttribute("class","mono"),msg.appendChild(Object.assign(document.createElement("span"),{style:"color:DodgerBlue",innerHTML:"[-"})),msg.appendChild(Object.assign(document.createElement("span"),{style:"color:OrangeRed",innerHTML:"nexMap"})),msg.appendChild(Object.assign(document.createElement("span"),{style:"color:DodgerBlue",innerHTML:"-] "})),html?msg.insertAdjacentHTML("beforeend",html):msg.appendChild(Object.assign(document.createElement("span"),{style:"color:GoldenRod",innerHTML:txt})),display_printHTML(msg.outerHTML)},generateTable=function generateTable(table){var entries=arguments.length>1&&void 0!==arguments[1]&&arguments[1],caption=arguments.length>2&&void 0!==arguments[2]&&arguments[2];pageIndex=0,"displayTable"===table?(console.log("works"),console.log(entries),displayEntries=entries,displayCap=caption,displayTable()):(console.log(table),console.log(entries),nexmap_nexmap.display["".concat(table)](entries,caption))},displayTable=function displayTable(){var entries=displayEntries;window.tester=entries,console.log(entries);var table=Object.assign(document.createElement("table"),{class:"mono",style:"max-width:100%;border:1px solid GoldenRod;border-spacing:0px"});if(0===pageIndex){var caption=document.createElement("span");caption.setAttribute("class","mono"),caption.appendChild(Object.assign(document.createElement("span"),{style:"color:DodgerBlue",innerHTML:"[-"})),caption.appendChild(Object.assign(document.createElement("span"),{style:"color:OrangeRed",innerHTML:"nexMap"})),caption.appendChild(Object.assign(document.createElement("span"),{style:"color:DodgerBlue",innerHTML:"-]"})),caption.appendChild(Object.assign(document.createElement("span"),{style:"color:GoldenRod",innerHTML:"Displaying matches for "})),caption.appendChild(Object.assign(document.createElement("span"),{style:"color:LawnGreen",innerHTML:displayCap})),table.createCaption(caption.innerHTML),table.caption.appendChild(caption);var header=Object.assign(document.createElement("tr"),{style:"text-align:left;color:Ivory"});header.appendChild(Object.assign(document.createElement("th"),{style:"width:5em",innerHTML:"Num"})),header.appendChild(Object.assign(document.createElement("th"),{style:"width:auto",innerHTML:"Name"})),header.appendChild(Object.assign(document.createElement("th"),{style:"width:auto",innerHTML:"Area"})),table.createTHead(),table.tHead.appendChild(header)}else{var _caption=document.createElement("span");_caption.setAttribute("class","mono"),_caption.appendChild(Object.assign(document.createElement("span"),{style:"color:DodgerBlue",innerHTML:"[-"})),_caption.appendChild(Object.assign(document.createElement("span"),{style:"color:OrangeRed",innerHTML:"nexMap"})),_caption.appendChild(Object.assign(document.createElement("span"),{style:"color:DodgerBlue",innerHTML:"-]"})),_caption.appendChild(Object.assign(document.createElement("span"),{style:"color:GoldenRod",innerHTML:"Displaying matches for "})),_caption.appendChild(Object.assign(document.createElement("span"),{style:"color:LawnGreen",innerHTML:displayCap})),table.createCaption(_caption.innerHTML),table.caption.appendChild(_caption);var _header=Object.assign(document.createElement("tr"),{style:"text-align:left;color:Ivory"});_header.appendChild(Object.assign(document.createElement("th"),{style:"width:5em",innerHTML:""})),_header.appendChild(Object.assign(document.createElement("th"),{style:"width:auto",innerHTML:""})),_header.appendChild(Object.assign(document.createElement("th"),{style:"width:auto",innerHTML:""})),table.createTHead(),table.tHead.appendChild(_header)}var pagination,startIndex=pageIndex>0?20*pageIndex:0;table.createTBody();for(var i=startIndex;i<entries.length&&i<startIndex+20;i++){var row=Object.assign(document.createElement("tr"),{style:"cursor:pointer;color:dimgrey;"});row.appendChild(Object.assign(document.createElement("td"),{style:"color:grey",onclick:"click.room(".concat(JSON.stringify(entries[i].data("id")),");"),innerHTML:entries[i].data("id")})),row.appendChild(Object.assign(document.createElement("td"),{style:"color:gainsboro;text-decoration:underline",onclick:"click.room(".concat(JSON.stringify(entries[i].data("id")),");"),innerHTML:entries[i].data("name")})),row.appendChild(Object.assign(document.createElement("td"),{style:"color:grey",onclick:"click.room(".concat(JSON.stringify(entries[i].data("id")),");"),innerHTML:entries[i].data("areaName")})),table.tBodies[0].appendChild(row),console.log(table)}display_printHTML(table.outerHTML),Math.ceil(displayEntries.length/20)>pageIndex+1?(pagination=Object.assign(document.createElement("span"),{style:"color:Goldenrod",innerHTML:"Displaying ".concat(startIndex+20," of ").concat(displayEntries.length,".")}),pageIndex++,pagination.appendChild(Object.assign(document.createElement("span"),{style:"color:Goldenrod",innerHTML:" Click for "})),pagination.appendChild(Object.assign(document.createElement("a"),{style:"cursor:pointer;color:Ivory;text-decoration:underline;",onclick:"displayTable()",innerHTML:"MORE"}))):pagination=Object.assign(document.createElement("span"),{style:"color:Goldenrod",innerHTML:"Displaying ".concat(displayEntries.length," of ").concat(displayEntries.length,".")}),display_printHTML(pagination.outerHTML)};function styles_typeof(obj){return styles_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},styles_typeof(obj)}function styles_regeneratorRuntime(){styles_regeneratorRuntime=function _regeneratorRuntime(){return exports};var exports={},Op=Object.prototype,hasOwn=Op.hasOwnProperty,$Symbol="function"==typeof Symbol?Symbol:{},iteratorSymbol=$Symbol.iterator||"@@iterator",asyncIteratorSymbol=$Symbol.asyncIterator||"@@asyncIterator",toStringTagSymbol=$Symbol.toStringTag||"@@toStringTag";function define(obj,key,value){return Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}),obj[key]}try{define({},"")}catch(err){define=function define(obj,key,value){return obj[key]=value}}function wrap(innerFn,outerFn,self,tryLocsList){var protoGenerator=outerFn&&outerFn.prototype instanceof Generator?outerFn:Generator,generator=Object.create(protoGenerator.prototype),context=new Context(tryLocsList||[]);return generator._invoke=function(innerFn,self,context){var state="suspendedStart";return function(method,arg){if("executing"===state)throw new Error("Generator is already running");if("completed"===state){if("throw"===method)throw arg;return doneResult()}for(context.method=method,context.arg=arg;;){var delegate=context.delegate;if(delegate){var delegateResult=maybeInvokeDelegate(delegate,context);if(delegateResult){if(delegateResult===ContinueSentinel)continue;return delegateResult}}if("next"===context.method)context.sent=context._sent=context.arg;else if("throw"===context.method){if("suspendedStart"===state)throw state="completed",context.arg;context.dispatchException(context.arg)}else"return"===context.method&&context.abrupt("return",context.arg);state="executing";var record=tryCatch(innerFn,self,context);if("normal"===record.type){if(state=context.done?"completed":"suspendedYield",record.arg===ContinueSentinel)continue;return{value:record.arg,done:context.done}}"throw"===record.type&&(state="completed",context.method="throw",context.arg=record.arg)}}}(innerFn,self,context),generator}function tryCatch(fn,obj,arg){try{return{type:"normal",arg:fn.call(obj,arg)}}catch(err){return{type:"throw",arg:err}}}exports.wrap=wrap;var ContinueSentinel={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var IteratorPrototype={};define(IteratorPrototype,iteratorSymbol,(function(){return this}));var getProto=Object.getPrototypeOf,NativeIteratorPrototype=getProto&&getProto(getProto(values([])));NativeIteratorPrototype&&NativeIteratorPrototype!==Op&&hasOwn.call(NativeIteratorPrototype,iteratorSymbol)&&(IteratorPrototype=NativeIteratorPrototype);var Gp=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(IteratorPrototype);function defineIteratorMethods(prototype){["next","throw","return"].forEach((function(method){define(prototype,method,(function(arg){return this._invoke(method,arg)}))}))}function AsyncIterator(generator,PromiseImpl){function invoke(method,arg,resolve,reject){var record=tryCatch(generator[method],generator,arg);if("throw"!==record.type){var result=record.arg,value=result.value;return value&&"object"==styles_typeof(value)&&hasOwn.call(value,"__await")?PromiseImpl.resolve(value.__await).then((function(value){invoke("next",value,resolve,reject)}),(function(err){invoke("throw",err,resolve,reject)})):PromiseImpl.resolve(value).then((function(unwrapped){result.value=unwrapped,resolve(result)}),(function(error){return invoke("throw",error,resolve,reject)}))}reject(record.arg)}var previousPromise;this._invoke=function(method,arg){function callInvokeWithMethodAndArg(){return new PromiseImpl((function(resolve,reject){invoke(method,arg,resolve,reject)}))}return previousPromise=previousPromise?previousPromise.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}}function maybeInvokeDelegate(delegate,context){var method=delegate.iterator[context.method];if(void 0===method){if(context.delegate=null,"throw"===context.method){if(delegate.iterator.return&&(context.method="return",context.arg=void 0,maybeInvokeDelegate(delegate,context),"throw"===context.method))return ContinueSentinel;context.method="throw",context.arg=new TypeError("The iterator does not provide a 'throw' method")}return ContinueSentinel}var record=tryCatch(method,delegate.iterator,context.arg);if("throw"===record.type)return context.method="throw",context.arg=record.arg,context.delegate=null,ContinueSentinel;var info=record.arg;return info?info.done?(context[delegate.resultName]=info.value,context.next=delegate.nextLoc,"return"!==context.method&&(context.method="next",context.arg=void 0),context.delegate=null,ContinueSentinel):info:(context.method="throw",context.arg=new TypeError("iterator result is not an object"),context.delegate=null,ContinueSentinel)}function pushTryEntry(locs){var entry={tryLoc:locs[0]};1 in locs&&(entry.catchLoc=locs[1]),2 in locs&&(entry.finallyLoc=locs[2],entry.afterLoc=locs[3]),this.tryEntries.push(entry)}function resetTryEntry(entry){var record=entry.completion||{};record.type="normal",delete record.arg,entry.completion=record}function Context(tryLocsList){this.tryEntries=[{tryLoc:"root"}],tryLocsList.forEach(pushTryEntry,this),this.reset(!0)}function values(iterable){if(iterable){var iteratorMethod=iterable[iteratorSymbol];if(iteratorMethod)return iteratorMethod.call(iterable);if("function"==typeof iterable.next)return iterable;if(!isNaN(iterable.length)){var i=-1,next=function next(){for(;++i<iterable.length;)if(hasOwn.call(iterable,i))return next.value=iterable[i],next.done=!1,next;return next.value=void 0,next.done=!0,next};return next.next=next}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,define(Gp,"constructor",GeneratorFunctionPrototype),define(GeneratorFunctionPrototype,"constructor",GeneratorFunction),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,toStringTagSymbol,"GeneratorFunction"),exports.isGeneratorFunction=function(genFun){var ctor="function"==typeof genFun&&genFun.constructor;return!!ctor&&(ctor===GeneratorFunction||"GeneratorFunction"===(ctor.displayName||ctor.name))},exports.mark=function(genFun){return Object.setPrototypeOf?Object.setPrototypeOf(genFun,GeneratorFunctionPrototype):(genFun.__proto__=GeneratorFunctionPrototype,define(genFun,toStringTagSymbol,"GeneratorFunction")),genFun.prototype=Object.create(Gp),genFun},exports.awrap=function(arg){return{__await:arg}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,asyncIteratorSymbol,(function(){return this})),exports.AsyncIterator=AsyncIterator,exports.async=function(innerFn,outerFn,self,tryLocsList,PromiseImpl){void 0===PromiseImpl&&(PromiseImpl=Promise);var iter=new AsyncIterator(wrap(innerFn,outerFn,self,tryLocsList),PromiseImpl);return exports.isGeneratorFunction(outerFn)?iter:iter.next().then((function(result){return result.done?result.value:iter.next()}))},defineIteratorMethods(Gp),define(Gp,toStringTagSymbol,"Generator"),define(Gp,iteratorSymbol,(function(){return this})),define(Gp,"toString",(function(){return"[object Generator]"})),exports.keys=function(object){var keys=[];for(var key in object)keys.push(key);return keys.reverse(),function next(){for(;keys.length;){var key=keys.pop();if(key in object)return next.value=key,next.done=!1,next}return next.done=!0,next}},exports.values=values,Context.prototype={constructor:Context,reset:function reset(skipTempReset){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!skipTempReset)for(var name in this)"t"===name.charAt(0)&&hasOwn.call(this,name)&&!isNaN(+name.slice(1))&&(this[name]=void 0)},stop:function stop(){this.done=!0;var rootRecord=this.tryEntries[0].completion;if("throw"===rootRecord.type)throw rootRecord.arg;return this.rval},dispatchException:function dispatchException(exception){if(this.done)throw exception;var context=this;function handle(loc,caught){return record.type="throw",record.arg=exception,context.next=loc,caught&&(context.method="next",context.arg=void 0),!!caught}for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i],record=entry.completion;if("root"===entry.tryLoc)return handle("end");if(entry.tryLoc<=this.prev){var hasCatch=hasOwn.call(entry,"catchLoc"),hasFinally=hasOwn.call(entry,"finallyLoc");if(hasCatch&&hasFinally){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0);if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}else if(hasCatch){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0)}else{if(!hasFinally)throw new Error("try statement without catch or finally");if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}}}},abrupt:function abrupt(type,arg){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc<=this.prev&&hasOwn.call(entry,"finallyLoc")&&this.prev<entry.finallyLoc){var finallyEntry=entry;break}}finallyEntry&&("break"===type||"continue"===type)&&finallyEntry.tryLoc<=arg&&arg<=finallyEntry.finallyLoc&&(finallyEntry=null);var record=finallyEntry?finallyEntry.completion:{};return record.type=type,record.arg=arg,finallyEntry?(this.method="next",this.next=finallyEntry.finallyLoc,ContinueSentinel):this.complete(record)},complete:function complete(record,afterLoc){if("throw"===record.type)throw record.arg;return"break"===record.type||"continue"===record.type?this.next=record.arg:"return"===record.type?(this.rval=this.arg=record.arg,this.method="return",this.next="end"):"normal"===record.type&&afterLoc&&(this.next=afterLoc),ContinueSentinel},finish:function finish(finallyLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.finallyLoc===finallyLoc)return this.complete(entry.completion,entry.afterLoc),resetTryEntry(entry),ContinueSentinel}},catch:function _catch(tryLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc===tryLoc){var record=entry.completion;if("throw"===record.type){var thrown=record.arg;resetTryEntry(entry)}return thrown}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(iterable,resultName,nextLoc){return this.delegate={iterator:values(iterable),resultName:resultName,nextLoc:nextLoc},"next"===this.method&&(this.arg=void 0),ContinueSentinel}},exports}function styles_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function styles_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){styles_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){styles_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}var styles={style:function style(){nexmap_nexmap.logging&&console.log("nexMap: nexMap.style()"),cy.once("render",(function(){cy.center()})),cy.on("mouseout","node",(function(evt){evt.target.removeClass("displayLabel")})),cy.on("mouseover","node",(function(evt){evt.target.flashClass("displayLabel",3e3)})),cy.on("zoom",(function(evt){cy.style().selector(".displayLabel").style({"font-size":"".concat(1/cy.zoom()*12,"px")})})),cy.on("unselect","node",(function(evt){walker.stop()})),cy.on("select","node",(function(evt){walker.speedWalk()})),styles.generateStyle()},generateStyle:function generateStyle(){document.querySelector(".client_nexmap-ruless")&&document.querySelector(".client_nexmap-ruless").remove();var nexMapCSS='.nexswitch {position: relative;display: inline-block;width: 38px;height: 22px;}cy {width: 100%;height: calc(100% - 44px);position: absolute;overflow: hidden;top: 0px;left: 0px;margin-top: 22px;margin-bottom: 22px}.nexswitch input {opacity: 0;width: 0;height: 0;}.nexslider {position: absolute;cursor: pointer;top: 0;left: 0;right: 0;bottom: 0;background-color: #555555;-webkit-transition: .4s;transition: .4s;border-radius: 24px;}.nexslider:before {position: absolute;content: "";height: 16px;width: 16px;left: 3px;bottom: 3px;background-color: white;-webkit-transition: .4s;transition: .4s;border-radius: 50%;}input:checked + .nexslider {background-color: #2196F3;}input:focus + .nexslider {box-shadow: 0 0 1px #2196F3;}input:checked + .nexslider:before {-webkit-transform: translateX(16px);-ms-transform: translateX(16px);transform: translateX(16px);}.nexcontainer   { display: flex; }.nexfixed    { width: 200px; }.nexflex-item    { flex-grow: 1; }';"standard"!==window.css_style&&(nexMapCSS+='#tab_nexmap_map::before {content: "\\f2ae";}'),function inject(rule){var rules=document.createElement("div");rules.innerHTML="&shy;",rules.setAttribute("class","client_nexmap-rules");var css=document.createElement("style");css.innerHTML=rule,rules.appendChild(css),document.body.appendChild(rules)}(nexMapCSS)},refresh:function refresh(){"function"==typeof cy.unmount?setTimeout(styles_asyncToGenerator(styles_regeneratorRuntime().mark((function _callee(){return styles_regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,Promise.all([changeRoom(nexmap_nexmap.currentRoom),changeArea(nexmap_nexmap.currentArea,nexmap_nexmap.currentZ,!0)]);case 2:case"end":return _context.stop()}}),_callee)}))),500):display_notice('nexMap not loaded. Please run "nm load".')},generateSVG:function generateSVG(txt){var svg_pin=document.createElement("svg");svg_pin.setAttribute("width","100"),svg_pin.setAttribute("height","100"),svg_pin.setAttribute("viewBox","0 0 100 100"),svg_pin.setAttribute("version","1.1"),svg_pin.setAttribute("preserveAspectRatio","xMidYMid meet"),svg_pin.setAttribute("xmlns","http://www.w3.org/2000/svg");var svg_text=document.createElement("text");return svg_text.setAttribute("x","50"),svg_text.setAttribute("y","60"),svg_text.setAttribute("font-size","90px"),svg_text.setAttribute("dominant-baseline","middle"),svg_text.setAttribute("text-anchor","middle"),svg_text.setAttribute("fill","black"),svg_text.setAttribute("font-family","Arial, monospace"),svg_text.setAttribute("text-align","center"),svg_text.setAttribute("font-weight","bold"),svg_text.appendChild(document.createTextNode(txt)),svg_pin.appendChild(svg_text),encodeURI("data:image/svg+xml;utf-8,"+svg_pin.outerHTML)},stylesheet:[{selector:"node",style:{shape:"rectangle",width:"10",height:"10","border-color":"black","border-width":"0.5",display:"none"}},{selector:"edge",style:{width:"1","line-color":"grey"}},{selector:"[image]",style:{"background-image":"data(image)","background-fit":"contain contain","background-width":"100%","background-height":"100%","background-repeat":"no-repeat","background-clip":"none"}},{selector:".displayLabel",style:{color:"white",label:"data(name)","min-zoomed-font-size":"12pt"}},{selector:".areaDisplay",style:{display:"element"}},{selector:".areaAdjacent",style:{visibility:"hidden",display:"element"}},{selector:".wormhole",style:{visibility:"hidden",width:"1","line-style":"dashed","line-dash-pattern":[5,10],"line-color":"#8d32a8"}},{selector:".sewergrate",style:{visibility:"hidden"}},{selector:".downexit",style:{visibility:"hidden","curve-style":"bezier","source-arrow-shape":"triangle"}},{selector:".upexit",style:{visibility:"hidden","curve-style":"bezier","source-arrow-shape":"triangle"}},{selector:".inexit",style:{visibility:"hidden","curve-style":"bezier","source-arrow-shape":"circle"}},{selector:".outexit",style:{visibility:"hidden","curve-style":"bezier","source-arrow-shape":"circle"}},{selector:".doorexit",style:{"curve-style":"straight","mid-source-arrow-shape":"tee","mid-target-arrow-shape":"tee","arrow-scale":.65}},{selector:".pseudo-d",style:{display:"element",label:"",shape:"polygon","shape-polygon-points":"-0.6 -0.7 0.6 -0.7 0 -0.1","background-color":"rgb(255,255,255)","border-color":"rgb(0,0,0)","border-width":"0.5px"}},{selector:".pseudo-up",style:{display:"element",label:"",shape:"polygon","shape-polygon-points":"0.6 0.7 -0.6 0.7 0 0.1","background-color":"rgb(255,255,255)","border-color":"rgb(0,0,0)","border-width":"0.5px"}},{selector:".pseudo-in",style:{display:"element",label:"",shape:"polygon","shape-polygon-points":"0.7 -0.6 0.7 0.6 0.1 0","background-color":"rgb(255,255,255)","border-color":"rgb(0,0,0)","border-width":"0.5px"}},{selector:".pseudo-out",style:{display:"element",label:"",shape:"polygon","shape-polygon-points":"-0.7 0.6 -0.7 -0.6 -0.1 0","background-color":"rgb(255,255,255)","border-color":"rgb(0,0,0)","border-width":"0.5px"}},{selector:".areaAdjacentExit",style:{display:"element","curve-style":"straight","arrow-scale":"0.75","target-arrow-shape":"vee"}},{selector:".environment2",style:{"background-color":"rgb(128,115,95)"}},{selector:".environment3",style:{"background-color":"rgb(118,81,22)"}},{selector:".environment4",style:{"background-color":"rgb(54,102,46)"}},{selector:".environment5",style:{"background-color":"rgb(255,255,204)"}},{selector:".environment6",style:{"background-color":"rgb(249,253,0)"}},{selector:".environment7",style:{"background-color":"rgb(29,199,19)"}},{selector:".environment8",style:{"background-color":"rgb(189,160,203)"}},{selector:".environment9",style:{"background-color":"rgb(45,119,32)"}},{selector:".environment10",style:{"background-color":"rgb(0,221,255)"}},{selector:".environment11",style:{"background-color":"rgb(131,119,102)"}},{selector:".environment12",style:{"background-color":"rgb(124,124,124)"}},{selector:".environment13",style:{"background-color":"rgb(65,171,47)"}},{selector:".environment14",style:{"background-color":"rgb(88,74,52)"}},{selector:".environment15",style:{"background-color":"rgb(118,132,60)"}},{selector:".environment16",style:{"background-color":"rgb(197,252,255)"}},{selector:".environment17",style:{"background-color":"rgb(137,225,75)"}},{selector:".environment18",style:{"background-color":"rgb(171,158,109)"}},{selector:".environment19",style:{"background-color":"rgb(86,165,116)"}},{selector:".environment20",style:{"background-color":"rgb(0,0,255)"}},{selector:".environment21",style:{"background-color":"rgb(148,228,93)"}},{selector:".environment22",style:{"background-color":"rgb(95,240,240)"}},{selector:".environment23",style:{"background-color":"rgb(145,128,16)"}},{selector:".environment24",style:{"background-color":"rgb(0,51,102)"}},{selector:".environment25",style:{"background-color":"rgb(249,129,103)"}},{selector:".environment27",style:{"background-color":"rgb(255,255,255)"}},{selector:".environment28",style:{"background-color":"rgb(0,227,66)"}},{selector:".environment29",style:{"background-color":"rgb(153,0,0)"}},{selector:".environment30",style:{"background-color":"rgb(77,66,212)"}},{selector:".environment31",style:{"background-color":"rgb(221,68,0)"}},{selector:".environment32",style:{"background-color":"rgb(221,186,130)"}},{selector:".environment33",style:{"background-color":"rgb(131,119,102)"}},{selector:".environment34",style:{"background-color":"rgb(0,0,255)"}},{selector:".environment35",style:{"background-color":"rgb(255,255,255)"}},{selector:".environment36",style:{"background-color":"rgb(145,128,16)"}},{selector:".environment39",style:{"background-color":"rgb(145,128,16)"}},{selector:".environment40",style:{"background-color":"rgb(192,192,192)"}},{selector:".environment41",style:{"background-color":"rgb(192,192,192)"}},{selector:".environment42",style:{"background-color":"rgb(207,16,32)"}},{selector:".environment43",style:{"background-color":"rgb(0,112,31)"}},{selector:".environment48",style:{"background-color":"rgb(249,129,103)"}},{selector:".environment257",style:{"background-color":"rgb(128,0,0)"}},{selector:".environment258",style:{"background-color":"rgb(0,128,0)"}},{selector:".environment259",style:{"background-color":"rgb(128,128,0)"}},{selector:".environment260",style:{"background-color":"rgb(0,0,128)"}},{selector:".environment261",style:{"background-color":"rgb(128,0,128)"}},{selector:".environment262",style:{"background-color":"rgb(0,128,128)"}},{selector:".environment263",style:{"background-color":"rgb(192,192,192)"}},{selector:".environment264",style:{"background-color":"rgb(70,70,70)"}},{selector:".environment265",style:{"background-color":"rgb(255,0,0)"}},{selector:".environment266",style:{"background-color":"rgb(0,255,0)"}},{selector:".environment267",style:{"background-color":"rgb(255,255,0)"}},{selector:".environment268",style:{"background-color":"rgb(0,0,255)"}},{selector:".environment269",style:{"background-color":"rgb(255,0,255)"}},{selector:".environment270",style:{"background-color":"rgb(0,255,255)"}},{selector:".environment271",style:{"background-color":"rgb(255,255,255)"}},{selector:".environment272",style:{"background-color":"rgb(128,128,128)"}},{selector:":selected",style:{shape:"star",height:"20px",width:"20px","background-color":"#ff1493"}},{selector:".basherArea",style:{"background-color":"deeppink"}},{selector:".currentRoom",style:{height:"12px",width:"12px",shape:"square","border-color":"orange","border-width":"2px"}}]},cytoscape_cjs=__webpack_require__(58),cytoscape_cjs_default=__webpack_require__.n(cytoscape_cjs);function graph_typeof(obj){return graph_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},graph_typeof(obj)}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function graph_slicedToArray(arr,i){return function graph_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function graph_iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||graph_unsupportedIterableToArray(arr,i)||function graph_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function graph_regeneratorRuntime(){graph_regeneratorRuntime=function _regeneratorRuntime(){return exports};var exports={},Op=Object.prototype,hasOwn=Op.hasOwnProperty,$Symbol="function"==typeof Symbol?Symbol:{},iteratorSymbol=$Symbol.iterator||"@@iterator",asyncIteratorSymbol=$Symbol.asyncIterator||"@@asyncIterator",toStringTagSymbol=$Symbol.toStringTag||"@@toStringTag";function define(obj,key,value){return Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}),obj[key]}try{define({},"")}catch(err){define=function define(obj,key,value){return obj[key]=value}}function wrap(innerFn,outerFn,self,tryLocsList){var protoGenerator=outerFn&&outerFn.prototype instanceof Generator?outerFn:Generator,generator=Object.create(protoGenerator.prototype),context=new Context(tryLocsList||[]);return generator._invoke=function(innerFn,self,context){var state="suspendedStart";return function(method,arg){if("executing"===state)throw new Error("Generator is already running");if("completed"===state){if("throw"===method)throw arg;return doneResult()}for(context.method=method,context.arg=arg;;){var delegate=context.delegate;if(delegate){var delegateResult=maybeInvokeDelegate(delegate,context);if(delegateResult){if(delegateResult===ContinueSentinel)continue;return delegateResult}}if("next"===context.method)context.sent=context._sent=context.arg;else if("throw"===context.method){if("suspendedStart"===state)throw state="completed",context.arg;context.dispatchException(context.arg)}else"return"===context.method&&context.abrupt("return",context.arg);state="executing";var record=tryCatch(innerFn,self,context);if("normal"===record.type){if(state=context.done?"completed":"suspendedYield",record.arg===ContinueSentinel)continue;return{value:record.arg,done:context.done}}"throw"===record.type&&(state="completed",context.method="throw",context.arg=record.arg)}}}(innerFn,self,context),generator}function tryCatch(fn,obj,arg){try{return{type:"normal",arg:fn.call(obj,arg)}}catch(err){return{type:"throw",arg:err}}}exports.wrap=wrap;var ContinueSentinel={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var IteratorPrototype={};define(IteratorPrototype,iteratorSymbol,(function(){return this}));var getProto=Object.getPrototypeOf,NativeIteratorPrototype=getProto&&getProto(getProto(values([])));NativeIteratorPrototype&&NativeIteratorPrototype!==Op&&hasOwn.call(NativeIteratorPrototype,iteratorSymbol)&&(IteratorPrototype=NativeIteratorPrototype);var Gp=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(IteratorPrototype);function defineIteratorMethods(prototype){["next","throw","return"].forEach((function(method){define(prototype,method,(function(arg){return this._invoke(method,arg)}))}))}function AsyncIterator(generator,PromiseImpl){function invoke(method,arg,resolve,reject){var record=tryCatch(generator[method],generator,arg);if("throw"!==record.type){var result=record.arg,value=result.value;return value&&"object"==graph_typeof(value)&&hasOwn.call(value,"__await")?PromiseImpl.resolve(value.__await).then((function(value){invoke("next",value,resolve,reject)}),(function(err){invoke("throw",err,resolve,reject)})):PromiseImpl.resolve(value).then((function(unwrapped){result.value=unwrapped,resolve(result)}),(function(error){return invoke("throw",error,resolve,reject)}))}reject(record.arg)}var previousPromise;this._invoke=function(method,arg){function callInvokeWithMethodAndArg(){return new PromiseImpl((function(resolve,reject){invoke(method,arg,resolve,reject)}))}return previousPromise=previousPromise?previousPromise.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}}function maybeInvokeDelegate(delegate,context){var method=delegate.iterator[context.method];if(void 0===method){if(context.delegate=null,"throw"===context.method){if(delegate.iterator.return&&(context.method="return",context.arg=void 0,maybeInvokeDelegate(delegate,context),"throw"===context.method))return ContinueSentinel;context.method="throw",context.arg=new TypeError("The iterator does not provide a 'throw' method")}return ContinueSentinel}var record=tryCatch(method,delegate.iterator,context.arg);if("throw"===record.type)return context.method="throw",context.arg=record.arg,context.delegate=null,ContinueSentinel;var info=record.arg;return info?info.done?(context[delegate.resultName]=info.value,context.next=delegate.nextLoc,"return"!==context.method&&(context.method="next",context.arg=void 0),context.delegate=null,ContinueSentinel):info:(context.method="throw",context.arg=new TypeError("iterator result is not an object"),context.delegate=null,ContinueSentinel)}function pushTryEntry(locs){var entry={tryLoc:locs[0]};1 in locs&&(entry.catchLoc=locs[1]),2 in locs&&(entry.finallyLoc=locs[2],entry.afterLoc=locs[3]),this.tryEntries.push(entry)}function resetTryEntry(entry){var record=entry.completion||{};record.type="normal",delete record.arg,entry.completion=record}function Context(tryLocsList){this.tryEntries=[{tryLoc:"root"}],tryLocsList.forEach(pushTryEntry,this),this.reset(!0)}function values(iterable){if(iterable){var iteratorMethod=iterable[iteratorSymbol];if(iteratorMethod)return iteratorMethod.call(iterable);if("function"==typeof iterable.next)return iterable;if(!isNaN(iterable.length)){var i=-1,next=function next(){for(;++i<iterable.length;)if(hasOwn.call(iterable,i))return next.value=iterable[i],next.done=!1,next;return next.value=void 0,next.done=!0,next};return next.next=next}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,define(Gp,"constructor",GeneratorFunctionPrototype),define(GeneratorFunctionPrototype,"constructor",GeneratorFunction),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,toStringTagSymbol,"GeneratorFunction"),exports.isGeneratorFunction=function(genFun){var ctor="function"==typeof genFun&&genFun.constructor;return!!ctor&&(ctor===GeneratorFunction||"GeneratorFunction"===(ctor.displayName||ctor.name))},exports.mark=function(genFun){return Object.setPrototypeOf?Object.setPrototypeOf(genFun,GeneratorFunctionPrototype):(genFun.__proto__=GeneratorFunctionPrototype,define(genFun,toStringTagSymbol,"GeneratorFunction")),genFun.prototype=Object.create(Gp),genFun},exports.awrap=function(arg){return{__await:arg}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,asyncIteratorSymbol,(function(){return this})),exports.AsyncIterator=AsyncIterator,exports.async=function(innerFn,outerFn,self,tryLocsList,PromiseImpl){void 0===PromiseImpl&&(PromiseImpl=Promise);var iter=new AsyncIterator(wrap(innerFn,outerFn,self,tryLocsList),PromiseImpl);return exports.isGeneratorFunction(outerFn)?iter:iter.next().then((function(result){return result.done?result.value:iter.next()}))},defineIteratorMethods(Gp),define(Gp,toStringTagSymbol,"Generator"),define(Gp,iteratorSymbol,(function(){return this})),define(Gp,"toString",(function(){return"[object Generator]"})),exports.keys=function(object){var keys=[];for(var key in object)keys.push(key);return keys.reverse(),function next(){for(;keys.length;){var key=keys.pop();if(key in object)return next.value=key,next.done=!1,next}return next.done=!0,next}},exports.values=values,Context.prototype={constructor:Context,reset:function reset(skipTempReset){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!skipTempReset)for(var name in this)"t"===name.charAt(0)&&hasOwn.call(this,name)&&!isNaN(+name.slice(1))&&(this[name]=void 0)},stop:function stop(){this.done=!0;var rootRecord=this.tryEntries[0].completion;if("throw"===rootRecord.type)throw rootRecord.arg;return this.rval},dispatchException:function dispatchException(exception){if(this.done)throw exception;var context=this;function handle(loc,caught){return record.type="throw",record.arg=exception,context.next=loc,caught&&(context.method="next",context.arg=void 0),!!caught}for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i],record=entry.completion;if("root"===entry.tryLoc)return handle("end");if(entry.tryLoc<=this.prev){var hasCatch=hasOwn.call(entry,"catchLoc"),hasFinally=hasOwn.call(entry,"finallyLoc");if(hasCatch&&hasFinally){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0);if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}else if(hasCatch){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0)}else{if(!hasFinally)throw new Error("try statement without catch or finally");if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}}}},abrupt:function abrupt(type,arg){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc<=this.prev&&hasOwn.call(entry,"finallyLoc")&&this.prev<entry.finallyLoc){var finallyEntry=entry;break}}finallyEntry&&("break"===type||"continue"===type)&&finallyEntry.tryLoc<=arg&&arg<=finallyEntry.finallyLoc&&(finallyEntry=null);var record=finallyEntry?finallyEntry.completion:{};return record.type=type,record.arg=arg,finallyEntry?(this.method="next",this.next=finallyEntry.finallyLoc,ContinueSentinel):this.complete(record)},complete:function complete(record,afterLoc){if("throw"===record.type)throw record.arg;return"break"===record.type||"continue"===record.type?this.next=record.arg:"return"===record.type?(this.rval=this.arg=record.arg,this.method="return",this.next="end"):"normal"===record.type&&afterLoc&&(this.next=afterLoc),ContinueSentinel},finish:function finish(finallyLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.finallyLoc===finallyLoc)return this.complete(entry.completion,entry.afterLoc),resetTryEntry(entry),ContinueSentinel}},catch:function _catch(tryLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc===tryLoc){var record=entry.completion;if("throw"===record.type){var thrown=record.arg;resetTryEntry(entry)}return thrown}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(iterable,resultName,nextLoc){return this.delegate={iterator:values(iterable),resultName:resultName,nextLoc:nextLoc},"next"===this.method&&(this.arg=void 0),ContinueSentinel}},exports}function graph_createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=graph_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function F(){};return{s:F,n:function n(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function e(_e2){throw _e2},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function s(){it=it.call(o)},n:function n(){var step=it.next();return normalCompletion=step.done,step},e:function e(_e3){didErr=!0,err=_e3},f:function f(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function graph_unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return graph_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?graph_arrayLikeToArray(o,minLen):void 0}}function graph_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function graph_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}window.cy=cytoscape_cjs_default()({container:void 0,layout:"grid",style:styles.stylesheet,zoom:1.25,minZoom:.2,maxZoom:3,wheelSensitivity:.5,boxSelectionEnabled:!1,selectionType:"single",hideEdgesOnViewport:!0,textureOnViewport:!0,motionBlur:!0,pixelRatio:"auto"});var crowdMapRevisions=function crowdMapRevisions(mudmap){return mudmap.areas.forEach((function(e){var continent=Object.keys(areaContinents).find((function(c){return areaContinents[c].includes(e.id)}));e.continent=void 0===continent?"":continent})),mudmap.areas.find((function(e){return"Shamtota Hills, the (West)"===e.name})).rooms.find((function(e){return 1450===e.id})).exits.find((function(e){return 15398===e.exitId})).name="say Chrysantha".concat(settings_userPreferences.commandSeparator,"push knob"),mudmap.areas.find((function(e){return"Battlesite of Mourning Pass"===e.name})).rooms.find((function(e){return 29081===e.id})).exits.find((function(e){return 30864===e.exitId})).name="pull rubble".concat(settings_userPreferences.commandSeparator,"east"),mudmap.areas.find((function(e){return"Battlesite of Mourning Pass"===e.name})).rooms.find((function(e){return 30136===e.id})).exits.find((function(e){return 30469===e.exitId})).name="push bones".concat(settings_userPreferences.commandSeparator,"east"),mudmap.areas.find((function(e){return"Battlesite of Mourning Pass"===e.name})).rooms.find((function(e){return 30469===e.id})).exits.find((function(e){return 30437===e.exitId})).name="pull shield81739".concat(settings_userPreferences.commandSeparator,"northeast"),mudmap.areas.find((function(e){return"Battlesite of Mourning Pass"===e.name})).rooms.find((function(e){return 30523===e.id})).exits.find((function(e){return 30631===e.exitId})).name="pull roots".concat(settings_userPreferences.commandSeparator,"south"),mudmap.areas.find((function(e){return"Battlesite of Mourning Pass"===e.name})).rooms.find((function(e){return 31099===e.id})).exits.find((function(e){return 23239===e.exitId})).name="pull mucus".concat(settings_userPreferences.commandSeparator,"northeast"),mudmap.areas.find((function(e){return"Ghezavat Commune"===e.name})).rooms.find((function(e){return 58509===e.id})).exits.push({exitId:58881,name:"northeast"}),mudmap.areas.find((function(e){return"Ghezavat Commune"===e.name})).rooms.push(JSON.parse('{"coordinates":[3,2,-1],"environment":2,"exits":[{"exitId":58509,"name":"west"},{"exitId":58306,"name":"northeast"}],"id":58881,"name":"A narrow, sandy tunnel","userData":{"Game Area":"the Ghezavat Commune","indoors":"y"}}')),mudmap.areas.find((function(e){return"Ghezavat Commune"===e.name})).rooms.push(JSON.parse('{"coordinates":[4,3,-1],"environment":2,"exits":[{"exitId":58881,"name":"southwest"}],"id":58306,"name":"A landscape of shifting sand","userData":{"Game Area":"the Ghezavat Commune","indoors":"y"}}')),mudmap},generateGraph=function(){var _ref=function graph_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){graph_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){graph_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}(graph_regeneratorRuntime().mark((function _callee(graph){var graphModel,_iterator,_step,area;return graph_regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:nexmap_nexmap.mudmap=crowdMapRevisions(graph),graphModel=[],_iterator=graph_createForOfIteratorHelper(graph.areas),_context.prev=3,_iterator.s();case 5:if((_step=_iterator.n()).done){_context.next=12;break}if(0!==(area=_step.value).roomCount){_context.next=9;break}return _context.abrupt("continue",10);case 9:graphModel=graphModel.concat(createRooms(area));case 10:_context.next=5;break;case 12:_context.next=17;break;case 14:_context.prev=14,_context.t0=_context.catch(3),_iterator.e(_context.t0);case 17:return _context.prev=17,_iterator.f(),_context.finish(17);case 20:return cy.batch((function(){cy.add(graphModel),cy.$("#45182-55588").addClass("nurRift"),cy.$("#55588-45182").addClass("nurRift"),nexmap_nexmap.wormholes=cy.$(".wormhole"),nexmap_nexmap.sewergrates=cy.$(".sewergrate")})),_context.abrupt("return",graphModel);case 22:case"end":return _context.stop()}}),_callee,null,[[3,14,17,20]])})));return function generateGraph(_x){return _ref.apply(this,arguments)}}(),createRooms=function createRooms(area){var _step2,graph=[],_iterator2=graph_createForOfIteratorHelper(area.rooms);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var _room$symbol,exits,edges,room=_step2.value,_createExits2=graph_slicedToArray(createExits(room,area.id),2);exits=_createExits2[0],edges=_createExits2[1];var node={group:"nodes",data:{id:room.id,area:area.id,areaName:area.name,environment:room.environment,name:room.name,continent:area.continent,userData:room.userData,coordinates:room.coordinates,z:room.coordinates[2],exits:exits,symbol:!!room.symbol&&room.symbol},position:{x:20*room.coordinates[0],y:-20*room.coordinates[1],z:room.coordinates[2]},classes:["environment".concat(room.environment)],locked:!0};null!=room&&null!==(_room$symbol=room.symbol)&&void 0!==_room$symbol&&_room$symbol.text&&["S","F","G","C","N","M","$","L","H","W","A","P","B"].includes(room.symbol.text)&&(node.classes.push("backgroundImageRoom"),node.data.image=styles.generateSVG(room.symbol.text)),graph.push(node),graph=graph.concat(edges)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}return graph},createExits=function createExits(room,areaId){var command,_step3,edges=[],exits=[],_iterator3=graph_createForOfIteratorHelper(room.exits);try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var exit=_step3.value;command=longDirs[exit.name]?longDirs[exit.name]:exit.name;var edge={group:"edges",data:{id:"".concat(room.id,"-").concat(exit.exitId),source:room.id,target:exit.exitId,weight:1,area:areaId,command:command,door:!!exit.door&&exit.door,z:room.coordinates[2]},classes:[]};edge.classes=addExitClasses(edge.data),edge.data.weight=edge.classes.includes("wormhole")?12:1,exits.push(command),edges.push(edge)}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}return[exits,edges]},addExitClasses=function addExitClasses(data){var classes=[];switch(data.door&&classes.push("doorexit"),data.command){case"in":classes.push("inexit");break;case"out":classes.push("outexit");break;case"up":classes.push("upexit");break;case"down":classes.push("downexit");break;case"worm warp":classes.push("wormhole");break;case"enter grate":classes.push("sewergrate")}return classes},generateExits=function generateExits(currentArea,currentZ){var exitIndex=0,createExit=function createExit(position,cmd,tar){var pos=function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}({},position);switch(cmd){case"s":case"n":pos.y+=20;break;case"e":pos.x+=20;break;case"w":pos.x+=-20;break;case"se":pos.x+=20,pos.y+=20;break;case"sw":pos.x+=-20,pos.y+=20;break;case"ne":pos.x+=20,pos.y+=-20;break;case"nw":pos.x+=-20,pos.y+=-20}var newNode={group:"nodes",data:{id:"pseudo".concat(exitIndex)},position:{x:pos.x,y:pos.y,z:pos.z},classes:["pseudo",tar?"areaAdjacent":"pseudo-".concat(cmd)]};cy.add(newNode),tar&&cy.add({group:"edges",data:{id:"pseudoE".concat(exitIndex),source:tar,target:newNode.data.id,weight:1},classes:["pseudo","areaAdjacentExit"]}),exitIndex++},x=cy.edges().filter((function(e){return e.data("area")===currentArea&&e.data("z")===currentZ}));x.filter((function(e){return["up","d","in","out"].includes(e.data("command"))})).forEach((function(e){return createExit(e.source().position(),e.data("command"))}));var xe=x.filter((function(e){return["s","n","e","w","ne","nw","se","sw"].includes(e.data("command"))}));(xe=xe.filter((function(e){return e.target().data("area")!==currentArea||e.target().data("z")!==currentZ}))).forEach((function(e){return createExit(e.source().position(),e.data("command"),e.data("source"))}))};for(var byteLength_1=function byteLength(b64){var lens=getLens(b64),validLen=lens[0],placeHoldersLen=lens[1];return 3*(validLen+placeHoldersLen)/4-placeHoldersLen},toByteArray_1=function toByteArray(b64){var tmp,i,lens=getLens(b64),validLen=lens[0],placeHoldersLen=lens[1],arr=new Arr(function _byteLength(b64,validLen,placeHoldersLen){return 3*(validLen+placeHoldersLen)/4-placeHoldersLen}(0,validLen,placeHoldersLen)),curByte=0,len=placeHoldersLen>0?validLen-4:validLen;for(i=0;i<len;i+=4)tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)],arr[curByte++]=tmp>>16&255,arr[curByte++]=tmp>>8&255,arr[curByte++]=255&tmp;2===placeHoldersLen&&(tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4,arr[curByte++]=255&tmp);1===placeHoldersLen&&(tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2,arr[curByte++]=tmp>>8&255,arr[curByte++]=255&tmp);return arr},fromByteArray_1=function fromByteArray(uint8){for(var tmp,len=uint8.length,extraBytes=len%3,parts=[],i=0,len2=len-extraBytes;i<len2;i+=16383)parts.push(encodeChunk(uint8,i,i+16383>len2?len2:i+16383));1===extraBytes?(tmp=uint8[len-1],parts.push(lookup[tmp>>2]+lookup[tmp<<4&63]+"==")):2===extraBytes&&(tmp=(uint8[len-2]<<8)+uint8[len-1],parts.push(lookup[tmp>>10]+lookup[tmp>>4&63]+lookup[tmp<<2&63]+"="));return parts.join("")},lookup=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,len=code.length;i<len;++i)lookup[i]=code[i],revLookup[code.charCodeAt(i)]=i;function getLens(b64){var len=b64.length;if(len%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var validLen=b64.indexOf("=");return-1===validLen&&(validLen=len),[validLen,validLen===len?0:4-validLen%4]}function encodeChunk(uint8,start,end){for(var tmp,num,output=[],i=start;i<end;i+=3)tmp=(uint8[i]<<16&16711680)+(uint8[i+1]<<8&65280)+(255&uint8[i+2]),output.push(lookup[(num=tmp)>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[63&num]);return output.join("")}revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63;var base64Js={byteLength:byteLength_1,toByteArray:toByteArray_1,fromByteArray:fromByteArray_1},ieee754_read=function read(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];for(i+=d,e=s&(1<<-nBits)-1,s>>=-nBits,nBits+=eLen;nBits>0;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;nBits>0;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?NaN:1/0*(s?-1:1);m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)},ieee754_write=function write(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=value<0||0===value&&1/value<0?1:0;for(value=Math.abs(value),isNaN(value)||value===1/0?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),(value+=e+eBias>=1?rt/c:rt*Math.pow(2,1-eBias))*c>=2&&(e++,c/=2),e+eBias>=eMax?(m=0,e=eMax):e+eBias>=1?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));mLen>=8;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;eLen>0;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*s},buffer$1=function createCommonjsModule(fn,module){return fn(module={exports:{}},module.exports),module.exports}((function(module,exports){var customInspectSymbol="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;exports.Buffer=Buffer,exports.SlowBuffer=function SlowBuffer(length){+length!=length&&(length=0);return Buffer.alloc(+length)},exports.INSPECT_MAX_BYTES=50;function createBuffer(length){if(length>2147483647)throw new RangeError('The value "'+length+'" is invalid for option "size"');var buf=new Uint8Array(length);return Object.setPrototypeOf(buf,Buffer.prototype),buf}function Buffer(arg,encodingOrOffset,length){if("number"==typeof arg){if("string"==typeof encodingOrOffset)throw new TypeError('The "string" argument must be of type string. Received type number');return allocUnsafe(arg)}return from(arg,encodingOrOffset,length)}function from(value,encodingOrOffset,length){if("string"==typeof value)return function fromString(string,encoding){"string"==typeof encoding&&""!==encoding||(encoding="utf8");if(!Buffer.isEncoding(encoding))throw new TypeError("Unknown encoding: "+encoding);var length=0|byteLength(string,encoding),buf=createBuffer(length),actual=buf.write(string,encoding);actual!==length&&(buf=buf.slice(0,actual));return buf}(value,encodingOrOffset);if(ArrayBuffer.isView(value))return function fromArrayView(arrayView){if(isInstance(arrayView,Uint8Array)){var copy=new Uint8Array(arrayView);return fromArrayBuffer(copy.buffer,copy.byteOffset,copy.byteLength)}return fromArrayLike(arrayView)}(value);if(null==value)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+babelHelpers.typeof(value));if(isInstance(value,ArrayBuffer)||value&&isInstance(value.buffer,ArrayBuffer))return fromArrayBuffer(value,encodingOrOffset,length);if("undefined"!=typeof SharedArrayBuffer&&(isInstance(value,SharedArrayBuffer)||value&&isInstance(value.buffer,SharedArrayBuffer)))return fromArrayBuffer(value,encodingOrOffset,length);if("number"==typeof value)throw new TypeError('The "value" argument must not be of type number. Received type number');var valueOf=value.valueOf&&value.valueOf();if(null!=valueOf&&valueOf!==value)return Buffer.from(valueOf,encodingOrOffset,length);var b=function fromObject(obj){if(Buffer.isBuffer(obj)){var len=0|checked(obj.length),buf=createBuffer(len);return 0===buf.length||obj.copy(buf,0,0,len),buf}if(void 0!==obj.length)return"number"!=typeof obj.length||numberIsNaN(obj.length)?createBuffer(0):fromArrayLike(obj);if("Buffer"===obj.type&&Array.isArray(obj.data))return fromArrayLike(obj.data)}(value);if(b)return b;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof value[Symbol.toPrimitive])return Buffer.from(value[Symbol.toPrimitive]("string"),encodingOrOffset,length);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+babelHelpers.typeof(value))}function assertSize(size){if("number"!=typeof size)throw new TypeError('"size" argument must be of type number');if(size<0)throw new RangeError('The value "'+size+'" is invalid for option "size"')}function allocUnsafe(size){return assertSize(size),createBuffer(size<0?0:0|checked(size))}function fromArrayLike(array){for(var length=array.length<0?0:0|checked(array.length),buf=createBuffer(length),i=0;i<length;i+=1)buf[i]=255&array[i];return buf}function fromArrayBuffer(array,byteOffset,length){if(byteOffset<0||array.byteLength<byteOffset)throw new RangeError('"offset" is outside of buffer bounds');if(array.byteLength<byteOffset+(length||0))throw new RangeError('"length" is outside of buffer bounds');var buf;return buf=void 0===byteOffset&&void 0===length?new Uint8Array(array):void 0===length?new Uint8Array(array,byteOffset):new Uint8Array(array,byteOffset,length),Object.setPrototypeOf(buf,Buffer.prototype),buf}function checked(length){if(length>=2147483647)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+2147483647..toString(16)+" bytes");return 0|length}function byteLength(string,encoding){if(Buffer.isBuffer(string))return string.length;if(ArrayBuffer.isView(string)||isInstance(string,ArrayBuffer))return string.byteLength;if("string"!=typeof string)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+babelHelpers.typeof(string));var len=string.length,mustMatch=arguments.length>2&&!0===arguments[2];if(!mustMatch&&0===len)return 0;for(var loweredCase=!1;;)switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*len;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return mustMatch?-1:utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase(),loweredCase=!0}}function slowToString(encoding,start,end){var loweredCase=!1;if((void 0===start||start<0)&&(start=0),start>this.length)return"";if((void 0===end||end>this.length)&&(end=this.length),end<=0)return"";if((end>>>=0)<=(start>>>=0))return"";for(encoding||(encoding="utf8");;)switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase(),loweredCase=!0}}function swap(b,n,m){var i=b[n];b[n]=b[m],b[m]=i}function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(0===buffer.length)return-1;if("string"==typeof byteOffset?(encoding=byteOffset,byteOffset=0):byteOffset>2147483647?byteOffset=2147483647:byteOffset<-2147483648&&(byteOffset=-2147483648),numberIsNaN(byteOffset=+byteOffset)&&(byteOffset=dir?0:buffer.length-1),byteOffset<0&&(byteOffset=buffer.length+byteOffset),byteOffset>=buffer.length){if(dir)return-1;byteOffset=buffer.length-1}else if(byteOffset<0){if(!dir)return-1;byteOffset=0}if("string"==typeof val&&(val=Buffer.from(val,encoding)),Buffer.isBuffer(val))return 0===val.length?-1:arrayIndexOf(buffer,val,byteOffset,encoding,dir);if("number"==typeof val)return val&=255,"function"==typeof Uint8Array.prototype.indexOf?dir?Uint8Array.prototype.indexOf.call(buffer,val,byteOffset):Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset):arrayIndexOf(buffer,[val],byteOffset,encoding,dir);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var i,indexSize=1,arrLength=arr.length,valLength=val.length;if(void 0!==encoding&&("ucs2"===(encoding=String(encoding).toLowerCase())||"ucs-2"===encoding||"utf16le"===encoding||"utf-16le"===encoding)){if(arr.length<2||val.length<2)return-1;indexSize=2,arrLength/=2,valLength/=2,byteOffset/=2}function read(buf,i){return 1===indexSize?buf[i]:buf.readUInt16BE(i*indexSize)}if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++)if(read(arr,i)===read(val,-1===foundIndex?0:i-foundIndex)){if(-1===foundIndex&&(foundIndex=i),i-foundIndex+1===valLength)return foundIndex*indexSize}else-1!==foundIndex&&(i-=i-foundIndex),foundIndex=-1}else for(byteOffset+valLength>arrLength&&(byteOffset=arrLength-valLength),i=byteOffset;i>=0;i--){for(var found=!0,j=0;j<valLength;j++)if(read(arr,i+j)!==read(val,j)){found=!1;break}if(found)return i}return-1}function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;length?(length=Number(length))>remaining&&(length=remaining):length=remaining;var strLen=string.length;length>strLen/2&&(length=strLen/2);for(var i=0;i<length;++i){var parsed=parseInt(string.substr(2*i,2),16);if(numberIsNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(function asciiToBytes(str){for(var byteArray=[],i=0;i<str.length;++i)byteArray.push(255&str.charCodeAt(i));return byteArray}(string),buf,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(function utf16leToBytes(str,units){for(var c,hi,lo,byteArray=[],i=0;i<str.length&&!((units-=2)<0);++i)hi=(c=str.charCodeAt(i))>>8,lo=c%256,byteArray.push(lo),byteArray.push(hi);return byteArray}(string,buf.length-offset),buf,offset,length)}function base64Slice(buf,start,end){return 0===start&&end===buf.length?base64Js.fromByteArray(buf):base64Js.fromByteArray(buf.slice(start,end))}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);for(var res=[],i=start;i<end;){var secondByte,thirdByte,fourthByte,tempCodePoint,firstByte=buf[i],codePoint=null,bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end)switch(bytesPerSequence){case 1:firstByte<128&&(codePoint=firstByte);break;case 2:128==(192&(secondByte=buf[i+1]))&&(tempCodePoint=(31&firstByte)<<6|63&secondByte)>127&&(codePoint=tempCodePoint);break;case 3:secondByte=buf[i+1],thirdByte=buf[i+2],128==(192&secondByte)&&128==(192&thirdByte)&&(tempCodePoint=(15&firstByte)<<12|(63&secondByte)<<6|63&thirdByte)>2047&&(tempCodePoint<55296||tempCodePoint>57343)&&(codePoint=tempCodePoint);break;case 4:secondByte=buf[i+1],thirdByte=buf[i+2],fourthByte=buf[i+3],128==(192&secondByte)&&128==(192&thirdByte)&&128==(192&fourthByte)&&(tempCodePoint=(15&firstByte)<<18|(63&secondByte)<<12|(63&thirdByte)<<6|63&fourthByte)>65535&&tempCodePoint<1114112&&(codePoint=tempCodePoint)}null===codePoint?(codePoint=65533,bytesPerSequence=1):codePoint>65535&&(codePoint-=65536,res.push(codePoint>>>10&1023|55296),codePoint=56320|1023&codePoint),res.push(codePoint),i+=bytesPerSequence}return function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=4096)return String.fromCharCode.apply(String,codePoints);var res="",i=0;for(;i<len;)res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=4096));return res}(res)}exports.kMaxLength=2147483647,Buffer.TYPED_ARRAY_SUPPORT=function typedArraySupport(){try{var arr=new Uint8Array(1),proto={foo:function foo(){return 42}};return Object.setPrototypeOf(proto,Uint8Array.prototype),Object.setPrototypeOf(arr,proto),42===arr.foo()}catch(e){return!1}}(),Buffer.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(Buffer.prototype,"parent",{enumerable:!0,get:function get(){if(Buffer.isBuffer(this))return this.buffer}}),Object.defineProperty(Buffer.prototype,"offset",{enumerable:!0,get:function get(){if(Buffer.isBuffer(this))return this.byteOffset}}),Buffer.poolSize=8192,Buffer.from=function(value,encodingOrOffset,length){return from(value,encodingOrOffset,length)},Object.setPrototypeOf(Buffer.prototype,Uint8Array.prototype),Object.setPrototypeOf(Buffer,Uint8Array),Buffer.alloc=function(size,fill,encoding){return function alloc(size,fill,encoding){return assertSize(size),size<=0?createBuffer(size):void 0!==fill?"string"==typeof encoding?createBuffer(size).fill(fill,encoding):createBuffer(size).fill(fill):createBuffer(size)}(size,fill,encoding)},Buffer.allocUnsafe=function(size){return allocUnsafe(size)},Buffer.allocUnsafeSlow=function(size){return allocUnsafe(size)},Buffer.isBuffer=function isBuffer(b){return null!=b&&!0===b._isBuffer&&b!==Buffer.prototype},Buffer.compare=function compare(a,b){if(isInstance(a,Uint8Array)&&(a=Buffer.from(a,a.offset,a.byteLength)),isInstance(b,Uint8Array)&&(b=Buffer.from(b,b.offset,b.byteLength)),!Buffer.isBuffer(a)||!Buffer.isBuffer(b))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(a===b)return 0;for(var x=a.length,y=b.length,i=0,len=Math.min(x,y);i<len;++i)if(a[i]!==b[i]){x=a[i],y=b[i];break}return x<y?-1:y<x?1:0},Buffer.isEncoding=function isEncoding(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function concat(list,length){if(!Array.isArray(list))throw new TypeError('"list" argument must be an Array of Buffers');if(0===list.length)return Buffer.alloc(0);var i;if(void 0===length)for(length=0,i=0;i<list.length;++i)length+=list[i].length;var buffer=Buffer.allocUnsafe(length),pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(isInstance(buf,Uint8Array))pos+buf.length>buffer.length?Buffer.from(buf).copy(buffer,pos):Uint8Array.prototype.set.call(buffer,buf,pos);else{if(!Buffer.isBuffer(buf))throw new TypeError('"list" argument must be an Array of Buffers');buf.copy(buffer,pos)}pos+=buf.length}return buffer},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function swap16(){var len=this.length;if(len%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var i=0;i<len;i+=2)swap(this,i,i+1);return this},Buffer.prototype.swap32=function swap32(){var len=this.length;if(len%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var i=0;i<len;i+=4)swap(this,i,i+3),swap(this,i+1,i+2);return this},Buffer.prototype.swap64=function swap64(){var len=this.length;if(len%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var i=0;i<len;i+=8)swap(this,i,i+7),swap(this,i+1,i+6),swap(this,i+2,i+5),swap(this,i+3,i+4);return this},Buffer.prototype.toString=function toString(){var length=this.length;return 0===length?"":0===arguments.length?utf8Slice(this,0,length):slowToString.apply(this,arguments)},Buffer.prototype.toLocaleString=Buffer.prototype.toString,Buffer.prototype.equals=function equals(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b||0===Buffer.compare(this,b)},Buffer.prototype.inspect=function inspect(){var str="",max=exports.INSPECT_MAX_BYTES;return str=this.toString("hex",0,max).replace(/(.{2})/g,"$1 ").trim(),this.length>max&&(str+=" ... "),"<Buffer "+str+">"},customInspectSymbol&&(Buffer.prototype[customInspectSymbol]=Buffer.prototype.inspect),Buffer.prototype.compare=function compare(target,start,end,thisStart,thisEnd){if(isInstance(target,Uint8Array)&&(target=Buffer.from(target,target.offset,target.byteLength)),!Buffer.isBuffer(target))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+babelHelpers.typeof(target));if(void 0===start&&(start=0),void 0===end&&(end=target?target.length:0),void 0===thisStart&&(thisStart=0),void 0===thisEnd&&(thisEnd=this.length),start<0||end>target.length||thisStart<0||thisEnd>this.length)throw new RangeError("out of range index");if(thisStart>=thisEnd&&start>=end)return 0;if(thisStart>=thisEnd)return-1;if(start>=end)return 1;if(this===target)return 0;for(var x=(thisEnd>>>=0)-(thisStart>>>=0),y=(end>>>=0)-(start>>>=0),len=Math.min(x,y),thisCopy=this.slice(thisStart,thisEnd),targetCopy=target.slice(start,end),i=0;i<len;++i)if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i],y=targetCopy[i];break}return x<y?-1:y<x?1:0},Buffer.prototype.includes=function includes(val,byteOffset,encoding){return-1!==this.indexOf(val,byteOffset,encoding)},Buffer.prototype.indexOf=function indexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!0)},Buffer.prototype.lastIndexOf=function lastIndexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!1)},Buffer.prototype.write=function write(string,offset,length,encoding){if(void 0===offset)encoding="utf8",length=this.length,offset=0;else if(void 0===length&&"string"==typeof offset)encoding=offset,length=this.length,offset=0;else{if(!isFinite(offset))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");offset>>>=0,isFinite(length)?(length>>>=0,void 0===encoding&&(encoding="utf8")):(encoding=length,length=void 0)}var remaining=this.length-offset;if((void 0===length||length>remaining)&&(length=remaining),string.length>0&&(length<0||offset<0)||offset>this.length)throw new RangeError("Attempt to write outside buffer bounds");encoding||(encoding="utf8");for(var loweredCase=!1;;)switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":case"latin1":case"binary":return asciiWrite(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase(),loweredCase=!0}},Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(127&buf[i]);return ret}function latin1Slice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(buf[i]);return ret}function hexSlice(buf,start,end){var len=buf.length;(!start||start<0)&&(start=0),(!end||end<0||end>len)&&(end=len);for(var out="",i=start;i<end;++i)out+=hexSliceLookupTable[buf[i]];return out}function utf16leSlice(buf,start,end){for(var bytes=buf.slice(start,end),res="",i=0;i<bytes.length-1;i+=2)res+=String.fromCharCode(bytes[i]+256*bytes[i+1]);return res}function checkOffset(offset,ext,length){if(offset%1!=0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){return value=+value,offset>>>=0,noAssert||checkIEEE754(buf,0,offset,4),ieee754_write(buf,value,offset,littleEndian,23,4),offset+4}function writeDouble(buf,value,offset,littleEndian,noAssert){return value=+value,offset>>>=0,noAssert||checkIEEE754(buf,0,offset,8),ieee754_write(buf,value,offset,littleEndian,52,8),offset+8}Buffer.prototype.slice=function slice(start,end){var len=this.length;(start=~~start)<0?(start+=len)<0&&(start=0):start>len&&(start=len),(end=void 0===end?len:~~end)<0?(end+=len)<0&&(end=0):end>len&&(end=len),end<start&&(end=start);var newBuf=this.subarray(start,end);return Object.setPrototypeOf(newBuf,Buffer.prototype),newBuf},Buffer.prototype.readUintLE=Buffer.prototype.readUIntLE=function readUIntLE(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val},Buffer.prototype.readUintBE=Buffer.prototype.readUIntBE=function readUIntBE(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset+--byteLength],mul=1;byteLength>0&&(mul*=256);)val+=this[offset+--byteLength]*mul;return val},Buffer.prototype.readUint8=Buffer.prototype.readUInt8=function readUInt8(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,1,this.length),this[offset]},Buffer.prototype.readUint16LE=Buffer.prototype.readUInt16LE=function readUInt16LE(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,2,this.length),this[offset]|this[offset+1]<<8},Buffer.prototype.readUint16BE=Buffer.prototype.readUInt16BE=function readUInt16BE(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,2,this.length),this[offset]<<8|this[offset+1]},Buffer.prototype.readUint32LE=Buffer.prototype.readUInt32LE=function readUInt32LE(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+16777216*this[offset+3]},Buffer.prototype.readUint32BE=Buffer.prototype.readUInt32BE=function readUInt32BE(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),16777216*this[offset]+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])},Buffer.prototype.readIntLE=function readIntLE(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val>=(mul*=128)&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readIntBE=function readIntBE(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var i=byteLength,mul=1,val=this[offset+--i];i>0&&(mul*=256);)val+=this[offset+--i]*mul;return val>=(mul*=128)&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readInt8=function readInt8(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,1,this.length),128&this[offset]?-1*(255-this[offset]+1):this[offset]},Buffer.prototype.readInt16LE=function readInt16LE(offset,noAssert){offset>>>=0,noAssert||checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt16BE=function readInt16BE(offset,noAssert){offset>>>=0,noAssert||checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt32LE=function readInt32LE(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24},Buffer.prototype.readInt32BE=function readInt32BE(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]},Buffer.prototype.readFloatLE=function readFloatLE(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),ieee754_read(this,offset,!0,23,4)},Buffer.prototype.readFloatBE=function readFloatBE(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),ieee754_read(this,offset,!1,23,4)},Buffer.prototype.readDoubleLE=function readDoubleLE(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,8,this.length),ieee754_read(this,offset,!0,52,8)},Buffer.prototype.readDoubleBE=function readDoubleBE(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,8,this.length),ieee754_read(this,offset,!1,52,8)},Buffer.prototype.writeUintLE=Buffer.prototype.writeUIntLE=function writeUIntLE(value,offset,byteLength,noAssert){(value=+value,offset>>>=0,byteLength>>>=0,noAssert)||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0);var mul=1,i=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUintBE=Buffer.prototype.writeUIntBE=function writeUIntBE(value,offset,byteLength,noAssert){(value=+value,offset>>>=0,byteLength>>>=0,noAssert)||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0);var i=byteLength-1,mul=1;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUint8=Buffer.prototype.writeUInt8=function writeUInt8(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,1,255,0),this[offset]=255&value,offset+1},Buffer.prototype.writeUint16LE=Buffer.prototype.writeUInt16LE=function writeUInt16LE(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,65535,0),this[offset]=255&value,this[offset+1]=value>>>8,offset+2},Buffer.prototype.writeUint16BE=Buffer.prototype.writeUInt16BE=function writeUInt16BE(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,65535,0),this[offset]=value>>>8,this[offset+1]=255&value,offset+2},Buffer.prototype.writeUint32LE=Buffer.prototype.writeUInt32LE=function writeUInt32LE(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,4294967295,0),this[offset+3]=value>>>24,this[offset+2]=value>>>16,this[offset+1]=value>>>8,this[offset]=255&value,offset+4},Buffer.prototype.writeUint32BE=Buffer.prototype.writeUInt32BE=function writeUInt32BE(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,4294967295,0),this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value,offset+4},Buffer.prototype.writeIntLE=function writeIntLE(value,offset,byteLength,noAssert){if(value=+value,offset>>>=0,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0,mul=1,sub=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i-1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeIntBE=function writeIntBE(value,offset,byteLength,noAssert){if(value=+value,offset>>>=0,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1,mul=1,sub=0;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i+1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeInt8=function writeInt8(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,1,127,-128),value<0&&(value=255+value+1),this[offset]=255&value,offset+1},Buffer.prototype.writeInt16LE=function writeInt16LE(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,32767,-32768),this[offset]=255&value,this[offset+1]=value>>>8,offset+2},Buffer.prototype.writeInt16BE=function writeInt16BE(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,32767,-32768),this[offset]=value>>>8,this[offset+1]=255&value,offset+2},Buffer.prototype.writeInt32LE=function writeInt32LE(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),this[offset]=255&value,this[offset+1]=value>>>8,this[offset+2]=value>>>16,this[offset+3]=value>>>24,offset+4},Buffer.prototype.writeInt32BE=function writeInt32BE(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),value<0&&(value=4294967295+value+1),this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value,offset+4},Buffer.prototype.writeFloatLE=function writeFloatLE(value,offset,noAssert){return writeFloat(this,value,offset,!0,noAssert)},Buffer.prototype.writeFloatBE=function writeFloatBE(value,offset,noAssert){return writeFloat(this,value,offset,!1,noAssert)},Buffer.prototype.writeDoubleLE=function writeDoubleLE(value,offset,noAssert){return writeDouble(this,value,offset,!0,noAssert)},Buffer.prototype.writeDoubleBE=function writeDoubleBE(value,offset,noAssert){return writeDouble(this,value,offset,!1,noAssert)},Buffer.prototype.copy=function copy(target,targetStart,start,end){if(!Buffer.isBuffer(target))throw new TypeError("argument should be a Buffer");if(start||(start=0),end||0===end||(end=this.length),targetStart>=target.length&&(targetStart=target.length),targetStart||(targetStart=0),end>0&&end<start&&(end=start),end===start)return 0;if(0===target.length||0===this.length)return 0;if(targetStart<0)throw new RangeError("targetStart out of bounds");if(start<0||start>=this.length)throw new RangeError("Index out of range");if(end<0)throw new RangeError("sourceEnd out of bounds");end>this.length&&(end=this.length),target.length-targetStart<end-start&&(end=target.length-targetStart+start);var len=end-start;return this===target&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(targetStart,start,end):Uint8Array.prototype.set.call(target,this.subarray(start,end),targetStart),len},Buffer.prototype.fill=function fill(val,start,end,encoding){if("string"==typeof val){if("string"==typeof start?(encoding=start,start=0,end=this.length):"string"==typeof end&&(encoding=end,end=this.length),void 0!==encoding&&"string"!=typeof encoding)throw new TypeError("encoding must be a string");if("string"==typeof encoding&&!Buffer.isEncoding(encoding))throw new TypeError("Unknown encoding: "+encoding);if(1===val.length){var code=val.charCodeAt(0);("utf8"===encoding&&code<128||"latin1"===encoding)&&(val=code)}}else"number"==typeof val?val&=255:"boolean"==typeof val&&(val=Number(val));if(start<0||this.length<start||this.length<end)throw new RangeError("Out of range index");if(end<=start)return this;var i;if(start>>>=0,end=void 0===end?this.length:end>>>0,val||(val=0),"number"==typeof val)for(i=start;i<end;++i)this[i]=val;else{var bytes=Buffer.isBuffer(val)?val:Buffer.from(val,encoding),len=bytes.length;if(0===len)throw new TypeError('The value "'+val+'" is invalid for argument "value"');for(i=0;i<end-start;++i)this[i+start]=bytes[i%len]}return this};var INVALID_BASE64_RE=/[^+/0-9A-Za-z-_]/g;function utf8ToBytes(string,units){var codePoint;units=units||1/0;for(var length=string.length,leadSurrogate=null,bytes=[],i=0;i<length;++i){if((codePoint=string.charCodeAt(i))>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){(units-=3)>-1&&bytes.push(239,191,189);continue}if(i+1===length){(units-=3)>-1&&bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){(units-=3)>-1&&bytes.push(239,191,189),leadSurrogate=codePoint;continue}codePoint=65536+(leadSurrogate-55296<<10|codePoint-56320)}else leadSurrogate&&(units-=3)>-1&&bytes.push(239,191,189);if(leadSurrogate=null,codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,63&codePoint|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,63&codePoint|128)}else{if(!(codePoint<1114112))throw new Error("Invalid code point");if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,63&codePoint|128)}}return bytes}function base64ToBytes(str){return base64Js.toByteArray(function base64clean(str){if((str=(str=str.split("=")[0]).trim().replace(INVALID_BASE64_RE,"")).length<2)return"";for(;str.length%4!=0;)str+="=";return str}(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length&&!(i+offset>=dst.length||i>=src.length);++i)dst[i+offset]=src[i];return i}function isInstance(obj,type){return obj instanceof type||null!=obj&&null!=obj.constructor&&null!=obj.constructor.name&&obj.constructor.name===type.name}function numberIsNaN(obj){return obj!=obj}var hexSliceLookupTable=function(){for(var table=new Array(256),i=0;i<16;++i)for(var i16=16*i,j=0;j<16;++j)table[i16+j]="0123456789abcdef"[i]+"0123456789abcdef"[j];return table}()})),buffer_1=buffer$1.Buffer;buffer$1.SlowBuffer,buffer$1.INSPECT_MAX_BYTES,buffer$1.kMaxLength;var _extendStatics=function extendStatics(d,b){return _extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])},_extendStatics(d,b)};function __extends(d,b){function __(){this.constructor=d}_extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}var _assign=function __assign(){return _assign=Object.assign||function __assign(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t},_assign.apply(this,arguments)},BSONError=function(_super){function BSONError(message){var _this=_super.call(this,message)||this;return Object.setPrototypeOf(_this,BSONError.prototype),_this}return __extends(BSONError,_super),Object.defineProperty(BSONError.prototype,"name",{get:function(){return"BSONError"},enumerable:!1,configurable:!0}),BSONError}(Error),BSONTypeError=function(_super){function BSONTypeError(message){var _this=_super.call(this,message)||this;return Object.setPrototypeOf(_this,BSONTypeError.prototype),_this}return __extends(BSONTypeError,_super),Object.defineProperty(BSONTypeError.prototype,"name",{get:function(){return"BSONTypeError"},enumerable:!1,configurable:!0}),BSONTypeError}(TypeError);function checkForMath(potentialGlobal){return potentialGlobal&&potentialGlobal.Math==Math&&potentialGlobal}function getGlobal(){return checkForMath("object"==typeof globalThis&&globalThis)||checkForMath("object"==typeof window&&window)||checkForMath("object"==typeof self&&self)||checkForMath("object"==typeof __webpack_require__.g&&__webpack_require__.g)||Function("return this")()}function normalizedFunctionString(fn){return fn.toString().replace("function(","function (")}var insecureRandomBytes=function insecureRandomBytes(size){var insecureWarning=function isReactNative(){var g=getGlobal();return"object"==typeof g.navigator&&"ReactNative"===g.navigator.product}()?"BSON: For React Native please polyfill crypto.getRandomValues, e.g. using: https://www.npmjs.com/package/react-native-get-random-values.":"BSON: No cryptographic implementation for random bytes present, falling back to a less secure implementation.";console.warn(insecureWarning);for(var result=buffer_1.alloc(size),i=0;i<size;++i)result[i]=Math.floor(256*Math.random());return result},randomBytes=function(){if("undefined"!=typeof window){var target_1=window.crypto||window.msCrypto;if(target_1&&target_1.getRandomValues)return function(size){return target_1.getRandomValues(buffer_1.alloc(size))}}if(void 0!==__webpack_require__.g&&__webpack_require__.g.crypto&&__webpack_require__.g.crypto.getRandomValues)return function(size){return __webpack_require__.g.crypto.getRandomValues(buffer_1.alloc(size))};var requiredRandomBytes;try{requiredRandomBytes=Object(function webpackMissingModule(){var e=new Error("Cannot find module 'crypto'");throw e.code="MODULE_NOT_FOUND",e}())}catch(e){}return requiredRandomBytes||insecureRandomBytes}();function isAnyArrayBuffer(value){return["[object ArrayBuffer]","[object SharedArrayBuffer]"].includes(Object.prototype.toString.call(value))}function isUint8Array(value){return"[object Uint8Array]"===Object.prototype.toString.call(value)}function isBigInt64Array(value){return"[object BigInt64Array]"===Object.prototype.toString.call(value)}function isBigUInt64Array(value){return"[object BigUint64Array]"===Object.prototype.toString.call(value)}function isRegExp(d){return"[object RegExp]"===Object.prototype.toString.call(d)}function isDate(d){return isObjectLike(d)&&"[object Date]"===Object.prototype.toString.call(d)}function isObjectLike(candidate){return"object"==typeof candidate&&null!==candidate}function deprecate(fn,message){var warned=!1;return function deprecated(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return warned||(console.warn(message),warned=!0),fn.apply(this,args)}}function ensureBuffer(potentialBuffer){if(ArrayBuffer.isView(potentialBuffer))return buffer_1.from(potentialBuffer.buffer,potentialBuffer.byteOffset,potentialBuffer.byteLength);if(isAnyArrayBuffer(potentialBuffer))return buffer_1.from(potentialBuffer);throw new BSONTypeError("Must use either Buffer or TypedArray")}var VALIDATION_REGEX=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|[0-9a-f]{12}4[0-9a-f]{3}[89ab][0-9a-f]{15})$/i,uuidValidateString=function(str){return"string"==typeof str&&VALIDATION_REGEX.test(str)},uuidHexStringToBuffer=function(hexString){if(!uuidValidateString(hexString))throw new BSONTypeError('UUID string representations must be a 32 or 36 character hex string (dashes excluded/included). Format: "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" or "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".');var sanitizedHexString=hexString.replace(/-/g,"");return buffer_1.from(sanitizedHexString,"hex")},bufferToUuidHexString=function(buffer,includeDashes){return void 0===includeDashes&&(includeDashes=!0),includeDashes?buffer.toString("hex",0,4)+"-"+buffer.toString("hex",4,6)+"-"+buffer.toString("hex",6,8)+"-"+buffer.toString("hex",8,10)+"-"+buffer.toString("hex",10,16):buffer.toString("hex")},kId$1=Symbol("id"),UUID=function(){function UUID(input){if(void 0===input)this.id=UUID.generate();else if(input instanceof UUID)this[kId$1]=buffer_1.from(input.id),this.__id=input.__id;else if(ArrayBuffer.isView(input)&&16===input.byteLength)this.id=ensureBuffer(input);else{if("string"!=typeof input)throw new BSONTypeError("Argument passed in UUID constructor must be a UUID, a 16 byte Buffer or a 32/36 character hex string (dashes excluded/included, format: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx).");this.id=uuidHexStringToBuffer(input)}}return Object.defineProperty(UUID.prototype,"id",{get:function(){return this[kId$1]},set:function(value){this[kId$1]=value,UUID.cacheHexString&&(this.__id=bufferToUuidHexString(value))},enumerable:!1,configurable:!0}),UUID.prototype.toHexString=function(includeDashes){if(void 0===includeDashes&&(includeDashes=!0),UUID.cacheHexString&&this.__id)return this.__id;var uuidHexString=bufferToUuidHexString(this.id,includeDashes);return UUID.cacheHexString&&(this.__id=uuidHexString),uuidHexString},UUID.prototype.toString=function(encoding){return encoding?this.id.toString(encoding):this.toHexString()},UUID.prototype.toJSON=function(){return this.toHexString()},UUID.prototype.equals=function(otherId){if(!otherId)return!1;if(otherId instanceof UUID)return otherId.id.equals(this.id);try{return new UUID(otherId).id.equals(this.id)}catch(_a){return!1}},UUID.prototype.toBinary=function(){return new Binary(this.id,Binary.SUBTYPE_UUID)},UUID.generate=function(){var bytes=randomBytes(16);return bytes[6]=15&bytes[6]|64,bytes[8]=63&bytes[8]|128,buffer_1.from(bytes)},UUID.isValid=function(input){if(!input)return!1;if(input instanceof UUID)return!0;if("string"==typeof input)return uuidValidateString(input);if(isUint8Array(input)){if(16!==input.length)return!1;try{return parseInt(input[6].toString(16)[0],10)===Binary.SUBTYPE_UUID}catch(_a){return!1}}return!1},UUID.createFromHexString=function(hexString){return new UUID(uuidHexStringToBuffer(hexString))},UUID.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},UUID.prototype.inspect=function(){return'new UUID("'+this.toHexString()+'")'},UUID}();Object.defineProperty(UUID.prototype,"_bsontype",{value:"UUID"});var Binary=function(){function Binary(buffer,subType){if(!(this instanceof Binary))return new Binary(buffer,subType);if(!(null==buffer||"string"==typeof buffer||ArrayBuffer.isView(buffer)||buffer instanceof ArrayBuffer||Array.isArray(buffer)))throw new BSONTypeError("Binary can only be constructed from string, Buffer, TypedArray, or Array<number>");this.sub_type=null!=subType?subType:Binary.BSON_BINARY_SUBTYPE_DEFAULT,null==buffer?(this.buffer=buffer_1.alloc(Binary.BUFFER_SIZE),this.position=0):("string"==typeof buffer?this.buffer=buffer_1.from(buffer,"binary"):Array.isArray(buffer)?this.buffer=buffer_1.from(buffer):this.buffer=ensureBuffer(buffer),this.position=this.buffer.byteLength)}return Binary.prototype.put=function(byteValue){if("string"==typeof byteValue&&1!==byteValue.length)throw new BSONTypeError("only accepts single character String");if("number"!=typeof byteValue&&1!==byteValue.length)throw new BSONTypeError("only accepts single character Uint8Array or Array");var decodedByte;if((decodedByte="string"==typeof byteValue?byteValue.charCodeAt(0):"number"==typeof byteValue?byteValue:byteValue[0])<0||decodedByte>255)throw new BSONTypeError("only accepts number in a valid unsigned byte range 0-255");if(this.buffer.length>this.position)this.buffer[this.position++]=decodedByte;else{var buffer=buffer_1.alloc(Binary.BUFFER_SIZE+this.buffer.length);this.buffer.copy(buffer,0,0,this.buffer.length),this.buffer=buffer,this.buffer[this.position++]=decodedByte}},Binary.prototype.write=function(sequence,offset){if(offset="number"==typeof offset?offset:this.position,this.buffer.length<offset+sequence.length){var buffer=buffer_1.alloc(this.buffer.length+sequence.length);this.buffer.copy(buffer,0,0,this.buffer.length),this.buffer=buffer}ArrayBuffer.isView(sequence)?(this.buffer.set(ensureBuffer(sequence),offset),this.position=offset+sequence.byteLength>this.position?offset+sequence.length:this.position):"string"==typeof sequence&&(this.buffer.write(sequence,offset,sequence.length,"binary"),this.position=offset+sequence.length>this.position?offset+sequence.length:this.position)},Binary.prototype.read=function(position,length){return length=length&&length>0?length:this.position,this.buffer.slice(position,position+length)},Binary.prototype.value=function(asRaw){return(asRaw=!!asRaw)&&this.buffer.length===this.position?this.buffer:asRaw?this.buffer.slice(0,this.position):this.buffer.toString("binary",0,this.position)},Binary.prototype.length=function(){return this.position},Binary.prototype.toJSON=function(){return this.buffer.toString("base64")},Binary.prototype.toString=function(format){return this.buffer.toString(format)},Binary.prototype.toExtendedJSON=function(options){options=options||{};var base64String=this.buffer.toString("base64"),subType=Number(this.sub_type).toString(16);return options.legacy?{$binary:base64String,$type:1===subType.length?"0"+subType:subType}:{$binary:{base64:base64String,subType:1===subType.length?"0"+subType:subType}}},Binary.prototype.toUUID=function(){if(this.sub_type===Binary.SUBTYPE_UUID)return new UUID(this.buffer.slice(0,this.position));throw new BSONError('Binary sub_type "'+this.sub_type+'" is not supported for converting to UUID. Only "'+Binary.SUBTYPE_UUID+'" is currently supported.')},Binary.fromExtendedJSON=function(doc,options){var data,type;if(options=options||{},"$binary"in doc?options.legacy&&"string"==typeof doc.$binary&&"$type"in doc?(type=doc.$type?parseInt(doc.$type,16):0,data=buffer_1.from(doc.$binary,"base64")):"string"!=typeof doc.$binary&&(type=doc.$binary.subType?parseInt(doc.$binary.subType,16):0,data=buffer_1.from(doc.$binary.base64,"base64")):"$uuid"in doc&&(type=4,data=uuidHexStringToBuffer(doc.$uuid)),!data)throw new BSONTypeError("Unexpected Binary Extended JSON format "+JSON.stringify(doc));return new Binary(data,type)},Binary.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},Binary.prototype.inspect=function(){return'new Binary(Buffer.from("'+this.value(!0).toString("hex")+'", "hex"), '+this.sub_type+")"},Binary.BSON_BINARY_SUBTYPE_DEFAULT=0,Binary.BUFFER_SIZE=256,Binary.SUBTYPE_DEFAULT=0,Binary.SUBTYPE_FUNCTION=1,Binary.SUBTYPE_BYTE_ARRAY=2,Binary.SUBTYPE_UUID_OLD=3,Binary.SUBTYPE_UUID=4,Binary.SUBTYPE_MD5=5,Binary.SUBTYPE_ENCRYPTED=6,Binary.SUBTYPE_COLUMN=7,Binary.SUBTYPE_USER_DEFINED=128,Binary}();Object.defineProperty(Binary.prototype,"_bsontype",{value:"Binary"});var Code=function(){function Code(code,scope){if(!(this instanceof Code))return new Code(code,scope);this.code=code,this.scope=scope}return Code.prototype.toJSON=function(){return{code:this.code,scope:this.scope}},Code.prototype.toExtendedJSON=function(){return this.scope?{$code:this.code,$scope:this.scope}:{$code:this.code}},Code.fromExtendedJSON=function(doc){return new Code(doc.$code,doc.$scope)},Code.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},Code.prototype.inspect=function(){var codeJson=this.toJSON();return'new Code("'+codeJson.code+'"'+(codeJson.scope?", "+JSON.stringify(codeJson.scope):"")+")"},Code}();function isDBRefLike(value){return isObjectLike(value)&&null!=value.$id&&"string"==typeof value.$ref&&(null==value.$db||"string"==typeof value.$db)}Object.defineProperty(Code.prototype,"_bsontype",{value:"Code"});var DBRef=function(){function DBRef(collection,oid,db,fields){if(!(this instanceof DBRef))return new DBRef(collection,oid,db,fields);var parts=collection.split(".");2===parts.length&&(db=parts.shift(),collection=parts.shift()),this.collection=collection,this.oid=oid,this.db=db,this.fields=fields||{}}return Object.defineProperty(DBRef.prototype,"namespace",{get:function(){return this.collection},set:function(value){this.collection=value},enumerable:!1,configurable:!0}),DBRef.prototype.toJSON=function(){var o=Object.assign({$ref:this.collection,$id:this.oid},this.fields);return null!=this.db&&(o.$db=this.db),o},DBRef.prototype.toExtendedJSON=function(options){options=options||{};var o={$ref:this.collection,$id:this.oid};return options.legacy?o:(this.db&&(o.$db=this.db),o=Object.assign(o,this.fields))},DBRef.fromExtendedJSON=function(doc){var copy=Object.assign({},doc);return delete copy.$ref,delete copy.$id,delete copy.$db,new DBRef(doc.$ref,doc.$id,doc.$db,copy)},DBRef.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},DBRef.prototype.inspect=function(){var oid=void 0===this.oid||void 0===this.oid.toString?this.oid:this.oid.toString();return'new DBRef("'+this.namespace+'", new ObjectId("'+oid+'")'+(this.db?', "'+this.db+'"':"")+")"},DBRef}();Object.defineProperty(DBRef.prototype,"_bsontype",{value:"DBRef"});var wasm=void 0;try{wasm=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(_a){}var INT_CACHE={},UINT_CACHE={},Long=function(){function Long(low,high,unsigned){if(void 0===low&&(low=0),!(this instanceof Long))return new Long(low,high,unsigned);"bigint"==typeof low?Object.assign(this,Long.fromBigInt(low,!!high)):"string"==typeof low?Object.assign(this,Long.fromString(low,!!high)):(this.low=0|low,this.high=0|high,this.unsigned=!!unsigned),Object.defineProperty(this,"__isLong__",{value:!0,configurable:!1,writable:!1,enumerable:!1})}return Long.fromBits=function(lowBits,highBits,unsigned){return new Long(lowBits,highBits,unsigned)},Long.fromInt=function(value,unsigned){var obj,cachedObj,cache;return unsigned?(cache=0<=(value>>>=0)&&value<256)&&(cachedObj=UINT_CACHE[value])?cachedObj:(obj=Long.fromBits(value,(0|value)<0?-1:0,!0),cache&&(UINT_CACHE[value]=obj),obj):(cache=-128<=(value|=0)&&value<128)&&(cachedObj=INT_CACHE[value])?cachedObj:(obj=Long.fromBits(value,value<0?-1:0,!1),cache&&(INT_CACHE[value]=obj),obj)},Long.fromNumber=function(value,unsigned){if(isNaN(value))return unsigned?Long.UZERO:Long.ZERO;if(unsigned){if(value<0)return Long.UZERO;if(value>=0x10000000000000000)return Long.MAX_UNSIGNED_VALUE}else{if(value<=-0x8000000000000000)return Long.MIN_VALUE;if(value+1>=0x8000000000000000)return Long.MAX_VALUE}return value<0?Long.fromNumber(-value,unsigned).neg():Long.fromBits(value%4294967296|0,value/4294967296|0,unsigned)},Long.fromBigInt=function(value,unsigned){return Long.fromString(value.toString(),unsigned)},Long.fromString=function(str,unsigned,radix){if(0===str.length)throw Error("empty string");if("NaN"===str||"Infinity"===str||"+Infinity"===str||"-Infinity"===str)return Long.ZERO;if("number"==typeof unsigned?(radix=unsigned,unsigned=!1):unsigned=!!unsigned,(radix=radix||10)<2||36<radix)throw RangeError("radix");var p;if((p=str.indexOf("-"))>0)throw Error("interior hyphen");if(0===p)return Long.fromString(str.substring(1),unsigned,radix).neg();for(var radixToPower=Long.fromNumber(Math.pow(radix,8)),result=Long.ZERO,i=0;i<str.length;i+=8){var size=Math.min(8,str.length-i),value=parseInt(str.substring(i,i+size),radix);if(size<8){var power=Long.fromNumber(Math.pow(radix,size));result=result.mul(power).add(Long.fromNumber(value))}else result=(result=result.mul(radixToPower)).add(Long.fromNumber(value))}return result.unsigned=unsigned,result},Long.fromBytes=function(bytes,unsigned,le){return le?Long.fromBytesLE(bytes,unsigned):Long.fromBytesBE(bytes,unsigned)},Long.fromBytesLE=function(bytes,unsigned){return new Long(bytes[0]|bytes[1]<<8|bytes[2]<<16|bytes[3]<<24,bytes[4]|bytes[5]<<8|bytes[6]<<16|bytes[7]<<24,unsigned)},Long.fromBytesBE=function(bytes,unsigned){return new Long(bytes[4]<<24|bytes[5]<<16|bytes[6]<<8|bytes[7],bytes[0]<<24|bytes[1]<<16|bytes[2]<<8|bytes[3],unsigned)},Long.isLong=function(value){return isObjectLike(value)&&!0===value.__isLong__},Long.fromValue=function(val,unsigned){return"number"==typeof val?Long.fromNumber(val,unsigned):"string"==typeof val?Long.fromString(val,unsigned):Long.fromBits(val.low,val.high,"boolean"==typeof unsigned?unsigned:val.unsigned)},Long.prototype.add=function(addend){Long.isLong(addend)||(addend=Long.fromValue(addend));var a48=this.high>>>16,a32=65535&this.high,a16=this.low>>>16,a00=65535&this.low,b48=addend.high>>>16,b32=65535&addend.high,b16=addend.low>>>16,c48=0,c32=0,c16=0,c00=0;return c16+=(c00+=a00+(65535&addend.low))>>>16,c00&=65535,c32+=(c16+=a16+b16)>>>16,c16&=65535,c48+=(c32+=a32+b32)>>>16,c32&=65535,c48+=a48+b48,c48&=65535,Long.fromBits(c16<<16|c00,c48<<16|c32,this.unsigned)},Long.prototype.and=function(other){return Long.isLong(other)||(other=Long.fromValue(other)),Long.fromBits(this.low&other.low,this.high&other.high,this.unsigned)},Long.prototype.compare=function(other){if(Long.isLong(other)||(other=Long.fromValue(other)),this.eq(other))return 0;var thisNeg=this.isNegative(),otherNeg=other.isNegative();return thisNeg&&!otherNeg?-1:!thisNeg&&otherNeg?1:this.unsigned?other.high>>>0>this.high>>>0||other.high===this.high&&other.low>>>0>this.low>>>0?-1:1:this.sub(other).isNegative()?-1:1},Long.prototype.comp=function(other){return this.compare(other)},Long.prototype.divide=function(divisor){if(Long.isLong(divisor)||(divisor=Long.fromValue(divisor)),divisor.isZero())throw Error("division by zero");if(wasm){if(!this.unsigned&&-2147483648===this.high&&-1===divisor.low&&-1===divisor.high)return this;var low=(this.unsigned?wasm.div_u:wasm.div_s)(this.low,this.high,divisor.low,divisor.high);return Long.fromBits(low,wasm.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Long.UZERO:Long.ZERO;var approx,rem,res;if(this.unsigned){if(divisor.unsigned||(divisor=divisor.toUnsigned()),divisor.gt(this))return Long.UZERO;if(divisor.gt(this.shru(1)))return Long.UONE;res=Long.UZERO}else{if(this.eq(Long.MIN_VALUE))return divisor.eq(Long.ONE)||divisor.eq(Long.NEG_ONE)?Long.MIN_VALUE:divisor.eq(Long.MIN_VALUE)?Long.ONE:(approx=this.shr(1).div(divisor).shl(1)).eq(Long.ZERO)?divisor.isNegative()?Long.ONE:Long.NEG_ONE:(rem=this.sub(divisor.mul(approx)),res=approx.add(rem.div(divisor)));if(divisor.eq(Long.MIN_VALUE))return this.unsigned?Long.UZERO:Long.ZERO;if(this.isNegative())return divisor.isNegative()?this.neg().div(divisor.neg()):this.neg().div(divisor).neg();if(divisor.isNegative())return this.div(divisor.neg()).neg();res=Long.ZERO}for(rem=this;rem.gte(divisor);){approx=Math.max(1,Math.floor(rem.toNumber()/divisor.toNumber()));for(var log2=Math.ceil(Math.log(approx)/Math.LN2),delta=log2<=48?1:Math.pow(2,log2-48),approxRes=Long.fromNumber(approx),approxRem=approxRes.mul(divisor);approxRem.isNegative()||approxRem.gt(rem);)approx-=delta,approxRem=(approxRes=Long.fromNumber(approx,this.unsigned)).mul(divisor);approxRes.isZero()&&(approxRes=Long.ONE),res=res.add(approxRes),rem=rem.sub(approxRem)}return res},Long.prototype.div=function(divisor){return this.divide(divisor)},Long.prototype.equals=function(other){return Long.isLong(other)||(other=Long.fromValue(other)),(this.unsigned===other.unsigned||this.high>>>31!=1||other.high>>>31!=1)&&(this.high===other.high&&this.low===other.low)},Long.prototype.eq=function(other){return this.equals(other)},Long.prototype.getHighBits=function(){return this.high},Long.prototype.getHighBitsUnsigned=function(){return this.high>>>0},Long.prototype.getLowBits=function(){return this.low},Long.prototype.getLowBitsUnsigned=function(){return this.low>>>0},Long.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Long.MIN_VALUE)?64:this.neg().getNumBitsAbs();var bit,val=0!==this.high?this.high:this.low;for(bit=31;bit>0&&0==(val&1<<bit);bit--);return 0!==this.high?bit+33:bit+1},Long.prototype.greaterThan=function(other){return this.comp(other)>0},Long.prototype.gt=function(other){return this.greaterThan(other)},Long.prototype.greaterThanOrEqual=function(other){return this.comp(other)>=0},Long.prototype.gte=function(other){return this.greaterThanOrEqual(other)},Long.prototype.ge=function(other){return this.greaterThanOrEqual(other)},Long.prototype.isEven=function(){return 0==(1&this.low)},Long.prototype.isNegative=function(){return!this.unsigned&&this.high<0},Long.prototype.isOdd=function(){return 1==(1&this.low)},Long.prototype.isPositive=function(){return this.unsigned||this.high>=0},Long.prototype.isZero=function(){return 0===this.high&&0===this.low},Long.prototype.lessThan=function(other){return this.comp(other)<0},Long.prototype.lt=function(other){return this.lessThan(other)},Long.prototype.lessThanOrEqual=function(other){return this.comp(other)<=0},Long.prototype.lte=function(other){return this.lessThanOrEqual(other)},Long.prototype.modulo=function(divisor){if(Long.isLong(divisor)||(divisor=Long.fromValue(divisor)),wasm){var low=(this.unsigned?wasm.rem_u:wasm.rem_s)(this.low,this.high,divisor.low,divisor.high);return Long.fromBits(low,wasm.get_high(),this.unsigned)}return this.sub(this.div(divisor).mul(divisor))},Long.prototype.mod=function(divisor){return this.modulo(divisor)},Long.prototype.rem=function(divisor){return this.modulo(divisor)},Long.prototype.multiply=function(multiplier){if(this.isZero())return Long.ZERO;if(Long.isLong(multiplier)||(multiplier=Long.fromValue(multiplier)),wasm){var low=wasm.mul(this.low,this.high,multiplier.low,multiplier.high);return Long.fromBits(low,wasm.get_high(),this.unsigned)}if(multiplier.isZero())return Long.ZERO;if(this.eq(Long.MIN_VALUE))return multiplier.isOdd()?Long.MIN_VALUE:Long.ZERO;if(multiplier.eq(Long.MIN_VALUE))return this.isOdd()?Long.MIN_VALUE:Long.ZERO;if(this.isNegative())return multiplier.isNegative()?this.neg().mul(multiplier.neg()):this.neg().mul(multiplier).neg();if(multiplier.isNegative())return this.mul(multiplier.neg()).neg();if(this.lt(Long.TWO_PWR_24)&&multiplier.lt(Long.TWO_PWR_24))return Long.fromNumber(this.toNumber()*multiplier.toNumber(),this.unsigned);var a48=this.high>>>16,a32=65535&this.high,a16=this.low>>>16,a00=65535&this.low,b48=multiplier.high>>>16,b32=65535&multiplier.high,b16=multiplier.low>>>16,b00=65535&multiplier.low,c48=0,c32=0,c16=0,c00=0;return c16+=(c00+=a00*b00)>>>16,c00&=65535,c32+=(c16+=a16*b00)>>>16,c16&=65535,c32+=(c16+=a00*b16)>>>16,c16&=65535,c48+=(c32+=a32*b00)>>>16,c32&=65535,c48+=(c32+=a16*b16)>>>16,c32&=65535,c48+=(c32+=a00*b32)>>>16,c32&=65535,c48+=a48*b00+a32*b16+a16*b32+a00*b48,c48&=65535,Long.fromBits(c16<<16|c00,c48<<16|c32,this.unsigned)},Long.prototype.mul=function(multiplier){return this.multiply(multiplier)},Long.prototype.negate=function(){return!this.unsigned&&this.eq(Long.MIN_VALUE)?Long.MIN_VALUE:this.not().add(Long.ONE)},Long.prototype.neg=function(){return this.negate()},Long.prototype.not=function(){return Long.fromBits(~this.low,~this.high,this.unsigned)},Long.prototype.notEquals=function(other){return!this.equals(other)},Long.prototype.neq=function(other){return this.notEquals(other)},Long.prototype.ne=function(other){return this.notEquals(other)},Long.prototype.or=function(other){return Long.isLong(other)||(other=Long.fromValue(other)),Long.fromBits(this.low|other.low,this.high|other.high,this.unsigned)},Long.prototype.shiftLeft=function(numBits){return Long.isLong(numBits)&&(numBits=numBits.toInt()),0==(numBits&=63)?this:numBits<32?Long.fromBits(this.low<<numBits,this.high<<numBits|this.low>>>32-numBits,this.unsigned):Long.fromBits(0,this.low<<numBits-32,this.unsigned)},Long.prototype.shl=function(numBits){return this.shiftLeft(numBits)},Long.prototype.shiftRight=function(numBits){return Long.isLong(numBits)&&(numBits=numBits.toInt()),0==(numBits&=63)?this:numBits<32?Long.fromBits(this.low>>>numBits|this.high<<32-numBits,this.high>>numBits,this.unsigned):Long.fromBits(this.high>>numBits-32,this.high>=0?0:-1,this.unsigned)},Long.prototype.shr=function(numBits){return this.shiftRight(numBits)},Long.prototype.shiftRightUnsigned=function(numBits){if(Long.isLong(numBits)&&(numBits=numBits.toInt()),0===(numBits&=63))return this;var high=this.high;if(numBits<32){var low=this.low;return Long.fromBits(low>>>numBits|high<<32-numBits,high>>>numBits,this.unsigned)}return 32===numBits?Long.fromBits(high,0,this.unsigned):Long.fromBits(high>>>numBits-32,0,this.unsigned)},Long.prototype.shr_u=function(numBits){return this.shiftRightUnsigned(numBits)},Long.prototype.shru=function(numBits){return this.shiftRightUnsigned(numBits)},Long.prototype.subtract=function(subtrahend){return Long.isLong(subtrahend)||(subtrahend=Long.fromValue(subtrahend)),this.add(subtrahend.neg())},Long.prototype.sub=function(subtrahend){return this.subtract(subtrahend)},Long.prototype.toInt=function(){return this.unsigned?this.low>>>0:this.low},Long.prototype.toNumber=function(){return this.unsigned?4294967296*(this.high>>>0)+(this.low>>>0):4294967296*this.high+(this.low>>>0)},Long.prototype.toBigInt=function(){return BigInt(this.toString())},Long.prototype.toBytes=function(le){return le?this.toBytesLE():this.toBytesBE()},Long.prototype.toBytesLE=function(){var hi=this.high,lo=this.low;return[255&lo,lo>>>8&255,lo>>>16&255,lo>>>24,255&hi,hi>>>8&255,hi>>>16&255,hi>>>24]},Long.prototype.toBytesBE=function(){var hi=this.high,lo=this.low;return[hi>>>24,hi>>>16&255,hi>>>8&255,255&hi,lo>>>24,lo>>>16&255,lo>>>8&255,255&lo]},Long.prototype.toSigned=function(){return this.unsigned?Long.fromBits(this.low,this.high,!1):this},Long.prototype.toString=function(radix){if((radix=radix||10)<2||36<radix)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(Long.MIN_VALUE)){var radixLong=Long.fromNumber(radix),div=this.div(radixLong),rem1=div.mul(radixLong).sub(this);return div.toString(radix)+rem1.toInt().toString(radix)}return"-"+this.neg().toString(radix)}for(var radixToPower=Long.fromNumber(Math.pow(radix,6),this.unsigned),rem=this,result="";;){var remDiv=rem.div(radixToPower),digits=(rem.sub(remDiv.mul(radixToPower)).toInt()>>>0).toString(radix);if((rem=remDiv).isZero())return digits+result;for(;digits.length<6;)digits="0"+digits;result=""+digits+result}},Long.prototype.toUnsigned=function(){return this.unsigned?this:Long.fromBits(this.low,this.high,!0)},Long.prototype.xor=function(other){return Long.isLong(other)||(other=Long.fromValue(other)),Long.fromBits(this.low^other.low,this.high^other.high,this.unsigned)},Long.prototype.eqz=function(){return this.isZero()},Long.prototype.le=function(other){return this.lessThanOrEqual(other)},Long.prototype.toExtendedJSON=function(options){return options&&options.relaxed?this.toNumber():{$numberLong:this.toString()}},Long.fromExtendedJSON=function(doc,options){var result=Long.fromString(doc.$numberLong);return options&&options.relaxed?result.toNumber():result},Long.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},Long.prototype.inspect=function(){return'new Long("'+this.toString()+'"'+(this.unsigned?", true":"")+")"},Long.TWO_PWR_24=Long.fromInt(16777216),Long.MAX_UNSIGNED_VALUE=Long.fromBits(-1,-1,!0),Long.ZERO=Long.fromInt(0),Long.UZERO=Long.fromInt(0,!0),Long.ONE=Long.fromInt(1),Long.UONE=Long.fromInt(1,!0),Long.NEG_ONE=Long.fromInt(-1),Long.MAX_VALUE=Long.fromBits(-1,2147483647,!1),Long.MIN_VALUE=Long.fromBits(0,-2147483648,!1),Long}();Object.defineProperty(Long.prototype,"__isLong__",{value:!0}),Object.defineProperty(Long.prototype,"_bsontype",{value:"Long"});var PARSE_STRING_REGEXP=/^(\+|-)?(\d+|(\d*\.\d*))?(E|e)?([-+])?(\d+)?$/,PARSE_INF_REGEXP=/^(\+|-)?(Infinity|inf)$/i,PARSE_NAN_REGEXP=/^(\+|-)?NaN$/i,NAN_BUFFER=[124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),INF_NEGATIVE_BUFFER=[248,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),INF_POSITIVE_BUFFER=[120,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),EXPONENT_REGEX=/^([-+])?(\d+)?$/;function isDigit(value){return!isNaN(parseInt(value,10))}function divideu128(value){var DIVISOR=Long.fromNumber(1e9),_rem=Long.fromNumber(0);if(!(value.parts[0]||value.parts[1]||value.parts[2]||value.parts[3]))return{quotient:value,rem:_rem};for(var i=0;i<=3;i++)_rem=(_rem=_rem.shiftLeft(32)).add(new Long(value.parts[i],0)),value.parts[i]=_rem.div(DIVISOR).low,_rem=_rem.modulo(DIVISOR);return{quotient:value,rem:_rem}}function invalidErr(string,message){throw new BSONTypeError('"'+string+'" is not a valid Decimal128 string - '+message)}var Decimal128=function(){function Decimal128(bytes){if(!(this instanceof Decimal128))return new Decimal128(bytes);if("string"==typeof bytes)this.bytes=Decimal128.fromString(bytes).bytes;else{if(!isUint8Array(bytes))throw new BSONTypeError("Decimal128 must take a Buffer or string");if(16!==bytes.byteLength)throw new BSONTypeError("Decimal128 must take a Buffer of 16 bytes");this.bytes=bytes}}return Decimal128.fromString=function(representation){var biasedExponent,isNegative=!1,sawRadix=!1,foundNonZero=!1,significantDigits=0,nDigitsRead=0,nDigits=0,radixPosition=0,firstNonZero=0,digits=[0],nDigitsStored=0,digitsInsert=0,firstDigit=0,lastDigit=0,exponent=0,i=0,significandHigh=new Long(0,0),significandLow=new Long(0,0),index=0;if(representation.length>=7e3)throw new BSONTypeError(representation+" not a valid Decimal128 string");var stringMatch=representation.match(PARSE_STRING_REGEXP),infMatch=representation.match(PARSE_INF_REGEXP),nanMatch=representation.match(PARSE_NAN_REGEXP);if(!stringMatch&&!infMatch&&!nanMatch||0===representation.length)throw new BSONTypeError(representation+" not a valid Decimal128 string");if(stringMatch){var unsignedNumber=stringMatch[2],e=stringMatch[4],expSign=stringMatch[5],expNumber=stringMatch[6];e&&void 0===expNumber&&invalidErr(representation,"missing exponent power"),e&&void 0===unsignedNumber&&invalidErr(representation,"missing exponent base"),void 0===e&&(expSign||expNumber)&&invalidErr(representation,"missing e before exponent")}if("+"!==representation[index]&&"-"!==representation[index]||(isNegative="-"===representation[index++]),!isDigit(representation[index])&&"."!==representation[index]){if("i"===representation[index]||"I"===representation[index])return new Decimal128(buffer_1.from(isNegative?INF_NEGATIVE_BUFFER:INF_POSITIVE_BUFFER));if("N"===representation[index])return new Decimal128(buffer_1.from(NAN_BUFFER))}for(;isDigit(representation[index])||"."===representation[index];)"."!==representation[index]?(nDigitsStored<34&&("0"!==representation[index]||foundNonZero)&&(foundNonZero||(firstNonZero=nDigitsRead),foundNonZero=!0,digits[digitsInsert++]=parseInt(representation[index],10),nDigitsStored+=1),foundNonZero&&(nDigits+=1),sawRadix&&(radixPosition+=1),nDigitsRead+=1,index+=1):(sawRadix&&invalidErr(representation,"contains multiple periods"),sawRadix=!0,index+=1);if(sawRadix&&!nDigitsRead)throw new BSONTypeError(representation+" not a valid Decimal128 string");if("e"===representation[index]||"E"===representation[index]){var match=representation.substr(++index).match(EXPONENT_REGEX);if(!match||!match[2])return new Decimal128(buffer_1.from(NAN_BUFFER));exponent=parseInt(match[0],10),index+=match[0].length}if(representation[index])return new Decimal128(buffer_1.from(NAN_BUFFER));if(firstDigit=0,nDigitsStored){if(lastDigit=nDigitsStored-1,1!==(significantDigits=nDigits))for(;0===digits[firstNonZero+significantDigits-1];)significantDigits-=1}else firstDigit=0,lastDigit=0,digits[0]=0,nDigits=1,nDigitsStored=1,significantDigits=0;for(exponent<=radixPosition&&radixPosition-exponent>16384?exponent=-6176:exponent-=radixPosition;exponent>6111;){if((lastDigit+=1)-firstDigit>34){if(digits.join("").match(/^0+$/)){exponent=6111;break}invalidErr(representation,"overflow")}exponent-=1}for(;exponent<-6176||nDigitsStored<nDigits;){if(0===lastDigit&&significantDigits<nDigitsStored){exponent=-6176,significantDigits=0;break}if(nDigitsStored<nDigits?nDigits-=1:lastDigit-=1,exponent<6111)exponent+=1;else{if(digits.join("").match(/^0+$/)){exponent=6111;break}invalidErr(representation,"overflow")}}if(lastDigit-firstDigit+1<significantDigits){var endOfString=nDigitsRead;sawRadix&&(firstNonZero+=1,endOfString+=1),isNegative&&(firstNonZero+=1,endOfString+=1);var roundDigit=parseInt(representation[firstNonZero+lastDigit+1],10),roundBit=0;if(roundDigit>=5&&(roundBit=1,5===roundDigit))for(roundBit=digits[lastDigit]%2==1?1:0,i=firstNonZero+lastDigit+2;i<endOfString;i++)if(parseInt(representation[i],10)){roundBit=1;break}if(roundBit)for(var dIdx=lastDigit;dIdx>=0;dIdx--)if(++digits[dIdx]>9&&(digits[dIdx]=0,0===dIdx)){if(!(exponent<6111))return new Decimal128(buffer_1.from(isNegative?INF_NEGATIVE_BUFFER:INF_POSITIVE_BUFFER));exponent+=1,digits[dIdx]=1}}if(significandHigh=Long.fromNumber(0),significandLow=Long.fromNumber(0),0===significantDigits)significandHigh=Long.fromNumber(0),significandLow=Long.fromNumber(0);else if(lastDigit-firstDigit<17){dIdx=firstDigit;for(significandLow=Long.fromNumber(digits[dIdx++]),significandHigh=new Long(0,0);dIdx<=lastDigit;dIdx++)significandLow=(significandLow=significandLow.multiply(Long.fromNumber(10))).add(Long.fromNumber(digits[dIdx]))}else{dIdx=firstDigit;for(significandHigh=Long.fromNumber(digits[dIdx++]);dIdx<=lastDigit-17;dIdx++)significandHigh=(significandHigh=significandHigh.multiply(Long.fromNumber(10))).add(Long.fromNumber(digits[dIdx]));for(significandLow=Long.fromNumber(digits[dIdx++]);dIdx<=lastDigit;dIdx++)significandLow=(significandLow=significandLow.multiply(Long.fromNumber(10))).add(Long.fromNumber(digits[dIdx]))}var significand=function multiply64x2(left,right){if(!left&&!right)return{high:Long.fromNumber(0),low:Long.fromNumber(0)};var leftHigh=left.shiftRightUnsigned(32),leftLow=new Long(left.getLowBits(),0),rightHigh=right.shiftRightUnsigned(32),rightLow=new Long(right.getLowBits(),0),productHigh=leftHigh.multiply(rightHigh),productMid=leftHigh.multiply(rightLow),productMid2=leftLow.multiply(rightHigh),productLow=leftLow.multiply(rightLow);return productHigh=productHigh.add(productMid.shiftRightUnsigned(32)),productMid=new Long(productMid.getLowBits(),0).add(productMid2).add(productLow.shiftRightUnsigned(32)),{high:productHigh=productHigh.add(productMid.shiftRightUnsigned(32)),low:productLow=productMid.shiftLeft(32).add(new Long(productLow.getLowBits(),0))}}(significandHigh,Long.fromString("100000000000000000"));significand.low=significand.low.add(significandLow),function lessThan(left,right){var uhleft=left.high>>>0,uhright=right.high>>>0;return uhleft<uhright||uhleft===uhright&&left.low>>>0<right.low>>>0}(significand.low,significandLow)&&(significand.high=significand.high.add(Long.fromNumber(1))),biasedExponent=exponent+6176;var dec={low:Long.fromNumber(0),high:Long.fromNumber(0)};significand.high.shiftRightUnsigned(49).and(Long.fromNumber(1)).equals(Long.fromNumber(1))?(dec.high=dec.high.or(Long.fromNumber(3).shiftLeft(61)),dec.high=dec.high.or(Long.fromNumber(biasedExponent).and(Long.fromNumber(16383).shiftLeft(47))),dec.high=dec.high.or(significand.high.and(Long.fromNumber(0x7fffffffffff)))):(dec.high=dec.high.or(Long.fromNumber(16383&biasedExponent).shiftLeft(49)),dec.high=dec.high.or(significand.high.and(Long.fromNumber(562949953421311)))),dec.low=significand.low,isNegative&&(dec.high=dec.high.or(Long.fromString("9223372036854775808")));var buffer=buffer_1.alloc(16);return index=0,buffer[index++]=255&dec.low.low,buffer[index++]=dec.low.low>>8&255,buffer[index++]=dec.low.low>>16&255,buffer[index++]=dec.low.low>>24&255,buffer[index++]=255&dec.low.high,buffer[index++]=dec.low.high>>8&255,buffer[index++]=dec.low.high>>16&255,buffer[index++]=dec.low.high>>24&255,buffer[index++]=255&dec.high.low,buffer[index++]=dec.high.low>>8&255,buffer[index++]=dec.high.low>>16&255,buffer[index++]=dec.high.low>>24&255,buffer[index++]=255&dec.high.high,buffer[index++]=dec.high.high>>8&255,buffer[index++]=dec.high.high>>16&255,buffer[index++]=dec.high.high>>24&255,new Decimal128(buffer)},Decimal128.prototype.toString=function(){for(var biased_exponent,significand_digits=0,significand=new Array(36),i=0;i<significand.length;i++)significand[i]=0;var significand_msb,j,k,index=0,is_zero=!1,significand128={parts:[0,0,0,0]},string=[];index=0;var buffer=this.bytes,low=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24,midl=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24,midh=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24,high=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24;index=0,{low:new Long(low,midl),high:new Long(midh,high)}.high.lessThan(Long.ZERO)&&string.push("-");var combination=high>>26&31;if(combination>>3==3){if(30===combination)return string.join("")+"Infinity";if(31===combination)return"NaN";biased_exponent=high>>15&16383,significand_msb=8+(high>>14&1)}else significand_msb=high>>14&7,biased_exponent=high>>17&16383;var exponent=biased_exponent-6176;if(significand128.parts[0]=(16383&high)+((15&significand_msb)<<14),significand128.parts[1]=midh,significand128.parts[2]=midl,significand128.parts[3]=low,0===significand128.parts[0]&&0===significand128.parts[1]&&0===significand128.parts[2]&&0===significand128.parts[3])is_zero=!0;else for(k=3;k>=0;k--){var least_digits=0,result=divideu128(significand128);if(significand128=result.quotient,least_digits=result.rem.low)for(j=8;j>=0;j--)significand[9*k+j]=least_digits%10,least_digits=Math.floor(least_digits/10)}if(is_zero)significand_digits=1,significand[index]=0;else for(significand_digits=36;!significand[index];)significand_digits-=1,index+=1;var scientific_exponent=significand_digits-1+exponent;if(scientific_exponent>=34||scientific_exponent<=-7||exponent>0){if(significand_digits>34)return string.push("0"),exponent>0?string.push("E+"+exponent):exponent<0&&string.push("E"+exponent),string.join("");string.push(""+significand[index++]),(significand_digits-=1)&&string.push(".");for(i=0;i<significand_digits;i++)string.push(""+significand[index++]);string.push("E"),scientific_exponent>0?string.push("+"+scientific_exponent):string.push(""+scientific_exponent)}else if(exponent>=0)for(i=0;i<significand_digits;i++)string.push(""+significand[index++]);else{var radix_position=significand_digits+exponent;if(radix_position>0)for(i=0;i<radix_position;i++)string.push(""+significand[index++]);else string.push("0");for(string.push(".");radix_position++<0;)string.push("0");for(i=0;i<significand_digits-Math.max(radix_position-1,0);i++)string.push(""+significand[index++])}return string.join("")},Decimal128.prototype.toJSON=function(){return{$numberDecimal:this.toString()}},Decimal128.prototype.toExtendedJSON=function(){return{$numberDecimal:this.toString()}},Decimal128.fromExtendedJSON=function(doc){return Decimal128.fromString(doc.$numberDecimal)},Decimal128.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},Decimal128.prototype.inspect=function(){return'new Decimal128("'+this.toString()+'")'},Decimal128}();Object.defineProperty(Decimal128.prototype,"_bsontype",{value:"Decimal128"});var Double=function(){function Double(value){if(!(this instanceof Double))return new Double(value);value instanceof Number&&(value=value.valueOf()),this.value=+value}return Double.prototype.valueOf=function(){return this.value},Double.prototype.toJSON=function(){return this.value},Double.prototype.toString=function(radix){return this.value.toString(radix)},Double.prototype.toExtendedJSON=function(options){return options&&(options.legacy||options.relaxed&&isFinite(this.value))?this.value:Object.is(Math.sign(this.value),-0)?{$numberDouble:"-"+this.value.toFixed(1)}:(Number.isInteger(this.value)?($numberDouble=this.value.toFixed(1)).length>=13&&($numberDouble=this.value.toExponential(13).toUpperCase()):$numberDouble=this.value.toString(),{$numberDouble:$numberDouble});var $numberDouble},Double.fromExtendedJSON=function(doc,options){var doubleValue=parseFloat(doc.$numberDouble);return options&&options.relaxed?doubleValue:new Double(doubleValue)},Double.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},Double.prototype.inspect=function(){return"new Double("+this.toExtendedJSON().$numberDouble+")"},Double}();Object.defineProperty(Double.prototype,"_bsontype",{value:"Double"});var Int32=function(){function Int32(value){if(!(this instanceof Int32))return new Int32(value);value instanceof Number&&(value=value.valueOf()),this.value=0|+value}return Int32.prototype.valueOf=function(){return this.value},Int32.prototype.toString=function(radix){return this.value.toString(radix)},Int32.prototype.toJSON=function(){return this.value},Int32.prototype.toExtendedJSON=function(options){return options&&(options.relaxed||options.legacy)?this.value:{$numberInt:this.value.toString()}},Int32.fromExtendedJSON=function(doc,options){return options&&options.relaxed?parseInt(doc.$numberInt,10):new Int32(doc.$numberInt)},Int32.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},Int32.prototype.inspect=function(){return"new Int32("+this.valueOf()+")"},Int32}();Object.defineProperty(Int32.prototype,"_bsontype",{value:"Int32"});var MaxKey=function(){function MaxKey(){if(!(this instanceof MaxKey))return new MaxKey}return MaxKey.prototype.toExtendedJSON=function(){return{$maxKey:1}},MaxKey.fromExtendedJSON=function(){return new MaxKey},MaxKey.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},MaxKey.prototype.inspect=function(){return"new MaxKey()"},MaxKey}();Object.defineProperty(MaxKey.prototype,"_bsontype",{value:"MaxKey"});var MinKey=function(){function MinKey(){if(!(this instanceof MinKey))return new MinKey}return MinKey.prototype.toExtendedJSON=function(){return{$minKey:1}},MinKey.fromExtendedJSON=function(){return new MinKey},MinKey.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},MinKey.prototype.inspect=function(){return"new MinKey()"},MinKey}();Object.defineProperty(MinKey.prototype,"_bsontype",{value:"MinKey"});var checkForHexRegExp=new RegExp("^[0-9a-fA-F]{24}$"),PROCESS_UNIQUE=null,kId=Symbol("id"),ObjectId=function(){function ObjectId(inputId){if(!(this instanceof ObjectId))return new ObjectId(inputId);var workingId;if("object"==typeof inputId&&inputId&&"id"in inputId){if("string"!=typeof inputId.id&&!ArrayBuffer.isView(inputId.id))throw new BSONTypeError("Argument passed in must have an id that is of type string or Buffer");workingId="toHexString"in inputId&&"function"==typeof inputId.toHexString?buffer_1.from(inputId.toHexString(),"hex"):inputId.id}else workingId=inputId;if(null==workingId||"number"==typeof workingId)this[kId]=ObjectId.generate("number"==typeof workingId?workingId:void 0);else if(ArrayBuffer.isView(workingId)&&12===workingId.byteLength)this[kId]=workingId instanceof buffer_1?workingId:ensureBuffer(workingId);else{if("string"!=typeof workingId)throw new BSONTypeError("Argument passed in does not match the accepted types");if(12===workingId.length){var bytes=buffer_1.from(workingId);if(12!==bytes.byteLength)throw new BSONTypeError("Argument passed in must be a string of 12 bytes");this[kId]=bytes}else{if(24!==workingId.length||!checkForHexRegExp.test(workingId))throw new BSONTypeError("Argument passed in must be a string of 12 bytes or a string of 24 hex characters or an integer");this[kId]=buffer_1.from(workingId,"hex")}}ObjectId.cacheHexString&&(this.__id=this.id.toString("hex"))}return Object.defineProperty(ObjectId.prototype,"id",{get:function(){return this[kId]},set:function(value){this[kId]=value,ObjectId.cacheHexString&&(this.__id=value.toString("hex"))},enumerable:!1,configurable:!0}),Object.defineProperty(ObjectId.prototype,"generationTime",{get:function(){return this.id.readInt32BE(0)},set:function(value){this.id.writeUInt32BE(value,0)},enumerable:!1,configurable:!0}),ObjectId.prototype.toHexString=function(){if(ObjectId.cacheHexString&&this.__id)return this.__id;var hexString=this.id.toString("hex");return ObjectId.cacheHexString&&!this.__id&&(this.__id=hexString),hexString},ObjectId.getInc=function(){return ObjectId.index=(ObjectId.index+1)%16777215},ObjectId.generate=function(time){"number"!=typeof time&&(time=Math.floor(Date.now()/1e3));var inc=ObjectId.getInc(),buffer=buffer_1.alloc(12);return buffer.writeUInt32BE(time,0),null===PROCESS_UNIQUE&&(PROCESS_UNIQUE=randomBytes(5)),buffer[4]=PROCESS_UNIQUE[0],buffer[5]=PROCESS_UNIQUE[1],buffer[6]=PROCESS_UNIQUE[2],buffer[7]=PROCESS_UNIQUE[3],buffer[8]=PROCESS_UNIQUE[4],buffer[11]=255&inc,buffer[10]=inc>>8&255,buffer[9]=inc>>16&255,buffer},ObjectId.prototype.toString=function(format){return format?this.id.toString(format):this.toHexString()},ObjectId.prototype.toJSON=function(){return this.toHexString()},ObjectId.prototype.equals=function(otherId){if(null==otherId)return!1;if(otherId instanceof ObjectId)return this[kId][11]===otherId[kId][11]&&this[kId].equals(otherId[kId]);if("string"==typeof otherId&&ObjectId.isValid(otherId)&&12===otherId.length&&isUint8Array(this.id))return otherId===buffer_1.prototype.toString.call(this.id,"latin1");if("string"==typeof otherId&&ObjectId.isValid(otherId)&&24===otherId.length)return otherId.toLowerCase()===this.toHexString();if("string"==typeof otherId&&ObjectId.isValid(otherId)&&12===otherId.length)return buffer_1.from(otherId).equals(this.id);if("object"==typeof otherId&&"toHexString"in otherId&&"function"==typeof otherId.toHexString){var otherIdString=otherId.toHexString(),thisIdString=this.toHexString().toLowerCase();return"string"==typeof otherIdString&&otherIdString.toLowerCase()===thisIdString}return!1},ObjectId.prototype.getTimestamp=function(){var timestamp=new Date,time=this.id.readUInt32BE(0);return timestamp.setTime(1e3*Math.floor(time)),timestamp},ObjectId.createPk=function(){return new ObjectId},ObjectId.createFromTime=function(time){var buffer=buffer_1.from([0,0,0,0,0,0,0,0,0,0,0,0]);return buffer.writeUInt32BE(time,0),new ObjectId(buffer)},ObjectId.createFromHexString=function(hexString){if(void 0===hexString||null!=hexString&&24!==hexString.length)throw new BSONTypeError("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");return new ObjectId(buffer_1.from(hexString,"hex"))},ObjectId.isValid=function(id){if(null==id)return!1;try{return new ObjectId(id),!0}catch(_a){return!1}},ObjectId.prototype.toExtendedJSON=function(){return this.toHexString?{$oid:this.toHexString()}:{$oid:this.toString("hex")}},ObjectId.fromExtendedJSON=function(doc){return new ObjectId(doc.$oid)},ObjectId.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},ObjectId.prototype.inspect=function(){return'new ObjectId("'+this.toHexString()+'")'},ObjectId.index=Math.floor(16777215*Math.random()),ObjectId}();Object.defineProperty(ObjectId.prototype,"generate",{value:deprecate((function(time){return ObjectId.generate(time)}),"Please use the static `ObjectId.generate(time)` instead")}),Object.defineProperty(ObjectId.prototype,"getInc",{value:deprecate((function(){return ObjectId.getInc()}),"Please use the static `ObjectId.getInc()` instead")}),Object.defineProperty(ObjectId.prototype,"get_inc",{value:deprecate((function(){return ObjectId.getInc()}),"Please use the static `ObjectId.getInc()` instead")}),Object.defineProperty(ObjectId,"get_inc",{value:deprecate((function(){return ObjectId.getInc()}),"Please use the static `ObjectId.getInc()` instead")}),Object.defineProperty(ObjectId.prototype,"_bsontype",{value:"ObjectID"});var BSONRegExp=function(){function BSONRegExp(pattern,options){if(!(this instanceof BSONRegExp))return new BSONRegExp(pattern,options);if(this.pattern=pattern,this.options=function alphabetize(str){return str.split("").sort().join("")}(null!=options?options:""),-1!==this.pattern.indexOf("\0"))throw new BSONError("BSON Regex patterns cannot contain null bytes, found: "+JSON.stringify(this.pattern));if(-1!==this.options.indexOf("\0"))throw new BSONError("BSON Regex options cannot contain null bytes, found: "+JSON.stringify(this.options));for(var i=0;i<this.options.length;i++)if("i"!==this.options[i]&&"m"!==this.options[i]&&"x"!==this.options[i]&&"l"!==this.options[i]&&"s"!==this.options[i]&&"u"!==this.options[i])throw new BSONError("The regular expression option ["+this.options[i]+"] is not supported")}return BSONRegExp.parseOptions=function(options){return options?options.split("").sort().join(""):""},BSONRegExp.prototype.toExtendedJSON=function(options){return(options=options||{}).legacy?{$regex:this.pattern,$options:this.options}:{$regularExpression:{pattern:this.pattern,options:this.options}}},BSONRegExp.fromExtendedJSON=function(doc){if("$regex"in doc){if("string"==typeof doc.$regex)return new BSONRegExp(doc.$regex,BSONRegExp.parseOptions(doc.$options));if("BSONRegExp"===doc.$regex._bsontype)return doc}if("$regularExpression"in doc)return new BSONRegExp(doc.$regularExpression.pattern,BSONRegExp.parseOptions(doc.$regularExpression.options));throw new BSONTypeError("Unexpected BSONRegExp EJSON object form: "+JSON.stringify(doc))},BSONRegExp}();Object.defineProperty(BSONRegExp.prototype,"_bsontype",{value:"BSONRegExp"});var BSONSymbol=function(){function BSONSymbol(value){if(!(this instanceof BSONSymbol))return new BSONSymbol(value);this.value=value}return BSONSymbol.prototype.valueOf=function(){return this.value},BSONSymbol.prototype.toString=function(){return this.value},BSONSymbol.prototype.inspect=function(){return'new BSONSymbol("'+this.value+'")'},BSONSymbol.prototype.toJSON=function(){return this.value},BSONSymbol.prototype.toExtendedJSON=function(){return{$symbol:this.value}},BSONSymbol.fromExtendedJSON=function(doc){return new BSONSymbol(doc.$symbol)},BSONSymbol.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},BSONSymbol}();Object.defineProperty(BSONSymbol.prototype,"_bsontype",{value:"Symbol"});var LongWithoutOverridesClass=Long,Timestamp=function(_super){function Timestamp(low,high){var _this=this;return _this instanceof Timestamp?(_this=Long.isLong(low)?_super.call(this,low.low,low.high,!0)||this:isObjectLike(low)&&void 0!==low.t&&void 0!==low.i?_super.call(this,low.i,low.t,!0)||this:_super.call(this,low,high,!0)||this,Object.defineProperty(_this,"_bsontype",{value:"Timestamp",writable:!1,configurable:!1,enumerable:!1}),_this):new Timestamp(low,high)}return __extends(Timestamp,_super),Timestamp.prototype.toJSON=function(){return{$timestamp:this.toString()}},Timestamp.fromInt=function(value){return new Timestamp(Long.fromInt(value,!0))},Timestamp.fromNumber=function(value){return new Timestamp(Long.fromNumber(value,!0))},Timestamp.fromBits=function(lowBits,highBits){return new Timestamp(lowBits,highBits)},Timestamp.fromString=function(str,optRadix){return new Timestamp(Long.fromString(str,!0,optRadix))},Timestamp.prototype.toExtendedJSON=function(){return{$timestamp:{t:this.high>>>0,i:this.low>>>0}}},Timestamp.fromExtendedJSON=function(doc){return new Timestamp(doc.$timestamp)},Timestamp.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},Timestamp.prototype.inspect=function(){return"new Timestamp({ t: "+this.getHighBits()+", i: "+this.getLowBits()+" })"},Timestamp.MAX_VALUE=Long.MAX_UNSIGNED_VALUE,Timestamp}(LongWithoutOverridesClass);function isBSONType(value){return isObjectLike(value)&&Reflect.has(value,"_bsontype")&&"string"==typeof value._bsontype}var keysToCodecs={$oid:ObjectId,$binary:Binary,$uuid:Binary,$symbol:BSONSymbol,$numberInt:Int32,$numberDecimal:Decimal128,$numberDouble:Double,$numberLong:Long,$minKey:MinKey,$maxKey:MaxKey,$regex:BSONRegExp,$regularExpression:BSONRegExp,$timestamp:Timestamp};function deserializeValue(value,options){if(void 0===options&&(options={}),"number"==typeof value){if(options.relaxed||options.legacy)return value;if(Math.floor(value)===value){if(value>=-2147483648&&value<=2147483647)return new Int32(value);if(value>=-0x8000000000000000&&value<=0x8000000000000000)return Long.fromNumber(value)}return new Double(value)}if(null==value||"object"!=typeof value)return value;if(value.$undefined)return null;for(var keys=Object.keys(value).filter((function(k){return k.startsWith("$")&&null!=value[k]})),i=0;i<keys.length;i++){var c=keysToCodecs[keys[i]];if(c)return c.fromExtendedJSON(value,options)}if(null!=value.$date){var d=value.$date,date=new Date;return options.legacy?"number"==typeof d?date.setTime(d):"string"==typeof d&&date.setTime(Date.parse(d)):"string"==typeof d?date.setTime(Date.parse(d)):Long.isLong(d)?date.setTime(d.toNumber()):"number"==typeof d&&options.relaxed&&date.setTime(d),date}if(null!=value.$code){var copy=Object.assign({},value);return value.$scope&&(copy.$scope=deserializeValue(value.$scope)),Code.fromExtendedJSON(value)}if(isDBRefLike(value)||value.$dbPointer){var v=value.$ref?value:value.$dbPointer;if(v instanceof DBRef)return v;var dollarKeys=Object.keys(v).filter((function(k){return k.startsWith("$")})),valid_1=!0;if(dollarKeys.forEach((function(k){-1===["$ref","$id","$db"].indexOf(k)&&(valid_1=!1)})),valid_1)return DBRef.fromExtendedJSON(v)}return value}function getISOString(date){var isoStr=date.toISOString();return 0!==date.getUTCMilliseconds()?isoStr:isoStr.slice(0,-5)+"Z"}function serializeValue(value,options){if(("object"==typeof value||"function"==typeof value)&&null!==value){var index=options.seenObjects.findIndex((function(entry){return entry.obj===value}));if(-1!==index){var props=options.seenObjects.map((function(entry){return entry.propertyName})),leadingPart=props.slice(0,index).map((function(prop){return prop+" -> "})).join(""),alreadySeen=props[index],circularPart=" -> "+props.slice(index+1,props.length-1).map((function(prop){return prop+" -> "})).join(""),current=props[props.length-1],leadingSpace=" ".repeat(leadingPart.length+alreadySeen.length/2),dashes="-".repeat(circularPart.length+(alreadySeen.length+current.length)/2-1);throw new BSONTypeError("Converting circular structure to EJSON:\n    "+leadingPart+alreadySeen+circularPart+current+"\n    "+leadingSpace+"\\"+dashes+"/")}options.seenObjects[options.seenObjects.length-1].obj=value}if(Array.isArray(value))return function serializeArray(array,options){return array.map((function(v,index){options.seenObjects.push({propertyName:"index "+index,obj:null});try{return serializeValue(v,options)}finally{options.seenObjects.pop()}}))}(value,options);if(void 0===value)return null;if(value instanceof Date||isDate(value)){var dateNum=value.getTime(),inRange=dateNum>-1&&dateNum<2534023188e5;return options.legacy?options.relaxed&&inRange?{$date:value.getTime()}:{$date:getISOString(value)}:options.relaxed&&inRange?{$date:getISOString(value)}:{$date:{$numberLong:value.getTime().toString()}}}if(!("number"!=typeof value||options.relaxed&&isFinite(value))){if(Math.floor(value)===value){var int64Range=value>=-0x8000000000000000&&value<=0x8000000000000000;if(value>=-2147483648&&value<=2147483647)return{$numberInt:value.toString()};if(int64Range)return{$numberLong:value.toString()}}return{$numberDouble:value.toString()}}if(value instanceof RegExp||isRegExp(value)){var flags=value.flags;if(void 0===flags){var match=value.toString().match(/[gimuy]*$/);match&&(flags=match[0])}return new BSONRegExp(value.source,flags).toExtendedJSON(options)}return null!=value&&"object"==typeof value?function serializeDocument(doc,options){if(null==doc||"object"!=typeof doc)throw new BSONError("not an object instance");var bsontype=doc._bsontype;if(void 0===bsontype){var _doc={};for(var name in doc){options.seenObjects.push({propertyName:name,obj:null});try{_doc[name]=serializeValue(doc[name],options)}finally{options.seenObjects.pop()}}return _doc}if(isBSONType(doc)){var outDoc=doc;if("function"!=typeof outDoc.toExtendedJSON){var mapper=BSON_TYPE_MAPPINGS[doc._bsontype];if(!mapper)throw new BSONTypeError("Unrecognized or invalid _bsontype: "+doc._bsontype);outDoc=mapper(outDoc)}return"Code"===bsontype&&outDoc.scope?outDoc=new Code(outDoc.code,serializeValue(outDoc.scope,options)):"DBRef"===bsontype&&outDoc.oid&&(outDoc=new DBRef(serializeValue(outDoc.collection,options),serializeValue(outDoc.oid,options),serializeValue(outDoc.db,options),serializeValue(outDoc.fields,options))),outDoc.toExtendedJSON(options)}throw new BSONError("_bsontype must be a string, but was: "+typeof bsontype)}(value,options):value}var EJSON,bsonMap,BSON_TYPE_MAPPINGS={Binary:function(o){return new Binary(o.value(),o.sub_type)},Code:function(o){return new Code(o.code,o.scope)},DBRef:function(o){return new DBRef(o.collection||o.namespace,o.oid,o.db,o.fields)},Decimal128:function(o){return new Decimal128(o.bytes)},Double:function(o){return new Double(o.value)},Int32:function(o){return new Int32(o.value)},Long:function(o){return Long.fromBits(null!=o.low?o.low:o.low_,null!=o.low?o.high:o.high_,null!=o.low?o.unsigned:o.unsigned_)},MaxKey:function(){return new MaxKey},MinKey:function(){return new MinKey},ObjectID:function(o){return new ObjectId(o)},ObjectId:function(o){return new ObjectId(o)},BSONRegExp:function(o){return new BSONRegExp(o.pattern,o.options)},Symbol:function(o){return new BSONSymbol(o.value)},Timestamp:function(o){return Timestamp.fromBits(o.low,o.high)}};!function(EJSON){function parse(text,options){var finalOptions=Object.assign({},{relaxed:!0,legacy:!1},options);return"boolean"==typeof finalOptions.relaxed&&(finalOptions.strict=!finalOptions.relaxed),"boolean"==typeof finalOptions.strict&&(finalOptions.relaxed=!finalOptions.strict),JSON.parse(text,(function(key,value){if(-1!==key.indexOf("\0"))throw new BSONError("BSON Document field names cannot contain null bytes, found: "+JSON.stringify(key));return deserializeValue(value,finalOptions)}))}function stringify(value,replacer,space,options){null!=space&&"object"==typeof space&&(options=space,space=0),null==replacer||"object"!=typeof replacer||Array.isArray(replacer)||(options=replacer,replacer=void 0,space=0);var doc=serializeValue(value,Object.assign({relaxed:!0,legacy:!1},options,{seenObjects:[{propertyName:"(root)",obj:null}]}));return JSON.stringify(doc,replacer,space)}EJSON.parse=parse,EJSON.stringify=stringify,EJSON.serialize=function serialize(value,options){return options=options||{},JSON.parse(stringify(value,options))},EJSON.deserialize=function deserialize(ejson,options){return options=options||{},parse(JSON.stringify(ejson),options)}}(EJSON||(EJSON={}));var bsonGlobal=getGlobal();bsonMap=bsonGlobal.Map?bsonGlobal.Map:function(){function Map(array){void 0===array&&(array=[]),this._keys=[],this._values={};for(var i=0;i<array.length;i++)if(null!=array[i]){var entry=array[i],key=entry[0],value=entry[1];this._keys.push(key),this._values[key]={v:value,i:this._keys.length-1}}}return Map.prototype.clear=function(){this._keys=[],this._values={}},Map.prototype.delete=function(key){var value=this._values[key];return null!=value&&(delete this._values[key],this._keys.splice(value.i,1),!0)},Map.prototype.entries=function(){var _this=this,index=0;return{next:function(){var key=_this._keys[index++];return{value:void 0!==key?[key,_this._values[key].v]:void 0,done:void 0===key}}}},Map.prototype.forEach=function(callback,self){self=self||this;for(var i=0;i<this._keys.length;i++){var key=this._keys[i];callback.call(self,this._values[key].v,key,self)}},Map.prototype.get=function(key){return this._values[key]?this._values[key].v:void 0},Map.prototype.has=function(key){return null!=this._values[key]},Map.prototype.keys=function(){var _this=this,index=0;return{next:function(){var key=_this._keys[index++];return{value:void 0!==key?key:void 0,done:void 0===key}}}},Map.prototype.set=function(key,value){return this._values[key]?(this._values[key].v=value,this):(this._keys.push(key),this._values[key]={v:value,i:this._keys.length-1},this)},Map.prototype.values=function(){var _this=this,index=0;return{next:function(){var key=_this._keys[index++];return{value:void 0!==key?_this._values[key].v:void 0,done:void 0===key}}}},Object.defineProperty(Map.prototype,"size",{get:function(){return this._keys.length},enumerable:!1,configurable:!0}),Map}();var BSON_INT32_MAX=2147483647,BSON_INT32_MIN=-2147483648,BSON_INT64_MAX=Math.pow(2,63)-1,BSON_INT64_MIN=-Math.pow(2,63),JS_INT_MAX=Math.pow(2,53),JS_INT_MIN=-Math.pow(2,53),BSON_DATA_NUMBER=1,BSON_DATA_STRING=2,BSON_DATA_OBJECT=3,BSON_DATA_ARRAY=4,BSON_DATA_BINARY=5,BSON_DATA_UNDEFINED=6,BSON_DATA_OID=7,BSON_DATA_BOOLEAN=8,BSON_DATA_DATE=9,BSON_DATA_NULL=10,BSON_DATA_REGEXP=11,BSON_DATA_DBPOINTER=12,BSON_DATA_CODE=13,BSON_DATA_SYMBOL=14,BSON_DATA_CODE_W_SCOPE=15,BSON_DATA_INT=16,BSON_DATA_TIMESTAMP=17,BSON_DATA_LONG=18,BSON_DATA_DECIMAL128=19,BSON_DATA_MIN_KEY=255,BSON_DATA_MAX_KEY=127,BSON_BINARY_SUBTYPE_DEFAULT=0,BSON_BINARY_SUBTYPE_FUNCTION=1,BSON_BINARY_SUBTYPE_BYTE_ARRAY=2,BSON_BINARY_SUBTYPE_UUID=3,BSON_BINARY_SUBTYPE_UUID_NEW=4,BSON_BINARY_SUBTYPE_MD5=5,BSON_BINARY_SUBTYPE_ENCRYPTED=6,BSON_BINARY_SUBTYPE_COLUMN=7,BSON_BINARY_SUBTYPE_USER_DEFINED=128;function calculateObjectSize$1(object,serializeFunctions,ignoreUndefined){var totalLength=5;if(Array.isArray(object))for(var i=0;i<object.length;i++)totalLength+=calculateElement(i.toString(),object[i],serializeFunctions,!0,ignoreUndefined);else for(var key in"function"==typeof(null==object?void 0:object.toBSON)&&(object=object.toBSON()),object)totalLength+=calculateElement(key,object[key],serializeFunctions,!1,ignoreUndefined);return totalLength}function calculateElement(name,value,serializeFunctions,isArray,ignoreUndefined){switch(void 0===serializeFunctions&&(serializeFunctions=!1),void 0===isArray&&(isArray=!1),void 0===ignoreUndefined&&(ignoreUndefined=!1),"function"==typeof(null==value?void 0:value.toBSON)&&(value=value.toBSON()),typeof value){case"string":return 1+buffer_1.byteLength(name,"utf8")+1+4+buffer_1.byteLength(value,"utf8")+1;case"number":return Math.floor(value)===value&&value>=JS_INT_MIN&&value<=JS_INT_MAX&&value>=BSON_INT32_MIN&&value<=BSON_INT32_MAX?(null!=name?buffer_1.byteLength(name,"utf8")+1:0)+5:(null!=name?buffer_1.byteLength(name,"utf8")+1:0)+9;case"undefined":return isArray||!ignoreUndefined?(null!=name?buffer_1.byteLength(name,"utf8")+1:0)+1:0;case"boolean":return(null!=name?buffer_1.byteLength(name,"utf8")+1:0)+2;case"object":if(null==value||"MinKey"===value._bsontype||"MaxKey"===value._bsontype)return(null!=name?buffer_1.byteLength(name,"utf8")+1:0)+1;if("ObjectId"===value._bsontype||"ObjectID"===value._bsontype)return(null!=name?buffer_1.byteLength(name,"utf8")+1:0)+13;if(value instanceof Date||isDate(value))return(null!=name?buffer_1.byteLength(name,"utf8")+1:0)+9;if(ArrayBuffer.isView(value)||value instanceof ArrayBuffer||isAnyArrayBuffer(value))return(null!=name?buffer_1.byteLength(name,"utf8")+1:0)+6+value.byteLength;if("Long"===value._bsontype||"Double"===value._bsontype||"Timestamp"===value._bsontype)return(null!=name?buffer_1.byteLength(name,"utf8")+1:0)+9;if("Decimal128"===value._bsontype)return(null!=name?buffer_1.byteLength(name,"utf8")+1:0)+17;if("Code"===value._bsontype)return null!=value.scope&&Object.keys(value.scope).length>0?(null!=name?buffer_1.byteLength(name,"utf8")+1:0)+1+4+4+buffer_1.byteLength(value.code.toString(),"utf8")+1+calculateObjectSize$1(value.scope,serializeFunctions,ignoreUndefined):(null!=name?buffer_1.byteLength(name,"utf8")+1:0)+1+4+buffer_1.byteLength(value.code.toString(),"utf8")+1;if("Binary"===value._bsontype)return value.sub_type===Binary.SUBTYPE_BYTE_ARRAY?(null!=name?buffer_1.byteLength(name,"utf8")+1:0)+(value.position+1+4+1+4):(null!=name?buffer_1.byteLength(name,"utf8")+1:0)+(value.position+1+4+1);if("Symbol"===value._bsontype)return(null!=name?buffer_1.byteLength(name,"utf8")+1:0)+buffer_1.byteLength(value.value,"utf8")+4+1+1;if("DBRef"===value._bsontype){var ordered_values=Object.assign({$ref:value.collection,$id:value.oid},value.fields);return null!=value.db&&(ordered_values.$db=value.db),(null!=name?buffer_1.byteLength(name,"utf8")+1:0)+1+calculateObjectSize$1(ordered_values,serializeFunctions,ignoreUndefined)}return value instanceof RegExp||isRegExp(value)?(null!=name?buffer_1.byteLength(name,"utf8")+1:0)+1+buffer_1.byteLength(value.source,"utf8")+1+(value.global?1:0)+(value.ignoreCase?1:0)+(value.multiline?1:0)+1:"BSONRegExp"===value._bsontype?(null!=name?buffer_1.byteLength(name,"utf8")+1:0)+1+buffer_1.byteLength(value.pattern,"utf8")+1+buffer_1.byteLength(value.options,"utf8")+1:(null!=name?buffer_1.byteLength(name,"utf8")+1:0)+calculateObjectSize$1(value,serializeFunctions,ignoreUndefined)+1;case"function":if(value instanceof RegExp||isRegExp(value)||"[object RegExp]"===String.call(value))return(null!=name?buffer_1.byteLength(name,"utf8")+1:0)+1+buffer_1.byteLength(value.source,"utf8")+1+(value.global?1:0)+(value.ignoreCase?1:0)+(value.multiline?1:0)+1;if(serializeFunctions&&null!=value.scope&&Object.keys(value.scope).length>0)return(null!=name?buffer_1.byteLength(name,"utf8")+1:0)+1+4+4+buffer_1.byteLength(normalizedFunctionString(value),"utf8")+1+calculateObjectSize$1(value.scope,serializeFunctions,ignoreUndefined);if(serializeFunctions)return(null!=name?buffer_1.byteLength(name,"utf8")+1:0)+1+4+buffer_1.byteLength(normalizedFunctionString(value),"utf8")+1}return 0}function validateUtf8(bytes,start,end){for(var continuation=0,i=start;i<end;i+=1){var byte=bytes[i];if(continuation){if(128!=(192&byte))return!1;continuation-=1}else if(128&byte)if(192==(224&byte))continuation=1;else if(224==(240&byte))continuation=2;else{if(240!=(248&byte))return!1;continuation=3}}return!continuation}var JS_INT_MAX_LONG=Long.fromNumber(JS_INT_MAX),JS_INT_MIN_LONG=Long.fromNumber(JS_INT_MIN),functionCache={};function deserialize$1(buffer,options,isArray){var index=(options=null==options?{}:options)&&options.index?options.index:0,size=buffer[index]|buffer[index+1]<<8|buffer[index+2]<<16|buffer[index+3]<<24;if(size<5)throw new BSONError("bson size must be >= 5, is "+size);if(options.allowObjectSmallerThanBufferSize&&buffer.length<size)throw new BSONError("buffer length "+buffer.length+" must be >= bson size "+size);if(!options.allowObjectSmallerThanBufferSize&&buffer.length!==size)throw new BSONError("buffer length "+buffer.length+" must === bson size "+size);if(size+index>buffer.byteLength)throw new BSONError("(bson size "+size+" + options.index "+index+" must be <= buffer length "+buffer.byteLength+")");if(0!==buffer[index+size-1])throw new BSONError("One object, sized correctly, with a spot for an EOO, but the EOO isn't 0x00");return deserializeObject(buffer,index,options,isArray)}var allowedDBRefKeys=/^\$ref$|^\$id$|^\$db$/;function deserializeObject(buffer,index,options,isArray){void 0===isArray&&(isArray=!1);var validationSetting,evalFunctions=null!=options.evalFunctions&&options.evalFunctions,cacheFunctions=null!=options.cacheFunctions&&options.cacheFunctions,fieldsAsRaw=null==options.fieldsAsRaw?null:options.fieldsAsRaw,raw=null!=options.raw&&options.raw,bsonRegExp="boolean"==typeof options.bsonRegExp&&options.bsonRegExp,promoteBuffers=null!=options.promoteBuffers&&options.promoteBuffers,promoteLongs=null==options.promoteLongs||options.promoteLongs,promoteValues=null==options.promoteValues||options.promoteValues,validation=null==options.validation?{utf8:!0}:options.validation,globalUTFValidation=!0,utf8KeysSet=new Set,utf8ValidatedKeys=validation.utf8;if("boolean"==typeof utf8ValidatedKeys)validationSetting=utf8ValidatedKeys;else{globalUTFValidation=!1;var utf8ValidationValues=Object.keys(utf8ValidatedKeys).map((function(key){return utf8ValidatedKeys[key]}));if(0===utf8ValidationValues.length)throw new BSONError("UTF-8 validation setting cannot be empty");if("boolean"!=typeof utf8ValidationValues[0])throw new BSONError("Invalid UTF-8 validation option, must specify boolean values");if(validationSetting=utf8ValidationValues[0],!utf8ValidationValues.every((function(item){return item===validationSetting})))throw new BSONError("Invalid UTF-8 validation option - keys must be all true or all false")}if(!globalUTFValidation)for(var _i=0,_a=Object.keys(utf8ValidatedKeys);_i<_a.length;_i++){var key=_a[_i];utf8KeysSet.add(key)}var startIndex=index;if(buffer.length<5)throw new BSONError("corrupt bson message < 5 bytes long");var size=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24;if(size<5||size>buffer.length)throw new BSONError("corrupt bson message");for(var object=isArray?[]:{},arrayIndex=0,isPossibleDBRef=!isArray&&null;;){var elementType=buffer[index++];if(0===elementType)break;for(var i=index;0!==buffer[i]&&i<buffer.length;)i++;if(i>=buffer.byteLength)throw new BSONError("Bad BSON Document: illegal CString");var name=isArray?arrayIndex++:buffer.toString("utf8",index,i),shouldValidateKey=!0;shouldValidateKey=globalUTFValidation||utf8KeysSet.has(name)?validationSetting:!validationSetting,!1!==isPossibleDBRef&&"$"===name[0]&&(isPossibleDBRef=allowedDBRefKeys.test(name));var value=void 0;if(index=i+1,elementType===BSON_DATA_STRING){if((stringSize=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24)<=0||stringSize>buffer.length-index||0!==buffer[index+stringSize-1])throw new BSONError("bad string length in bson");value=getValidatedString(buffer,index,index+stringSize-1,shouldValidateKey),index+=stringSize}else if(elementType===BSON_DATA_OID){var oid=buffer_1.alloc(12);buffer.copy(oid,0,index,index+12),value=new ObjectId(oid),index+=12}else if(elementType===BSON_DATA_INT&&!1===promoteValues)value=new Int32(buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24);else if(elementType===BSON_DATA_INT)value=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24;else if(elementType===BSON_DATA_NUMBER&&!1===promoteValues)value=new Double(buffer.readDoubleLE(index)),index+=8;else if(elementType===BSON_DATA_NUMBER)value=buffer.readDoubleLE(index),index+=8;else if(elementType===BSON_DATA_DATE){var lowBits=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24,highBits=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24;value=new Date(new Long(lowBits,highBits).toNumber())}else if(elementType===BSON_DATA_BOOLEAN){if(0!==buffer[index]&&1!==buffer[index])throw new BSONError("illegal boolean type value");value=1===buffer[index++]}else if(elementType===BSON_DATA_OBJECT){var _index=index;if((objectSize=buffer[index]|buffer[index+1]<<8|buffer[index+2]<<16|buffer[index+3]<<24)<=0||objectSize>buffer.length-index)throw new BSONError("bad embedded document length in bson");if(raw)value=buffer.slice(index,index+objectSize);else{var objectOptions=options;globalUTFValidation||(objectOptions=_assign(_assign({},options),{validation:{utf8:shouldValidateKey}})),value=deserializeObject(buffer,_index,objectOptions,!1)}index+=objectSize}else if(elementType===BSON_DATA_ARRAY){_index=index;var arrayOptions=options,stopIndex=index+(objectSize=buffer[index]|buffer[index+1]<<8|buffer[index+2]<<16|buffer[index+3]<<24);if(fieldsAsRaw&&fieldsAsRaw[name]){for(var n in arrayOptions={},options)arrayOptions[n]=options[n];arrayOptions.raw=!0}if(globalUTFValidation||(arrayOptions=_assign(_assign({},arrayOptions),{validation:{utf8:shouldValidateKey}})),value=deserializeObject(buffer,_index,arrayOptions,!0),0!==buffer[(index+=objectSize)-1])throw new BSONError("invalid array terminator byte");if(index!==stopIndex)throw new BSONError("corrupted array bson")}else if(elementType===BSON_DATA_UNDEFINED)value=void 0;else if(elementType===BSON_DATA_NULL)value=null;else if(elementType===BSON_DATA_LONG){lowBits=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24,highBits=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24;var long=new Long(lowBits,highBits);value=promoteLongs&&!0===promoteValues&&long.lessThanOrEqual(JS_INT_MAX_LONG)&&long.greaterThanOrEqual(JS_INT_MIN_LONG)?long.toNumber():long}else if(elementType===BSON_DATA_DECIMAL128){var bytes=buffer_1.alloc(16);buffer.copy(bytes,0,index,index+16),index+=16;var decimal128=new Decimal128(bytes);value="toObject"in decimal128&&"function"==typeof decimal128.toObject?decimal128.toObject():decimal128}else if(elementType===BSON_DATA_BINARY){var binarySize=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24,totalBinarySize=binarySize,subType=buffer[index++];if(binarySize<0)throw new BSONError("Negative binary type element size found");if(binarySize>buffer.byteLength)throw new BSONError("Binary type size larger than document size");if(null!=buffer.slice){if(subType===Binary.SUBTYPE_BYTE_ARRAY){if((binarySize=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24)<0)throw new BSONError("Negative binary type element size found for subtype 0x02");if(binarySize>totalBinarySize-4)throw new BSONError("Binary type with subtype 0x02 contains too long binary size");if(binarySize<totalBinarySize-4)throw new BSONError("Binary type with subtype 0x02 contains too short binary size")}value=promoteBuffers&&promoteValues?buffer.slice(index,index+binarySize):new Binary(buffer.slice(index,index+binarySize),subType)}else{var _buffer=buffer_1.alloc(binarySize);if(subType===Binary.SUBTYPE_BYTE_ARRAY){if((binarySize=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24)<0)throw new BSONError("Negative binary type element size found for subtype 0x02");if(binarySize>totalBinarySize-4)throw new BSONError("Binary type with subtype 0x02 contains too long binary size");if(binarySize<totalBinarySize-4)throw new BSONError("Binary type with subtype 0x02 contains too short binary size")}for(i=0;i<binarySize;i++)_buffer[i]=buffer[index+i];value=promoteBuffers&&promoteValues?_buffer:new Binary(_buffer,subType)}index+=binarySize}else if(elementType===BSON_DATA_REGEXP&&!1===bsonRegExp){for(i=index;0!==buffer[i]&&i<buffer.length;)i++;if(i>=buffer.length)throw new BSONError("Bad BSON Document: illegal CString");var source=buffer.toString("utf8",index,i);for(i=index=i+1;0!==buffer[i]&&i<buffer.length;)i++;if(i>=buffer.length)throw new BSONError("Bad BSON Document: illegal CString");var regExpOptions=buffer.toString("utf8",index,i);index=i+1;var optionsArray=new Array(regExpOptions.length);for(i=0;i<regExpOptions.length;i++)switch(regExpOptions[i]){case"m":optionsArray[i]="m";break;case"s":optionsArray[i]="g";break;case"i":optionsArray[i]="i"}value=new RegExp(source,optionsArray.join(""))}else if(elementType===BSON_DATA_REGEXP&&!0===bsonRegExp){for(i=index;0!==buffer[i]&&i<buffer.length;)i++;if(i>=buffer.length)throw new BSONError("Bad BSON Document: illegal CString");source=buffer.toString("utf8",index,i);for(i=index=i+1;0!==buffer[i]&&i<buffer.length;)i++;if(i>=buffer.length)throw new BSONError("Bad BSON Document: illegal CString");regExpOptions=buffer.toString("utf8",index,i);index=i+1,value=new BSONRegExp(source,regExpOptions)}else if(elementType===BSON_DATA_SYMBOL){if((stringSize=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24)<=0||stringSize>buffer.length-index||0!==buffer[index+stringSize-1])throw new BSONError("bad string length in bson");var symbol=getValidatedString(buffer,index,index+stringSize-1,shouldValidateKey);value=promoteValues?symbol:new BSONSymbol(symbol),index+=stringSize}else if(elementType===BSON_DATA_TIMESTAMP){lowBits=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24,highBits=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24;value=new Timestamp(lowBits,highBits)}else if(elementType===BSON_DATA_MIN_KEY)value=new MinKey;else if(elementType===BSON_DATA_MAX_KEY)value=new MaxKey;else if(elementType===BSON_DATA_CODE){if((stringSize=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24)<=0||stringSize>buffer.length-index||0!==buffer[index+stringSize-1])throw new BSONError("bad string length in bson");var functionString=getValidatedString(buffer,index,index+stringSize-1,shouldValidateKey);value=evalFunctions?cacheFunctions?isolateEval(functionString,functionCache,object):isolateEval(functionString):new Code(functionString),index+=stringSize}else if(elementType===BSON_DATA_CODE_W_SCOPE){var totalSize=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24;if(totalSize<13)throw new BSONError("code_w_scope total size shorter minimum expected length");if((stringSize=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24)<=0||stringSize>buffer.length-index||0!==buffer[index+stringSize-1])throw new BSONError("bad string length in bson");functionString=getValidatedString(buffer,index,index+stringSize-1,shouldValidateKey),_index=index+=stringSize;var objectSize=buffer[index]|buffer[index+1]<<8|buffer[index+2]<<16|buffer[index+3]<<24,scopeObject=deserializeObject(buffer,_index,options,!1);if(index+=objectSize,totalSize<8+objectSize+stringSize)throw new BSONError("code_w_scope total size is too short, truncating scope");if(totalSize>8+objectSize+stringSize)throw new BSONError("code_w_scope total size is too long, clips outer document");evalFunctions?(value=cacheFunctions?isolateEval(functionString,functionCache,object):isolateEval(functionString)).scope=scopeObject:value=new Code(functionString,scopeObject)}else{if(elementType!==BSON_DATA_DBPOINTER)throw new BSONError("Detected unknown BSON type "+elementType.toString(16)+' for fieldname "'+name+'"');var stringSize;if((stringSize=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24)<=0||stringSize>buffer.length-index||0!==buffer[index+stringSize-1])throw new BSONError("bad string length in bson");if(null!=validation&&validation.utf8&&!validateUtf8(buffer,index,index+stringSize-1))throw new BSONError("Invalid UTF-8 string in BSON document");var namespace=buffer.toString("utf8",index,index+stringSize-1);index+=stringSize;var oidBuffer=buffer_1.alloc(12);buffer.copy(oidBuffer,0,index,index+12);oid=new ObjectId(oidBuffer);index+=12,value=new DBRef(namespace,oid)}"__proto__"===name?Object.defineProperty(object,name,{value:value,writable:!0,enumerable:!0,configurable:!0}):object[name]=value}if(size!==index-startIndex){if(isArray)throw new BSONError("corrupt array bson");throw new BSONError("corrupt object bson")}if(!isPossibleDBRef)return object;if(isDBRefLike(object)){var copy=Object.assign({},object);return delete copy.$ref,delete copy.$id,delete copy.$db,new DBRef(object.$ref,object.$id,object.$db,copy)}return object}function isolateEval(functionString,functionCache,object){return functionCache?(null==functionCache[functionString]&&(functionCache[functionString]=new Function(functionString)),functionCache[functionString].bind(object)):new Function(functionString)}function getValidatedString(buffer,start,end,shouldValidateUtf8){var value=buffer.toString("utf8",start,end);if(shouldValidateUtf8)for(var i=0;i<value.length;i++)if(65533===value.charCodeAt(i)){if(!validateUtf8(buffer,start,end))throw new BSONError("Invalid UTF-8 string in BSON document");break}return value}function writeIEEE754(buffer,value,offset,endian,mLen,nBytes){var e,m,c,bBE="big"===endian,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=bBE?nBytes-1:0,d=bBE?-1:1,s=value<0||0===value&&1/value<0?1:0;for(value=Math.abs(value),isNaN(value)||value===1/0?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),(value+=e+eBias>=1?rt/c:rt*Math.pow(2,1-eBias))*c>=2&&(e++,c/=2),e+eBias>=eMax?(m=0,e=eMax):e+eBias>=1?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0)),isNaN(value)&&(m=0);mLen>=8;)buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8;for(e=e<<mLen|m,isNaN(value)&&(e+=8),eLen+=mLen;eLen>0;)buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8;buffer[offset+i-d]|=128*s}var regexp=/\x00/,ignoreKeys=new Set(["$db","$ref","$id","$clusterTime"]);function serializeString(buffer,key,value,index,isArray){buffer[index++]=BSON_DATA_STRING;var numberOfWrittenBytes=isArray?buffer.write(key,index,void 0,"ascii"):buffer.write(key,index,void 0,"utf8");buffer[(index=index+numberOfWrittenBytes+1)-1]=0;var size=buffer.write(value,index+4,void 0,"utf8");return buffer[index+3]=size+1>>24&255,buffer[index+2]=size+1>>16&255,buffer[index+1]=size+1>>8&255,buffer[index]=size+1&255,index=index+4+size,buffer[index++]=0,index}function serializeNumber(buffer,key,value,index,isArray){Number.isInteger(value)&&value>=BSON_INT32_MIN&&value<=BSON_INT32_MAX?(buffer[index++]=BSON_DATA_INT,index+=isArray?buffer.write(key,index,void 0,"ascii"):buffer.write(key,index,void 0,"utf8"),buffer[index++]=0,buffer[index++]=255&value,buffer[index++]=value>>8&255,buffer[index++]=value>>16&255,buffer[index++]=value>>24&255):(buffer[index++]=BSON_DATA_NUMBER,index+=isArray?buffer.write(key,index,void 0,"ascii"):buffer.write(key,index,void 0,"utf8"),buffer[index++]=0,writeIEEE754(buffer,value,index,"little",52,8),index+=8);return index}function serializeNull(buffer,key,_,index,isArray){return buffer[index++]=BSON_DATA_NULL,index+=isArray?buffer.write(key,index,void 0,"ascii"):buffer.write(key,index,void 0,"utf8"),buffer[index++]=0,index}function serializeBoolean(buffer,key,value,index,isArray){return buffer[index++]=BSON_DATA_BOOLEAN,index+=isArray?buffer.write(key,index,void 0,"ascii"):buffer.write(key,index,void 0,"utf8"),buffer[index++]=0,buffer[index++]=value?1:0,index}function serializeDate(buffer,key,value,index,isArray){buffer[index++]=BSON_DATA_DATE,index+=isArray?buffer.write(key,index,void 0,"ascii"):buffer.write(key,index,void 0,"utf8"),buffer[index++]=0;var dateInMilis=Long.fromNumber(value.getTime()),lowBits=dateInMilis.getLowBits(),highBits=dateInMilis.getHighBits();return buffer[index++]=255&lowBits,buffer[index++]=lowBits>>8&255,buffer[index++]=lowBits>>16&255,buffer[index++]=lowBits>>24&255,buffer[index++]=255&highBits,buffer[index++]=highBits>>8&255,buffer[index++]=highBits>>16&255,buffer[index++]=highBits>>24&255,index}function serializeRegExp(buffer,key,value,index,isArray){if(buffer[index++]=BSON_DATA_REGEXP,index+=isArray?buffer.write(key,index,void 0,"ascii"):buffer.write(key,index,void 0,"utf8"),buffer[index++]=0,value.source&&null!=value.source.match(regexp))throw Error("value "+value.source+" must not contain null bytes");return index+=buffer.write(value.source,index,void 0,"utf8"),buffer[index++]=0,value.ignoreCase&&(buffer[index++]=105),value.global&&(buffer[index++]=115),value.multiline&&(buffer[index++]=109),buffer[index++]=0,index}function serializeBSONRegExp(buffer,key,value,index,isArray){if(buffer[index++]=BSON_DATA_REGEXP,index+=isArray?buffer.write(key,index,void 0,"ascii"):buffer.write(key,index,void 0,"utf8"),buffer[index++]=0,null!=value.pattern.match(regexp))throw Error("pattern "+value.pattern+" must not contain null bytes");return index+=buffer.write(value.pattern,index,void 0,"utf8"),buffer[index++]=0,index+=buffer.write(value.options.split("").sort().join(""),index,void 0,"utf8"),buffer[index++]=0,index}function serializeMinMax(buffer,key,value,index,isArray){return null===value?buffer[index++]=BSON_DATA_NULL:"MinKey"===value._bsontype?buffer[index++]=BSON_DATA_MIN_KEY:buffer[index++]=BSON_DATA_MAX_KEY,index+=isArray?buffer.write(key,index,void 0,"ascii"):buffer.write(key,index,void 0,"utf8"),buffer[index++]=0,index}function serializeObjectId(buffer,key,value,index,isArray){if(buffer[index++]=BSON_DATA_OID,index+=isArray?buffer.write(key,index,void 0,"ascii"):buffer.write(key,index,void 0,"utf8"),buffer[index++]=0,"string"==typeof value.id)buffer.write(value.id,index,void 0,"binary");else{if(!isUint8Array(value.id))throw new BSONTypeError("object ["+JSON.stringify(value)+"] is not a valid ObjectId");buffer.set(value.id.subarray(0,12),index)}return index+12}function serializeBuffer(buffer,key,value,index,isArray){buffer[index++]=BSON_DATA_BINARY,index+=isArray?buffer.write(key,index,void 0,"ascii"):buffer.write(key,index,void 0,"utf8"),buffer[index++]=0;var size=value.length;return buffer[index++]=255&size,buffer[index++]=size>>8&255,buffer[index++]=size>>16&255,buffer[index++]=size>>24&255,buffer[index++]=BSON_BINARY_SUBTYPE_DEFAULT,buffer.set(ensureBuffer(value),index),index+=size}function serializeObject(buffer,key,value,index,checkKeys,depth,serializeFunctions,ignoreUndefined,isArray,path){void 0===checkKeys&&(checkKeys=!1),void 0===depth&&(depth=0),void 0===serializeFunctions&&(serializeFunctions=!1),void 0===ignoreUndefined&&(ignoreUndefined=!0),void 0===isArray&&(isArray=!1),void 0===path&&(path=[]);for(var i=0;i<path.length;i++)if(path[i]===value)throw new BSONError("cyclic dependency detected");path.push(value),buffer[index++]=Array.isArray(value)?BSON_DATA_ARRAY:BSON_DATA_OBJECT,index+=isArray?buffer.write(key,index,void 0,"ascii"):buffer.write(key,index,void 0,"utf8"),buffer[index++]=0;var endIndex=serializeInto(buffer,value,checkKeys,index,depth+1,serializeFunctions,ignoreUndefined,path);return path.pop(),endIndex}function serializeDecimal128(buffer,key,value,index,isArray){return buffer[index++]=BSON_DATA_DECIMAL128,index+=isArray?buffer.write(key,index,void 0,"ascii"):buffer.write(key,index,void 0,"utf8"),buffer[index++]=0,buffer.set(value.bytes.subarray(0,16),index),index+16}function serializeLong(buffer,key,value,index,isArray){buffer[index++]="Long"===value._bsontype?BSON_DATA_LONG:BSON_DATA_TIMESTAMP,index+=isArray?buffer.write(key,index,void 0,"ascii"):buffer.write(key,index,void 0,"utf8"),buffer[index++]=0;var lowBits=value.getLowBits(),highBits=value.getHighBits();return buffer[index++]=255&lowBits,buffer[index++]=lowBits>>8&255,buffer[index++]=lowBits>>16&255,buffer[index++]=lowBits>>24&255,buffer[index++]=255&highBits,buffer[index++]=highBits>>8&255,buffer[index++]=highBits>>16&255,buffer[index++]=highBits>>24&255,index}function serializeInt32(buffer,key,value,index,isArray){return value=value.valueOf(),buffer[index++]=BSON_DATA_INT,index+=isArray?buffer.write(key,index,void 0,"ascii"):buffer.write(key,index,void 0,"utf8"),buffer[index++]=0,buffer[index++]=255&value,buffer[index++]=value>>8&255,buffer[index++]=value>>16&255,buffer[index++]=value>>24&255,index}function serializeDouble(buffer,key,value,index,isArray){return buffer[index++]=BSON_DATA_NUMBER,index+=isArray?buffer.write(key,index,void 0,"ascii"):buffer.write(key,index,void 0,"utf8"),buffer[index++]=0,writeIEEE754(buffer,value.value,index,"little",52,8),index+=8}function serializeFunction(buffer,key,value,index,_checkKeys,_depth,isArray){buffer[index++]=BSON_DATA_CODE,index+=isArray?buffer.write(key,index,void 0,"ascii"):buffer.write(key,index,void 0,"utf8"),buffer[index++]=0;var functionString=normalizedFunctionString(value),size=buffer.write(functionString,index+4,void 0,"utf8")+1;return buffer[index]=255&size,buffer[index+1]=size>>8&255,buffer[index+2]=size>>16&255,buffer[index+3]=size>>24&255,index=index+4+size-1,buffer[index++]=0,index}function serializeCode(buffer,key,value,index,checkKeys,depth,serializeFunctions,ignoreUndefined,isArray){if(void 0===checkKeys&&(checkKeys=!1),void 0===depth&&(depth=0),void 0===serializeFunctions&&(serializeFunctions=!1),void 0===ignoreUndefined&&(ignoreUndefined=!0),void 0===isArray&&(isArray=!1),value.scope&&"object"==typeof value.scope){buffer[index++]=BSON_DATA_CODE_W_SCOPE,index+=isArray?buffer.write(key,index,void 0,"ascii"):buffer.write(key,index,void 0,"utf8"),buffer[index++]=0;var startIndex=index,functionString="string"==typeof value.code?value.code:value.code.toString();index+=4;var codeSize=buffer.write(functionString,index+4,void 0,"utf8")+1;buffer[index]=255&codeSize,buffer[index+1]=codeSize>>8&255,buffer[index+2]=codeSize>>16&255,buffer[index+3]=codeSize>>24&255,buffer[index+4+codeSize-1]=0,index=index+codeSize+4;var endIndex=serializeInto(buffer,value.scope,checkKeys,index,depth+1,serializeFunctions,ignoreUndefined);index=endIndex-1;var totalSize=endIndex-startIndex;buffer[startIndex++]=255&totalSize,buffer[startIndex++]=totalSize>>8&255,buffer[startIndex++]=totalSize>>16&255,buffer[startIndex++]=totalSize>>24&255,buffer[index++]=0}else{buffer[index++]=BSON_DATA_CODE,index+=isArray?buffer.write(key,index,void 0,"ascii"):buffer.write(key,index,void 0,"utf8"),buffer[index++]=0;functionString=value.code.toString();var size=buffer.write(functionString,index+4,void 0,"utf8")+1;buffer[index]=255&size,buffer[index+1]=size>>8&255,buffer[index+2]=size>>16&255,buffer[index+3]=size>>24&255,index=index+4+size-1,buffer[index++]=0}return index}function serializeBinary(buffer,key,value,index,isArray){buffer[index++]=BSON_DATA_BINARY,index+=isArray?buffer.write(key,index,void 0,"ascii"):buffer.write(key,index,void 0,"utf8"),buffer[index++]=0;var data=value.value(!0),size=value.position;return value.sub_type===Binary.SUBTYPE_BYTE_ARRAY&&(size+=4),buffer[index++]=255&size,buffer[index++]=size>>8&255,buffer[index++]=size>>16&255,buffer[index++]=size>>24&255,buffer[index++]=value.sub_type,value.sub_type===Binary.SUBTYPE_BYTE_ARRAY&&(size-=4,buffer[index++]=255&size,buffer[index++]=size>>8&255,buffer[index++]=size>>16&255,buffer[index++]=size>>24&255),buffer.set(data,index),index+=value.position}function serializeSymbol(buffer,key,value,index,isArray){buffer[index++]=BSON_DATA_SYMBOL,index+=isArray?buffer.write(key,index,void 0,"ascii"):buffer.write(key,index,void 0,"utf8"),buffer[index++]=0;var size=buffer.write(value.value,index+4,void 0,"utf8")+1;return buffer[index]=255&size,buffer[index+1]=size>>8&255,buffer[index+2]=size>>16&255,buffer[index+3]=size>>24&255,index=index+4+size-1,buffer[index++]=0,index}function serializeDBRef(buffer,key,value,index,depth,serializeFunctions,isArray){buffer[index++]=BSON_DATA_OBJECT,index+=isArray?buffer.write(key,index,void 0,"ascii"):buffer.write(key,index,void 0,"utf8"),buffer[index++]=0;var startIndex=index,output={$ref:value.collection||value.namespace,$id:value.oid};null!=value.db&&(output.$db=value.db);var endIndex=serializeInto(buffer,output=Object.assign(output,value.fields),!1,index,depth+1,serializeFunctions),size=endIndex-startIndex;return buffer[startIndex++]=255&size,buffer[startIndex++]=size>>8&255,buffer[startIndex++]=size>>16&255,buffer[startIndex++]=size>>24&255,endIndex}function serializeInto(buffer,object,checkKeys,startingIndex,depth,serializeFunctions,ignoreUndefined,path){void 0===checkKeys&&(checkKeys=!1),void 0===startingIndex&&(startingIndex=0),void 0===depth&&(depth=0),void 0===serializeFunctions&&(serializeFunctions=!1),void 0===ignoreUndefined&&(ignoreUndefined=!0),void 0===path&&(path=[]),startingIndex=startingIndex||0,(path=path||[]).push(object);var index=startingIndex+4;if(Array.isArray(object))for(var i=0;i<object.length;i++){var key=""+i;if("function"==typeof(null==(value=object[i])?void 0:value.toBSON)&&(value=value.toBSON()),"string"==typeof value)index=serializeString(buffer,key,value,index,!0);else if("number"==typeof value)index=serializeNumber(buffer,key,value,index,!0);else{if("bigint"==typeof value)throw new BSONTypeError("Unsupported type BigInt, please use Decimal128");if("boolean"==typeof value)index=serializeBoolean(buffer,key,value,index,!0);else if(value instanceof Date||isDate(value))index=serializeDate(buffer,key,value,index,!0);else if(void 0===value)index=serializeNull(buffer,key,0,index,!0);else if(null===value)index=serializeNull(buffer,key,0,index,!0);else if("ObjectId"===value._bsontype||"ObjectID"===value._bsontype)index=serializeObjectId(buffer,key,value,index,!0);else if(isUint8Array(value))index=serializeBuffer(buffer,key,value,index,!0);else if(value instanceof RegExp||isRegExp(value))index=serializeRegExp(buffer,key,value,index,!0);else if("object"==typeof value&&null==value._bsontype)index=serializeObject(buffer,key,value,index,checkKeys,depth,serializeFunctions,ignoreUndefined,!0,path);else if("object"==typeof value&&isBSONType(value)&&"Decimal128"===value._bsontype)index=serializeDecimal128(buffer,key,value,index,!0);else if("Long"===value._bsontype||"Timestamp"===value._bsontype)index=serializeLong(buffer,key,value,index,!0);else if("Double"===value._bsontype)index=serializeDouble(buffer,key,value,index,!0);else if("function"==typeof value&&serializeFunctions)index=serializeFunction(buffer,key,value,index,0,0,!0);else if("Code"===value._bsontype)index=serializeCode(buffer,key,value,index,checkKeys,depth,serializeFunctions,ignoreUndefined,!0);else if("Binary"===value._bsontype)index=serializeBinary(buffer,key,value,index,!0);else if("Symbol"===value._bsontype)index=serializeSymbol(buffer,key,value,index,!0);else if("DBRef"===value._bsontype)index=serializeDBRef(buffer,key,value,index,depth,serializeFunctions,!0);else if("BSONRegExp"===value._bsontype)index=serializeBSONRegExp(buffer,key,value,index,!0);else if("Int32"===value._bsontype)index=serializeInt32(buffer,key,value,index,!0);else if("MinKey"===value._bsontype||"MaxKey"===value._bsontype)index=serializeMinMax(buffer,key,value,index,!0);else if(void 0!==value._bsontype)throw new BSONTypeError("Unrecognized or invalid _bsontype: "+value._bsontype)}}else if(object instanceof bsonMap||function isMap(d){return"[object Map]"===Object.prototype.toString.call(d)}(object))for(var iterator=object.entries(),done=!1;!done;){var entry=iterator.next();if(!(done=!!entry.done)){key=entry.value[0];var type=typeof(value=entry.value[1]);if("string"==typeof key&&!ignoreKeys.has(key)){if(null!=key.match(regexp))throw Error("key "+key+" must not contain null bytes");if(checkKeys){if("$"===key[0])throw Error("key "+key+" must not start with '$'");if(~key.indexOf("."))throw Error("key "+key+" must not contain '.'")}}if("string"===type)index=serializeString(buffer,key,value,index);else if("number"===type)index=serializeNumber(buffer,key,value,index);else{if("bigint"===type||isBigInt64Array(value)||isBigUInt64Array(value))throw new BSONTypeError("Unsupported type BigInt, please use Decimal128");if("boolean"===type)index=serializeBoolean(buffer,key,value,index);else if(value instanceof Date||isDate(value))index=serializeDate(buffer,key,value,index);else if(null===value||void 0===value&&!1===ignoreUndefined)index=serializeNull(buffer,key,0,index);else if("ObjectId"===value._bsontype||"ObjectID"===value._bsontype)index=serializeObjectId(buffer,key,value,index);else if(isUint8Array(value))index=serializeBuffer(buffer,key,value,index);else if(value instanceof RegExp||isRegExp(value))index=serializeRegExp(buffer,key,value,index);else if("object"===type&&null==value._bsontype)index=serializeObject(buffer,key,value,index,checkKeys,depth,serializeFunctions,ignoreUndefined,!1,path);else if("object"===type&&"Decimal128"===value._bsontype)index=serializeDecimal128(buffer,key,value,index);else if("Long"===value._bsontype||"Timestamp"===value._bsontype)index=serializeLong(buffer,key,value,index);else if("Double"===value._bsontype)index=serializeDouble(buffer,key,value,index);else if("Code"===value._bsontype)index=serializeCode(buffer,key,value,index,checkKeys,depth,serializeFunctions,ignoreUndefined);else if("function"==typeof value&&serializeFunctions)index=serializeFunction(buffer,key,value,index,0,0,serializeFunctions);else if("Binary"===value._bsontype)index=serializeBinary(buffer,key,value,index);else if("Symbol"===value._bsontype)index=serializeSymbol(buffer,key,value,index);else if("DBRef"===value._bsontype)index=serializeDBRef(buffer,key,value,index,depth,serializeFunctions);else if("BSONRegExp"===value._bsontype)index=serializeBSONRegExp(buffer,key,value,index);else if("Int32"===value._bsontype)index=serializeInt32(buffer,key,value,index);else if("MinKey"===value._bsontype||"MaxKey"===value._bsontype)index=serializeMinMax(buffer,key,value,index);else if(void 0!==value._bsontype)throw new BSONTypeError("Unrecognized or invalid _bsontype: "+value._bsontype)}}}else{if("function"==typeof(null==object?void 0:object.toBSON)&&null!=(object=object.toBSON())&&"object"!=typeof object)throw new BSONTypeError("toBSON function did not return an object");for(var key in object){var value;"function"==typeof(null==(value=object[key])?void 0:value.toBSON)&&(value=value.toBSON());type=typeof value;if("string"==typeof key&&!ignoreKeys.has(key)){if(null!=key.match(regexp))throw Error("key "+key+" must not contain null bytes");if(checkKeys){if("$"===key[0])throw Error("key "+key+" must not start with '$'");if(~key.indexOf("."))throw Error("key "+key+" must not contain '.'")}}if("string"===type)index=serializeString(buffer,key,value,index);else if("number"===type)index=serializeNumber(buffer,key,value,index);else{if("bigint"===type)throw new BSONTypeError("Unsupported type BigInt, please use Decimal128");if("boolean"===type)index=serializeBoolean(buffer,key,value,index);else if(value instanceof Date||isDate(value))index=serializeDate(buffer,key,value,index);else if(void 0===value)!1===ignoreUndefined&&(index=serializeNull(buffer,key,0,index));else if(null===value)index=serializeNull(buffer,key,0,index);else if("ObjectId"===value._bsontype||"ObjectID"===value._bsontype)index=serializeObjectId(buffer,key,value,index);else if(isUint8Array(value))index=serializeBuffer(buffer,key,value,index);else if(value instanceof RegExp||isRegExp(value))index=serializeRegExp(buffer,key,value,index);else if("object"===type&&null==value._bsontype)index=serializeObject(buffer,key,value,index,checkKeys,depth,serializeFunctions,ignoreUndefined,!1,path);else if("object"===type&&"Decimal128"===value._bsontype)index=serializeDecimal128(buffer,key,value,index);else if("Long"===value._bsontype||"Timestamp"===value._bsontype)index=serializeLong(buffer,key,value,index);else if("Double"===value._bsontype)index=serializeDouble(buffer,key,value,index);else if("Code"===value._bsontype)index=serializeCode(buffer,key,value,index,checkKeys,depth,serializeFunctions,ignoreUndefined);else if("function"==typeof value&&serializeFunctions)index=serializeFunction(buffer,key,value,index,0,0,serializeFunctions);else if("Binary"===value._bsontype)index=serializeBinary(buffer,key,value,index);else if("Symbol"===value._bsontype)index=serializeSymbol(buffer,key,value,index);else if("DBRef"===value._bsontype)index=serializeDBRef(buffer,key,value,index,depth,serializeFunctions);else if("BSONRegExp"===value._bsontype)index=serializeBSONRegExp(buffer,key,value,index);else if("Int32"===value._bsontype)index=serializeInt32(buffer,key,value,index);else if("MinKey"===value._bsontype||"MaxKey"===value._bsontype)index=serializeMinMax(buffer,key,value,index);else if(void 0!==value._bsontype)throw new BSONTypeError("Unrecognized or invalid _bsontype: "+value._bsontype)}}}path.pop(),buffer[index++]=0;var size=index-startingIndex;return buffer[startingIndex++]=255&size,buffer[startingIndex++]=size>>8&255,buffer[startingIndex++]=size>>16&255,buffer[startingIndex++]=size>>24&255,index}var buffer=buffer_1.alloc(17825792);function setInternalBufferSize(size){buffer.length<size&&(buffer=buffer_1.alloc(size))}function serialize(object,options){void 0===options&&(options={});var checkKeys="boolean"==typeof options.checkKeys&&options.checkKeys,serializeFunctions="boolean"==typeof options.serializeFunctions&&options.serializeFunctions,ignoreUndefined="boolean"!=typeof options.ignoreUndefined||options.ignoreUndefined,minInternalBufferSize="number"==typeof options.minInternalBufferSize?options.minInternalBufferSize:17825792;buffer.length<minInternalBufferSize&&(buffer=buffer_1.alloc(minInternalBufferSize));var serializationIndex=serializeInto(buffer,object,checkKeys,0,0,serializeFunctions,ignoreUndefined,[]),finishedBuffer=buffer_1.alloc(serializationIndex);return buffer.copy(finishedBuffer,0,0,finishedBuffer.length),finishedBuffer}function serializeWithBufferAndIndex(object,finalBuffer,options){void 0===options&&(options={});var checkKeys="boolean"==typeof options.checkKeys&&options.checkKeys,serializeFunctions="boolean"==typeof options.serializeFunctions&&options.serializeFunctions,ignoreUndefined="boolean"!=typeof options.ignoreUndefined||options.ignoreUndefined,startIndex="number"==typeof options.index?options.index:0,serializationIndex=serializeInto(buffer,object,checkKeys,0,0,serializeFunctions,ignoreUndefined);return buffer.copy(finalBuffer,startIndex,0,serializationIndex),startIndex+serializationIndex-1}function deserialize(buffer,options){return void 0===options&&(options={}),deserialize$1(buffer instanceof buffer_1?buffer:ensureBuffer(buffer),options)}function calculateObjectSize(object,options){return void 0===options&&(options={}),calculateObjectSize$1(object,"boolean"==typeof(options=options||{}).serializeFunctions&&options.serializeFunctions,"boolean"!=typeof options.ignoreUndefined||options.ignoreUndefined)}function deserializeStream(data,startIndex,numberOfDocuments,documents,docStartIndex,options){for(var internalOptions=Object.assign({allowObjectSmallerThanBufferSize:!0,index:0},options),bufferData=ensureBuffer(data),index=startIndex,i=0;i<numberOfDocuments;i++){var size=bufferData[index]|bufferData[index+1]<<8|bufferData[index+2]<<16|bufferData[index+3]<<24;internalOptions.index=index,documents[docStartIndex+i]=deserialize$1(bufferData,internalOptions),index+=size}return index}var bson_browser_esm={Binary:Binary,Code:Code,DBRef:DBRef,Decimal128:Decimal128,Double:Double,Int32:Int32,Long:Long,UUID:UUID,Map:bsonMap,MaxKey:MaxKey,MinKey:MinKey,ObjectId:ObjectId,ObjectID:ObjectId,BSONRegExp:BSONRegExp,BSONSymbol:BSONSymbol,Timestamp:Timestamp,EJSON:EJSON,setInternalBufferSize:setInternalBufferSize,serialize:serialize,serializeWithBufferAndIndex:serializeWithBufferAndIndex,deserialize:deserialize,calculateObjectSize:calculateObjectSize,deserializeStream:deserializeStream,BSONError:BSONError,BSONTypeError:BSONTypeError},__spreadArray=function(to,from,pack){if(pack||2===arguments.length)for(var ar,i=0,l=from.length;i<l;i++)!ar&&i in from||(ar||(ar=Array.prototype.slice.call(from,0,i)),ar[i]=from[i]);return to.concat(ar||Array.prototype.slice.call(from))},BrowserInfo=function BrowserInfo(name,version,os){this.name=name,this.version=version,this.os=os,this.type="browser"},NodeInfo=function NodeInfo(version){this.version=version,this.type="node",this.name="node",this.os=process.platform},SearchBotDeviceInfo=function SearchBotDeviceInfo(name,version,os,bot){this.name=name,this.version=version,this.os=os,this.bot=bot,this.type="bot-device"},BotInfo=function BotInfo(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null},ReactNativeInfo=function ReactNativeInfo(){this.type="react-native",this.name="react-native",this.version=null,this.os=null},SEARCHBOT_OS_REGEX=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,userAgentRules=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],operatingSystemRules=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function parseUserAgent(ua){var matchedRule=function matchUserAgent(ua){return""!==ua&&userAgentRules.reduce((function(matched,_a){var browser=_a[0],regex=_a[1];if(matched)return matched;var uaMatch=regex.exec(ua);return!!uaMatch&&[browser,uaMatch]}),!1)}(ua);if(!matchedRule)return null;var name=matchedRule[0],match=matchedRule[1];if("searchbot"===name)return new BotInfo;var versionParts=match[1]&&match[1].split(".").join("_").split("_").slice(0,3);versionParts?versionParts.length<3&&(versionParts=__spreadArray(__spreadArray([],versionParts,!0),function createVersionParts(count){for(var output=[],ii=0;ii<count;ii++)output.push("0");return output}(3-versionParts.length),!0)):versionParts=[];var version=versionParts.join("."),os=function detectOS(ua){for(var ii=0,count=operatingSystemRules.length;ii<count;ii++){var _a=operatingSystemRules[ii],os=_a[0];if(_a[1].exec(ua))return os}return null}(ua),searchBotMatch=SEARCHBOT_OS_REGEX.exec(ua);return searchBotMatch&&searchBotMatch[1]?new SearchBotDeviceInfo(name,version,os,searchBotMatch[1]):new BrowserInfo(name,version,os)}class DefaultNetworkTransport{constructor(){if(!DefaultNetworkTransport.fetch)throw new Error("DefaultNetworkTransport.fetch must be set before it's used");if(!DefaultNetworkTransport.AbortController)throw new Error("DefaultNetworkTransport.AbortController must be set before it's used")}fetchWithCallbacks(request,handler){this.fetch(request).then((async response=>{const decodedBody=await response.text(),responseHeaders={};return response.headers.forEach(((value,key)=>{responseHeaders[key]=value})),{statusCode:response.status,headers:responseHeaders,body:decodedBody}})).then((r=>handler.onSuccess(r))).catch((e=>handler.onError(e)))}async fetch(request){const{timeoutMs:timeoutMs,url:url,...rest}=request,{signal:signal,cancelTimeout:cancelTimeout}=this.createTimeoutSignal(timeoutMs);try{return await DefaultNetworkTransport.fetch(url,{...DefaultNetworkTransport.extraFetchOptions,signal:signal,...rest})}finally{cancelTimeout()}}createTimeoutSignal(timeoutMs){if("number"==typeof timeoutMs){const controller=new DefaultNetworkTransport.AbortController,timeout=setTimeout((()=>{controller.abort()}),timeoutMs);return{signal:controller.signal,cancelTimeout:()=>{clearTimeout(timeout)}}}return{signal:void 0,cancelTimeout:()=>{}}}}DefaultNetworkTransport.DEFAULT_HEADERS={"Content-Type":"application/json"},DefaultNetworkTransport.fetch=globalThis.fetch.bind(globalThis),DefaultNetworkTransport.AbortController=globalThis.AbortController;const _hasatob="function"==typeof atob,_hasbtoa="function"==typeof btoa,_hasBuffer="function"==typeof Buffer,_TD="function"==typeof TextDecoder?new TextDecoder:void 0,_TE="function"==typeof TextEncoder?new TextEncoder:void 0,b64chs=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),b64tab=(a=>{let tab={};return a.forEach(((c,i)=>tab[c]=i)),tab})(b64chs),b64re=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,_fromCC=String.fromCharCode.bind(String),_U8Afrom="function"==typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):(it,fn=(x=>x))=>new Uint8Array(Array.prototype.slice.call(it,0).map(fn)),_mkUriSafe=src=>src.replace(/=/g,"").replace(/[+\/]/g,(m0=>"+"==m0?"-":"_")),_tidyB64=s=>s.replace(/[^A-Za-z0-9\+\/]/g,""),btoaPolyfill=bin=>{let u32,c0,c1,c2,asc="";const pad=bin.length%3;for(let i=0;i<bin.length;){if((c0=bin.charCodeAt(i++))>255||(c1=bin.charCodeAt(i++))>255||(c2=bin.charCodeAt(i++))>255)throw new TypeError("invalid character found");u32=c0<<16|c1<<8|c2,asc+=b64chs[u32>>18&63]+b64chs[u32>>12&63]+b64chs[u32>>6&63]+b64chs[63&u32]}return pad?asc.slice(0,pad-3)+"===".substring(pad):asc},_btoa=_hasbtoa?bin=>btoa(bin):_hasBuffer?bin=>Buffer.from(bin,"binary").toString("base64"):btoaPolyfill,_fromUint8Array=_hasBuffer?u8a=>Buffer.from(u8a).toString("base64"):u8a=>{let strs=[];for(let i=0,l=u8a.length;i<l;i+=4096)strs.push(_fromCC.apply(null,u8a.subarray(i,i+4096)));return _btoa(strs.join(""))},cb_utob=c=>{if(c.length<2)return(cc=c.charCodeAt(0))<128?c:cc<2048?_fromCC(192|cc>>>6)+_fromCC(128|63&cc):_fromCC(224|cc>>>12&15)+_fromCC(128|cc>>>6&63)+_fromCC(128|63&cc);var cc=65536+1024*(c.charCodeAt(0)-55296)+(c.charCodeAt(1)-56320);return _fromCC(240|cc>>>18&7)+_fromCC(128|cc>>>12&63)+_fromCC(128|cc>>>6&63)+_fromCC(128|63&cc)},re_utob=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,utob=u=>u.replace(re_utob,cb_utob),_encode=_hasBuffer?s=>Buffer.from(s,"utf8").toString("base64"):_TE?s=>_fromUint8Array(_TE.encode(s)):s=>_btoa(utob(s)),encode=(src,urlsafe=!1)=>urlsafe?_mkUriSafe(_encode(src)):_encode(src),re_btou=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,cb_btou=cccc=>{switch(cccc.length){case 4:var offset=((7&cccc.charCodeAt(0))<<18|(63&cccc.charCodeAt(1))<<12|(63&cccc.charCodeAt(2))<<6|63&cccc.charCodeAt(3))-65536;return _fromCC(55296+(offset>>>10))+_fromCC(56320+(1023&offset));case 3:return _fromCC((15&cccc.charCodeAt(0))<<12|(63&cccc.charCodeAt(1))<<6|63&cccc.charCodeAt(2));default:return _fromCC((31&cccc.charCodeAt(0))<<6|63&cccc.charCodeAt(1))}},btou=b=>b.replace(re_btou,cb_btou),atobPolyfill=asc=>{if(asc=asc.replace(/\s+/g,""),!b64re.test(asc))throw new TypeError("malformed base64.");asc+="==".slice(2-(3&asc.length));let u24,r1,r2,bin="";for(let i=0;i<asc.length;)u24=b64tab[asc.charAt(i++)]<<18|b64tab[asc.charAt(i++)]<<12|(r1=b64tab[asc.charAt(i++)])<<6|(r2=b64tab[asc.charAt(i++)]),bin+=64===r1?_fromCC(u24>>16&255):64===r2?_fromCC(u24>>16&255,u24>>8&255):_fromCC(u24>>16&255,u24>>8&255,255&u24);return bin},_atob=_hasatob?asc=>atob(_tidyB64(asc)):_hasBuffer?asc=>Buffer.from(asc,"base64").toString("binary"):atobPolyfill,_toUint8Array=_hasBuffer?a=>_U8Afrom(Buffer.from(a,"base64")):a=>_U8Afrom(_atob(a),(c=>c.charCodeAt(0))),_decode=_hasBuffer?a=>Buffer.from(a,"base64").toString("utf8"):_TD?a=>_TD.decode(_toUint8Array(a)):a=>btou(_atob(a)),_unURI=a=>_tidyB64(a.replace(/[-_]/g,(m0=>"-"==m0?"+":"/"))),decode=src=>_decode(_unURI(src)),gBase64_encode=encode,gBase64_decode=decode,SERIALIZATION_OPTIONS={relaxed:!1};function bundle_dom_es_serialize(obj){return EJSON.serialize(obj,SERIALIZATION_OPTIONS)}function bundle_dom_es_deserialize(obj){return Array.isArray(obj)?obj.map((doc=>EJSON.deserialize(doc))):EJSON.deserialize(obj)}var UserType,DataKey;!function(UserType){UserType.Normal="normal",UserType.Server="server"}(UserType||(UserType={})),function(DataKey){DataKey.NAME="name",DataKey.EMAIL="email",DataKey.PICTURE="picture",DataKey.FIRST_NAME="first_name",DataKey.LAST_NAME="last_name",DataKey.GENDER="gender",DataKey.BIRTHDAY="birthday",DataKey.MIN_AGE="min_age",DataKey.MAX_AGE="max_age"}(DataKey||(DataKey={}));const DATA_MAPPING={[DataKey.NAME]:"name",[DataKey.EMAIL]:"email",[DataKey.PICTURE]:"pictureUrl",[DataKey.FIRST_NAME]:"firstName",[DataKey.LAST_NAME]:"lastName",[DataKey.GENDER]:"gender",[DataKey.BIRTHDAY]:"birthday",[DataKey.MIN_AGE]:"minAge",[DataKey.MAX_AGE]:"maxAge"};class UserProfile{constructor(response){if(this.type=UserType.Normal,this.identities=[],"object"==typeof response&&null!==response){const{type:type,identities:identities,data:data}=response;if("string"!=typeof type)throw new Error("Expected 'type' in the response body");if(this.type=type,!Array.isArray(identities))throw new Error("Expected 'identities' in the response body");if(this.identities=identities.map((identity=>{const{id:id,provider_type:providerType}=identity;return{id:id,providerType:providerType}})),"object"!=typeof data||null===data)throw new Error("Expected 'data' in the response body");{const mappedData=Object.fromEntries(Object.entries(data).map((([key,value])=>key in DATA_MAPPING?[DATA_MAPPING[key],value]:[key,value])));this.data=bundle_dom_es_deserialize(mappedData)}}else this.data={}}}class PrefixedStorage{constructor(storage,keyPart){this.storage=storage,this.keyPart=keyPart}get(key){return this.storage.get(this.keyPart+PrefixedStorage.PART_SEPARATOR+key)}set(key,value){return this.storage.set(this.keyPart+PrefixedStorage.PART_SEPARATOR+key,value)}remove(key){return this.storage.remove(this.keyPart+PrefixedStorage.PART_SEPARATOR+key)}prefix(keyPart){return new PrefixedStorage(this,keyPart)}clear(prefix=""){return this.storage.clear(this.keyPart+PrefixedStorage.PART_SEPARATOR+prefix)}addListener(listener){return this.storage.addListener(listener)}removeListener(listener){return this.storage.addListener(listener)}}PrefixedStorage.PART_SEPARATOR=":";class UserStorage extends PrefixedStorage{constructor(storage,userId){super(storage,`user(${userId})`)}get accessToken(){return this.get("accessToken")}set accessToken(value){null===value?this.remove("accessToken"):this.set("accessToken",value)}get refreshToken(){return this.get("refreshToken")}set refreshToken(value){null===value?this.remove("refreshToken"):this.set("refreshToken",value)}get profile(){const value=this.get("profile");if(value){const profile=new UserProfile;return Object.assign(profile,JSON.parse(value)),profile}}set profile(value){value?this.set("profile",JSON.stringify(value)):this.remove("profile")}get providerType(){const value=this.get("providerType");if(value)return value}set providerType(value){value?this.set("providerType",value):this.remove("providerType")}}function removeKeysWithUndefinedValues(obj){return Object.fromEntries(Object.entries(obj).filter((entry=>void 0!==entry[1])))}function encodeQueryString(params,prefixed=!0){const cleanedParams=removeKeysWithUndefinedValues(params);return(prefixed&&Object.keys(cleanedParams).length>0?"?":"")+Object.entries(cleanedParams).map((([k,v])=>`${k}=${encodeURIComponent(v)}`)).join("&")}const RESERVED_NAMES=["inspect","callFunction","callFunctionStreaming",...Object.getOwnPropertyNames(Object.prototype)];function cleanArgsAndSerialize(args){const cleaned=function cleanArgs(args){for(const arg of args)if("object"==typeof arg&&arg)for(const[key,value]of Object.entries(arg))void 0===value&&delete arg[key];return args}(args);return cleaned.map((arg=>"object"==typeof arg?bundle_dom_es_serialize(arg):arg))}class FunctionsFactory{constructor(fetcher,config={}){this.fetcher=fetcher,this.serviceName=config.serviceName,this.argsTransformation=config.argsTransformation||cleanArgsAndSerialize}static create(fetcher,config={}){const factory=new FunctionsFactory(fetcher,config);return new Proxy(factory,{get(target,p,receiver){if("string"==typeof p&&-1===RESERVED_NAMES.indexOf(p))return target.callFunction.bind(target,p);{const prop=Reflect.get(target,p,receiver);return"function"==typeof prop?prop.bind(target):prop}}})}async callFunction(name,...args){const body={name:name,arguments:this.argsTransformation?this.argsTransformation(args):args};this.serviceName&&(body.service=this.serviceName);const appRoute=this.fetcher.appRoute;return this.fetcher.fetchJSON({method:"POST",path:appRoute.functionsCall().path,body:body})}callFunctionStreaming(name,...args){const body={name:name,arguments:this.argsTransformation?this.argsTransformation(args):args};this.serviceName&&(body.service=this.serviceName);const appRoute=this.fetcher.appRoute,qs=encodeQueryString({baas_request:gBase64_encode(JSON.stringify(body))});return this.fetcher.fetchStream({method:"GET",path:appRoute.functionsCall().path+qs})}}let isDevelopmentMode=!1;const handleDeprecatedPositionalArgs=(args,methodName,argNames,hasRestArgs)=>{if("object"!=typeof args[0]){const restArgsText=hasRestArgs?", ...args":"";deprecatedItem=`${methodName}(${argNames.join(", ")}${restArgsText})`,suggestedReplacement=`${methodName}({ ${argNames.join(", ")} }${restArgsText})`,isDevelopmentMode&&console.warn(`Deprecation warning from Realm: ${deprecatedItem} is deprecated and will be removed in a future major release. Consider switching to ${suggestedReplacement}.`);return{argsObject:argNames.reduce(((prev,argName,index)=>({...prev,[argName]:args[index]})),{}),restArgs:hasRestArgs?args.slice(argNames.length):void 0}}var deprecatedItem,suggestedReplacement;return{argsObject:args[0],restArgs:hasRestArgs?args.slice(1):void 0}};var state;state="undefined"!=typeof __DEV__&&__DEV__,isDevelopmentMode=state;class EmailPasswordAuth{constructor(fetcher,providerName="local-userpass"){this.fetcher=fetcher,this.providerName=providerName}async registerUser(...args){const{argsObject:userDetails}=handleDeprecatedPositionalArgs(args,"registerUser",["email","password"]),appRoute=this.fetcher.appRoute;await this.fetcher.fetchJSON({method:"POST",path:appRoute.emailPasswordAuth(this.providerName).register().path,body:userDetails})}async confirmUser(...args){const{argsObject:tokenDetails}=handleDeprecatedPositionalArgs(args,"confirmUser",["token","tokenId"]),appRoute=this.fetcher.appRoute;await this.fetcher.fetchJSON({method:"POST",path:appRoute.emailPasswordAuth(this.providerName).confirm().path,body:tokenDetails})}async resendConfirmationEmail(...args){const{argsObject:emailDetails}=handleDeprecatedPositionalArgs(args,"resendConfirmationEmail",["email"]),appRoute=this.fetcher.appRoute;await this.fetcher.fetchJSON({method:"POST",path:appRoute.emailPasswordAuth(this.providerName).confirmSend().path,body:emailDetails})}async retryCustomConfirmation(...args){const{argsObject:emailDetails}=handleDeprecatedPositionalArgs(args,"retryCustomConfirmation",["email"]),appRoute=this.fetcher.appRoute;await this.fetcher.fetchJSON({method:"POST",path:appRoute.emailPasswordAuth(this.providerName).confirmCall().path,body:emailDetails})}async resetPassword(...args){const{argsObject:resetDetails}=handleDeprecatedPositionalArgs(args,"resetPassword",["token","tokenId","password"]),appRoute=this.fetcher.appRoute;await this.fetcher.fetchJSON({method:"POST",path:appRoute.emailPasswordAuth(this.providerName).reset().path,body:resetDetails})}async sendResetPasswordEmail(...args){const{argsObject:emailDetails}=handleDeprecatedPositionalArgs(args,"sendResetPasswordEmail",["email"]),appRoute=this.fetcher.appRoute;await this.fetcher.fetchJSON({method:"POST",path:appRoute.emailPasswordAuth(this.providerName).resetSend().path,body:emailDetails})}async callResetPasswordFunction(...args){const{argsObject:resetDetails,restArgs:restArgs}=handleDeprecatedPositionalArgs(args,"callResetPasswordFunction",["email","password"],!0),appRoute=this.fetcher.appRoute;await this.fetcher.fetchJSON({method:"POST",path:appRoute.emailPasswordAuth(this.providerName).resetCall().path,body:{...resetDetails,arguments:restArgs}})}}var routes={api:function api(){return{path:"/api/client/v2.0",app(appId){return{path:this.path+`/app/${appId}`,location(){return{path:this.path+"/location"}},authProvider(providerName){return{path:this.path+`/auth/providers/${providerName}`,login(){return{path:this.path+"/login"}}}},emailPasswordAuth(providerName){return{...this.authProvider(providerName),register(){return{path:this.path+"/register"}},confirm(){return{path:this.path+"/confirm"}},confirmSend(){return{path:this.path+"/confirm/send"}},confirmCall(){return{path:this.path+"/confirm/call"}},reset(){return{path:this.path+"/reset"}},resetSend(){return{path:this.path+"/reset/send"}},resetCall(){return{path:this.path+"/reset/call"}}}},functionsCall(){return{path:this.path+"/functions/call"}}}},auth(){return{path:this.path+"/auth",apiKeys(){return{path:this.path+"/api_keys",key(id){return{path:this.path+`/${id}`,enable(){return{path:this.path+"/enable"}},disable(){return{path:this.path+"/disable"}}}}}},profile(){return{path:this.path+"/profile"}},session(){return{path:this.path+"/session"}},delete(){return{path:this.path+"/delete"}}}}}}};class ApiKeyAuth{constructor(fetcher){this.fetcher=fetcher}create(name){return this.fetcher.fetchJSON({method:"POST",body:{name:name},path:routes.api().auth().apiKeys().path,tokenType:"refresh"})}fetch(keyId){return this.fetcher.fetchJSON({method:"GET",path:routes.api().auth().apiKeys().key(keyId).path,tokenType:"refresh"})}fetchAll(){return this.fetcher.fetchJSON({method:"GET",tokenType:"refresh",path:routes.api().auth().apiKeys().path})}async delete(keyId){await this.fetcher.fetchJSON({method:"DELETE",path:routes.api().auth().apiKeys().key(keyId).path,tokenType:"refresh"})}async enable(keyId){await this.fetcher.fetchJSON({method:"PUT",path:routes.api().auth().apiKeys().key(keyId).enable().path,tokenType:"refresh"})}async disable(keyId){await this.fetcher.fetchJSON({method:"PUT",path:routes.api().auth().apiKeys().key(keyId).disable().path,tokenType:"refresh"})}}let environment=null;function setEnvironment(e){environment=e}function getEnvironment(){if(environment)return environment;throw new Error("Cannot get environment before it's set")}class WatchError extends Error{constructor({message:message,code:code}){super(message),this.name="WatchError",this.code=code}}var WatchStreamState;!function(WatchStreamState){WatchStreamState.NEED_DATA="NEED_DATA",WatchStreamState.HAVE_EVENT="HAVE_EVENT",WatchStreamState.HAVE_ERROR="HAVE_ERROR"}(WatchStreamState||(WatchStreamState={}));class WatchStream{constructor(){this._state=WatchStreamState.NEED_DATA,this._error=null,this._textDecoder=new(getEnvironment().TextDecoder),this._buffer="",this._bufferOffset=0,this._eventType="",this._dataBuffer=""}feedBuffer(buffer){this.assertState(WatchStreamState.NEED_DATA),this._buffer+=this._textDecoder.decode(buffer,{stream:!0}),this.advanceBufferState()}feedLine(line){if(this.assertState(WatchStreamState.NEED_DATA),line.endsWith("\n")&&(line=line.substr(0,line.length-1)),line.endsWith("\r")&&(line=line.substr(0,line.length-1)),0===line.length){if(0===this._dataBuffer.length)return void(this._eventType="");this._dataBuffer.endsWith("\n")&&(this._dataBuffer=this._dataBuffer.substr(0,this._dataBuffer.length-1)),this.feedSse({data:this._dataBuffer,eventType:this._eventType}),this._dataBuffer="",this._eventType=""}if(":"===line[0])return;const colon=line.indexOf(":"),field=line.substr(0,colon);let value=-1===colon?"":line.substr(colon+1);value.startsWith(" ")&&(value=value.substr(1)),"event"===field?this._eventType=value:"data"===field&&(this._dataBuffer+=value,this._dataBuffer+="\n")}feedSse(sse){this.assertState(WatchStreamState.NEED_DATA);const firstPercentIndex=sse.data.indexOf("%");if(-1!==firstPercentIndex){let buffer="",start=0;for(let percentIndex=firstPercentIndex;-1!==percentIndex;percentIndex=sse.data.indexOf("%",start)){buffer+=sse.data.substr(start,percentIndex-start);const encoded=sse.data.substr(percentIndex,3);buffer+="%25"===encoded?"%":"%0A"===encoded?"\n":"%0D"===encoded?"\r":encoded,start=percentIndex+encoded.length}buffer+=sse.data.substr(start),sse.data=buffer}if(sse.eventType&&"message"!==sse.eventType){if("error"===sse.eventType){this._state=WatchStreamState.HAVE_ERROR,this._error=new WatchError({message:sse.data,code:"unknown"});try{const{error_code:errorCode,error:error}=EJSON.parse(sse.data);if("string"!=typeof errorCode)return;if("string"!=typeof error)return;this._error=new WatchError({message:error,code:errorCode})}catch{return}}}else{try{const parsed=EJSON.parse(sse.data);if("object"==typeof parsed)return this._nextEvent=parsed,void(this._state=WatchStreamState.HAVE_EVENT)}catch{}this._state=WatchStreamState.HAVE_ERROR,this._error=new WatchError({message:"server returned malformed event: "+sse.data,code:"bad bson parse"})}}get state(){return this._state}nextEvent(){this.assertState(WatchStreamState.HAVE_EVENT);const out=this._nextEvent;return this._state=WatchStreamState.NEED_DATA,this.advanceBufferState(),out}get error(){return this._error}advanceBufferState(){for(this.assertState(WatchStreamState.NEED_DATA);this.state===WatchStreamState.NEED_DATA;){if(this._bufferOffset===this._buffer.length)return this._buffer="",void(this._bufferOffset=0);const nextNewlineIndex=this._buffer.indexOf("\n",this._bufferOffset);if(-1===nextNewlineIndex)return void(0!==this._bufferOffset&&(this._buffer=this._buffer.substr(this._bufferOffset,this._buffer.length-this._bufferOffset),this._bufferOffset=0));this.feedLine(this._buffer.substr(this._bufferOffset,nextNewlineIndex-this._bufferOffset)),this._bufferOffset=nextNewlineIndex+1}}assertState(state){if(this._state!==state)throw Error(`Expected WatchStream to be in state ${state}, but in state ${this._state}`)}}class MongoDBCollection{constructor(fetcher,serviceName,databaseName,collectionName){this.functions=FunctionsFactory.create(fetcher,{serviceName:serviceName}),this.databaseName=databaseName,this.collectionName=collectionName,this.serviceName=serviceName,this.fetcher=fetcher}find(filter={},options={}){return this.functions.find({database:this.databaseName,collection:this.collectionName,query:filter,project:options.projection,sort:options.sort,limit:options.limit})}findOne(filter={},options={}){return this.functions.findOne({database:this.databaseName,collection:this.collectionName,query:filter,project:options.projection,sort:options.sort})}findOneAndUpdate(filter={},update,options={}){return this.functions.findOneAndUpdate({database:this.databaseName,collection:this.collectionName,filter:filter,update:update,sort:options.sort,projection:options.projection,upsert:options.upsert,returnNewDocument:options.returnNewDocument})}findOneAndReplace(filter={},replacement,options={}){return this.functions.findOneAndReplace({database:this.databaseName,collection:this.collectionName,filter:filter,update:replacement,sort:options.sort,projection:options.projection,upsert:options.upsert,returnNewDocument:options.returnNewDocument})}findOneAndDelete(filter={},options={}){return this.functions.findOneAndReplace({database:this.databaseName,collection:this.collectionName,filter:filter,sort:options.sort,projection:options.projection})}aggregate(pipeline){return this.functions.aggregate({database:this.databaseName,collection:this.collectionName,pipeline:pipeline})}count(filter={},options={}){return this.functions.count({database:this.databaseName,collection:this.collectionName,query:filter,limit:options.limit})}insertOne(document){return this.functions.insertOne({database:this.databaseName,collection:this.collectionName,document:document})}insertMany(documents){return this.functions.insertMany({database:this.databaseName,collection:this.collectionName,documents:documents})}deleteOne(filter={}){return this.functions.deleteOne({database:this.databaseName,collection:this.collectionName,query:filter})}deleteMany(filter={}){return this.functions.deleteMany({database:this.databaseName,collection:this.collectionName,query:filter})}updateOne(filter,update,options={}){return this.functions.updateOne({database:this.databaseName,collection:this.collectionName,query:filter,update:update,upsert:options.upsert,arrayFilters:options.arrayFilters})}updateMany(filter,update,options={}){return this.functions.updateMany({database:this.databaseName,collection:this.collectionName,query:filter,update:update,upsert:options.upsert,arrayFilters:options.arrayFilters})}async*watch({ids:ids,filter:filter}={}){const iterator=await this.functions.callFunctionStreaming("watch",{database:this.databaseName,collection:this.collectionName,ids:ids,filter:filter}),watchStream=new WatchStream;for await(const chunk of iterator)if(chunk){for(watchStream.feedBuffer(chunk);watchStream.state==WatchStreamState.HAVE_EVENT;)yield watchStream.nextEvent();if(watchStream.state==WatchStreamState.HAVE_ERROR)throw watchStream.error}}}function createCollection(fetcher,serviceName,databaseName,collectionName){return new MongoDBCollection(fetcher,serviceName,databaseName,collectionName)}function createDatabase(fetcher,serviceName,databaseName){return{collection:createCollection.bind(null,fetcher,serviceName,databaseName)}}var UserState,UserType$1;!function(UserState){UserState.Active="active",UserState.LoggedOut="logged-out",UserState.Removed="removed"}(UserState||(UserState={})),function(UserType){UserType.Normal="normal",UserType.Server="server"}(UserType$1||(UserType$1={}));class User{constructor(parameters){if(this.app=parameters.app,this.id=parameters.id,this.storage=new UserStorage(this.app.storage,this.id),"accessToken"in parameters&&"refreshToken"in parameters&&"providerType"in parameters)this._accessToken=parameters.accessToken,this._refreshToken=parameters.refreshToken,this.providerType=parameters.providerType,this.storage.accessToken=parameters.accessToken,this.storage.refreshToken=parameters.refreshToken,this.storage.providerType=parameters.providerType;else{this._accessToken=this.storage.accessToken,this._refreshToken=this.storage.refreshToken;const providerType=this.storage.providerType;if(this._profile=this.storage.profile,!providerType)throw new Error("Storage is missing a provider type");this.providerType=providerType}this.fetcher=this.app.fetcher.clone({userContext:{currentUser:this}}),this.apiKeys=new ApiKeyAuth(this.fetcher),this.functions=FunctionsFactory.create(this.fetcher)}get accessToken(){return this._accessToken}set accessToken(token){this._accessToken=token,this.storage.accessToken=token}get refreshToken(){return this._refreshToken}set refreshToken(token){this._refreshToken=token,this.storage.refreshToken=token}get state(){return this.id in this.app.allUsers?null===this.refreshToken?UserState.LoggedOut:UserState.Active:UserState.Removed}get isLoggedIn(){return this.state===UserState.Active}get customData(){if(this.accessToken){return this.decodeAccessToken().userData}throw new Error("Cannot read custom data without an access token")}get profile(){if(this._profile)return this._profile.data;throw new Error("A profile was never fetched for this user")}get identities(){if(this._profile)return this._profile.identities;throw new Error("A profile was never fetched for this user")}get deviceId(){if(this.accessToken){const payload=this.accessToken.split(".")[1];if(payload){const deviceId=JSON.parse(gBase64_decode(payload)).baas_device_id;if("string"==typeof deviceId&&"000000000000000000000000"!==deviceId)return deviceId}}return null}async refreshProfile(){const response=await this.fetcher.fetchJSON({method:"GET",path:routes.api().auth().profile().path});this._profile=new UserProfile(response),this.storage.profile=this._profile}async logOut(){try{null!==this._refreshToken&&await this.fetcher.fetchJSON({method:"DELETE",path:routes.api().auth().session().path,tokenType:"refresh"})}catch(err){if(!(err instanceof Error&&err.message.includes("failed to find refresh token")))throw err}finally{this.accessToken=null,this.refreshToken=null}}async linkCredentials(credentials){const response=await this.app.authenticator.authenticate(credentials,this);if(this.id!==response.userId){const details=`got user id ${response.userId} expected ${this.id}`;throw new Error(`Link response ment for another user (${details})`)}this.accessToken=response.accessToken,await this.refreshProfile()}async refreshAccessToken(){const response=await this.fetcher.fetchJSON({method:"POST",path:routes.api().auth().session().path,tokenType:"refresh"}),{access_token:accessToken}=response;if("string"!=typeof accessToken)throw new Error("Expected an 'access_token' in the response");this.accessToken=accessToken}async refreshCustomData(){return await this.refreshAccessToken(),this.customData}callFunction(name,...args){return this.functions.callFunction(name,...args)}toJSON(){return{id:this.id,accessToken:this.accessToken,refreshToken:this.refreshToken,profile:this._profile,state:this.state,customData:this.customData}}push(){throw new Error("Not yet implemented")}mongoClient(serviceName){return function createService(fetcher,serviceName="mongo-db"){return{db:createDatabase.bind(null,fetcher,serviceName)}}(this.fetcher,serviceName)}decodeAccessToken(){if(this.accessToken){const parts=this.accessToken.split(".");if(3!==parts.length)throw new Error("Expected an access token with three parts");const encodedPayload=parts[1],decodedPayload=gBase64_decode(encodedPayload),parsedPayload=JSON.parse(decodedPayload),{exp:expires,iat:issuedAt,sub:subject,user_data:userData={}}=parsedPayload;if("number"!=typeof expires)throw new Error("Failed to decode access token 'exp'");if("number"!=typeof issuedAt)throw new Error("Failed to decode access token 'iat'");return{expires:expires,issuedAt:issuedAt,subject:subject,userData:userData}}throw new Error("Missing an access token")}}class Credentials{constructor(providerName,providerType,payload){this.providerName=providerName,this.providerType=providerType,this.payload=payload}static anonymous(){return new Credentials("anon-user","anon-user",{})}static userApiKey(key){return new Credentials("api-key","api-key",{key:key})}static serverApiKey(key){return new Credentials("api-key","api-key",{key:key})}static apiKey(key){return new Credentials("api-key","api-key",{key:key})}static emailPassword(email,password){return new Credentials("local-userpass","local-userpass",{username:email,password:password})}static function(payload){return new Credentials("custom-function","custom-function",payload)}static jwt(token){return new Credentials("custom-token","custom-token",{token:token})}static google(payload){return new Credentials("oauth2-google","oauth2-google",Credentials.derivePayload(payload))}static derivePayload(payload){if("string"==typeof payload){if(payload.includes("://"))return this.derivePayload({redirectUrl:payload});if(payload.startsWith("4/"))return this.derivePayload({authCode:payload});if(payload.startsWith("ey"))return this.derivePayload({idToken:payload});throw new Error(`Unexpected payload: ${payload}`)}if(1===Object.keys(payload).length){if("authCode"in payload||"redirectUrl"in payload)return payload;if("idToken"in payload)return{id_token:payload.idToken};throw new Error("Unexpected payload: "+JSON.stringify(payload))}throw new Error("Expected only one property in payload, got "+JSON.stringify(payload))}static facebook(redirectUrlOrAccessToken){return new Credentials("oauth2-facebook","oauth2-facebook",redirectUrlOrAccessToken.includes("://")?{redirectUrl:redirectUrlOrAccessToken}:{accessToken:redirectUrlOrAccessToken})}static apple(redirectUrlOrIdToken){return new Credentials("oauth2-apple","oauth2-apple",redirectUrlOrIdToken.includes("://")?{redirectUrl:redirectUrlOrIdToken}:{id_token:redirectUrlOrIdToken})}}class AppStorage extends PrefixedStorage{constructor(storage,appId){super(storage,`app(${appId})`)}getUserIds(){const userIdsString=this.get("userIds"),userIds=userIdsString?JSON.parse(userIdsString):[];if(Array.isArray(userIds))return[...new Set(userIds)];throw new Error("Expected the user ids to be an array")}setUserIds(userIds,mergeWithExisting){if(mergeWithExisting){const existingIds=this.getUserIds();for(const id of existingIds)-1===userIds.indexOf(id)&&userIds.push(id)}this.set("userIds",JSON.stringify(userIds))}removeUserId(userId){const userIds=this.getUserIds().filter((id=>id!==userId));this.setUserIds(userIds,!1)}getDeviceId(){return this.get("deviceId")}setDeviceId(deviceId){this.set("deviceId",deviceId)}}const REDIRECT_HASH_TO_RESULT={_stitch_client_app_id:"appId",_baas_client_app_id:"appId",_stitch_ua:"userAuth",_baas_ua:"userAuth",_stitch_link:"link",_baas_link:"link",_stitch_error:"error",_baas_error:"error",_stitch_state:"state",_baas_state:"state"};class OAuth2Helper{constructor(storage,openWindow=getEnvironment().openWindow){this.storage=storage.prefix("oauth2"),this.openWindow=openWindow}static parseRedirectLocation(queryString){const params=function decodeQueryString(str){const cleanStr="?"===str[0]?str.substr(1):str;return Object.fromEntries(cleanStr.split("&").filter((s=>s.length>0)).map((kvp=>kvp.split("="))).map((([k,v])=>[k,decodeURIComponent(v)])))}(queryString),result={};for(const[p,r]of Object.entries(REDIRECT_HASH_TO_RESULT)){const value=params[p];value&&(result[r]=value)}return result}static handleRedirect(queryString,storage=getEnvironment().defaultStorage){const result=OAuth2Helper.parseRedirectLocation(queryString),{state:state,error:error}=result;if("string"!=typeof state)throw error?new Error(`Failed to handle OAuth 2.0 redirect: ${error}`):new Error("Failed to handle OAuth 2.0 redirect.");{const oauth2Storage=storage.prefix("oauth2");OAuth2Helper.getStateStorage(oauth2Storage,state).set("result",JSON.stringify(result))}}static decodeAuthInfo(authInfo){const parts=(authInfo||"").split("$");if(4===parts.length){const[accessToken,refreshToken,userId,deviceId]=parts;return{accessToken:accessToken,refreshToken:refreshToken,userId:userId,deviceId:deviceId}}throw new Error("Failed to decode 'authInfo' into ids and tokens")}static getStateStorage(storage,state){return storage.prefix(`state(${state})`)}openWindowAndWaitForRedirect(url,state){const stateStorage=OAuth2Helper.getStateStorage(this.storage,state);return new Promise(((resolve,reject)=>{let windowClosedInterval,redirectWindow=null;const handleStorageUpdate=()=>{const result=stateStorage.get("result");if(result){const parsedResult=JSON.parse(result);stateStorage.removeListener(handleStorageUpdate),stateStorage.clear();try{redirectWindow&&(clearInterval(windowClosedInterval),redirectWindow.close())}catch(err){console.warn(`Failed closing redirect window: ${err}`)}finally{resolve(parsedResult)}}};stateStorage.addListener(handleStorageUpdate),redirectWindow=this.openWindow(url),windowClosedInterval=setInterval((()=>{if(redirectWindow){if(redirectWindow.closed){clearInterval(windowClosedInterval),stateStorage.removeListener(handleStorageUpdate);const err=new Error("Window closed");reject(err)}}else clearInterval(windowClosedInterval)}),100)}))}generateState(){return function generateRandomString(length,alphabet){let result="";for(let i=0;i<length;i++)result+=alphabet[Math.floor(Math.random()*alphabet.length)];return result}(12,"abcdefghijklmnopqrstuvwxyz")}}class Authenticator{constructor(fetcher,storage,getDeviceInformation){this.fetcher=fetcher,this.oauth2=new OAuth2Helper(storage),this.getDeviceInformation=getDeviceInformation}async authenticate(credentials,linkingUser){const deviceInformation=this.getDeviceInformation(),isLinking="object"==typeof linkingUser;if(credentials.providerType.startsWith("oauth2")&&"string"==typeof credentials.payload.redirectUrl){const state=this.oauth2.generateState(),url=await this.getLogInUrl(credentials,isLinking,{state:state,redirect:credentials.payload.redirectUrl,providerRedirectHeader:!!isLinking||void 0,device:isLinking?void 0:deviceInformation.encode()});if(isLinking){const redirectUrl=(await this.fetcher.fetch({method:"GET",url:url,tokenType:isLinking?"access":"none",user:linkingUser,mode:"cors",credentials:"include"})).headers.get("x-baas-location");if(redirectUrl)return this.openWindowAndWaitForAuthResponse(redirectUrl,state);throw new Error("Missing x-baas-location header")}return this.openWindowAndWaitForAuthResponse(url,state)}{const logInUrl=await this.getLogInUrl(credentials,isLinking),response=await this.fetcher.fetchJSON({method:"POST",url:logInUrl,body:{...credentials.payload,options:{device:deviceInformation.toJSON()}},tokenType:isLinking?"access":"none",user:linkingUser}),{user_id:userId,access_token:accessToken,refresh_token:refreshToken=null,device_id:deviceId}=response;if("string"!=typeof userId)throw new Error("Expected a user id in the response");if("string"!=typeof accessToken)throw new Error("Expected an access token in the response");if("string"!=typeof refreshToken&&null!==refreshToken)throw new Error("Expected refresh token to be a string or null");if("string"!=typeof deviceId)throw new Error("Expected device id to be a string");return{userId:userId,accessToken:accessToken,refreshToken:refreshToken,deviceId:deviceId}}}async getLogInUrl(credentials,link=!1,extraQueryParams={}){const loginRoute=this.fetcher.appRoute.authProvider(credentials.providerName).login(),qs=encodeQueryString({link:link?"true":void 0,...extraQueryParams});return await this.fetcher.locationUrl+loginRoute.path+qs}async openWindowAndWaitForAuthResponse(redirectUrl,state){const redirectResult=await this.oauth2.openWindowAndWaitForRedirect(redirectUrl,state);return OAuth2Helper.decodeAuthInfo(redirectResult.userAuth)}}class MongoDBRealmError extends Error{constructor(method,url,statusCode,statusText,error,errorCode,link){const summary=statusText?`status ${statusCode} ${statusText}`:`status ${statusCode}`;super("string"==typeof error?`Request failed (${method} ${url}): ${error} (${summary})`:`Request failed (${method} ${url}): (${summary})`),this.method=method,this.url=url,this.statusText=statusText,this.statusCode=statusCode,this.error=error,this.errorCode=errorCode,this.link=link}static async fromRequestAndResponse(request,response){var _a;const{url:url,method:method}=request,{status:status,statusText:statusText}=response;if(null===(_a=response.headers.get("content-type"))||void 0===_a?void 0:_a.startsWith("application/json")){const body=await response.json();if("object"==typeof body&&body){const{error:error,error_code:errorCode,link:link}=body;return new MongoDBRealmError(method,url,status,statusText,"string"==typeof error?error:void 0,"string"==typeof errorCode?errorCode:void 0,"string"==typeof link?link:void 0)}}return new MongoDBRealmError(method,url,status,statusText)}}class Fetcher{constructor({appId:appId,transport:transport,userContext:userContext,locationUrlContext:locationUrlContext}){this.appId=appId,this.transport=transport,this.userContext=userContext,this.locationUrlContext=locationUrlContext}static buildAuthorizationHeader(user,tokenType){if(user&&"none"!==tokenType){if("access"===tokenType)return{Authorization:`Bearer ${user.accessToken}`};if("refresh"===tokenType)return{Authorization:`Bearer ${user.refreshToken}`};throw new Error(`Unexpected token type (${tokenType})`)}return{}}static buildBody(body){if(body){if("object"==typeof body&&null!==body)return JSON.stringify(bundle_dom_es_serialize(body));if("string"==typeof body)return body;throw console.log("body is",body),new Error("Unexpected type of body")}}static buildJsonHeader(body){return body&&body.length>0?{"Content-Type":"application/json"}:{}}clone(config){return new Fetcher({appId:this.appId,transport:this.transport,userContext:this.userContext,locationUrlContext:this.locationUrlContext,...config})}async fetch(request){const{path:path,url:url,tokenType:tokenType="access",user:user=this.userContext.currentUser,...restOfRequest}=request;if("string"==typeof path&&"string"==typeof url)throw new Error("Use of 'url' and 'path' mutually exclusive");if("string"==typeof path){const url=await this.locationUrlContext.locationUrl+path;return this.fetch({...request,path:void 0,url:url})}if("string"==typeof url){const response=await this.transport.fetch({...restOfRequest,url:url,headers:{...Fetcher.buildAuthorizationHeader(user,tokenType),...request.headers}});if(response.ok)return response;if(user&&401===response.status&&"access"===tokenType)return await user.refreshAccessToken(),this.fetch({...request,user:user});throw user&&401===response.status&&"refresh"===tokenType&&(user.accessToken=null,user.refreshToken=null),await MongoDBRealmError.fromRequestAndResponse(request,response)}throw new Error("Expected either 'url' or 'path'")}async fetchJSON(request){const{body:body}=request,serializedBody=Fetcher.buildBody(body),contentTypeHeaders=Fetcher.buildJsonHeader(serializedBody),response=await this.fetch({...request,body:serializedBody,headers:{Accept:"application/json",...contentTypeHeaders,...request.headers}}),contentType=response.headers.get("content-type");if(null==contentType?void 0:contentType.startsWith("application/json")){return bundle_dom_es_deserialize(await response.json())}if(null===contentType)return null;throw new Error(`Expected JSON response, got "${contentType}"`)}async fetchStream(request){const{body:body}=await this.fetch({...request,headers:{Accept:"text/event-stream",...request.headers}});return function asyncIteratorFromResponseBody(body){if("object"!=typeof body||null===body)throw new Error("Expected a non-null object");if(Symbol.asyncIterator in body)return body;if("getReader"in body){const stream=body;return{[Symbol.asyncIterator](){const reader=stream.getReader();return{next:()=>reader.read(),return:async()=>(await reader.cancel(),{done:!0,value:null})}}}}throw new Error("Expected an AsyncIterable or a ReadableStream")}(body)}get appRoute(){return routes.api().app(this.appId)}get locationUrl(){return this.locationUrlContext.locationUrl}}var DeviceFields;!function(DeviceFields){DeviceFields.DEVICE_ID="deviceId",DeviceFields.APP_ID="appId",DeviceFields.APP_VERSION="appVersion",DeviceFields.PLATFORM="platform",DeviceFields.PLATFORM_VERSION="platformVersion",DeviceFields.SDK_VERSION="sdkVersion"}(DeviceFields||(DeviceFields={}));class DeviceInformation{constructor({appId:appId,appVersion:appVersion,deviceId:deviceId}){this.sdkVersion="1.7.0";const environment=getEnvironment();this.platform=environment.platform,this.platformVersion=environment.platformVersion,this.appId=appId,this.appVersion=appVersion,this.deviceId=deviceId}encode(){const obj=removeKeysWithUndefinedValues(this);return gBase64_encode(JSON.stringify(obj))}toJSON(){return removeKeysWithUndefinedValues(this)}}const DEFAULT_BASE_URL="https://realm.mongodb.com";class App{constructor(idOrConfiguration){this.users=[],this._locationUrl=null;const configuration="string"==typeof idOrConfiguration?{id:idOrConfiguration}:idOrConfiguration;if("object"!=typeof configuration||"string"!=typeof configuration.id)throw new Error("Missing a MongoDB Realm app-id");this.id=configuration.id,this.baseUrl=configuration.baseUrl||DEFAULT_BASE_URL,configuration.skipLocationRequest&&(this._locationUrl=Promise.resolve(this.baseUrl)),this.localApp=configuration.app;const{storage:storage,transport:transport=new DefaultNetworkTransport}=configuration;this.fetcher=new Fetcher({appId:this.id,userContext:this,locationUrlContext:this,transport:transport}),this.emailPasswordAuth=new EmailPasswordAuth(this.fetcher);const baseStorage=storage||getEnvironment().defaultStorage;this.storage=new AppStorage(baseStorage,this.id),this.authenticator=new Authenticator(this.fetcher,baseStorage,(()=>this.deviceInformation));try{this.hydrate()}catch(err){this.storage.clear(),console.warn("Realm app hydration failed:",err instanceof Error?err.message:err)}}static getApp(id){if(id in App.appCache)return App.appCache[id];{const instance=new App(id);return App.appCache[id]=instance,instance}}switchUser(nextUser){const index=this.users.findIndex((u=>u===nextUser));if(-1===index)throw new Error("The user was never logged into this app");const[user]=this.users.splice(index,1);this.users.unshift(user)}async logIn(credentials,fetchProfile=!0){const response=await this.authenticator.authenticate(credentials),user=this.createOrUpdateUser(response,credentials.providerType);this.switchUser(user),fetchProfile&&await user.refreshProfile(),this.storage.setUserIds(this.users.map((u=>u.id)),!0);const deviceId=response.deviceId;return deviceId&&"000000000000000000000000"!==deviceId&&this.storage.set("deviceId",deviceId),user}async removeUser(user){const index=this.users.findIndex((u=>u===user));if(-1===index)throw new Error("The user was never logged into this app");this.users.splice(index,1),await user.logOut(),this.storage.remove(`user(${user.id}):profile`),this.storage.removeUserId(user.id)}async deleteUser(user){await this.fetcher.fetchJSON({method:"DELETE",path:routes.api().auth().delete().path}),await this.removeUser(user)}get currentUser(){const activeUsers=this.users.filter((user=>user.state===UserState.Active));return 0===activeUsers.length?null:activeUsers[0]}get allUsers(){return Object.fromEntries(this.users.map((user=>[user.id,user])))}get locationUrl(){if(!this._locationUrl){const path=routes.api().app(this.id).location().path;this._locationUrl=this.fetcher.fetchJSON({method:"GET",url:this.baseUrl+path,tokenType:"none"}).then((body=>{if("object"!=typeof body)throw new Error("Expected response body be an object");return body})).then((({hostname:hostname})=>{if("string"!=typeof hostname)throw new Error("Expected response to contain a 'hostname'");return hostname})).catch((err=>{throw this._locationUrl=null,err}))}return this._locationUrl}get deviceInformation(){const deviceIdStr=this.storage.getDeviceId(),deviceId="string"==typeof deviceIdStr&&"000000000000000000000000"!==deviceIdStr?new ObjectId(deviceIdStr):void 0;return new DeviceInformation({appId:this.localApp?this.localApp.name:void 0,appVersion:this.localApp?this.localApp.version:void 0,deviceId:deviceId})}createOrUpdateUser(response,providerType){const existingUser=this.users.find((u=>u.id===response.userId));if(existingUser)return existingUser.accessToken=response.accessToken,existingUser.refreshToken=response.refreshToken,existingUser;{if(!response.refreshToken)throw new Error("No refresh token in response from server");const user=new User({app:this,id:response.userId,accessToken:response.accessToken,refreshToken:response.refreshToken,providerType:providerType});return this.users.unshift(user),user}}hydrate(){const userIds=this.storage.getUserIds();this.users=userIds.map((id=>new User({app:this,id:id})))}}function getApp(id){return App.getApp(id)}App.appCache={},App.Credentials=Credentials;class LocalStorage{constructor(){if("object"!=typeof globalThis.localStorage)throw new Error("Cannot use LocalStorage without a global localStorage object");this.global=globalThis}get(key){return this.global.localStorage.getItem(key)}set(key,value){return this.global.localStorage.setItem(key,value)}remove(key){return this.global.localStorage.removeItem(key)}prefix(keyPart){return new PrefixedStorage(this,keyPart)}clear(prefix){const keys=[];for(let i=0;i<this.global.localStorage.length;i++){const key=this.global.localStorage.key(i);!key||prefix&&!key.startsWith(prefix)||keys.push(key)}for(const key of keys)this.global.localStorage.removeItem(key)}addListener(listener){return this.global.addEventListener("storage",listener)}removeListener(listener){return this.global.removeEventListener("storage",listener)}}const browser=function detect(userAgent){return userAgent?parseUserAgent(userAgent):"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product?new ReactNativeInfo:"undefined"!=typeof navigator?parseUserAgent(navigator.userAgent):function getNodeVersion(){return"undefined"!=typeof process&&process.version?new NodeInfo(process.version.slice(1)):null}()}();const environment$1={defaultStorage:(new("localStorage"in globalThis?LocalStorage:class MemoryStorage{constructor(){this.storage={},this.listeners=new Set}get(key){return key in this.storage?this.storage[key]:null}set(key,value){this.storage[key]=value,this.fireListeners()}remove(key){delete this.storage[key],this.fireListeners()}prefix(keyPart){return new PrefixedStorage(this,keyPart)}clear(prefix){for(const key of Object.keys(this.storage))prefix&&!key.startsWith(prefix)||delete this.storage[key];this.fireListeners()}addListener(listener){this.listeners.add(listener)}removeListener(listener){this.listeners.delete(listener)}fireListeners(){this.listeners.forEach((listener=>listener()))}})).prefix("realm-web"),openWindow:function openWindow(url){return"function"==typeof globalThis.open?globalThis.open(url):(console.log(`Please open ${url}`),null)},platform:(null==browser?void 0:browser.name)||"web",platformVersion:(null==browser?void 0:browser.version)||"0.0.0",TextDecoder:TextDecoder};function handleAuthRedirect(location=globalThis.location,storage=environment$1.defaultStorage){try{const queryString=location.hash.substr(1);OAuth2Helper.handleRedirect(queryString,storage)}catch(err){console.warn(err)}}function mongo_typeof(obj){return mongo_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},mongo_typeof(obj)}function mongo_regeneratorRuntime(){mongo_regeneratorRuntime=function _regeneratorRuntime(){return exports};var exports={},Op=Object.prototype,hasOwn=Op.hasOwnProperty,$Symbol="function"==typeof Symbol?Symbol:{},iteratorSymbol=$Symbol.iterator||"@@iterator",asyncIteratorSymbol=$Symbol.asyncIterator||"@@asyncIterator",toStringTagSymbol=$Symbol.toStringTag||"@@toStringTag";function define(obj,key,value){return Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}),obj[key]}try{define({},"")}catch(err){define=function define(obj,key,value){return obj[key]=value}}function wrap(innerFn,outerFn,self,tryLocsList){var protoGenerator=outerFn&&outerFn.prototype instanceof Generator?outerFn:Generator,generator=Object.create(protoGenerator.prototype),context=new Context(tryLocsList||[]);return generator._invoke=function(innerFn,self,context){var state="suspendedStart";return function(method,arg){if("executing"===state)throw new Error("Generator is already running");if("completed"===state){if("throw"===method)throw arg;return doneResult()}for(context.method=method,context.arg=arg;;){var delegate=context.delegate;if(delegate){var delegateResult=maybeInvokeDelegate(delegate,context);if(delegateResult){if(delegateResult===ContinueSentinel)continue;return delegateResult}}if("next"===context.method)context.sent=context._sent=context.arg;else if("throw"===context.method){if("suspendedStart"===state)throw state="completed",context.arg;context.dispatchException(context.arg)}else"return"===context.method&&context.abrupt("return",context.arg);state="executing";var record=tryCatch(innerFn,self,context);if("normal"===record.type){if(state=context.done?"completed":"suspendedYield",record.arg===ContinueSentinel)continue;return{value:record.arg,done:context.done}}"throw"===record.type&&(state="completed",context.method="throw",context.arg=record.arg)}}}(innerFn,self,context),generator}function tryCatch(fn,obj,arg){try{return{type:"normal",arg:fn.call(obj,arg)}}catch(err){return{type:"throw",arg:err}}}exports.wrap=wrap;var ContinueSentinel={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var IteratorPrototype={};define(IteratorPrototype,iteratorSymbol,(function(){return this}));var getProto=Object.getPrototypeOf,NativeIteratorPrototype=getProto&&getProto(getProto(values([])));NativeIteratorPrototype&&NativeIteratorPrototype!==Op&&hasOwn.call(NativeIteratorPrototype,iteratorSymbol)&&(IteratorPrototype=NativeIteratorPrototype);var Gp=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(IteratorPrototype);function defineIteratorMethods(prototype){["next","throw","return"].forEach((function(method){define(prototype,method,(function(arg){return this._invoke(method,arg)}))}))}function AsyncIterator(generator,PromiseImpl){function invoke(method,arg,resolve,reject){var record=tryCatch(generator[method],generator,arg);if("throw"!==record.type){var result=record.arg,value=result.value;return value&&"object"==mongo_typeof(value)&&hasOwn.call(value,"__await")?PromiseImpl.resolve(value.__await).then((function(value){invoke("next",value,resolve,reject)}),(function(err){invoke("throw",err,resolve,reject)})):PromiseImpl.resolve(value).then((function(unwrapped){result.value=unwrapped,resolve(result)}),(function(error){return invoke("throw",error,resolve,reject)}))}reject(record.arg)}var previousPromise;this._invoke=function(method,arg){function callInvokeWithMethodAndArg(){return new PromiseImpl((function(resolve,reject){invoke(method,arg,resolve,reject)}))}return previousPromise=previousPromise?previousPromise.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}}function maybeInvokeDelegate(delegate,context){var method=delegate.iterator[context.method];if(void 0===method){if(context.delegate=null,"throw"===context.method){if(delegate.iterator.return&&(context.method="return",context.arg=void 0,maybeInvokeDelegate(delegate,context),"throw"===context.method))return ContinueSentinel;context.method="throw",context.arg=new TypeError("The iterator does not provide a 'throw' method")}return ContinueSentinel}var record=tryCatch(method,delegate.iterator,context.arg);if("throw"===record.type)return context.method="throw",context.arg=record.arg,context.delegate=null,ContinueSentinel;var info=record.arg;return info?info.done?(context[delegate.resultName]=info.value,context.next=delegate.nextLoc,"return"!==context.method&&(context.method="next",context.arg=void 0),context.delegate=null,ContinueSentinel):info:(context.method="throw",context.arg=new TypeError("iterator result is not an object"),context.delegate=null,ContinueSentinel)}function pushTryEntry(locs){var entry={tryLoc:locs[0]};1 in locs&&(entry.catchLoc=locs[1]),2 in locs&&(entry.finallyLoc=locs[2],entry.afterLoc=locs[3]),this.tryEntries.push(entry)}function resetTryEntry(entry){var record=entry.completion||{};record.type="normal",delete record.arg,entry.completion=record}function Context(tryLocsList){this.tryEntries=[{tryLoc:"root"}],tryLocsList.forEach(pushTryEntry,this),this.reset(!0)}function values(iterable){if(iterable){var iteratorMethod=iterable[iteratorSymbol];if(iteratorMethod)return iteratorMethod.call(iterable);if("function"==typeof iterable.next)return iterable;if(!isNaN(iterable.length)){var i=-1,next=function next(){for(;++i<iterable.length;)if(hasOwn.call(iterable,i))return next.value=iterable[i],next.done=!1,next;return next.value=void 0,next.done=!0,next};return next.next=next}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,define(Gp,"constructor",GeneratorFunctionPrototype),define(GeneratorFunctionPrototype,"constructor",GeneratorFunction),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,toStringTagSymbol,"GeneratorFunction"),exports.isGeneratorFunction=function(genFun){var ctor="function"==typeof genFun&&genFun.constructor;return!!ctor&&(ctor===GeneratorFunction||"GeneratorFunction"===(ctor.displayName||ctor.name))},exports.mark=function(genFun){return Object.setPrototypeOf?Object.setPrototypeOf(genFun,GeneratorFunctionPrototype):(genFun.__proto__=GeneratorFunctionPrototype,define(genFun,toStringTagSymbol,"GeneratorFunction")),genFun.prototype=Object.create(Gp),genFun},exports.awrap=function(arg){return{__await:arg}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,asyncIteratorSymbol,(function(){return this})),exports.AsyncIterator=AsyncIterator,exports.async=function(innerFn,outerFn,self,tryLocsList,PromiseImpl){void 0===PromiseImpl&&(PromiseImpl=Promise);var iter=new AsyncIterator(wrap(innerFn,outerFn,self,tryLocsList),PromiseImpl);return exports.isGeneratorFunction(outerFn)?iter:iter.next().then((function(result){return result.done?result.value:iter.next()}))},defineIteratorMethods(Gp),define(Gp,toStringTagSymbol,"Generator"),define(Gp,iteratorSymbol,(function(){return this})),define(Gp,"toString",(function(){return"[object Generator]"})),exports.keys=function(object){var keys=[];for(var key in object)keys.push(key);return keys.reverse(),function next(){for(;keys.length;){var key=keys.pop();if(key in object)return next.value=key,next.done=!1,next}return next.done=!0,next}},exports.values=values,Context.prototype={constructor:Context,reset:function reset(skipTempReset){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!skipTempReset)for(var name in this)"t"===name.charAt(0)&&hasOwn.call(this,name)&&!isNaN(+name.slice(1))&&(this[name]=void 0)},stop:function stop(){this.done=!0;var rootRecord=this.tryEntries[0].completion;if("throw"===rootRecord.type)throw rootRecord.arg;return this.rval},dispatchException:function dispatchException(exception){if(this.done)throw exception;var context=this;function handle(loc,caught){return record.type="throw",record.arg=exception,context.next=loc,caught&&(context.method="next",context.arg=void 0),!!caught}for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i],record=entry.completion;if("root"===entry.tryLoc)return handle("end");if(entry.tryLoc<=this.prev){var hasCatch=hasOwn.call(entry,"catchLoc"),hasFinally=hasOwn.call(entry,"finallyLoc");if(hasCatch&&hasFinally){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0);if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}else if(hasCatch){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0)}else{if(!hasFinally)throw new Error("try statement without catch or finally");if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}}}},abrupt:function abrupt(type,arg){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc<=this.prev&&hasOwn.call(entry,"finallyLoc")&&this.prev<entry.finallyLoc){var finallyEntry=entry;break}}finallyEntry&&("break"===type||"continue"===type)&&finallyEntry.tryLoc<=arg&&arg<=finallyEntry.finallyLoc&&(finallyEntry=null);var record=finallyEntry?finallyEntry.completion:{};return record.type=type,record.arg=arg,finallyEntry?(this.method="next",this.next=finallyEntry.finallyLoc,ContinueSentinel):this.complete(record)},complete:function complete(record,afterLoc){if("throw"===record.type)throw record.arg;return"break"===record.type||"continue"===record.type?this.next=record.arg:"return"===record.type?(this.rval=this.arg=record.arg,this.method="return",this.next="end"):"normal"===record.type&&afterLoc&&(this.next=afterLoc),ContinueSentinel},finish:function finish(finallyLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.finallyLoc===finallyLoc)return this.complete(entry.completion,entry.afterLoc),resetTryEntry(entry),ContinueSentinel}},catch:function _catch(tryLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc===tryLoc){var record=entry.completion;if("throw"===record.type){var thrown=record.arg;resetTryEntry(entry)}return thrown}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(iterable,resultName,nextLoc){return this.delegate={iterator:values(iterable),resultName:resultName,nextLoc:nextLoc},"next"===this.method&&(this.arg=void 0),ContinueSentinel}},exports}function mongo_createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=function mongo_unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return mongo_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return mongo_arrayLikeToArray(o,minLen)}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function F(){};return{s:F,n:function n(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function s(){it=it.call(o)},n:function n(){var step=it.next();return normalCompletion=step.done,step},e:function e(_e2){didErr=!0,err=_e2},f:function f(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function mongo_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function mongo_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function mongo_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){mongo_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){mongo_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}setEnvironment(environment$1);var _initialize,_collectShrines,_collectDenizens,mongo={denizenEntries:[],shrineEntries:[],db:{},user:{},logging:!1,collectDenizens:(_collectDenizens=mongo_asyncToGenerator(mongo_regeneratorRuntime().mark((function _callee(){var roomDenizens,newDenizens,roamers,curRoom,_iterator,_step,denizen,_iterator2,_step2,_loop;return mongo_regeneratorRuntime().wrap((function _callee$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(null!=GMCP.CurrentArea.id){_context2.next=2;break}return _context2.abrupt("return");case 2:if(0!==(roomDenizens=GMCP.Char.Items.List.items.filter((function(x){return"m"===x.attrib&&!mongo.ignoreList.some((function(rx){return rx.test(x.name)}))}))).length){_context2.next=5;break}return _context2.abrupt("return");case 5:roamers=[],curRoom=GMCP.Location.id,newDenizens=roomDenizens.filter((function(x){return!mongo.denizenEntries.find((function(y){return x.id===y.id}))})),mongo.logging&&(console.log("newDenizens:"),console.log(newDenizens)),roamers=roomDenizens.filter((function(x){return mongo.denizenEntries.find((function(y){return x.id===y.id&&!y.room.includes(curRoom)}))})),mongo.logging&&(console.log("roamers:"),console.log(roamers)),mongo.db.collectionName="denizens",_iterator=mongo_createForOfIteratorHelper(newDenizens),_context2.prev=14,_iterator.s();case 16:if((_step=_iterator.n()).done){_context2.next=28;break}return(denizen=_step.value).id=parseInt(denizen.id),denizen.room=[curRoom],denizen.area={name:GMCP.Room.Info.area,id:GMCP.Location.areaid},denizen.time=window.Date(),denizen.user={id:mongo.user.id,name:GMCP.Status.name},mongo.denizenEntries.push({id:denizen.id,room:denizen.room}),_context2.next=26,mongo.db.insertOne(denizen);case 26:_context2.next=16;break;case 28:_context2.next=33;break;case 30:_context2.prev=30,_context2.t0=_context2.catch(14),_iterator.e(_context2.t0);case 33:return _context2.prev=33,_iterator.f(),_context2.finish(33);case 36:_iterator2=mongo_createForOfIteratorHelper(roamers),_context2.prev=37,_loop=mongo_regeneratorRuntime().mark((function _loop(){var denizen;return mongo_regeneratorRuntime().wrap((function _loop$(_context){for(;;)switch(_context.prev=_context.next){case 0:return denizen=_step2.value,mongo.denizenEntries.find((function(e){return e.id===denizen.id})).rooom=[curRoom],_context.next=4,mongo.db.updateOne({id:denizen.id},{$set:{room:[curRoom],id:parseInt(denizen.id)}});case 4:case"end":return _context.stop()}}),_loop)})),_iterator2.s();case 40:if((_step2=_iterator2.n()).done){_context2.next=44;break}return _context2.delegateYield(_loop(),"t1",42);case 42:_context2.next=40;break;case 44:_context2.next=49;break;case 46:_context2.prev=46,_context2.t2=_context2.catch(37),_iterator2.e(_context2.t2);case 49:return _context2.prev=49,_iterator2.f(),_context2.finish(49);case 52:case"end":return _context2.stop()}}),_callee,null,[[14,30,33,36],[37,46,49,52]])}))),function collectDenizens(){return _collectDenizens.apply(this,arguments)}),collectShrines:(_collectShrines=mongo_asyncToGenerator(mongo_regeneratorRuntime().mark((function _callee2(){var roomShrine,existingShrine;return mongo_regeneratorRuntime().wrap((function _callee2$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(null!=GMCP.CurrentArea.id){_context3.next=2;break}return _context3.abrupt("return");case 2:if(roomShrine=GMCP.Char.Items.List.items.find((function(x){return"shrine"===x.icon})),existingShrine=mongo.shrineEntries.find((function(e){return e.room===GMCP.Room.Info.num})),roomShrine||roomShrine){_context3.next=6;break}return _context3.abrupt("return");case 6:if(mongo.db.collectionName="shrines",!existingShrine||roomShrine){_context3.next=11;break}return _context3.next=10,mongo.db.deleteOne({room:existingShrine.room});case 10:return _context3.abrupt("return");case 11:if((null==existingShrine?void 0:existingShrine.id)!==roomShrine.id){_context3.next=13;break}return _context3.abrupt("return");case 13:return roomShrine.id=parseInt(roomShrine.id),roomShrine.room=GMCP.Room.Info.num,roomShrine.area={name:GMCP.Room.Info.area,id:parseInt(GMCP.CurrentArea.id)},roomShrine.time=window.Date(),roomShrine.user={id:mongo.user.id,name:GMCP.Status.name},existingShrine&&(null==existingShrine?void 0:existingShrine.id)!==roomShrine.id?existingShrine.id=roomShrine.id:mongo.shrineEntries.push({id:roomShrine.id,room:roomShrine.room}),_context3.next=21,mongo.db.updateOne({room:GMCP.Room.Info.num},roomShrine,{upsert:!0});case 21:return _context3.abrupt("return",!0);case 22:case"end":return _context3.stop()}}),_callee2)}))),function collectShrines(){return _collectShrines.apply(this,arguments)}),initialize:(_initialize=mongo_asyncToGenerator(mongo_regeneratorRuntime().mark((function _callee3(){var app,credentials,mongodb;return mongo_regeneratorRuntime().wrap((function _callee3$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(console.log("Mongo startup called"),bundle_dom_es_namespaceObject){_context4.next=4;break}return console.log("Mongo startup cancelled. Realm not loaded."),_context4.abrupt("return");case 4:return app=new App({id:"nexmap-izeal"}),_context4.next=8,Credentials.apiKey("pE7xABGhoWjv2XvSLvON4D2oOSF8WcmEwXkLoKzE2bqlIX1HpkxQIJTLUbr0qhPw");case 8:return credentials=_context4.sent,_context4.next=11,app.logIn(credentials);case 11:return mongo.user=_context4.sent,mongo.user.id=app.currentUser.id,mongodb=app.currentUser.mongoClient("mongodb-atlas"),mongo.db=mongodb.db("nexMap").collection("denizens"),_context4.next=17,mongo.db.find({},{projection:{_id:0,id:1,room:1}});case 17:return mongo.denizenEntries=_context4.sent,mongo.db.collectionName="shrines",_context4.next=21,mongo.db.find({},{projection:{_id:0,id:1,room:1}});case 21:return mongo.shrineEntries=_context4.sent,console.log("MongoDB loaded"),console.log(mongo.db),display_notice("Denizen database loaded with ".concat(mongo.denizenEntries.length," NPC entries.")),_context4.abrupt("return",mongo.db);case 26:case"end":return _context4.stop()}}),_callee3)}))),function initialize(){return _initialize.apply(this,arguments)}),ignoreList:[/a dervish/,/a sharp-toothed gremlin/,/a chaos orb/,/a bloodleech/,/a minion of chaos/,/a worm/,/a green slime/,/a soulmaster/,/a humbug/,/a chimera/,/a bubonis/,/a chaos storm/,/a chaos hound/,/a withered crone/,/a pathfinder/,/a doppleganger/,/an ethereal firelord/,/a simpering sycophant/,/a water weird/,/an eldritch abomination/,/Khaseem/,/a guardian angel/,/a diminutive homunculus/,/a Baalzadeen/,/shipmate/,/a squad of/,/swashbuckler/,/a red admiral butterfly/,/a baby rat/,/a young rat/,/a rat/,/an old rat/,/a black rat/]};function navigation_typeof(obj){return navigation_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},navigation_typeof(obj)}function navigation_regeneratorRuntime(){navigation_regeneratorRuntime=function _regeneratorRuntime(){return exports};var exports={},Op=Object.prototype,hasOwn=Op.hasOwnProperty,$Symbol="function"==typeof Symbol?Symbol:{},iteratorSymbol=$Symbol.iterator||"@@iterator",asyncIteratorSymbol=$Symbol.asyncIterator||"@@asyncIterator",toStringTagSymbol=$Symbol.toStringTag||"@@toStringTag";function define(obj,key,value){return Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}),obj[key]}try{define({},"")}catch(err){define=function define(obj,key,value){return obj[key]=value}}function wrap(innerFn,outerFn,self,tryLocsList){var protoGenerator=outerFn&&outerFn.prototype instanceof Generator?outerFn:Generator,generator=Object.create(protoGenerator.prototype),context=new Context(tryLocsList||[]);return generator._invoke=function(innerFn,self,context){var state="suspendedStart";return function(method,arg){if("executing"===state)throw new Error("Generator is already running");if("completed"===state){if("throw"===method)throw arg;return doneResult()}for(context.method=method,context.arg=arg;;){var delegate=context.delegate;if(delegate){var delegateResult=maybeInvokeDelegate(delegate,context);if(delegateResult){if(delegateResult===ContinueSentinel)continue;return delegateResult}}if("next"===context.method)context.sent=context._sent=context.arg;else if("throw"===context.method){if("suspendedStart"===state)throw state="completed",context.arg;context.dispatchException(context.arg)}else"return"===context.method&&context.abrupt("return",context.arg);state="executing";var record=tryCatch(innerFn,self,context);if("normal"===record.type){if(state=context.done?"completed":"suspendedYield",record.arg===ContinueSentinel)continue;return{value:record.arg,done:context.done}}"throw"===record.type&&(state="completed",context.method="throw",context.arg=record.arg)}}}(innerFn,self,context),generator}function tryCatch(fn,obj,arg){try{return{type:"normal",arg:fn.call(obj,arg)}}catch(err){return{type:"throw",arg:err}}}exports.wrap=wrap;var ContinueSentinel={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var IteratorPrototype={};define(IteratorPrototype,iteratorSymbol,(function(){return this}));var getProto=Object.getPrototypeOf,NativeIteratorPrototype=getProto&&getProto(getProto(values([])));NativeIteratorPrototype&&NativeIteratorPrototype!==Op&&hasOwn.call(NativeIteratorPrototype,iteratorSymbol)&&(IteratorPrototype=NativeIteratorPrototype);var Gp=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(IteratorPrototype);function defineIteratorMethods(prototype){["next","throw","return"].forEach((function(method){define(prototype,method,(function(arg){return this._invoke(method,arg)}))}))}function AsyncIterator(generator,PromiseImpl){function invoke(method,arg,resolve,reject){var record=tryCatch(generator[method],generator,arg);if("throw"!==record.type){var result=record.arg,value=result.value;return value&&"object"==navigation_typeof(value)&&hasOwn.call(value,"__await")?PromiseImpl.resolve(value.__await).then((function(value){invoke("next",value,resolve,reject)}),(function(err){invoke("throw",err,resolve,reject)})):PromiseImpl.resolve(value).then((function(unwrapped){result.value=unwrapped,resolve(result)}),(function(error){return invoke("throw",error,resolve,reject)}))}reject(record.arg)}var previousPromise;this._invoke=function(method,arg){function callInvokeWithMethodAndArg(){return new PromiseImpl((function(resolve,reject){invoke(method,arg,resolve,reject)}))}return previousPromise=previousPromise?previousPromise.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}}function maybeInvokeDelegate(delegate,context){var method=delegate.iterator[context.method];if(void 0===method){if(context.delegate=null,"throw"===context.method){if(delegate.iterator.return&&(context.method="return",context.arg=void 0,maybeInvokeDelegate(delegate,context),"throw"===context.method))return ContinueSentinel;context.method="throw",context.arg=new TypeError("The iterator does not provide a 'throw' method")}return ContinueSentinel}var record=tryCatch(method,delegate.iterator,context.arg);if("throw"===record.type)return context.method="throw",context.arg=record.arg,context.delegate=null,ContinueSentinel;var info=record.arg;return info?info.done?(context[delegate.resultName]=info.value,context.next=delegate.nextLoc,"return"!==context.method&&(context.method="next",context.arg=void 0),context.delegate=null,ContinueSentinel):info:(context.method="throw",context.arg=new TypeError("iterator result is not an object"),context.delegate=null,ContinueSentinel)}function pushTryEntry(locs){var entry={tryLoc:locs[0]};1 in locs&&(entry.catchLoc=locs[1]),2 in locs&&(entry.finallyLoc=locs[2],entry.afterLoc=locs[3]),this.tryEntries.push(entry)}function resetTryEntry(entry){var record=entry.completion||{};record.type="normal",delete record.arg,entry.completion=record}function Context(tryLocsList){this.tryEntries=[{tryLoc:"root"}],tryLocsList.forEach(pushTryEntry,this),this.reset(!0)}function values(iterable){if(iterable){var iteratorMethod=iterable[iteratorSymbol];if(iteratorMethod)return iteratorMethod.call(iterable);if("function"==typeof iterable.next)return iterable;if(!isNaN(iterable.length)){var i=-1,next=function next(){for(;++i<iterable.length;)if(hasOwn.call(iterable,i))return next.value=iterable[i],next.done=!1,next;return next.value=void 0,next.done=!0,next};return next.next=next}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,define(Gp,"constructor",GeneratorFunctionPrototype),define(GeneratorFunctionPrototype,"constructor",GeneratorFunction),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,toStringTagSymbol,"GeneratorFunction"),exports.isGeneratorFunction=function(genFun){var ctor="function"==typeof genFun&&genFun.constructor;return!!ctor&&(ctor===GeneratorFunction||"GeneratorFunction"===(ctor.displayName||ctor.name))},exports.mark=function(genFun){return Object.setPrototypeOf?Object.setPrototypeOf(genFun,GeneratorFunctionPrototype):(genFun.__proto__=GeneratorFunctionPrototype,define(genFun,toStringTagSymbol,"GeneratorFunction")),genFun.prototype=Object.create(Gp),genFun},exports.awrap=function(arg){return{__await:arg}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,asyncIteratorSymbol,(function(){return this})),exports.AsyncIterator=AsyncIterator,exports.async=function(innerFn,outerFn,self,tryLocsList,PromiseImpl){void 0===PromiseImpl&&(PromiseImpl=Promise);var iter=new AsyncIterator(wrap(innerFn,outerFn,self,tryLocsList),PromiseImpl);return exports.isGeneratorFunction(outerFn)?iter:iter.next().then((function(result){return result.done?result.value:iter.next()}))},defineIteratorMethods(Gp),define(Gp,toStringTagSymbol,"Generator"),define(Gp,iteratorSymbol,(function(){return this})),define(Gp,"toString",(function(){return"[object Generator]"})),exports.keys=function(object){var keys=[];for(var key in object)keys.push(key);return keys.reverse(),function next(){for(;keys.length;){var key=keys.pop();if(key in object)return next.value=key,next.done=!1,next}return next.done=!0,next}},exports.values=values,Context.prototype={constructor:Context,reset:function reset(skipTempReset){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!skipTempReset)for(var name in this)"t"===name.charAt(0)&&hasOwn.call(this,name)&&!isNaN(+name.slice(1))&&(this[name]=void 0)},stop:function stop(){this.done=!0;var rootRecord=this.tryEntries[0].completion;if("throw"===rootRecord.type)throw rootRecord.arg;return this.rval},dispatchException:function dispatchException(exception){if(this.done)throw exception;var context=this;function handle(loc,caught){return record.type="throw",record.arg=exception,context.next=loc,caught&&(context.method="next",context.arg=void 0),!!caught}for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i],record=entry.completion;if("root"===entry.tryLoc)return handle("end");if(entry.tryLoc<=this.prev){var hasCatch=hasOwn.call(entry,"catchLoc"),hasFinally=hasOwn.call(entry,"finallyLoc");if(hasCatch&&hasFinally){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0);if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}else if(hasCatch){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0)}else{if(!hasFinally)throw new Error("try statement without catch or finally");if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}}}},abrupt:function abrupt(type,arg){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc<=this.prev&&hasOwn.call(entry,"finallyLoc")&&this.prev<entry.finallyLoc){var finallyEntry=entry;break}}finallyEntry&&("break"===type||"continue"===type)&&finallyEntry.tryLoc<=arg&&arg<=finallyEntry.finallyLoc&&(finallyEntry=null);var record=finallyEntry?finallyEntry.completion:{};return record.type=type,record.arg=arg,finallyEntry?(this.method="next",this.next=finallyEntry.finallyLoc,ContinueSentinel):this.complete(record)},complete:function complete(record,afterLoc){if("throw"===record.type)throw record.arg;return"break"===record.type||"continue"===record.type?this.next=record.arg:"return"===record.type?(this.rval=this.arg=record.arg,this.method="return",this.next="end"):"normal"===record.type&&afterLoc&&(this.next=afterLoc),ContinueSentinel},finish:function finish(finallyLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.finallyLoc===finallyLoc)return this.complete(entry.completion,entry.afterLoc),resetTryEntry(entry),ContinueSentinel}},catch:function _catch(tryLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc===tryLoc){var record=entry.completion;if("throw"===record.type){var thrown=record.arg;resetTryEntry(entry)}return thrown}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(iterable,resultName,nextLoc){return this.delegate={iterator:values(iterable),resultName:resultName,nextLoc:nextLoc},"next"===this.method&&(this.arg=void 0),ContinueSentinel}},exports}function navigation_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function navigation_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){navigation_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){navigation_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}var onGMCP=function(){var _ref=navigation_asyncToGenerator(navigation_regeneratorRuntime().mark((function _callee(method,args){return navigation_regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:_context.t0=method,_context.next="Room.Info"===_context.t0?3:"Char.Items.List"===_context.t0?21:"Char.Status"===_context.t0?23:25;break;case 3:if(GMCP.Room.Info=args,!args.ohmap){_context.next=9;break}return nexusclient.ui().layout().flexLayout.model.doAction({data:{tabNode:"map"},type:"FlexLayout_SelectTab"}),_context.abrupt("return");case 9:nexusclient.ui().layout().flexLayout.model.doAction({data:{tabNode:"nexmap"},type:"FlexLayout_SelectTab"}),styles.refresh(),cy.center("#".concat(GMCP.Room.Info.num));case 12:return _context.next=14,changeRoom(GMCP.Room.Info.num);case 14:if(!(mongo.denizenEntries.length>0&&"undefined"!=typeof Realm&&"room"===GMCP.Char.Items.List.location&&GMCP.Char.Items.List.items.length>0)){_context.next=19;break}return _context.next=17,mongo.collectDenizens();case 17:return _context.next=19,mongo.collectShrines();case 19:return walker.pathing&&step(),_context.abrupt("break",26);case 21:return GMCP.Char.Items.List=args,_context.abrupt("break",26);case 23:return"Serpent"!==args.class&&!settings_userPreferences.vibratingStick||settings_userPreferences.useWormhole||toggle("useWormholes"),_context.abrupt("break",26);case 25:return _context.abrupt("break",26);case 26:case"end":return _context.stop()}}),_callee)})));return function onGMCP(_x,_x2){return _ref.apply(this,arguments)}}(),farseeLocal=function(){var _ref2=navigation_asyncToGenerator(navigation_regeneratorRuntime().mark((function _callee2(target,room){var tar,msg;return navigation_regeneratorRuntime().wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return tar=cy.nodes().find((function(n){return n.data("name")===room})).data("id"),(msg=document.createElement("span")).setAttribute("id","farsee"),msg.appendChild(Object.assign(document.createElement("span"),{innerHTML:"You see that "})),msg.appendChild(Object.assign(document.createElement("span"),{style:"color:goldenrod",innerHTML:target})),msg.appendChild(Object.assign(document.createElement("span"),{innerHTML:" is at "})),msg.appendChild(Object.assign(document.createElement("span"),{id:"farsee",style:"color:White;text-decoration:underline;cursor:pointer",onclick:"walker.speedWalk(".concat(nexmap_nexmap.currentRoom,", ").concat(tar,")"),innerHTML:'"'.concat(room,'"')})),display_printHTML(msg[0].outerHTML),display_printHTML(Object.assign(document.createElement("span"),{innerHTML:"[".concat(determinePath(nexmap_nexmap.currentRoom,tar).rawPath.join(", "),"]")})),_context2.abrupt("return",!0);case 10:case"end":return _context2.stop()}}),_callee2)})));return function farseeLocal(_x3,_x4){return _ref2.apply(this,arguments)}}(),farseeArea=function(){var _ref3=navigation_asyncToGenerator(navigation_regeneratorRuntime().mark((function _callee3(target,area){var areas,msg,link;return navigation_regeneratorRuntime().wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if((areas=findArea("".concat(area))).length){_context3.next=4;break}return console.log("".concat(area)),_context3.abrupt("return",!1);case 4:return(msg=document.createElement("span")).setAttribute("id","farsee"),msg.appendChild(Object.assign(document.createElement("span"),{innerHTML:"Though too far away to accurately perceive details, you see that "})),msg.appendChild(Object.assign(document.createElement("span"),{style:"color:goldenrod",innerHTML:target})),msg.appendChild(Object.assign(document.createElement("span"),{innerHTML:" is in "})),link=Object.assign(document.createElement("span"),{id:"farsee",style:"color:White;text-decoration:underline;cursor:pointer",onclick:"display.click.area(".concat(JSON.stringify(areas[0].id),");"),innerHTML:'"'.concat(area,'"')}),areas.length>1?(msg.appendChild(Object.assign(document.createElement("span"),{innerHTML:area})),display_printHTML(msg[0].outerHTML),generateTable("areaTable",areas,area)):1===areas.length?(msg.appendChild(link),display_printHTML(msg[0].outerHTML)):(msg.appendChild(Object.assign(document.createElement("span"),{innerHTML:area})),display_printHTML(msg[0].outerHTML),display_notice("nothing found")),_context3.abrupt("return",!0);case 12:case"end":return _context3.stop()}}),_callee3)})));return function farseeArea(_x5,_x6){return _ref3.apply(this,arguments)}}(),findRooms=function(){var _ref5=navigation_asyncToGenerator(navigation_regeneratorRuntime().mark((function _callee5(search){var qry;return navigation_regeneratorRuntime().wrap((function _callee5$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(nexmap_nexmap.logging&&console.log(" findRoom(".concat(search,")")),void 0!==(qry=cy.nodes().filter((function(e){return!(!e.data("name")||!e.data("name").toLowerCase().includes(search.trim().toLowerCase()))})))){_context5.next=7;break}return console.log("Rooms matching ".concat(search," not found.")),_context5.abrupt("return",!1);case 7:return _context5.abrupt("return",qry);case 8:case"end":return _context5.stop()}}),_callee5)})));return function findRooms(_x8){return _ref5.apply(this,arguments)}}(),findArea=function(){var _ref6=navigation_asyncToGenerator(navigation_regeneratorRuntime().mark((function _callee6(search){var areas;return navigation_regeneratorRuntime().wrap((function _callee6$(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:if(void 0!==(areas=nexmap_nexmap.mudmap.areas.filter((function(e){return e.rooms.find((function(e2){var _e2$userData,_e2$userData$GameAre;return(null==e2||null===(_e2$userData=e2.userData)||void 0===_e2$userData||null===(_e2$userData$GameAre=_e2$userData["Game Area"])||void 0===_e2$userData$GameAre?void 0:_e2$userData$GameAre.toLowerCase())===search.toLowerCase()}))})))){_context6.next=4;break}return console.log("Area not found"),_context6.abrupt("return",!1);case 4:return _context6.abrupt("return",areas);case 5:case"end":return _context6.stop()}}),_callee6)})));return function findArea(_x9){return _ref6.apply(this,arguments)}}(),findAreas=function(){var _ref7=navigation_asyncToGenerator(navigation_regeneratorRuntime().mark((function _callee7(search){var areas;return navigation_regeneratorRuntime().wrap((function _callee7$(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:if(void 0!==(areas=nexmap_nexmap.mudmap.areas.filter((function(e){return e.rooms.find((function(e2){var _e2$userData2,_e2$userData2$GameAr;return null==e2||null===(_e2$userData2=e2.userData)||void 0===_e2$userData2||null===(_e2$userData2$GameAr=_e2$userData2["Game Area"])||void 0===_e2$userData2$GameAr?void 0:_e2$userData2$GameAr.toLowerCase().includes(search.toLowerCase())}))})))){_context7.next=4;break}return console.log("Area not found"),_context7.abrupt("return",!1);case 4:return _context7.abrupt("return",areas);case 5:case"end":return _context7.stop()}}),_callee7)})));return function findAreas(_x10){return _ref7.apply(this,arguments)}}(),changeArea=function(){var _ref8=navigation_asyncToGenerator(navigation_regeneratorRuntime().mark((function _callee8(area,z){var _GMCP,_GMCP$Room,_GMCP$Room$Info,override,_args8=arguments;return navigation_regeneratorRuntime().wrap((function _callee8$(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:if(override=_args8.length>2&&void 0!==_args8[2]&&_args8[2],nexmap_nexmap.logging&&console.log(" changeArea(".concat(area," ").concat(z,")")),area!==nexmap_nexmap.currentArea||z!==nexmap_nexmap.currentZ||override){_context8.next=5;break}return nexmap_nexmap.logging&&console.log(" changeArea() returned"),_context8.abrupt("return");case 5:return nexmap_nexmap.currentArea=area,nexmap_nexmap.currentZ=z,cy.$(".areaDisplay").removeClass("areaDisplay"),cy.$(".pseudo").remove(),cy.nodes().filter((function(e){return e.data("area")===nexmap_nexmap.currentArea&&e.data("z")===nexmap_nexmap.currentZ})).addClass("areaDisplay"),generateExits(nexmap_nexmap.currentArea,nexmap_nexmap.currentZ),cy.center("#".concat((null===(_GMCP=GMCP)||void 0===_GMCP||null===(_GMCP$Room=_GMCP.Room)||void 0===_GMCP$Room||null===(_GMCP$Room$Info=_GMCP$Room.Info)||void 0===_GMCP$Room$Info?void 0:_GMCP$Room$Info.num)||436)),_context8.abrupt("return",!0);case 14:case"end":return _context8.stop()}}),_callee8)})));return function changeArea(_x11,_x12){return _ref8.apply(this,arguments)}}(),changeRoom=function(){var _ref9=navigation_asyncToGenerator(navigation_regeneratorRuntime().mark((function _callee9(id){var room;return navigation_regeneratorRuntime().wrap((function _callee9$(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:if(nexmap_nexmap.logging&&console.log(" changeRoom(".concat(id,")")),id!==nexmap_nexmap.currentRoom){_context9.next=3;break}return _context9.abrupt("return");case 3:if(!cy.$id(id).hasClass("currentRoom")&&cy.$id(id).length){_context9.next=5;break}return _context9.abrupt("return");case 5:return room=cy.$id(id),cy.startBatch(),cy.$(".currentRoom").removeClass("currentRoom"),room.addClass("currentRoom"),_context9.next=11,changeArea(cy.$id(id).data("area"),cy.$id(id).position().z);case 11:cy.endBatch(),cy.center("#".concat(id)),document.getElementById("currentRoomLabel").innerHTML="".concat(room.data("areaName"),": ").concat(room.data("name")," (").concat(id,")"),document.getElementById("currentExitsLabel").innerHTML="Exits: ".concat(room.data("exits").join(", ")),nexmap_nexmap.currentRoom=id;case 16:case"end":return _context9.stop()}}),_callee9)})));return function changeRoom(_x13){return _ref9.apply(this,arguments)}}();function aliases_typeof(obj){return aliases_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},aliases_typeof(obj)}function aliases_regeneratorRuntime(){aliases_regeneratorRuntime=function _regeneratorRuntime(){return exports};var exports={},Op=Object.prototype,hasOwn=Op.hasOwnProperty,$Symbol="function"==typeof Symbol?Symbol:{},iteratorSymbol=$Symbol.iterator||"@@iterator",asyncIteratorSymbol=$Symbol.asyncIterator||"@@asyncIterator",toStringTagSymbol=$Symbol.toStringTag||"@@toStringTag";function define(obj,key,value){return Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}),obj[key]}try{define({},"")}catch(err){define=function define(obj,key,value){return obj[key]=value}}function wrap(innerFn,outerFn,self,tryLocsList){var protoGenerator=outerFn&&outerFn.prototype instanceof Generator?outerFn:Generator,generator=Object.create(protoGenerator.prototype),context=new Context(tryLocsList||[]);return generator._invoke=function(innerFn,self,context){var state="suspendedStart";return function(method,arg){if("executing"===state)throw new Error("Generator is already running");if("completed"===state){if("throw"===method)throw arg;return doneResult()}for(context.method=method,context.arg=arg;;){var delegate=context.delegate;if(delegate){var delegateResult=maybeInvokeDelegate(delegate,context);if(delegateResult){if(delegateResult===ContinueSentinel)continue;return delegateResult}}if("next"===context.method)context.sent=context._sent=context.arg;else if("throw"===context.method){if("suspendedStart"===state)throw state="completed",context.arg;context.dispatchException(context.arg)}else"return"===context.method&&context.abrupt("return",context.arg);state="executing";var record=tryCatch(innerFn,self,context);if("normal"===record.type){if(state=context.done?"completed":"suspendedYield",record.arg===ContinueSentinel)continue;return{value:record.arg,done:context.done}}"throw"===record.type&&(state="completed",context.method="throw",context.arg=record.arg)}}}(innerFn,self,context),generator}function tryCatch(fn,obj,arg){try{return{type:"normal",arg:fn.call(obj,arg)}}catch(err){return{type:"throw",arg:err}}}exports.wrap=wrap;var ContinueSentinel={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var IteratorPrototype={};define(IteratorPrototype,iteratorSymbol,(function(){return this}));var getProto=Object.getPrototypeOf,NativeIteratorPrototype=getProto&&getProto(getProto(values([])));NativeIteratorPrototype&&NativeIteratorPrototype!==Op&&hasOwn.call(NativeIteratorPrototype,iteratorSymbol)&&(IteratorPrototype=NativeIteratorPrototype);var Gp=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(IteratorPrototype);function defineIteratorMethods(prototype){["next","throw","return"].forEach((function(method){define(prototype,method,(function(arg){return this._invoke(method,arg)}))}))}function AsyncIterator(generator,PromiseImpl){function invoke(method,arg,resolve,reject){var record=tryCatch(generator[method],generator,arg);if("throw"!==record.type){var result=record.arg,value=result.value;return value&&"object"==aliases_typeof(value)&&hasOwn.call(value,"__await")?PromiseImpl.resolve(value.__await).then((function(value){invoke("next",value,resolve,reject)}),(function(err){invoke("throw",err,resolve,reject)})):PromiseImpl.resolve(value).then((function(unwrapped){result.value=unwrapped,resolve(result)}),(function(error){return invoke("throw",error,resolve,reject)}))}reject(record.arg)}var previousPromise;this._invoke=function(method,arg){function callInvokeWithMethodAndArg(){return new PromiseImpl((function(resolve,reject){invoke(method,arg,resolve,reject)}))}return previousPromise=previousPromise?previousPromise.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}}function maybeInvokeDelegate(delegate,context){var method=delegate.iterator[context.method];if(void 0===method){if(context.delegate=null,"throw"===context.method){if(delegate.iterator.return&&(context.method="return",context.arg=void 0,maybeInvokeDelegate(delegate,context),"throw"===context.method))return ContinueSentinel;context.method="throw",context.arg=new TypeError("The iterator does not provide a 'throw' method")}return ContinueSentinel}var record=tryCatch(method,delegate.iterator,context.arg);if("throw"===record.type)return context.method="throw",context.arg=record.arg,context.delegate=null,ContinueSentinel;var info=record.arg;return info?info.done?(context[delegate.resultName]=info.value,context.next=delegate.nextLoc,"return"!==context.method&&(context.method="next",context.arg=void 0),context.delegate=null,ContinueSentinel):info:(context.method="throw",context.arg=new TypeError("iterator result is not an object"),context.delegate=null,ContinueSentinel)}function pushTryEntry(locs){var entry={tryLoc:locs[0]};1 in locs&&(entry.catchLoc=locs[1]),2 in locs&&(entry.finallyLoc=locs[2],entry.afterLoc=locs[3]),this.tryEntries.push(entry)}function resetTryEntry(entry){var record=entry.completion||{};record.type="normal",delete record.arg,entry.completion=record}function Context(tryLocsList){this.tryEntries=[{tryLoc:"root"}],tryLocsList.forEach(pushTryEntry,this),this.reset(!0)}function values(iterable){if(iterable){var iteratorMethod=iterable[iteratorSymbol];if(iteratorMethod)return iteratorMethod.call(iterable);if("function"==typeof iterable.next)return iterable;if(!isNaN(iterable.length)){var i=-1,next=function next(){for(;++i<iterable.length;)if(hasOwn.call(iterable,i))return next.value=iterable[i],next.done=!1,next;return next.value=void 0,next.done=!0,next};return next.next=next}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,define(Gp,"constructor",GeneratorFunctionPrototype),define(GeneratorFunctionPrototype,"constructor",GeneratorFunction),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,toStringTagSymbol,"GeneratorFunction"),exports.isGeneratorFunction=function(genFun){var ctor="function"==typeof genFun&&genFun.constructor;return!!ctor&&(ctor===GeneratorFunction||"GeneratorFunction"===(ctor.displayName||ctor.name))},exports.mark=function(genFun){return Object.setPrototypeOf?Object.setPrototypeOf(genFun,GeneratorFunctionPrototype):(genFun.__proto__=GeneratorFunctionPrototype,define(genFun,toStringTagSymbol,"GeneratorFunction")),genFun.prototype=Object.create(Gp),genFun},exports.awrap=function(arg){return{__await:arg}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,asyncIteratorSymbol,(function(){return this})),exports.AsyncIterator=AsyncIterator,exports.async=function(innerFn,outerFn,self,tryLocsList,PromiseImpl){void 0===PromiseImpl&&(PromiseImpl=Promise);var iter=new AsyncIterator(wrap(innerFn,outerFn,self,tryLocsList),PromiseImpl);return exports.isGeneratorFunction(outerFn)?iter:iter.next().then((function(result){return result.done?result.value:iter.next()}))},defineIteratorMethods(Gp),define(Gp,toStringTagSymbol,"Generator"),define(Gp,iteratorSymbol,(function(){return this})),define(Gp,"toString",(function(){return"[object Generator]"})),exports.keys=function(object){var keys=[];for(var key in object)keys.push(key);return keys.reverse(),function next(){for(;keys.length;){var key=keys.pop();if(key in object)return next.value=key,next.done=!1,next}return next.done=!0,next}},exports.values=values,Context.prototype={constructor:Context,reset:function reset(skipTempReset){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!skipTempReset)for(var name in this)"t"===name.charAt(0)&&hasOwn.call(this,name)&&!isNaN(+name.slice(1))&&(this[name]=void 0)},stop:function stop(){this.done=!0;var rootRecord=this.tryEntries[0].completion;if("throw"===rootRecord.type)throw rootRecord.arg;return this.rval},dispatchException:function dispatchException(exception){if(this.done)throw exception;var context=this;function handle(loc,caught){return record.type="throw",record.arg=exception,context.next=loc,caught&&(context.method="next",context.arg=void 0),!!caught}for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i],record=entry.completion;if("root"===entry.tryLoc)return handle("end");if(entry.tryLoc<=this.prev){var hasCatch=hasOwn.call(entry,"catchLoc"),hasFinally=hasOwn.call(entry,"finallyLoc");if(hasCatch&&hasFinally){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0);if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}else if(hasCatch){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0)}else{if(!hasFinally)throw new Error("try statement without catch or finally");if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}}}},abrupt:function abrupt(type,arg){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc<=this.prev&&hasOwn.call(entry,"finallyLoc")&&this.prev<entry.finallyLoc){var finallyEntry=entry;break}}finallyEntry&&("break"===type||"continue"===type)&&finallyEntry.tryLoc<=arg&&arg<=finallyEntry.finallyLoc&&(finallyEntry=null);var record=finallyEntry?finallyEntry.completion:{};return record.type=type,record.arg=arg,finallyEntry?(this.method="next",this.next=finallyEntry.finallyLoc,ContinueSentinel):this.complete(record)},complete:function complete(record,afterLoc){if("throw"===record.type)throw record.arg;return"break"===record.type||"continue"===record.type?this.next=record.arg:"return"===record.type?(this.rval=this.arg=record.arg,this.method="return",this.next="end"):"normal"===record.type&&afterLoc&&(this.next=afterLoc),ContinueSentinel},finish:function finish(finallyLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.finallyLoc===finallyLoc)return this.complete(entry.completion,entry.afterLoc),resetTryEntry(entry),ContinueSentinel}},catch:function _catch(tryLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc===tryLoc){var record=entry.completion;if("throw"===record.type){var thrown=record.arg;resetTryEntry(entry)}return thrown}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(iterable,resultName,nextLoc){return this.delegate={iterator:values(iterable),resultName:resultName,nextLoc:nextLoc},"next"===this.method&&(this.arg=void 0),ContinueSentinel}},exports}function aliases_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function aliases_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){aliases_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){aliases_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}var _update,_find,aliases={call:function call(alias){var args=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object.keys(aliases).includes(alias)?aliases[alias](args):display_notice('"nm  '.concat(alias,'" is not a valid command.'))},config:function config(){},save:function save(){settings_save()},find:(_find=aliases_asyncToGenerator(aliases_regeneratorRuntime().mark((function _callee(args){return aliases_regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(/^[a-zA-z\s]+$/g.test(args)){_context.next=2;break}return _context.abrupt("return");case 2:return _context.t0=generateTable,_context.next=5,findRooms(args);case 5:_context.t1=_context.sent,_context.t2=args.toLowerCase(),(0,_context.t0)("displayTable",_context.t1,_context.t2);case 8:case"end":return _context.stop()}}),_callee)}))),function find(_x){return _find.apply(this,arguments)}),area:function area(args){/^[a-zA-z'-\s]+$/g.test(args)&&generateTable("areaTable",findAreas(args),args)},info:function info(){display_notice("Room.Info"),display_printHTML("Name: \t\t".concat(GMCP.Room.Info.name)),display_printHTML("Number: \t\t".concat(GMCP.Room.Info.num)),display_printHTML("Area: \t\t".concat(GMCP.Room.Info.area)),display_printHTML("Area ID: \t\t".concat(GMCP.CurrentArea.id)),display_printHTML("Environment: \t".concat(GMCP.Room.Info.environment)),display_printHTML("Coordinates: \t".concat(GMCP.Room.Info.coords)),display_printHTML("Details: \t\t".concat(GMCP.Room.Info.details))},goto:function goto(args){/^[0-9]+$/g.test(args)?(cy.$(":selected").unselect(),cy.$("#".concat(args)).select()):/^[a-zA-z'-\s]+$/g.test(args)&&walker.goto(args)},mark:function mark(args){/^[a-zA-z\s]+$/g.test(args)&&function addMark(str){if(settings_userPreferences.landmarks.find((function(e){return e.name.toLowerCase()===str.toLowerCase()})))return display_notice('Landmark already exits for "'.concat(str,'". Please remove existing landmark first.')),void generateTable("landmarkTable",[settings_userPreferences.landmarks.find((function(e){return e.name.toLowerCase()===str.toLowerCase()}))],str);var newMark={};newMark.name=str,newMark.roomID=cy.$(".currentRoom").data("id"),settings_userPreferences.landmarks.push(newMark),display_notice('Added landmark "'.concat(str,'"')),settings_save()}(args)},marks:function marks(){generateTable("landmarkTable")},stop:function stop(){walker.stop()},zoom:function zoom(args){/^\d(?:.\d\d?)?$/g.test(args)&&(args>3?cy.zoom(3):args<.2?cy.zoom(.2):cy.zoom(parseFloat(args)))},fit:function fit(){cy.fit()},refresh:function refresh(){styles.refresh()},wormholes:function wormholes(){toggle("useWormholes")},clouds:function clouds(){toggle("useDuanathar"),toggle("useDuanatharan")},walkto:function walkto(){},npc:function npc(text){var qry=text.toLowerCase(),table=function(){var _ref=aliases_asyncToGenerator(aliases_regeneratorRuntime().mark((function _callee2(rr){var re,results;return aliases_regeneratorRuntime().wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return re=new RegExp("".concat(rr),"i"),nexmap_nexmap.mongo.db.collectionName="denizens",_context2.next=4,nexmap_nexmap.mongo.db.aggregate([{$match:{name:re}},{$sort:{name:1,area:1}}]);case 4:results=_context2.sent,generateTable("denizenTable",results,qry);case 6:case"end":return _context2.stop()}}),_callee2)})));return function table(_x2){return _ref.apply(this,arguments)}}();table(qry)},update:(_update=aliases_asyncToGenerator(aliases_regeneratorRuntime().mark((function _callee3(){return aliases_regeneratorRuntime().wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:case"end":return _context3.stop()}}),_callee3)}))),function update(){return _update.apply(this,arguments)})};function nexmap_typeof(obj){return nexmap_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},nexmap_typeof(obj)}function nexmap_regeneratorRuntime(){nexmap_regeneratorRuntime=function _regeneratorRuntime(){return exports};var exports={},Op=Object.prototype,hasOwn=Op.hasOwnProperty,$Symbol="function"==typeof Symbol?Symbol:{},iteratorSymbol=$Symbol.iterator||"@@iterator",asyncIteratorSymbol=$Symbol.asyncIterator||"@@asyncIterator",toStringTagSymbol=$Symbol.toStringTag||"@@toStringTag";function define(obj,key,value){return Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}),obj[key]}try{define({},"")}catch(err){define=function define(obj,key,value){return obj[key]=value}}function wrap(innerFn,outerFn,self,tryLocsList){var protoGenerator=outerFn&&outerFn.prototype instanceof Generator?outerFn:Generator,generator=Object.create(protoGenerator.prototype),context=new Context(tryLocsList||[]);return generator._invoke=function(innerFn,self,context){var state="suspendedStart";return function(method,arg){if("executing"===state)throw new Error("Generator is already running");if("completed"===state){if("throw"===method)throw arg;return doneResult()}for(context.method=method,context.arg=arg;;){var delegate=context.delegate;if(delegate){var delegateResult=maybeInvokeDelegate(delegate,context);if(delegateResult){if(delegateResult===ContinueSentinel)continue;return delegateResult}}if("next"===context.method)context.sent=context._sent=context.arg;else if("throw"===context.method){if("suspendedStart"===state)throw state="completed",context.arg;context.dispatchException(context.arg)}else"return"===context.method&&context.abrupt("return",context.arg);state="executing";var record=tryCatch(innerFn,self,context);if("normal"===record.type){if(state=context.done?"completed":"suspendedYield",record.arg===ContinueSentinel)continue;return{value:record.arg,done:context.done}}"throw"===record.type&&(state="completed",context.method="throw",context.arg=record.arg)}}}(innerFn,self,context),generator}function tryCatch(fn,obj,arg){try{return{type:"normal",arg:fn.call(obj,arg)}}catch(err){return{type:"throw",arg:err}}}exports.wrap=wrap;var ContinueSentinel={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var IteratorPrototype={};define(IteratorPrototype,iteratorSymbol,(function(){return this}));var getProto=Object.getPrototypeOf,NativeIteratorPrototype=getProto&&getProto(getProto(values([])));NativeIteratorPrototype&&NativeIteratorPrototype!==Op&&hasOwn.call(NativeIteratorPrototype,iteratorSymbol)&&(IteratorPrototype=NativeIteratorPrototype);var Gp=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(IteratorPrototype);function defineIteratorMethods(prototype){["next","throw","return"].forEach((function(method){define(prototype,method,(function(arg){return this._invoke(method,arg)}))}))}function AsyncIterator(generator,PromiseImpl){function invoke(method,arg,resolve,reject){var record=tryCatch(generator[method],generator,arg);if("throw"!==record.type){var result=record.arg,value=result.value;return value&&"object"==nexmap_typeof(value)&&hasOwn.call(value,"__await")?PromiseImpl.resolve(value.__await).then((function(value){invoke("next",value,resolve,reject)}),(function(err){invoke("throw",err,resolve,reject)})):PromiseImpl.resolve(value).then((function(unwrapped){result.value=unwrapped,resolve(result)}),(function(error){return invoke("throw",error,resolve,reject)}))}reject(record.arg)}var previousPromise;this._invoke=function(method,arg){function callInvokeWithMethodAndArg(){return new PromiseImpl((function(resolve,reject){invoke(method,arg,resolve,reject)}))}return previousPromise=previousPromise?previousPromise.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}}function maybeInvokeDelegate(delegate,context){var method=delegate.iterator[context.method];if(void 0===method){if(context.delegate=null,"throw"===context.method){if(delegate.iterator.return&&(context.method="return",context.arg=void 0,maybeInvokeDelegate(delegate,context),"throw"===context.method))return ContinueSentinel;context.method="throw",context.arg=new TypeError("The iterator does not provide a 'throw' method")}return ContinueSentinel}var record=tryCatch(method,delegate.iterator,context.arg);if("throw"===record.type)return context.method="throw",context.arg=record.arg,context.delegate=null,ContinueSentinel;var info=record.arg;return info?info.done?(context[delegate.resultName]=info.value,context.next=delegate.nextLoc,"return"!==context.method&&(context.method="next",context.arg=void 0),context.delegate=null,ContinueSentinel):info:(context.method="throw",context.arg=new TypeError("iterator result is not an object"),context.delegate=null,ContinueSentinel)}function pushTryEntry(locs){var entry={tryLoc:locs[0]};1 in locs&&(entry.catchLoc=locs[1]),2 in locs&&(entry.finallyLoc=locs[2],entry.afterLoc=locs[3]),this.tryEntries.push(entry)}function resetTryEntry(entry){var record=entry.completion||{};record.type="normal",delete record.arg,entry.completion=record}function Context(tryLocsList){this.tryEntries=[{tryLoc:"root"}],tryLocsList.forEach(pushTryEntry,this),this.reset(!0)}function values(iterable){if(iterable){var iteratorMethod=iterable[iteratorSymbol];if(iteratorMethod)return iteratorMethod.call(iterable);if("function"==typeof iterable.next)return iterable;if(!isNaN(iterable.length)){var i=-1,next=function next(){for(;++i<iterable.length;)if(hasOwn.call(iterable,i))return next.value=iterable[i],next.done=!1,next;return next.value=void 0,next.done=!0,next};return next.next=next}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,define(Gp,"constructor",GeneratorFunctionPrototype),define(GeneratorFunctionPrototype,"constructor",GeneratorFunction),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,toStringTagSymbol,"GeneratorFunction"),exports.isGeneratorFunction=function(genFun){var ctor="function"==typeof genFun&&genFun.constructor;return!!ctor&&(ctor===GeneratorFunction||"GeneratorFunction"===(ctor.displayName||ctor.name))},exports.mark=function(genFun){return Object.setPrototypeOf?Object.setPrototypeOf(genFun,GeneratorFunctionPrototype):(genFun.__proto__=GeneratorFunctionPrototype,define(genFun,toStringTagSymbol,"GeneratorFunction")),genFun.prototype=Object.create(Gp),genFun},exports.awrap=function(arg){return{__await:arg}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,asyncIteratorSymbol,(function(){return this})),exports.AsyncIterator=AsyncIterator,exports.async=function(innerFn,outerFn,self,tryLocsList,PromiseImpl){void 0===PromiseImpl&&(PromiseImpl=Promise);var iter=new AsyncIterator(wrap(innerFn,outerFn,self,tryLocsList),PromiseImpl);return exports.isGeneratorFunction(outerFn)?iter:iter.next().then((function(result){return result.done?result.value:iter.next()}))},defineIteratorMethods(Gp),define(Gp,toStringTagSymbol,"Generator"),define(Gp,iteratorSymbol,(function(){return this})),define(Gp,"toString",(function(){return"[object Generator]"})),exports.keys=function(object){var keys=[];for(var key in object)keys.push(key);return keys.reverse(),function next(){for(;keys.length;){var key=keys.pop();if(key in object)return next.value=key,next.done=!1,next}return next.done=!0,next}},exports.values=values,Context.prototype={constructor:Context,reset:function reset(skipTempReset){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!skipTempReset)for(var name in this)"t"===name.charAt(0)&&hasOwn.call(this,name)&&!isNaN(+name.slice(1))&&(this[name]=void 0)},stop:function stop(){this.done=!0;var rootRecord=this.tryEntries[0].completion;if("throw"===rootRecord.type)throw rootRecord.arg;return this.rval},dispatchException:function dispatchException(exception){if(this.done)throw exception;var context=this;function handle(loc,caught){return record.type="throw",record.arg=exception,context.next=loc,caught&&(context.method="next",context.arg=void 0),!!caught}for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i],record=entry.completion;if("root"===entry.tryLoc)return handle("end");if(entry.tryLoc<=this.prev){var hasCatch=hasOwn.call(entry,"catchLoc"),hasFinally=hasOwn.call(entry,"finallyLoc");if(hasCatch&&hasFinally){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0);if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}else if(hasCatch){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0)}else{if(!hasFinally)throw new Error("try statement without catch or finally");if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}}}},abrupt:function abrupt(type,arg){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc<=this.prev&&hasOwn.call(entry,"finallyLoc")&&this.prev<entry.finallyLoc){var finallyEntry=entry;break}}finallyEntry&&("break"===type||"continue"===type)&&finallyEntry.tryLoc<=arg&&arg<=finallyEntry.finallyLoc&&(finallyEntry=null);var record=finallyEntry?finallyEntry.completion:{};return record.type=type,record.arg=arg,finallyEntry?(this.method="next",this.next=finallyEntry.finallyLoc,ContinueSentinel):this.complete(record)},complete:function complete(record,afterLoc){if("throw"===record.type)throw record.arg;return"break"===record.type||"continue"===record.type?this.next=record.arg:"return"===record.type?(this.rval=this.arg=record.arg,this.method="return",this.next="end"):"normal"===record.type&&afterLoc&&(this.next=afterLoc),ContinueSentinel},finish:function finish(finallyLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.finallyLoc===finallyLoc)return this.complete(entry.completion,entry.afterLoc),resetTryEntry(entry),ContinueSentinel}},catch:function _catch(tryLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc===tryLoc){var record=entry.completion;if("throw"===record.type){var thrown=record.arg;resetTryEntry(entry)}return thrown}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(iterable,resultName,nextLoc){return this.delegate={iterator:values(iterable),resultName:resultName,nextLoc:nextLoc},"next"===this.method&&(this.arg=void 0),ContinueSentinel}},exports}function nexmap_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}var nexmap_nexmap={version:"3.0.7",nxsVersion:"3.0.7",logging:!1,loggingTime:"",cytoscapeLoaded:!1,mudletMapLoaded:!1,currentRoom:-99,currentArea:-99,currentZ:-99,wormholes:{},sewergrates:{},generateGraph:generateGraph,farseeLocal:farseeLocal,farseeArea:farseeArea,changeRoom:changeRoom,onGMCP:onGMCP,styles:styles,aliases:aliases,mongo:mongo,walker:walker,startup:function startup(){var _document$getElementB;null===(_document$getElementB=document.getElementById("cy"))||void 0===_document$getElementB||_document$getElementB.remove();var nexmapTab=document.getElementById("tbl_nexmap_map");nexmapTab.appendChild(Object.assign(document.createElement("div"),{id:"currentRoomLabel"})),nexmapTab.appendChild(Object.assign(document.createElement("div"),{id:"cy"})),nexmapTab.appendChild(Object.assign(document.createElement("div"),{id:"currentExitsLabel",style:"position:absolute;bottom:0px"})),styles.style(),fetch("https://ire-mudlet-mapping.github.io/AchaeaCrowdmap/Map/map_mini.json").then((function(response){return response.json()})).then(function(){var _ref=function nexmap_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){nexmap_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){nexmap_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}(nexmap_regeneratorRuntime().mark((function _callee(data){var graph;return nexmap_regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,generateGraph(data);case 2:graph=_context.sent,window.cy.add(graph);case 4:case"end":return _context.stop()}}),_callee)})));return function(_x){return _ref.apply(this,arguments)}}()).then((function(){window.cy.mount(document.getElementById("cy")),nexmap_nexmap.changeRoom(6534)}))}};window.nexmap=nexmap_nexmap}()}();