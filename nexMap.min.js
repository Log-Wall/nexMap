"use strict";var cy={},nexMap={version:.997,logging:!1,loggingTime:"",mudmap:{},cytoscapeLoaded:!1,mudletMapLoaded:!1,currentRoom:-99,currentArea:-99,currentZ:-99,shortDirs:{east:"e",west:"w",south:"s",north:"n",northeast:"ne",northwest:"nw",southeast:"se",southeastst:"se",southwest:"sw",in:"in",out:"out",down:"d",up:"up"},findRoom:function(e){nexMap.logging&&console.log(`nexMap: nexMap.findRoom(${e})`);let n=nexMap.mudmap.areas.find(n=>n.rooms.find(n=>n.id==e));if(void 0===n)return console.log(`Area ${e} not mapped`),!1;let t=n.rooms.find(n=>n.id==e);return nexMap.logging&&console.log(t),!0},findRooms:function(e){nexMap.logging&&console.log(`nexMap: nexMap.findRoom(${e})`);let n=cy.nodes().filter(n=>{if(n.data("name")&&n.data("name").toLowerCase().includes(e.trim().toLowerCase()))return!0});return void 0===n?(console.log(`Rooms matching ${e} not found.`),!1):n},findArea:function(e){let n=nexMap.mudmap.areas.find(n=>n.rooms.find(n=>{var t,o;return null==n?void 0:null===(t=n.userData)||void 0===t?void 0:null===(o=t["Game Area"])||void 0===o?void 0:o.toLowerCase().includes(e.toLowerCase())}));return void 0===n?(console.log("Area not found"),!1):n},changeRoom:function(e){if(nexMap.logging&&console.log(`nexMap: nexMap.changeRoom(${e})`),!nexMap.findRoom(e))return;let n=cy.$id(e);cy.startBatch(),cy.$(".currentRoom").removeClass("currentRoom"),n.addClass("currentRoom"),cy.endBatch(),nexMap.currentRoom=e,$("#currentRoomLabel").text(`${n.data("areaName")}: ${n.data("name")}`),$("#currentExitsLabel").text(`Exits: ${n.data("exits").join(", ")}`),nexMap.changeArea(cy.$id(e).data().area,cy.$id(e).position().z),cy.center(".currentRoom")},changeArea:function(e,n,t=!1){if(nexMap.logging&&console.log(`nexMap: nexMap.changeArea(${e} ${n})`),e==nexMap.currentArea&&n==nexMap.currentZ&&!t)return void console.log("area return");nexMap.currentArea=e,nexMap.currentZ=n,cy.startBatch(),cy.$(".areaDisplay").removeClass("areaDisplay"),cy.$(".pseudo").remove(),cy.nodes().filter(e=>e.data("area")==nexMap.currentArea&&e.data("z")==nexMap.currentZ).addClass("areaDisplay"),nexMap.generateExits(),cy.center(nexMap.currentRoom),cy.endBatch()},fit:function(){cy.fit()},generateExits:function(){nexMap.logging&&console.log("nexMap: nexMap.generateExits()");let e=0,n=function(n,t,o){let a={...n};"s"==t?a.y+=20:"n"==t?a.y+=-20:"e"==t?a.x+=20:"w"==t?a.x+=-20:"se"==t?(a.x+=20,a.y+=20):"sw"==t?(a.x+=-20,a.y+=20):"ne"==t?(a.x+=20,a.y+=-20):"nw"==t&&(a.x+=-20,a.y+=-20);let r={group:"nodes",data:{id:`pseudo${e}`},position:{x:a.x,y:a.y,z:a.z},classes:["pseudo",o?"areaAdjacent":`pseudo-${t}`]};cy.add(r),o&&cy.add({group:"edges",data:{id:`pseudoE${e}`,source:o,target:r.data.id},classes:["pseudo","areaAdjacentExit"]}),e++},t=cy.edges().filter(e=>e.data("area")==nexMap.currentArea&&e.data("z")==nexMap.currentZ);t.filter(e=>["up","d","in","out"].includes(e.data("command"))).forEach(e=>n(e.source().position(),e.data("command")));let o=t.filter(e=>["s","n","e","w","ne","nw","se","sw"].includes(e.data("command")));(o=o.filter(e=>e.target().data("area")!=nexMap.currentArea||e.target().data("z")!=nexMap.currentZ)).forEach(e=>n(e.source().position(),e.data("command"),e.data("source")))},generateGraph:async function(){return nexMap.logging&&console.log("nexMap: nexMap.generateGraph()"),new Promise((e,n)=>{cy.startBatch();let t=[];nexMap.mudmap.areas.forEach(e=>{e.roomCount&&e.rooms.forEach(n=>{var o;let a=[];n.exits.forEach(e=>a.push(nexMap.shortDirs[e.name]?nexMap.shortDirs[e.name]:e.name));let r={group:"nodes",data:{id:n.id,area:e.id,areaName:e.name,environment:n.environment,name:n.name,userData:n.userData,z:n.coordinates[2],exits:a,symbol:!!n.symbol&&n.symbol},position:{x:20*n.coordinates[0],y:-20*n.coordinates[1],z:n.coordinates[2]},classes:[`environment${n.environment}`],locked:!0};null!=n&&null!==(o=n.symbol)&&void 0!==o&&o.text&&["S","F","G","C","N","M","$","L","H","W","A","P","B"].includes(n.symbol.text)&&(r.data.image=nexMap.styles.generateSVG(n.symbol.text)),a.includes("worm warp")&&r.classes.push("wormholeRoom"),t.push(r)})}),nexMap.mudmap.areas.forEach(e=>{e.roomCount&&e.rooms.forEach(n=>{n.exits.forEach(o=>{let a,r=nexMap.shortDirs[o.name]?nexMap.shortDirs[o.name]:o.name;0==cy.$(`#${n.id}-${o.exitId}`).length&&((a={group:"edges",data:{id:`${n.id}-${o.exitId}`,source:n.id,target:o.exitId,weight:1,area:e.id,command:r,door:!!o.door&&o.door,z:n.coordinates[2]},classes:[]}).data.door&&a.classes.push("doorexit"),"in"==r?a.classes.push("inexit"):"out"==r?a.classes.push("outexit"):"up"==r?a.classes.push("upexit"):"d"==r?a.classes.push("downexit"):"worm warp"==r?a.classes.push("wormhole"):"enter grate"==r&&a.classes.push("sewergrate"),t.push(a))})})}),cy.add(t),cy.$(".wormhole").data({weight:nexMap.settings.userPreferences.useWormholes?1:100}),cy.endBatch(),console.log("nexMap: Graph model created."),e()})},loadDependencies:async function(){nexMap.logging&&console.log("nexMap: nexMap.loadDependencies()");let e=function(n){let t;if(null==n||"object"!=typeof n)return n;if(n instanceof String)return(" "+n).slice(1);if(n instanceof Date)return(t=new Date).setTime(n.getTime()),t;if(n instanceof Array){t=[];for(var o=0,a=n.length;o<a;o++)t[o]=e(n[o]);return t}if(n instanceof Object){for(var r in t={},n)n.hasOwnProperty(r)&&(t[r]=e(n[r]));return t}throw new Error("Unable to copy object! Type not supported.")};return function(){$("body").on("restoreMap",function(e,n){console.log(n),window.Map=n,$("body").off("restoreMap")});let n=document.createElement("iframe");n.width=0,n.height=0,n.src="about:blank",n.onload=function(){$("body").trigger("restoreMap",[e(n.contentWindow.Map)]),document.body.removeChild(n)},document.body.appendChild(n)}(),await Promise.all([async function(){return new Promise((e,n)=>{let t="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.18.2/cytoscape.min.js",o=document.getElementsByTagName("head")[0],a=document.createElement("script");a.src=t+"?"+Math.random(),a.onload=(()=>{console.log("Loaded "+t+"."),nexMap.cytoscapeLoaded=!0,e()}),a.onerror=(()=>{console.log("Unable to load "+t+"."),n()}),o.appendChild(a)})}(),async function(){return new Promise((e,n)=>{$.ajax({async:!0,global:!1,url:"https://cdn.jsdelivr.net/gh/Log-Wall/nexMap/mudletmap-min.json",dataType:"json",success:function(e){nexMap.mudmap=e,nexMap.mudletMapLoaded=!0},complete:()=>{nexMap.mudletMapLoaded&&e(),console.log("nexMap: mudlet JSON map loaded.")},error:()=>{n()}})})}()]),!0},initializeGraph:function(){nexMap.logging&&console.log("nexMap: nexMap.initializeGraph()"),$("#cy").length&&$("#cy").remove(),$("<div></div>",{id:"currentRoomLabel"}).appendTo("#tbl_nexmap_map"),$("<div></div>",{id:"cy"}).appendTo("#tbl_nexmap_map"),$("<div></div>",{style:"position:absolute;bottom:0px",id:"currentExitsLabel"}).appendTo("#tbl_nexmap_map"),cy=cytoscape({container:document.getElementById("cy"),layout:"grid",style:nexMap.styles.stylesheet,zoom:1,minZoom:.25,maxZoom:3,boxSelectionEnabled:!1,selectionType:"single",hideEdgesOnViewport:!0,textureOnViewport:!0,motionBlur:!0,pixelRatio:"auto"})},startUp:function(){nexMap.logging&&console.log("nexMap: nexMap.startUp()"),nexMap.loggingTime=new Date,run_function("nexMap.settings",{},"nexmap"),nexMap.logging&&console.log(`${(new Date-nexMap.loggingTime)/1e3}s`),run_function("nexMap.display",{},"nexmap"),nexMap.logging&&console.log(`${(new Date-nexMap.loggingTime)/1e3}s`),nexMap.display.notice("Loading mapper modules. May take up to 10 seconds."),nexMap.logging&&console.log(`${(new Date-nexMap.loggingTime)/1e3}s`),nexMap.loadDependencies().then(()=>{nexMap.logging&&console.log(`${(new Date-nexMap.loggingTime)/1e3}s`),nexMap.initializeGraph(),nexMap.logging&&console.log(`${(new Date-nexMap.loggingTime)/1e3}s`),nexMap.generateGraph().then(()=>{nexMap.logging&&console.log(`${(new Date-nexMap.loggingTime)/1e3}s`),run_function("nexMap.styles",{},"nexmap"),nexMap.logging&&console.log(`${(new Date-nexMap.loggingTime)/1e3}s`),run_function("nexMap.walker",{},"nexmap"),nexMap.logging&&console.log(`${(new Date-nexMap.loggingTime)/1e3}s`),nexMap.styles.style(),nexMap.logging&&console.log(`${(new Date-nexMap.loggingTime)/1e3}s`),client.send_direct("ql"),nexMap.display.notice(`Mapper loaded and ready for use. (${(new Date-nexMap.loggingTime)/1e3}s)`),nexMap.display.notice('Use "nm" for summary of user commands')})})},settings:{}};nexMap.settings.userPreferences=get_variable("nexMapConfigs")||{commandSeparator:"\\",useDuanathar:!1,useDuanatharan:!1,duanatharCommand:"say duanathar",duanatharanCommand:"say duanatharan",useWormholes:!1,vibratingStick:!1,displayWormholes:!1},nexMap.settings.save=function(){set_variable("nexMapConfigs",nexMap.settings.userPreferences),set_variable("nexMapStyles",nexMap.styles.userPreferences)},nexMap.settings.toggle=function(e){nexMap.settings.userPreferences[e]?nexMap.settings.userPreferences[e]=!1:nexMap.settings.userPreferences[e]=!0,["displayWormholes","useWormholes"].includes(e)&&cy.$(".wormhole").style({visibility:nexMap.settings.userPreferences.displayWormholes?"visible":"hidden",width:1}).data({weight:nexMap.settings.userPreferences.useWormholes?1:100}),nexMap.settings.save()},nexMap.styles={},nexMap.styles.userPreferences=get_variable("nexMapStyles")||{nodeShape:"rectangle",currentRoomShape:"star",currentRoomColor:"#ff1493"},nexMap.styles.style=function(){nexMap.logging&&console.log("nexMap: nexMap.style()"),$("#cy").css({id:"cy","background-image":" url(/includes/images/windows/map-background.jpg)",width:"100%",height:"calc(100% - 44px)",position:"absolute",overflow:"hidden",top:"0px",left:"0px","margin-top":"22px","margin-bottom":"22px"}),cy.on("mouseout","node",e=>{e.target.removeClass("displayLabel")}),cy.on("mouseover","node",e=>{e.target.flashClass("displayLabel",3e3)}),cy.on("zoom",e=>{cy.style().selector(".displayLabel").style({"font-size":`${12/cy.zoom()}pt`})}),cy.on("unselect","node",e=>{nexMap.walker.stop()}),cy.on("select","node",e=>{nexMap.walker.speedWalk()}),cy.endBatch();!function(){$(".client_nexmap-rules").length&&$(".client_nexmap-rules").remove();let e='.nexswitch {position: relative;display: inline-block;width: 38px;height: 22px;}.nexswitch input {opacity: 0;width: 0;height: 0;}.nexslider {position: absolute;cursor: pointer;top: 0;left: 0;right: 0;bottom: 0;background-color: #555555;-webkit-transition: .4s;transition: .4s;border-radius: 24px;}.nexslider:before {position: absolute;content: "";height: 16px;width: 16px;left: 3px;bottom: 3px;background-color: white;-webkit-transition: .4s;transition: .4s;border-radius: 50%;}input:checked + .nexslider {background-color: #2196F3;}input:focus + .nexslider {box-shadow: 0 0 1px #2196F3;}input:checked + .nexslider:before {-webkit-transform: translateX(16px);-ms-transform: translateX(16px);transform: translateX(16px);}.nexcontainer   { display: flex; }.nexfixed    { width: 200px; }.nexflex-item    { flex-grow: 1; }';var n;"standard"!=client.css_style&&(e+='#tab_nexmap_map::before {content: "\\f262";}'),n=e,$("body").append('<div class="client_nexmap-rules">&shy;<style>'+n+"</style></div>")}()},nexMap.styles.generateSVG=function(e){let n=$('<svg width="11" height="11" viewBox="0 0 11 11" version="1.1"  xmlns="http://www.w3.org/2000/svg"></svg>');return $("<text></text>",{x:"2",y:"8",fill:"black","font-family":"Arial, monospace",style:"font-size:8px;text-align:center;font-weight:bold"}).text(e).appendTo(n),encodeURI("data:image/svg+xml;utf-8,"+n[0].outerHTML)},nexMap.styles.stylesheet=[{selector:"node",style:{shape:"rectangle",width:"10",height:"10","border-color":"black","border-width":"0.5",display:"none"}},{selector:"edge",style:{width:"1","line-color":"grey"}},{selector:"[image]",style:{"background-image":"data(image)","background-fit":"contain","background-width":"100%","background-height":"100%"}},{selector:".displayLabel",style:{color:"white",label:"data(id)"}},{selector:".areaDisplay",style:{display:"element"}},{selector:".areaAdjacent",style:{visibility:"hidden",display:"element"}},{selector:".wormhole",style:{visibility:nexMap.settings.userPreferences.displayWormholes?"visible":"hidden",width:"1","line-style":"dashed","line-dash-pattern":[5,10],"line-color":"#8d32a8"}},{selector:".sewergrate",style:{visibility:"hidden"}},{selector:".downexit",style:{visibility:"hidden","curve-style":"bezier","source-arrow-shape":"triangle"}},{selector:".upexit",style:{visibility:"hidden","curve-style":"bezier","source-arrow-shape":"triangle"}},{selector:".inexit",style:{visibility:"hidden","curve-style":"bezier","source-arrow-shape":"circle"}},{selector:".outexit",style:{visibility:"hidden","curve-style":"bezier","source-arrow-shape":"circle"}},{selector:".doorexit",style:{"curve-style":"straight","mid-source-arrow-shape":"tee","mid-target-arrow-shape":"tee","arrow-scale":.65}},{selector:".pseudo-d",style:{display:"element",label:"",shape:"polygon","shape-polygon-points":"-0.6 -0.7 0.6 -0.7 0 -0.1","background-color":"rgb(255,255,255)","border-color":"rgb(0,0,0)","border-width":"0.5px"}},{selector:".pseudo-up",style:{display:"element",label:"",shape:"polygon","shape-polygon-points":"0.6 0.7 -0.6 0.7 0 0.1","background-color":"rgb(255,255,255)","border-color":"rgb(0,0,0)","border-width":"0.5px"}},{selector:".pseudo-in",style:{display:"element",label:"",shape:"polygon","shape-polygon-points":"0.7 -0.6 0.7 0.6 0.1 0","background-color":"rgb(255,255,255)","border-color":"rgb(0,0,0)","border-width":"0.5px"}},{selector:".pseudo-out",style:{display:"element",label:"",shape:"polygon","shape-polygon-points":"-0.7 0.6 -0.7 -0.6 -0.1 0","background-color":"rgb(255,255,255)","border-color":"rgb(0,0,0)","border-width":"0.5px"}},{selector:".areaAdjacentExit",style:{display:"element","curve-style":"straight","arrow-scale":"0.75","target-arrow-shape":"vee"}},{selector:".environment2",style:{"background-color":"rgb(128,115,95)"}},{selector:".environment3",style:{"background-color":"rgb(118,81,22)"}},{selector:".environment4",style:{"background-color":"rgb(54,102,46)"}},{selector:".environment5",style:{"background-color":"rgb(255,255,204)"}},{selector:".environment6",style:{"background-color":"rgb(249,253,0)"}},{selector:".environment7",style:{"background-color":"rgb(29,199,19)"}},{selector:".environment8",style:{"background-color":"rgb(189,160,203)"}},{selector:".environment9",style:{"background-color":"rgb(45,119,32)"}},{selector:".environment10",style:{"background-color":"rgb(0,221,255)"}},{selector:".environment11",style:{"background-color":"rgb(131,119,102)"}},{selector:".environment12",style:{"background-color":"rgb(124,124,124)"}},{selector:".environment13",style:{"background-color":"rgb(65,171,47)"}},{selector:".environment14",style:{"background-color":"rgb(88,74,52)"}},{selector:".environment15",style:{"background-color":"rgb(118,132,60)"}},{selector:".environment16",style:{"background-color":"rgb(197,252,255)"}},{selector:".environment17",style:{"background-color":"rgb(137,225,75)"}},{selector:".environment18",style:{"background-color":"rgb(171,158,109)"}},{selector:".environment19",style:{"background-color":"rgb(86,165,116)"}},{selector:".environment20",style:{"background-color":"rgb(0,0,255)"}},{selector:".environment21",style:{"background-color":"rgb(148,228,93)"}},{selector:".environment22",style:{"background-color":"rgb(95,240,240)"}},{selector:".environment23",style:{"background-color":"rgb(145,128,16)"}},{selector:".environment24",style:{"background-color":"rgb(0,51,102)"}},{selector:".environment25",style:{"background-color":"rgb(249,129,103)"}},{selector:".environment27",style:{"background-color":"rgb(255,255,255)"}},{selector:".environment28",style:{"background-color":"rgb(0,227,66)"}},{selector:".environment29",style:{"background-color":"rgb(153,0,0)"}},{selector:".environment30",style:{"background-color":"rgb(77,66,212)"}},{selector:".environment31",style:{"background-color":"rgb(221,68,0)"}},{selector:".environment32",style:{"background-color":"rgb(221,186,130)"}},{selector:".environment33",style:{"background-color":"rgb(131,119,102)"}},{selector:".environment34",style:{"background-color":"rgb(0,0,255)"}},{selector:".environment35",style:{"background-color":"rgb(255,255,255)"}},{selector:".environment36",style:{"background-color":"rgb(145,128,16)"}},{selector:".environment39",style:{"background-color":"rgb(145,128,16)"}},{selector:".environment40",style:{"background-color":"rgb(192,192,192)"}},{selector:".environment41",style:{"background-color":"rgb(192,192,192)"}},{selector:".environment42",style:{"background-color":"rgb(207,16,32)"}},{selector:".environment43",style:{"background-color":"rgb(0,112,31)"}},{selector:".environment48",style:{"background-color":"rgb(249,129,103)"}},{selector:".environment257",style:{"background-color":"rgb(128,0,0)"}},{selector:".environment258",style:{"background-color":"rgb(0,128,0)"}},{selector:".environment259",style:{"background-color":"rgb(128,128,0)"}},{selector:".environment260",style:{"background-color":"rgb(0,0,128)"}},{selector:".environment261",style:{"background-color":"rgb(128,0,128)"}},{selector:".environment262",style:{"background-color":"rgb(0,128,128)"}},{selector:".environment263",style:{"background-color":"rgb(192,192,192)"}},{selector:".environment264",style:{"background-color":"rgb(70,70,70)"}},{selector:".environment265",style:{"background-color":"rgb(255,0,0)"}},{selector:".environment266",style:{"background-color":"rgb(0,255,0)"}},{selector:".environment267",style:{"background-color":"rgb(255,255,0)"}},{selector:".environment268",style:{"background-color":"rgb(0,0,255)"}},{selector:".environment269",style:{"background-color":"rgb(255,0,255)"}},{selector:".environment270",style:{"background-color":"rgb(0,255,255)"}},{selector:".environment271",style:{"background-color":"rgb(255,255,255)"}},{selector:".environment272",style:{"background-color":"rgb(128,128,128)"}},{selector:":selected",style:{"background-color":"rgb(0,128,0)"}},{selector:".currentRoom",style:{height:"12px",width:"12px",shape:"star","border-color":"rgb(88,233,231)","border-width":"2px"}}],nexMap.styles.refresh=function(){console.log(typeof cy.umount),"function"==typeof cy.unmount?(cy.unmount(),cy.mount($("#cy")),nexMap.changeArea(nexMap.currentArea,nexMap.currentZ,!0)):nexMap.display.notice('nexMap not loaded. Please run "nm load".')},nexMap.walker={pathing:!1,pathRooms:[],pathCommands:[],pathRawCommands:[],pathRawRooms:[],delay:!1,destination:0,antiWingAreas:[44],stepCommand:"",clientEcho:client.echo_input},nexMap.walker.speedWalk=function(e,n){nexMap.logging&&console.log("nexMap: nexMap.walker.speedwalk()"),nexMap.walker.pathingStartTime=new Date,client.echo_input=!1,nexMap.walker.determinePath(e,n),nexMap.walker.step()},nexMap.walker.step=function(){let e=nexMap.walker;if(nexMap.logging&&console.log("nexMap: nexMap.walker.step()"),0==e.pathCommands.length)return void(nexMap.logging&&console.log("nexMap: nexMap.walker.step RETURN"));let n=e.pathRooms.indexOf(GMCP.Room.Info.num);if(GMCP.Room.Info.num==e.destination)return e.pathing=!1,e.reset(),void nexMap.display.notice(`Pathing complete. ${(new Date-e.pathingStartTime)/1e3}s`);e.pathRooms.includes(GMCP.Room.Info.num.toString())&&(e.pathing=!0,e.stepCommand=e.pathCommands[n]),send_direct(`path stop${nexMap.settings.userPreferences.commandSeparator}${e.stepCommand}`)},nexMap.walker.determinePath=function(e,n){nexMap.logging&&console.log(`nexMap: nexMap.walker.determinePath(${e}, ${n})`);let t=e||cy.$(".currentRoom").data("id"),o=n||cy.$(":selected").data("id"),a=nexMap.walker;a.destination=o,a.pathRooms=[],a.pathCommands=[];let r=cy.elements().aStar({root:`#${cy.$id(t).data("id")}`,goal:`#${cy.$id(o).data("id")}`,weight:function(e){return e.data("weight")},directed:!0});if(r.found)return r.path.nodes().forEach(e=>a.pathRooms.push(e.data("id"))),r.path.edges().forEach(e=>a.pathCommands.push(e.data("command"))),a.checkClouds(r,o),a.pathRawCommands=[...a.pathCommands],a.pathRawRooms=[...a.pathRooms],a.hybridPath(),{path:nexMap.walker.pathCommands,rawPath:nexMap.walker.pathRawCommands};nexMap.display.notice(`No path to ${o} found.`)},nexMap.walker.checkClouds=function(e,n){if(nexMap.logging&&console.log("nexMap: nexMap.walker.checkClouds()"),!nexMap.settings.userPreferences.useDuanathar&&!nexMap.settings.userPreferences.useDuanatharan)return;let t,o=nexMap.walker,a=e.path.nodes().find(e=>"y"!=e.data().userData.indoors&&!o.antiWingAreas.includes(e.data("area"))),r=a?a.data("id"):0;if(0==r)return;let s=cy.elements().aStar({root:`#${cy.$id(3885).data("id")}`,goal:`#${cy.$id(n).data("id")}`,weight:function(e){return e.data("weight")},directed:!0});nexMap.settings.userPreferences.useDuanatharan&&(t=cy.elements().aStar({root:`#${cy.$id(4882).data("id")}`,goal:`#${cy.$id(n).data("id")}`,weight:function(e){return e.data("weight")},directed:!0}));let l=function(n,t){e.distance>o.pathRooms.indexOf(r)+n.distance&&(o.pathRooms.splice(o.pathRooms.indexOf(r)+1),o.pathCommands.splice(o.pathRooms.indexOf(r)),o.pathCommands.push(t),n.path.nodes().forEach(e=>o.pathRooms.push(e.data("id"))),n.path.edges().forEach(e=>o.pathCommands.push(e.data("command"))))};t&&s.distance>t.distance?l(t,nexMap.settings.userPreferences.duanatharanCommand):l(s,nexMap.settings.userPreferences.duanatharCommand)},nexMap.walker.hybridPath=function(){nexMap.logging&&console.log("nexMap: nexMap.walker.hybridPath()");let e=nexMap.walker.pathCommands,n=nexMap.walker.pathRooms;nexMap.logging&&console.log(e),nexMap.logging&&console.log(n);let t=[],o=[n[0]];e.forEach((e,a)=>{0!=a||Object.values(nexMap.shortDirs).includes(e)?Object.values(nexMap.shortDirs).includes(e)||(o.push(n[a]),o.push(n[a+1]),t.push(`path track ${n[a]}`),t.push(e)):(o.push(n[a+1]),t.push(e))}),Object.values(nexMap.shortDirs).includes(e[e.length-1])&&(o.push(n[n.length-1]),t.push(`path track ${n[n.length-1]}`)),nexMap.logging&&console.log(t),nexMap.logging&&console.log(o),nexMap.walker.pathCommands=[...t],nexMap.walker.pathRooms=[...o]},nexMap.walker.reset=function(){nexMap.logging&&console.log("nexMap: nexMap.walker.reset()"),nexMap.walker.pathing=!1,cy.$(":selected").unselect(),nexMap.walker.pathCommands=[],nexMap.walker.pathRooms=[],nexMap.walker.destination=0,client.echo_input=nexMap.walker.clientEcho},nexMap.walker.stop=function(){nexMap.logging&&console.log("nexMap: nexMap.walker.stop()"),!0===nexMap.walker.pathing&&(nexMap.walker.reset(),nexMap.display.notice("Pathing canceled"))},nexMap.display={pageBreak:20,pageIndex:0,displayCap:{},displayClick:"",displayEntries:{}},nexMap.display.notice=function(e,n=!1){let t=$("<span></span>",{class:"mono"});$("<span></span>",{style:"color:DodgerBlue"}).text("[-").appendTo(t),$("<span></span>",{style:"color:OrangeRed"}).text("nexMap").appendTo(t),$("<span></span>",{style:"color:DodgerBlue"}).text("-] ").appendTo(t),n?e.appendTo(t):$("<span></span>",{style:"color:GoldenRod"}).text(e).appendTo(t),print(t[0].outerHTML)},nexMap.display.generateTable=function(e,n){nexMap.display.pageIndex=0,nexMap.display.displayEntries=e,nexMap.display.displayCap=n,nexMap.display.displayTable()},nexMap.display.click=function(e){cy.$(":selected").unselect(),cy.$(`#${e}`).select()},nexMap.display.displayTable=function(){let e=nexMap.display.displayEntries,n=(nexMap.display.displayCap,$("<table></table>",{class:"mono",style:"max-width:100%;border:1px solid white;border-spacing:0px"}));if(0==nexMap.display.pageIndex){let e=$("<caption></caption>",{style:"text-align:left"}).appendTo(n);$("<span></span>",{style:"color:DodgerBlue"}).text("[-").appendTo(e),$("<span></span>",{style:"color:OrangeRed"}).text("nexMap").appendTo(e),$("<span></span>",{style:"color:DodgerBlue"}).text("-] ").appendTo(e),$("<span></span>",{style:"color:GoldenRod"}).text("Displaying matches for ").appendTo(e),$("<span></span>",{style:"font-weight:bold;color:LawnGreen"}).text(nexMap.display.displayCap).appendTo(e);let t=$("<tr></tr>",{style:"text-align:left;color:Ivory"}).appendTo(n);$("<th></th>",{style:"width:5em"}).text("Num").appendTo(t),$("<th></th>",{style:"width:auto"}).text("Name").appendTo(t),$("<th></th>",{style:"width:auto"}).text("Area").appendTo(t)}else{let e=$("<tr></tr>",{style:"text-align:left;color:Ivory"}).appendTo(n);$("<th></th>",{style:"width:5em"}).text("").appendTo(e),$("<th></th>",{style:"width:auto"}).text("").appendTo(e),$("<th></th>",{style:"width:auto"}).text("").appendTo(e)}let t,o=nexMap.display.pageIndex>0?nexMap.display.pageIndex*nexMap.display.pageBreak:0;for(let t=o;t<e.length&&t<o+nexMap.display.pageBreak;t++){let o=$("<tr></tr>",{style:"cursor:pointer;color:dimgrey;"}).appendTo(n);$("<td></td>",{style:"color:grey",onclick:`nexMap.display.click(${JSON.stringify(e[t].data("id"))});`}).text(e[t].data("id")).appendTo(o),$("<td></td>",{style:"color:gainsboro;text-decoration:underline",onclick:`nexMap.display.click(${JSON.stringify(e[t].data("id"))});`}).text(e[t].data("name")).appendTo(o),$("<td></td>",{onclick:`nexMap.display.click(${JSON.stringify(e[t].data("id"))});`}).text(e[t].data("areaName")).appendTo(o)}print(n[0].outerHTML),Math.ceil(nexMap.display.displayEntries.length/nexMap.display.pageBreak)>nexMap.display.pageIndex+1?(t=$("<span></span>",{style:"color:Goldenrod"}).text(`Displaying ${o+nexMap.display.pageBreak} of ${nexMap.display.displayEntries.length}.`),nexMap.display.pageIndex++,$("<span></span>",{style:"color:Goldenrod"}).text(" Click for ").appendTo(t),$("<a></a>",{style:"cursor:pointer;color:Ivory;text-decoration:underline;",onclick:"nexMap.display.displayTable()"}).text("MORE").appendTo(t)):t=$("<span></span>",{style:"color:Goldenrod"}).text(`Displaying ${nexMap.display.displayEntries.length} of ${nexMap.display.displayEntries.length}.`),print(t[0].outerHTML)},nexMap.display.userCommands=function(){let e={0:{cmd:"nm load",txt:"Initial load of the map. There are a few seconds of degraded performance while the full model is loaded."},1:{cmd:"nm config",txt:"Display all user configuration options."},2:{cmd:"nm save",txt:"Saves the current user configuration settings."},3:{cmd:"nm find <phrase>",txt:"Replaces the functionality of the mapdb package. Displays all rooms matching the phrase. Clicking any entry on the table will begin pathing."},4:{cmd:"nm goto <id>",txt:"Calculates the most efficient path to the target room. Will use wings/wormholes/dash/gallop if enabled by the user in settings."},5:{cmd:"nm stop",txt:"Cancels the current pathing."},6:{cmd:"nm zoom",txt:"Manual zoom control of the map. Accepts values between 0.2 - 3.0"},7:{cmd:"nm refresh",txt:"Refresh the graphical display of the map. Fail safe for display issues."},8:{cmd:"nm update",txt:"Attempt to load the latest version of nexMap without regenerating the entire map."},9:{cmd:"nm wormholes",txt:"Toggles the use of wormholes for pathing."},10:{cmd:"nm clouds",txt:"Toggles the use of clouds, both high and low, for pathing."},11:{cmd:"(map)",txt:"Selecting any room on the map via mouse click will speedwalk to the selected room."},12:{cmd:"(map)",txt:"A mouse click on the map anywhere other than a room will unselect the current selection and stop any active pathing."}},n=$("<table></table>",{class:"mono",style:"max-width:100%;border:1px solid white;border-spacing:0px"}),t=$("<tr></tr>",{style:"text-align:left;color:Ivory"}).appendTo(n);$("<th></th>",{style:"width:10em"}).text("Command").appendTo(t),$("<th></th>",{style:"width:auto"}).text("Summary").appendTo(t);for(let t in e){console.log(t);let o=$("<tr></tr>",{style:"color:dimgrey;border-top: 1px solid white;border-bottom: 1px solid white;"}).appendTo(n);$("<td></td>",{style:"color:grey"}).text(e[t].cmd).appendTo(o),$("<td></td>",{style:"color:gainsboro;"}).text(e[t].txt).appendTo(o)}nexMap.display.notice("Aliases for user interaction"),print(n[0].outerHTML)},nexMap.display.configDialog=function(){let e=$("<div></div>",{id:"nexMapDialog"});$("<div></div>").appendTo(e);let n=$("<table></table>",{class:"mono nexInput",style:"max-width:100%;border-spacing:4x;vertical-align:center"}),t=$("<tr></tr>",{style:"text-align:left;color:Ivory"}).appendTo(n);$("<th></th>",{style:"width:auto"}).text("Option").appendTo(t),$("<th></th>",{style:"width:auto"}).text("Setting").appendTo(t);let o=[{name:"Wormholes",setting:"useWormholes"},{name:"Show Wormholes",setting:"displayWormholes"},{name:"Vibrating Stick",setting:"vibratingStick"},{name:"Low Clouds",setting:"useDuanathar"},{name:"High Clouds",setting:"useDuanatharan"}];for(let e=0;e<o.length;e++){let t=$("<label></label>",{class:"nexswitch nexInput"});$("<input></input>",{type:"checkbox",class:"nexbox nexInput"}).prop("checked",nexMap.settings.userPreferences[o[e].setting]).on("change",function(){nexMap.settings.toggle(o[e].setting)}).appendTo(t),$("<span></span>",{class:"nexslider nexInput"}).appendTo(t);let a=$("<tr></tr>",{class:"nexRow",style:"cursor:pointer;color:dimgrey;"}).appendTo(n);$("<td></td>",{style:"color:grey"}).text(o[e].name).appendTo(a),$("<td></td>",{style:"color:gainsboro;text-decoration:underline"}).append(t).appendTo(a)}let a=$("<input></input>",{type:"text",class:"nexInput",id:"nexCommandSep",maxlength:1,width:24,value:nexMap.settings.userPreferences.commandSeparator}),r=$("<tr></tr>",{class:"nexRow",style:"cursor:pointer;color:dimgrey;"}).appendTo(n);$("<td></td>",{style:"color:grey"}).text("Command Separator").appendTo(r),$("<td></td>",{style:"color:gainsboro;text-decoration:underline"}).append(a).appendTo(r);let s=$("<input></input>",{type:"text",class:"nexInput",id:"nexDuanathar",width:150,value:nexMap.settings.userPreferences.duanatharCommand}),l=$("<tr></tr>",{class:"nexRow",style:"cursor:pointer;color:dimgrey;"}).appendTo(n);$("<td></td>",{style:"color:grey"}).text("Low Clouds Command(s)").appendTo(l),$("<td></td>",{style:"color:gainsboro;text-decoration:underline"}).append(s).appendTo(l);let i=$("<input></input>",{type:"text",class:"nexInput",id:"nexDuanatharan",width:150,value:nexMap.settings.userPreferences.duanatharanCommand}),p=$("<tr></tr>",{class:"nexRow",style:"cursor:pointer;color:dimgrey;"}).appendTo(n);$("<td></td>",{style:"color:grey"}).text("High Clouds Command(s)").appendTo(p),$("<td></td>",{style:"color:gainsboro;text-decoration:underline"}).append(i).appendTo(p);let d=$("<select></select>",{class:"nexInput",id:"nexPlayerShape",height:"auto",width:"auto"}).on("change",function(){nexMap.styles.userPreferences.currentRoomShape=$(this)[0].value,cy.style().selector(".currentRoom").style({shape:$(this)[0].value}).update()});$("<option></option>",{value:"rectangle",text:"Rectangle"}).prop("selected","rectangle"==nexMap.styles.userPreferences.currentRoomShape).appendTo(d),$("<option></option>",{value:"ellipse",text:"Circle"}).prop("selected","ellipse"==nexMap.styles.userPreferences.currentRoomShape).appendTo(d),$("<option></option>",{value:"diamond",text:"Diamond"}).prop("selected","diamond"==nexMap.styles.userPreferences.currentRoomShape).appendTo(d),$("<option></option>",{value:"star",text:"Star"}).prop("selected","star"==nexMap.styles.userPreferences.currentRoomShape).appendTo(d),$("<option></option>",{value:"vee",text:"Vee"}).prop("selected","vee"==nexMap.styles.userPreferences.currentRoomShape).appendTo(d);let c=$("<tr></tr>",{class:"nexRow",style:"cursor:pointer;color:dimgrey;"}).appendTo(n);$("<td></td>",{style:"color:grey"}).text("Current room shape").appendTo(c),$("<td></td>",{style:"color:gainsboro;text-decoration:underline"}).append(d).appendTo(c);let g=$("<input></input>",{type:"color",class:"nexInput",id:"nexPlayerColor",width:100,defaultValue:nexMap.styles.userPreferences.currentRoomColor,value:nexMap.styles.userPreferences.currentRoomColor}).on("change",function(){nexMap.styles.userPreferences.currentRoomColor=$(this)[0].value,cy.style().selector(".currentRoom").style({"border-color":$(this)[0].value}).update()}),u=$("<tr></tr>",{class:"nexRow",style:"cursor:pointer;color:dimgrey;"}).appendTo(n);$("<td></td>",{style:"color:grey"}).text("Current Room Color").appendTo(u),$("<td></td>",{style:"color:gainsboro;text-decoration:underline"}).append(g).appendTo(u),n.appendTo(e),e.dialog({title:"nexMap Configuration",width:400,close:function(){nexMap.settings.userPreferences.commandSeparator=$("#nexCommandSep")[0].value.toString(),nexMap.settings.userPreferences.duanatharCommand=$("#nexDuanathar")[0].value.toString(),nexMap.settings.userPreferences.duanatharanCommand=$("#nexDuanatharan")[0].value.toString(),nexMap.settings.save(),$(".nexInput").remove(),$(".nexMapDialog").parent().remove()}})};